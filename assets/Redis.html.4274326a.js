import{_ as r,r as t,o as d,c as p,b as a,a as n,F as l,e as i,d as e}from"./app.2a7ffa2e.js";const o={},h=i('<h2 id="\u57FA\u7840" tabindex="-1"><a class="header-anchor" href="#\u57FA\u7840" aria-hidden="true">#</a> \u57FA\u7840</h2><h3 id="_1-\u4EC0\u4E48\u662Fredis" tabindex="-1"><a class="header-anchor" href="#_1-\u4EC0\u4E48\u662Fredis" aria-hidden="true">#</a> 1. \u4EC0\u4E48\u662FRedis</h3><p>Redis(Remote Dictionary Server) \u662F\u4E00\u4E2A\u4F7F\u7528 C \u8BED\u8A00\u7F16\u5199\u7684\uFF0C\u5F00\u6E90\u7684\uFF08BSD\u8BB8\u53EF\uFF09\u9AD8\u6027\u80FD\u975E\u5173\u7CFB\u578B\uFF08NoSQL\uFF09\u7684\u952E\u503C\u5BF9\u6570\u636E\u5E93\u3002 Redis \u53EF\u4EE5\u5B58\u50A8\u952E\u548C\u4E94\u79CD\u4E0D\u540C\u7C7B\u578B\u7684\u503C\u4E4B\u95F4\u7684\u6620\u5C04\u3002\u952E\u7684\u7C7B\u578B\u53EA\u80FD\u4E3A\u5B57\u7B26\u4E32\uFF0C\u503C\u652F\u6301\u4E94\u79CD\u6570\u636E\u7C7B\u578B\uFF1A\u5B57\u7B26\u4E32\u3001\u5217\u8868\u3001\u96C6\u5408\u3001\u6563\u5217\u8868\u3001\u6709\u5E8F\u96C6\u5408\u3002 \u4E0E\u4F20\u7EDF\u6570\u636E\u5E93\u4E0D\u540C\u7684\u662F Redis \u7684\u6570\u636E\u662F\u5B58\u5728\u5185\u5B58\u4E2D\u7684\uFF0C\u6240\u4EE5\u8BFB\u5199\u901F\u5EA6\u975E\u5E38\u5FEB\uFF0C\u56E0\u6B64 redis \u88AB\u5E7F\u6CDB\u5E94\u7528\u4E8E\u7F13\u5B58\u65B9\u5411\uFF0C\u6BCF\u79D2\u53EF\u4EE5\u5904\u7406\u8D85\u8FC7 10\u4E07\u6B21\u8BFB\u5199\u64CD\u4F5C\uFF0C\u662F\u5DF2\u77E5\u6027\u80FD\u6700\u5FEB\u7684Key-Value DB\u3002\u53E6\u5916\uFF0CRedis \u4E5F\u7ECF\u5E38\u7528\u6765\u505A\u5206\u5E03\u5F0F\u9501\u3002\u9664\u6B64\u4E4B\u5916\uFF0CRedis \u652F\u6301\u4E8B\u52A1 \u3001\u6301\u4E45\u5316\u3001LUA\u811A\u672C\u3001LRU\u9A71\u52A8\u4E8B\u4EF6\u3001\u591A\u79CD\u96C6\u7FA4\u65B9\u6848\u3002</p><h3 id="_2-redis\u6709\u54EA\u4E9B\u4F18\u7F3A\u70B9" tabindex="-1"><a class="header-anchor" href="#_2-redis\u6709\u54EA\u4E9B\u4F18\u7F3A\u70B9" aria-hidden="true">#</a> 2. Redis\u6709\u54EA\u4E9B\u4F18\u7F3A\u70B9</h3><p>\u4F18\u70B9</p><ul><li>\u8BFB\u5199\u6027\u80FD\u4F18\u5F02\u3002</li><li>\u652F\u6301\u6570\u636E\u6301\u4E45\u5316\uFF0C\u652F\u6301AOF\u548CRDB\u4E24\u79CD\u6301\u4E45\u5316\u65B9\u5F0F\u3002</li><li>\u652F\u6301\u4E8B\u52A1\uFF0CRedis\u7684\u6240\u6709\u64CD\u4F5C\u90FD\u662F\u539F\u5B50\u6027\u7684\uFF0C\u540C\u65F6Redis\u8FD8\u652F\u6301\u5BF9\u51E0\u4E2A\u64CD\u4F5C\u5408\u5E76\u540E\u7684\u539F\u5B50\u6027\u6267\u884C\u3002</li><li>\u6570\u636E\u7ED3\u6784\u4E30\u5BCC\uFF0C\u9664\u4E86\u652F\u6301string\u7C7B\u578B\u7684value\u5916\u8FD8\u652F\u6301hash\u3001set\u3001zset\u3001list\u7B49\u6570\u636E\u7ED3\u6784\u3002</li><li>\u652F\u6301\u4E3B\u4ECE\u590D\u5236\uFF0C\u4E3B\u673A\u4F1A\u81EA\u52A8\u5C06\u6570\u636E\u540C\u6B65\u5230\u4ECE\u673A\uFF0C\u53EF\u4EE5\u8FDB\u884C\u8BFB\u5199\u5206\u79BB\u3002</li></ul><p>\u7F3A\u70B9</p><ul><li>\u6570\u636E\u5E93\u5BB9\u91CF\u53D7\u5230\u7269\u7406\u5185\u5B58\u7684\u9650\u5236\uFF0C\u4E0D\u80FD\u7528\u4F5C\u6D77\u91CF\u6570\u636E\u7684\u9AD8\u6027\u80FD\u8BFB\u5199\uFF0C\u56E0\u6B64Redis\u9002\u5408\u7684\u573A\u666F\u4E3B\u8981\u5C40\u9650\u5728\u8F83\u5C11\u6570\u636E\u91CF\u7684\u9AD8\u6027\u80FD\u64CD\u4F5C\u548C\u8FD0\u7B97\u4E0A\u3002</li><li>Redis \u4E0D\u5177\u5907\u81EA\u52A8\u5BB9\u9519\u548C\u6062\u590D\u529F\u80FD\uFF0C\u4E3B\u673A\u4ECE\u673A\u7684\u5B95\u673A\u90FD\u4F1A\u5BFC\u81F4\u524D\u7AEF\u90E8\u5206\u8BFB\u5199\u8BF7\u6C42\u5931\u8D25\uFF0C\u9700\u8981\u7B49\u5F85\u673A\u5668\u91CD\u542F\u6216\u8005\u624B\u52A8\u5207\u6362\u524D\u7AEF\u7684IP\u624D\u80FD\u6062\u590D\u3002</li><li>\u4E3B\u673A\u5B95\u673A\uFF0C\u5B95\u673A\u524D\u6709\u90E8\u5206\u6570\u636E\u672A\u80FD\u53CA\u65F6\u540C\u6B65\u5230\u4ECE\u673A\uFF0C\u5207\u6362IP\u540E\u8FD8\u4F1A\u5F15\u5165\u6570\u636E\u4E0D\u4E00\u81F4\u7684\u95EE\u9898\uFF0C\u964D\u4F4E\u4E86\u7CFB\u7EDF\u7684\u53EF\u7528\u6027\u3002</li><li>Redis \u8F83\u96BE\u652F\u6301\u5728\u7EBF\u6269\u5BB9\uFF0C\u5728\u96C6\u7FA4\u5BB9\u91CF\u8FBE\u5230\u4E0A\u9650\u65F6\u5728\u7EBF\u6269\u5BB9\u4F1A\u53D8\u5F97\u5F88\u590D\u6742\u3002\u4E3A\u907F\u514D\u8FD9\u4E00\u95EE\u9898\uFF0C\u8FD0\u7EF4\u4EBA\u5458\u5728\u7CFB\u7EDF\u4E0A\u7EBF\u65F6\u5FC5\u987B\u786E\u4FDD\u6709\u8DB3\u591F\u7684\u7A7A\u95F4\uFF0C\u8FD9\u5BF9\u8D44\u6E90\u9020\u6210\u4E86\u5F88\u5927\u7684\u6D6A\u8D39\u3002</li></ul><h3 id="_3-\u4E3A\u4EC0\u4E48\u8981\u7528-redis-\u4E3A\u4EC0\u4E48\u8981\u7528\u7F13\u5B58" tabindex="-1"><a class="header-anchor" href="#_3-\u4E3A\u4EC0\u4E48\u8981\u7528-redis-\u4E3A\u4EC0\u4E48\u8981\u7528\u7F13\u5B58" aria-hidden="true">#</a> 3. \u4E3A\u4EC0\u4E48\u8981\u7528 Redis /\u4E3A\u4EC0\u4E48\u8981\u7528\u7F13\u5B58</h3><p>\u4E3B\u8981\u4ECE\u201C\u9AD8\u6027\u80FD\u201D\u548C\u201C\u9AD8\u5E76\u53D1\u201D\u8FD9\u4E24\u70B9\u6765\u770B\u5F85\u8FD9\u4E2A\u95EE\u9898\u3002</p><h4 id="\u9AD8\u6027\u80FD" tabindex="-1"><a class="header-anchor" href="#\u9AD8\u6027\u80FD" aria-hidden="true">#</a> \u9AD8\u6027\u80FD\uFF1A</h4><p>\u5047\u5982\u7528\u6237\u7B2C\u4E00\u6B21\u8BBF\u95EE\u6570\u636E\u5E93\u4E2D\u7684\u67D0\u4E9B\u6570\u636E\u3002\u8FD9\u4E2A\u8FC7\u7A0B\u4F1A\u6BD4\u8F83\u6162\uFF0C\u56E0\u4E3A\u662F\u4ECE\u786C\u76D8\u4E0A\u8BFB\u53D6\u7684\u3002\u5C06\u8BE5\u7528\u6237\u8BBF\u95EE\u7684\u6570\u636E\u5B58\u5728\u6570\u7F13\u5B58\u4E2D\uFF0C\u8FD9\u6837\u4E0B\u4E00\u6B21\u518D\u8BBF\u95EE\u8FD9\u4E9B\u6570\u636E\u7684\u65F6\u5019\u5C31\u53EF\u4EE5\u76F4\u63A5\u4ECE\u7F13\u5B58\u4E2D\u83B7\u53D6\u4E86\u3002\u64CD\u4F5C\u7F13\u5B58\u5C31\u662F\u76F4\u63A5\u64CD\u4F5C\u5185\u5B58\uFF0C\u6240\u4EE5\u901F\u5EA6\u76F8\u5F53\u5FEB\u3002\u5982\u679C\u6570\u636E\u5E93\u4E2D\u7684\u5BF9\u5E94\u6570\u636E\u6539\u53D8\u7684\u4E4B\u540E\uFF0C\u540C\u6B65\u6539\u53D8\u7F13\u5B58\u4E2D\u76F8\u5E94\u7684\u6570\u636E\u5373\u53EF\uFF01</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2517043/1599814692827-ab87ea77-73fb-4429-9e7e-1ccd27ffce34.png#averageHue=%23f7f7f7&amp;height=468&amp;id=Jvfg0&amp;originHeight=936&amp;originWidth=1462&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=183239&amp;status=done&amp;style=none&amp;title=&amp;width=731" alt="image.png"></p><h4 id="\u9AD8\u5E76\u53D1" tabindex="-1"><a class="header-anchor" href="#\u9AD8\u5E76\u53D1" aria-hidden="true">#</a> \u9AD8\u5E76\u53D1\uFF1A</h4><p>\u76F4\u63A5\u64CD\u4F5C\u7F13\u5B58\u80FD\u591F\u627F\u53D7\u7684\u8BF7\u6C42\u662F\u8FDC\u8FDC\u5927\u4E8E\u76F4\u63A5\u8BBF\u95EE\u6570\u636E\u5E93\u7684\uFF0C\u6240\u4EE5\u6211\u4EEC\u53EF\u4EE5\u8003\u8651\u628A\u6570\u636E\u5E93\u4E2D\u7684\u90E8\u5206\u6570\u636E\u8F6C\u79FB\u5230\u7F13\u5B58\u4E2D\u53BB\uFF0C\u8FD9\u6837\u7528\u6237\u7684\u4E00\u90E8\u5206\u8BF7\u6C42\u4F1A\u76F4\u63A5\u5230\u7F13\u5B58\u8FD9\u91CC\u800C\u4E0D\u7528\u7ECF\u8FC7\u6570\u636E\u5E93\u3002 <img src="https://cdn.nlark.com/yuque/0/2020/png/2517043/1599814715490-af3bc054-5452-4fee-824a-07ddceef6f44.png#averageHue=%23f9f9f9&amp;height=472&amp;id=con63&amp;originHeight=944&amp;originWidth=1326&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=140054&amp;status=done&amp;style=none&amp;title=&amp;width=663" alt="image.png"></p><h3 id="_4-\u4E3A\u4EC0\u4E48\u8981\u7528-redis-\u800C\u4E0D\u7528-map-guava-\u505A\u7F13\u5B58" tabindex="-1"><a class="header-anchor" href="#_4-\u4E3A\u4EC0\u4E48\u8981\u7528-redis-\u800C\u4E0D\u7528-map-guava-\u505A\u7F13\u5B58" aria-hidden="true">#</a> 4. \u4E3A\u4EC0\u4E48\u8981\u7528 Redis \u800C\u4E0D\u7528 map/guava \u505A\u7F13\u5B58?</h3><p>\u7F13\u5B58\u5206\u4E3A\u672C\u5730\u7F13\u5B58\u548C\u5206\u5E03\u5F0F\u7F13\u5B58\u3002\u6BD4\u5982\u8BF4\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528\u5168\u5C40 map \u5B9E\u73B0\u672C\u5730\u7F13\u5B58\u3002\u672C\u5730\u7F13\u5B58\u591A\u5B9E\u4F8B\u7684\u60C5\u51B5\u4E0B\uFF0C\u6BCF\u4E2A\u5B9E\u4F8B\u90FD\u9700\u8981\u5404\u81EA\u4FDD\u5B58\u4E00\u4EFD\u7F13\u5B58\uFF0C\u7F13\u5B58\u4E0D\u5177\u6709\u4E00\u81F4\u6027\u3002 \u4F7F\u7528 redis \u6216 memcached \u4E4B\u7C7B\u7684\u79F0\u4E3A\u5206\u5E03\u5F0F\u7F13\u5B58\uFF0C\u5728\u591A\u5B9E\u4F8B\u7684\u60C5\u51B5\u4E0B\uFF0C\u5404\u5B9E\u4F8B\u5171\u7528\u4E00\u4EFD\u7F13\u5B58\u6570\u636E\uFF0C\u7F13\u5B58\u5177\u6709\u4E00\u81F4\u6027\u3002\u7F3A\u70B9\u662F\u9700\u8981\u4FDD\u6301 redis \u6216 memcached\u670D\u52A1\u7684\u9AD8\u53EF\u7528\uFF0C\u6574\u4E2A\u7A0B\u5E8F\u67B6\u6784\u4E0A\u8F83\u4E3A\u590D\u6742\u3002</p><h3 id="_5-redis\u4E0Ememcached\u7684\u533A\u522B" tabindex="-1"><a class="header-anchor" href="#_5-redis\u4E0Ememcached\u7684\u533A\u522B" aria-hidden="true">#</a> 5. Redis\u4E0EMemcached\u7684\u533A\u522B</h3><p>\u4E24\u8005\u90FD\u662F\u975E\u5173\u7CFB\u578B\u5185\u5B58\u952E\u503C\u6570\u636E\u5E93\uFF0C\u73B0\u5728\u516C\u53F8\u4E00\u822C\u90FD\u662F\u7528 Redis \u6765\u5B9E\u73B0\u7F13\u5B58\uFF0C\u800C\u4E14 Redis \u81EA\u8EAB\u4E5F\u8D8A\u6765\u8D8A\u5F3A\u5927\u4E86\uFF01Redis \u4E0E Memcached \u4E3B\u8981\u6709\u4EE5\u4E0B\u4E0D\u540C\uFF1A <img src="https://cdn.nlark.com/yuque/0/2020/png/2517043/1599815168248-fee4eb66-06eb-4cee-b455-3149f6f8c57b.png#averageHue=%23f5f5f5&amp;height=801&amp;id=UDNU0&amp;originHeight=1602&amp;originWidth=1976&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=333505&amp;status=done&amp;style=none&amp;title=&amp;width=988" alt="image.png"> (1) memcached\u6240\u6709\u7684\u503C\u5747\u662F\u7B80\u5355\u7684\u5B57\u7B26\u4E32\uFF0Credis\u4F5C\u4E3A\u5176\u66FF\u4EE3\u8005\uFF0C\u652F\u6301\u66F4\u4E3A\u4E30\u5BCC\u7684\u6570\u636E\u7C7B\u578B (2) redis\u7684\u901F\u5EA6\u6BD4memcached\u5FEB\u5F88\u591A (3) redis\u53EF\u4EE5\u6301\u4E45\u5316\u5176\u6570\u636E</p><h3 id="_6-redis\u4E3A\u4EC0\u4E48\u8FD9\u4E48\u5FEB" tabindex="-1"><a class="header-anchor" href="#_6-redis\u4E3A\u4EC0\u4E48\u8FD9\u4E48\u5FEB" aria-hidden="true">#</a> 6. Redis\u4E3A\u4EC0\u4E48\u8FD9\u4E48\u5FEB</h3><p>1\u3001\u5B8C\u5168\u57FA\u4E8E\u5185\u5B58\uFF0C\u7EDD\u5927\u90E8\u5206\u8BF7\u6C42\u662F\u7EAF\u7CB9\u7684\u5185\u5B58\u64CD\u4F5C\uFF0C\u975E\u5E38\u5FEB\u901F\u3002\u6570\u636E\u5B58\u5728\u5185\u5B58\u4E2D\uFF0C\u7C7B\u4F3C\u4E8E HashMap\uFF0CHashMap \u7684\u4F18\u52BF\u5C31\u662F\u67E5\u627E\u548C\u64CD\u4F5C\u7684\u65F6\u95F4\u590D\u6742\u5EA6\u90FD\u662FO(1)\uFF1B 2\u3001\u6570\u636E\u7ED3\u6784\u7B80\u5355\uFF0C\u5BF9\u6570\u636E\u64CD\u4F5C\u4E5F\u7B80\u5355\uFF0CRedis \u4E2D\u7684\u6570\u636E\u7ED3\u6784\u662F\u4E13\u95E8\u8FDB\u884C\u8BBE\u8BA1\u7684\uFF1B 3\u3001\u91C7\u7528\u5355\u7EBF\u7A0B\uFF0C\u907F\u514D\u4E86\u4E0D\u5FC5\u8981\u7684\u4E0A\u4E0B\u6587\u5207\u6362\u548C\u7ADE\u4E89\u6761\u4EF6\uFF0C\u4E5F\u4E0D\u5B58\u5728\u591A\u8FDB\u7A0B\u6216\u8005\u591A\u7EBF\u7A0B\u5BFC\u81F4\u7684\u5207\u6362\u800C\u6D88\u8017 CPU\uFF0C\u4E0D\u7528\u53BB\u8003\u8651\u5404\u79CD\u9501\u7684\u95EE\u9898\uFF0C\u4E0D\u5B58\u5728\u52A0\u9501\u91CA\u653E\u9501\u64CD\u4F5C\uFF0C\u6CA1\u6709\u56E0\u4E3A\u53EF\u80FD\u51FA\u73B0\u6B7B\u9501\u800C\u5BFC\u81F4\u7684\u6027\u80FD\u6D88\u8017\uFF1B 4\u3001\u4F7F\u7528\u591A\u8DEF I/O \u590D\u7528\u6A21\u578B\uFF0C\u975E\u963B\u585E IO\uFF1B 5\u3001\u4F7F\u7528\u5E95\u5C42\u6A21\u578B\u4E0D\u540C\uFF0C\u5B83\u4EEC\u4E4B\u95F4\u5E95\u5C42\u5B9E\u73B0\u65B9\u5F0F\u4EE5\u53CA\u4E0E\u5BA2\u6237\u7AEF\u4E4B\u95F4\u901A\u4FE1\u7684\u5E94\u7528\u534F\u8BAE\u4E0D\u4E00\u6837\uFF0CRedis \u76F4\u63A5\u81EA\u5DF1\u6784\u5EFA\u4E86 VM \u673A\u5236 \uFF0C\u56E0\u4E3A\u4E00\u822C\u7684\u7CFB\u7EDF\u8C03\u7528\u7CFB\u7EDF\u51FD\u6570\u7684\u8BDD\uFF0C\u4F1A\u6D6A\u8D39\u4E00\u5B9A\u7684\u65F6\u95F4\u53BB\u79FB\u52A8\u548C\u8BF7\u6C42\uFF1B</p><h2 id="\u6570\u636E\u7C7B\u578B" tabindex="-1"><a class="header-anchor" href="#\u6570\u636E\u7C7B\u578B" aria-hidden="true">#</a> \u6570\u636E\u7C7B\u578B</h2><h3 id="_1-redis\u6709\u54EA\u4E9B\u6570\u636E\u7C7B\u578B" tabindex="-1"><a class="header-anchor" href="#_1-redis\u6709\u54EA\u4E9B\u6570\u636E\u7C7B\u578B" aria-hidden="true">#</a> 1. Redis\u6709\u54EA\u4E9B\u6570\u636E\u7C7B\u578B</h3><p>Redis\u4E3B\u8981\u67095\u79CD\u6570\u636E\u7C7B\u578B\uFF0C\u5305\u62EC String\uFF0CList\uFF0CSet\uFF0CZset\uFF0CHash\uFF0C\u6EE1\u8DB3\u5927\u90E8\u5206\u7684\u4F7F\u7528\u8981\u6C42 <img src="https://cdn.nlark.com/yuque/0/2020/png/2517043/1599814750947-71ddb599-5f32-40bf-ad09-861b8cd4b173.png#averageHue=%23f4f4f4&amp;height=518&amp;id=k9REZ&amp;originHeight=1036&amp;originWidth=1984&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=237323&amp;status=done&amp;style=none&amp;title=&amp;width=992" alt="image.png"></p><h3 id="_2-redis\u7684\u5E94\u7528\u573A\u666F" tabindex="-1"><a class="header-anchor" href="#_2-redis\u7684\u5E94\u7528\u573A\u666F" aria-hidden="true">#</a> 2. Redis\u7684\u5E94\u7528\u573A\u666F</h3><h4 id="_2-1-\u5206\u5E03\u5F0F\u8BA1\u6570\u5668" tabindex="-1"><a class="header-anchor" href="#_2-1-\u5206\u5E03\u5F0F\u8BA1\u6570\u5668" aria-hidden="true">#</a> 2.1 \u5206\u5E03\u5F0F\u8BA1\u6570\u5668</h4><p>\u53EF\u4EE5\u5BF9 String \u8FDB\u884C\u81EA\u589E\u81EA\u51CF\u8FD0\u7B97\uFF0C\u4ECE\u800C\u5B9E\u73B0\u8BA1\u6570\u5668\u529F\u80FD\u3002Redis \u8FD9\u79CD\u5185\u5B58\u578B\u6570\u636E\u5E93\u7684\u8BFB\u5199\u6027\u80FD\u975E\u5E38\u9AD8\uFF0C\u5F88\u9002\u5408\u5B58\u50A8\u9891\u7E41\u8BFB\u5199\u7684\u8BA1\u6570\u91CF\u3002</p><h4 id="_2-2-\u7F13\u5B58" tabindex="-1"><a class="header-anchor" href="#_2-2-\u7F13\u5B58" aria-hidden="true">#</a> 2.2 \u7F13\u5B58</h4><p>\u5C06\u70ED\u70B9\u6570\u636E\u653E\u5230\u5185\u5B58\u4E2D\uFF0C\u8BBE\u7F6E\u5185\u5B58\u7684\u6700\u5927\u4F7F\u7528\u91CF\u4EE5\u53CA\u6DD8\u6C70\u7B56\u7565\u6765\u4FDD\u8BC1\u7F13\u5B58\u7684\u547D\u4E2D\u7387\u3002</p><h4 id="_2-3-\u4F1A\u8BDD\u7F13\u5B58" tabindex="-1"><a class="header-anchor" href="#_2-3-\u4F1A\u8BDD\u7F13\u5B58" aria-hidden="true">#</a> 2.3 \u4F1A\u8BDD\u7F13\u5B58</h4><p>\u53EF\u4EE5\u4F7F\u7528 Redis \u6765\u7EDF\u4E00\u5B58\u50A8\u591A\u53F0\u5E94\u7528\u670D\u52A1\u5668\u7684\u4F1A\u8BDD\u4FE1\u606F\u3002\u5F53\u5E94\u7528\u670D\u52A1\u5668\u4E0D\u518D\u5B58\u50A8\u7528\u6237\u7684\u4F1A\u8BDD\u4FE1\u606F\uFF0C\u4E5F\u5C31\u4E0D\u518D\u5177\u6709\u72B6\u6001\uFF0C\u4E00\u4E2A\u7528\u6237\u53EF\u4EE5\u8BF7\u6C42\u4EFB\u610F\u4E00\u4E2A\u5E94\u7528\u670D\u52A1\u5668\uFF0C\u4ECE\u800C\u66F4\u5BB9\u6613\u5B9E\u73B0\u9AD8\u53EF\u7528\u6027\u4EE5\u53CA\u53EF\u4F38\u7F29\u6027\u3002 \u67E5\u627E\u8868 \u4F8B\u5982 DNS \u8BB0\u5F55\u5C31\u5F88\u9002\u5408\u4F7F\u7528 Redis \u8FDB\u884C\u5B58\u50A8\u3002\u67E5\u627E\u8868\u548C\u7F13\u5B58\u7C7B\u4F3C\uFF0C\u4E5F\u662F\u5229\u7528\u4E86 Redis \u5FEB\u901F\u7684\u67E5\u627E\u7279\u6027\u3002\u4F46\u662F\u67E5\u627E\u8868\u7684\u5185\u5BB9\u4E0D\u80FD\u5931\u6548\uFF0C\u800C\u7F13\u5B58\u7684\u5185\u5BB9\u53EF\u4EE5\u5931\u6548\uFF0C\u56E0\u4E3A\u7F13\u5B58\u4E0D\u4F5C\u4E3A\u53EF\u9760\u7684\u6570\u636E\u6765\u6E90\u3002</p><h4 id="_2-4-\u6D88\u606F\u961F\u5217-\u53D1\u5E03-\u8BA2\u9605\u529F\u80FD" tabindex="-1"><a class="header-anchor" href="#_2-4-\u6D88\u606F\u961F\u5217-\u53D1\u5E03-\u8BA2\u9605\u529F\u80FD" aria-hidden="true">#</a> 2.4 \u6D88\u606F\u961F\u5217(\u53D1\u5E03/\u8BA2\u9605\u529F\u80FD)</h4><p>List \u662F\u4E00\u4E2A\u53CC\u5411\u94FE\u8868\uFF0C\u53EF\u4EE5\u901A\u8FC7 lpush \u548C rpop \u5199\u5165\u548C\u8BFB\u53D6\u6D88\u606F\u3002\u4E0D\u8FC7\u6700\u597D\u4F7F\u7528 Kafka\u3001RabbitMQ \u7B49\u6D88\u606F\u4E2D\u95F4\u4EF6\u3002</p><h4 id="_2-5-\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_2-5-\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0" aria-hidden="true">#</a> 2.5 \u5206\u5E03\u5F0F\u9501\u5B9E\u73B0</h4><p>\u5728\u5206\u5E03\u5F0F\u573A\u666F\u4E0B\uFF0C\u65E0\u6CD5\u4F7F\u7528\u5355\u673A\u73AF\u5883\u4E0B\u7684\u9501\u6765\u5BF9\u591A\u4E2A\u8282\u70B9\u4E0A\u7684\u8FDB\u7A0B\u8FDB\u884C\u540C\u6B65\u3002\u53EF\u4EE5\u4F7F\u7528 Redis \u81EA\u5E26\u7684 SETNX \u547D\u4EE4\u5B9E\u73B0\u5206\u5E03\u5F0F\u9501\uFF0C\u9664\u6B64\u4E4B\u5916\uFF0C\u8FD8\u53EF\u4EE5\u4F7F\u7528\u5B98\u65B9\u63D0\u4F9B\u7684 RedLock \u5206\u5E03\u5F0F\u9501\u5B9E\u73B0\u3002</p><h4 id="_2-6-\u5176\u5B83" tabindex="-1"><a class="header-anchor" href="#_2-6-\u5176\u5B83" aria-hidden="true">#</a> 2.6 \u5176\u5B83</h4><p>Set \u53EF\u4EE5\u5B9E\u73B0\u4EA4\u96C6\u3001\u5E76\u96C6\u7B49\u64CD\u4F5C\uFF0C\u4ECE\u800C\u5B9E\u73B0\u5171\u540C\u597D\u53CB\u7B49\u529F\u80FD\u3002ZSet \u53EF\u4EE5\u5B9E\u73B0\u6709\u5E8F\u6027\u64CD\u4F5C\uFF0C\u4ECE\u800C\u5B9E\u73B0\u6392\u884C\u699C\u7B49\u529F\u80FD\u3002</p><h2 id="redis-\u7684\u6570\u636E\u7C7B\u578B\u7684\u5E95\u5C42\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#redis-\u7684\u6570\u636E\u7C7B\u578B\u7684\u5E95\u5C42\u5B9E\u73B0" aria-hidden="true">#</a> Redis \u7684\u6570\u636E\u7C7B\u578B\u7684\u5E95\u5C42\u5B9E\u73B0</h2><h3 id="_0-\u6570\u636E\u7C7B\u578B\u7684\u5E95\u5C42\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_0-\u6570\u636E\u7C7B\u578B\u7684\u5E95\u5C42\u5B9E\u73B0" aria-hidden="true">#</a> 0. \u6570\u636E\u7C7B\u578B\u7684\u5E95\u5C42\u5B9E\u73B0</h3><h4 id="_0-1-string-\u7684\u5E95\u5C42\u5B9E\u73B0\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_0-1-string-\u7684\u5E95\u5C42\u5B9E\u73B0\u539F\u7406" aria-hidden="true">#</a> 0.1. String \u7684\u5E95\u5C42\u5B9E\u73B0\u539F\u7406</h4><p>String \u4E3B\u8981\u6709\u4E09\u79CD\u7F16\u7801\u65B9\u5F0F\uFF1A<code>int\u3001embstr\u3001raw</code>\uFF0C\u5F53\u5B57\u7B26\u4E32\u662F\u4E00\u4E2A\u53EF\u4EE5\u7528\u957F\u6574\u578B\uFF0864\u4F4D\u6709\u7B26\u53F7\u6574\u6570\uFF09\u8868\u793A\u7684\u65F6\u5019\uFF0C\u91C7\u7528 <code>int</code>\u7F16\u7801\uFF1B\u5F53\u5B57\u7B26\u4E32\u957F\u5EA6\u5C0F\u4E8E45\u5B57\u8282\u65F6(<code>redis5</code>)\uFF0C\u91C7\u7528 <code>embstr</code>\u7F16\u7801\uFF0C\u5176\u4F59\u60C5\u51B5\u4F7F\u7528 <code>raw</code>\u7F16\u7801\u3002</p><h5 id="int" tabindex="-1"><a class="header-anchor" href="#int" aria-hidden="true">#</a> int</h5><p>Redis \u542F\u52A8\u65F6\u4F1A\u9884\u5148\u5EFA\u7ACB <strong>10000</strong> \u4E2A\u5206\u522B\u5B58\u50A8 <strong>0~9999</strong> \u7684 redisObject \u53D8\u91CF\u4F5C\u4E3A\u5171\u4EAB\u5BF9\u8C61\uFF0C\u8FD9\u5C31\u610F\u5473\u7740\u5982\u679C set\u5B57\u7B26\u4E32\u7684\u952E\u503C\u5728 0~10000 \u4E4B\u95F4\u7684\u8BDD\uFF0C\u5219\u53EF\u4EE5 <strong>\u76F4\u63A5\u6307\u5411\u5171\u4EAB\u5BF9\u8C61</strong> \u800C\u4E0D\u9700\u8981\u518D\u5EFA\u7ACB\u65B0\u5BF9\u8C61\uFF0C\u6B64\u65F6\u952E\u503C\u4E0D\u5360\u7A7A\u95F4\uFF01 <img src="https://cdn.nlark.com/yuque/0/2023/webp/21883277/1676997500311-de7356af-43af-45c2-8102-62b3e3c35ca8.webp#averageHue=%23474221&amp;clientId=ua1617796-c383-4&amp;from=paste&amp;id=B6rGL&amp;originHeight=592&amp;originWidth=792&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u5e6b1c38-a85b-4aae-8c2d-ba0bae7a1b8&amp;title=" alt=""></p><h5 id="embstr" tabindex="-1"><a class="header-anchor" href="#embstr" aria-hidden="true">#</a> embstr</h5><p>\u987E\u540D\u601D\u4E49\u5373\uFF1A<strong>embedded string</strong>\uFF0C\u8868\u793A\u5D4C\u5165\u5F0F\u7684String\u3002\u4ECE\u5185\u5B58\u7ED3\u6784\u4E0A\u770B\u662F\u5B57\u7B26\u4E32 sds\u7ED3\u6784\u4F53\u4E0E\u5176\u5BF9\u5E94\u7684 redisObject \u5BF9\u8C61\u5206\u914D\u5728 <strong>\u540C\u4E00\u5757\u8FDE\u7EED\u7684\u5185\u5B58\u7A7A\u95F4</strong>\uFF0C\u8FD9\u5C31\u4EFF\u4F5B\u5B57\u7B26\u4E32 sds \u5D4C\u5165\u5728 redisObject \u5BF9\u8C61\u4E4B\u4E2D\u4E00\u6837\uFF0C\u8FD9\u4E00\u5207\u4ECE\u4E0B\u9762\u7684\u4EE3\u7801\u5373\u53EF\u6E05\u695A\u5730\u770B\u5230\uFF1A <img src="https://cdn.nlark.com/yuque/0/2023/webp/21883277/1676997513685-13eff625-0881-49ec-80cb-68ae4c1ffcd6.webp#averageHue=%233f4023&amp;clientId=ua1617796-c383-4&amp;from=paste&amp;id=G27ah&amp;originHeight=332&amp;originWidth=798&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u768978e6-3b9b-4d07-b96f-3e2fa5a1e3f&amp;title=" alt=""></p><h5 id="raw" tabindex="-1"><a class="header-anchor" href="#raw" aria-hidden="true">#</a> raw</h5><p>\u4E0E\u4E0A\u9762\u7684 OBJ_ENCODING_EMBSTR \u7F16\u7801\u65B9\u5F0F\u7684\u4E0D\u540C\u4E4B\u5904\u5728\u4E8E \u6B64\u65F6\u52A8\u6001\u5B57\u7B26\u4E32 sds \u7684\u5185\u5B58\u4E0E\u5176\u4F9D\u8D56\u7684 redisObject \u7684 <strong>\u5185\u5B58\u4E0D\u518D\u8FDE\u7EED\uFF0C\u9700\u8981\u7533\u8BF7\u4E24\u6B21\u5185\u5B58\u3002</strong></p><h4 id="_0-2-\u5217\u8868\u7684\u5E95\u5C42\u5B9E\u73B0\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_0-2-\u5217\u8868\u7684\u5E95\u5C42\u5B9E\u73B0\u539F\u7406" aria-hidden="true">#</a> 0.2. \u5217\u8868\u7684\u5E95\u5C42\u5B9E\u73B0\u539F\u7406</h4><p>\u5217\u8868\u5BF9\u8C61\u7684\u7F16\u7801\u6709\u4E24\u79CD\uFF0C\u5206\u522B\u662F\uFF1Aziplist\u3001linkedlist\u3002 \u5F53\u5217\u8868\u7684\u957F\u5EA6\u5C0F\u4E8E 512\uFF0C\u5E76\u4E14\u6240\u6709\u5143\u7D20\u7684\u957F\u5EA6\u90FD\u5C0F\u4E8E 64 \u5B57\u8282\u65F6\uFF0C\u4F7F\u7528\u538B\u7F29\u5217\u8868\u5B58\u50A8\uFF1B\u5426\u5219\u4F7F\u7528 linkedlist \u5B58\u50A8\u3002</p><h4 id="_0-3-\u5B57\u5178\u7684\u5E95\u5C42\u5B9E\u73B0\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_0-3-\u5B57\u5178\u7684\u5E95\u5C42\u5B9E\u73B0\u539F\u7406" aria-hidden="true">#</a> 0.3. \u5B57\u5178\u7684\u5E95\u5C42\u5B9E\u73B0\u539F\u7406</h4><p>\u54C8\u5E0C\u5BF9\u8C61\u7684\u7F16\u7801\u6709\u4E24\u79CD\uFF0C\u5206\u522B\u662F\uFF1Aziplist\u3001hashtable\u3002 \u5F53\u54C8\u5E0C\u5BF9\u8C61\u4FDD\u5B58\u7684\u952E\u503C\u5BF9\u6570\u91CF\u5C0F\u4E8E 512\uFF0C\u5E76\u4E14\u6240\u6709\u952E\u503C\u5BF9\u7684\u957F\u5EA6\u90FD\u5C0F\u4E8E 64 \u5B57\u8282\u65F6\uFF0C\u4F7F\u7528\u538B\u7F29\u5217\u8868\u5B58\u50A8\uFF1B\u5426\u5219\u4F7F\u7528 hashtable \u5B58\u50A8\u3002</p><h4 id="_0-4-\u96C6\u5408\u7684\u5E95\u5C42\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_0-4-\u96C6\u5408\u7684\u5E95\u5C42\u5B9E\u73B0" aria-hidden="true">#</a> 0.4. \u96C6\u5408\u7684\u5E95\u5C42\u5B9E\u73B0</h4><p>\u96C6\u5408\u5BF9\u8C61\u7684\u7F16\u7801\u6709\u4E24\u79CD\uFF0C\u5206\u522B\u662F\uFF1Aintset\u3001hashtable\u3002 \u5F53\u96C6\u5408\u7684\u957F\u5EA6\u5C0F\u4E8E\u67D0\u4E2A\u7279\u5B9A\u503C\uFF0C\u5E76\u4E14\u6240\u6709\u5143\u7D20\u90FD\u662F\u6574\u6570\u65F6\uFF0C\u4F7F\u7528\u6574\u6570\u96C6\u5408\u5B58\u50A8\uFF1B\u5426\u5219\u4F7F\u7528 hashtable \u5B58\u50A8\u3002</p><h4 id="_0-5-\u6709\u5E8F\u96C6\u5408\u7684\u5E95\u5C42\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_0-5-\u6709\u5E8F\u96C6\u5408\u7684\u5E95\u5C42\u5B9E\u73B0" aria-hidden="true">#</a> 0.5. \u6709\u5E8F\u96C6\u5408\u7684\u5E95\u5C42\u5B9E\u73B0</h4><p>\u6709\u5E8F\u96C6\u5408\u5BF9\u8C61\u7684\u7F16\u7801\u6709\u4E24\u79CD\uFF0C\u5206\u522B\u662F\uFF1Aziplist\u3001skiplist\u3002 \u5F53\u6709\u5E8F\u96C6\u5408\u7684\u957F\u5EA6\u5C0F\u4E8E\u67D0\u4E2A\u7279\u5B9A\u503C\uFF0C\u5E76\u4E14\u6240\u6709\u5143\u7D20\u7684\u957F\u5EA6\u90FD\u5C0F\u4E8E 64 \u5B57\u8282\u65F6\uFF0C\u4F7F\u7528\u538B\u7F29\u5217\u8868\u5B58\u50A8\uFF1B\u5426\u5219\u4F7F\u7528 skiplist \u5B58\u50A8\u3002</p><h3 id="_1-\u8BF4\u4E00\u8BF4-redis-\u7684\u5E95\u5C42\u6570\u636E\u7ED3\u6784" tabindex="-1"><a class="header-anchor" href="#_1-\u8BF4\u4E00\u8BF4-redis-\u7684\u5E95\u5C42\u6570\u636E\u7ED3\u6784" aria-hidden="true">#</a> 1. \u8BF4\u4E00\u8BF4 redis \u7684\u5E95\u5C42\u6570\u636E\u7ED3\u6784</h3><p>Redis\u6709<strong>\u52A8\u6001\u5B57\u7B26\u4E32(sds)</strong>\u3001<strong>\u94FE\u8868(list)</strong>\u3001<strong>\u5B57\u5178(ht)</strong>\u3001<strong>\u8DF3\u8DC3\u8868(skiplist)</strong>\u3001<strong>\u6574\u6570\u96C6\u5408(intset)</strong>\u3001<strong>\u538B\u7F29\u5217\u8868(ziplist)</strong> \u7B49\u5E95\u5C42\u6570\u636E\u7ED3\u6784\u3002 Redis\u5E76\u6CA1\u6709\u4F7F\u7528\u8FD9\u4E9B\u6570\u636E\u7ED3\u6784\u6765\u76F4\u63A5\u5B9E\u73B0\u952E\u503C\u5BF9\u6570\u636E\u5E93\uFF0C\u800C\u662F\u57FA\u4E8E\u8FD9\u4E9B\u6570\u636E\u7ED3\u6784\u521B\u5EFA\u4E86\u4E00\u4E2A\u5BF9\u8C61\u7CFB\u7EDF\uFF0C\u6765\u8868\u793A\u6240\u6709\u7684key-value\u3002 <img src="https://cdn.nlark.com/yuque/0/2022/png/21883277/1663306421058-bbd5362e-8f2b-4ccb-a7f0-bb478afda85c.png#averageHue=%23fcfaf8&amp;clientId=ucf814711-336e-4&amp;errorMessage=unknown error&amp;from=paste&amp;id=u00c77620&amp;originHeight=563&amp;originWidth=1151&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=error&amp;style=none&amp;taskId=ud7f533cf-7233-475c-b577-9de6c5c2418&amp;title=" alt=""> \u6211\u4EEC\u5E38\u7528\u7684\u6570\u636E\u7C7B\u578B\u548C\u7F16\u7801\u5BF9\u5E94\u7684\u6620\u5C04\u5173\u7CFB\uFF1A <img src="https://cdn.nlark.com/yuque/0/2022/png/21883277/1663306421241-72e26e66-7374-4f78-a39f-bbc5c8f83fc7.png#averageHue=%23fdfaf8&amp;clientId=ucf814711-336e-4&amp;errorMessage=unknown error&amp;from=paste&amp;id=u7531b8c5&amp;originHeight=561&amp;originWidth=875&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=error&amp;style=none&amp;taskId=u0f696392-8a7d-43a8-9767-12d84161853&amp;title=" alt=""></p><h4 id="_1-1-\u5B57\u7B26\u4E32" tabindex="-1"><a class="header-anchor" href="#_1-1-\u5B57\u7B26\u4E32" aria-hidden="true">#</a> 1.1 \u5B57\u7B26\u4E32</h4><p>redis \u6CA1\u6709\u76F4\u63A5\u4F7F\u2F64 C \u8BED\u2F94\u4F20\u7EDF\u7684\u5B57\u7B26\u4E32\u8868\u793A\uFF0C\u2F7D\u662F\u2F83\u2F30\u5B9E\u73B0\u7684\u53EB\u505A\u7B80\u5355\u52A8\u6001\u5B57\u7B26\u4E32SDS\u7684\u62BD\u8C61\u7C7B\u578B\u3002C \u8BED\u2F94\u7684\u5B57\u7B26\u4E32\u4E0D\u8BB0\u5F55\u2F83\u8EAB\u7684\u2ED3\u5EA6\u4FE1\u606F\uFF0C\u2F7D SDS \u5219\u4FDD\u5B58\u4E86\u2ED3\u5EA6\u4FE1\u606F\uFF0C\u8FD9\u6837\u5C06\u83B7\u53D6\u5B57\u7B26\u4E32\u2ED3\u5EA6\u7684\u65F6\u95F4\u7531 O(N) \u964D\u4F4E\u5230\u4E86 O(1)\uFF0C\u540C\u65F6\u53EF\u4EE5\u907F\u514D\u7F13\u51B2\u533A\u6EA2\u51FA\u548C\u51CF\u5C11\u4FEE\u6539\u5B57\u7B26\u4E32\u2ED3\u5EA6\u65F6\u6240\u9700\u7684\u5185\u5B58\u91CD\u5206\u914D\u6B21\u6570\u3002 <img src="https://cdn.nlark.com/yuque/0/2022/png/21883277/1663306483493-cb725a20-f934-40ae-b1b5-dd5e835676aa.png#averageHue=%23cecdcd&amp;clientId=ucf814711-336e-4&amp;errorMessage=unknown error&amp;from=paste&amp;id=u83824978&amp;originHeight=438&amp;originWidth=655&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=error&amp;style=none&amp;taskId=u97b0b738-c6ac-4bef-9cbf-8709b1f9084&amp;title=" alt=""></p><h4 id="_1-2-\u94FE\u8868linkedlist" tabindex="-1"><a class="header-anchor" href="#_1-2-\u94FE\u8868linkedlist" aria-hidden="true">#</a> 1.2 <strong>\u94FE\u8868linkedlist</strong></h4><p>redis \u94FE\u8868\u662F\u2F00\u4E2A\u53CC\u5411\u2F46\u73AF\u94FE\u8868\u7ED3\u6784\uFF0C\u6BCF\u4E2A\u94FE\u8868\u7684\u8282\u70B9\u7531\u2F00\u4E2A listNode \u7ED3\u6784\u6765\u8868\u793A\uFF0C\u6BCF\u4E2A\u8282\u70B9\u90FD\u6709\u6307\u5411\u524D\u7F6E\u8282\u70B9\u548C\u540E\u7F6E\u8282\u70B9\u7684\u6307\u9488\uFF0C\u540C\u65F6\u8868\u5934\u8282\u70B9\u7684\u524D\u7F6E\u548C\u8868\u5C3E\u7684\u540E\u7F6E\u8282\u70B9\u90FD\u6307\u5411NULL\u3002 <img src="https://cdn.nlark.com/yuque/0/2022/png/21883277/1663306524547-777e7d0f-15e7-4119-97c9-4db227ab8034.png#averageHue=%23dad9d8&amp;clientId=ucf814711-336e-4&amp;errorMessage=unknown error&amp;from=paste&amp;id=ucaa9bcd8&amp;originHeight=708&amp;originWidth=964&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=error&amp;style=none&amp;taskId=u2af7c899-13c4-47d7-a635-9c4546af4f5&amp;title=" alt=""></p><h4 id="_1-3-\u54C8\u5E0C\u8868-hashtable" tabindex="-1"><a class="header-anchor" href="#_1-3-\u54C8\u5E0C\u8868-hashtable" aria-hidden="true">#</a> 1.3 \u54C8\u5E0C\u8868 hashtable</h4><p>\u4E00\u4E2A\u54C8\u5E0C\u8868\u91CC\u53EF\u4EE5\u6709\u591A\u4E2A\u54C8\u5E0C\u8868\u8282\u70B9\uFF0C\u800C\u6BCF\u4E2A\u54C8\u5E0C\u8868\u8282\u70B9\u5C31\u4FDD\u5B58\u4E86\u5B57\u5178\u91CC\u4E2D\u7684\u4E00\u4E2A\u952E\u503C\u5BF9\u3002 \u6BCF\u4E2A\u5B57\u5178\u5E26\u6709\u4E24\u4E2Ahash\u8868\uFF0C\u4F9B\u5E73\u65F6\u4F7F\u2F64\u548C rehash \u65F6\u4F7F\u2F64\uFF0Chash\u8868\u4F7F\u2F64\u94FE\u5730\u5740\u6CD5\u6765\u89E3\u51B3\u952E\u51B2\u7A81\uFF0C\u88AB\u5206\u914D\u5230\u540C\u2F00\u4E2A\u7D22\u5F15\u4F4D\u7F6E\u7684\u591A\u4E2A\u952E\u503C\u5BF9\u4F1A\u5F62\u6210\u2F00\u4E2A\u5355\u5411\u94FE\u8868\uFF0C\u5728\u5BF9hash\u8868\u8FDB\u2F8F\u6269\u5BB9\u6216\u8005\u7F29\u5BB9\u7684\u65F6\u5019\uFF0C\u4E3A\u4E86\u670D\u52A1\u7684\u53EF\u2F64\u6027\uFF0Crehash\u7684\u8FC7\u7A0B\u4E0D\u662F\u2F00\u6B21\u6027\u5B8C\u6210\u7684\uFF0C\u2F7D\u662F\u6E10\u8FDB\u5F0F\u7684\u3002 <img src="https://cdn.nlark.com/yuque/0/2022/png/21883277/1663306603087-f3b79022-97cf-4b5f-b3cf-cd3beadc98a0.png#averageHue=%23c6c5c5&amp;clientId=ucf814711-336e-4&amp;errorMessage=unknown error&amp;from=paste&amp;id=u55ea279b&amp;originHeight=796&amp;originWidth=1027&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=error&amp;style=none&amp;taskId=uf519453f-6fda-4c1c-992d-7f896230d2b&amp;title=" alt=""></p><h4 id="_1-4-\u8DF3\u8DC3\u8868skiplist" tabindex="-1"><a class="header-anchor" href="#_1-4-\u8DF3\u8DC3\u8868skiplist" aria-hidden="true">#</a> 1.4 \u8DF3\u8DC3\u8868skiplist</h4><p>Redis\u8DF3\u8DC3\u8868\u7531 zskiplist \u548C zskiplistNode \u7EC4\u6210\uFF0Czskiplist \u2F64\u4E8E\u4FDD\u5B58\u8DF3\u8DC3\u8868\u4FE1\u606F\uFF08\u8868\u5934\u3001\u8868\u5C3E\u8282\u70B9\u3001\u2ED3\u5EA6\u7B49\uFF09\uFF0CzskiplistNode \u2F64\u4E8E\u8868\u793A\u8868\u8DF3\u8DC3\u8282\u70B9\uFF0C\u6BCF\u4E2A\u8DF3\u8DC3\u8868\u8282\u70B9\u7684\u5C42\u2FBC\u90FD\u662F 1-32 \u7684\u968F\u673A\u6570\uFF0C\u5728\u540C\u2F00\u4E2A\u8DF3\u8DC3\u8868\u4E2D\uFF0C\u591A\u4E2A\u8282\u70B9\u53EF\u4EE5\u5305\u542B\u76F8\u540C\u7684\u5206\u503C\uFF0C\u4F46\u662F\u6BCF\u4E2A\u8282\u70B9\u7684\u6210\u5458\u5BF9\u8C61\u5FC5\u987B\u662F\u552F\u2F00\u7684\uFF0C\u8282\u70B9\u6309\u7167\u5206\u503C\u2F24\u2F29\u6392\u5E8F\uFF0C\u5982\u679C\u5206\u503C\u76F8\u540C\uFF0C\u5219\u6309\u7167\u6210\u5458\u5BF9\u8C61\u7684\u2F24\u2F29\u6392\u5E8F\u3002 <img src="https://cdn.nlark.com/yuque/0/2022/png/21883277/1663306603131-20f2c79b-16b3-43bc-83ce-39910a15484c.png#averageHue=%23d4d2d2&amp;clientId=ucf814711-336e-4&amp;errorMessage=unknown error&amp;from=paste&amp;id=ud3d4d420&amp;originHeight=684&amp;originWidth=1181&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=error&amp;style=none&amp;taskId=uea483791-0920-44bc-82c3-0ed51f08576&amp;title=" alt=""></p><h4 id="_1-5-\u6574\u6570\u96C6\u5408intset" tabindex="-1"><a class="header-anchor" href="#_1-5-\u6574\u6570\u96C6\u5408intset" aria-hidden="true">#</a> 1.5 \u6574\u6570\u96C6\u5408intset</h4><p>\u2F64\u4E8E\u4FDD\u5B58\u6574\u6570\u503C\u7684\u96C6\u5408\u62BD\u8C61\u6570\u636E\u7ED3\u6784\uFF0C\u4E0D\u4F1A\u51FA\u73B0\u91CD\u590D\u5143\u7D20\uFF0C\u5E95\u5C42\u5B9E\u73B0\u4E3A\u6570\u7EC4\u3002 <img src="https://cdn.nlark.com/yuque/0/2022/png/21883277/1663306603081-ec50deb2-0d1d-4f03-8a21-9e0e166d24be.png#averageHue=%23dfdfde&amp;clientId=ucf814711-336e-4&amp;errorMessage=unknown error&amp;from=paste&amp;id=uf632c9c4&amp;originHeight=342&amp;originWidth=1013&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=error&amp;style=none&amp;taskId=u44998106-5501-4ef0-9a6b-beb1bcd5fd0&amp;title=" alt=""></p><h4 id="_1-6-\u538B\u7F29\u5217\u8868ziplist-\u538B\u7F29\u5217\u8868\u662F\u4E3A\u8282\u7EA6\u5185\u5B58\u800C\u5F00\u53D1\u7684\u987A\u5E8F\u6027\u6570\u636E\u7ED3\u6784-\u5B83\u53EF\u4EE5\u5305\u542B\u4EFB\u610F\u591A\u4E2A\u8282\u70B9-\u6BCF\u4E2A\u8282\u70B9\u53EF\u4EE5\u4FDD\u5B58\u4E00\u4E2A\u5B57\u8282\u6570\u7EC4\u6216\u8005\u6574\u6570\u503C\u3002" tabindex="-1"><a class="header-anchor" href="#_1-6-\u538B\u7F29\u5217\u8868ziplist-\u538B\u7F29\u5217\u8868\u662F\u4E3A\u8282\u7EA6\u5185\u5B58\u800C\u5F00\u53D1\u7684\u987A\u5E8F\u6027\u6570\u636E\u7ED3\u6784-\u5B83\u53EF\u4EE5\u5305\u542B\u4EFB\u610F\u591A\u4E2A\u8282\u70B9-\u6BCF\u4E2A\u8282\u70B9\u53EF\u4EE5\u4FDD\u5B58\u4E00\u4E2A\u5B57\u8282\u6570\u7EC4\u6216\u8005\u6574\u6570\u503C\u3002" aria-hidden="true">#</a> 1.6 \u538B\u7F29\u5217\u8868ziplist\uFF1A\u538B\u7F29\u5217\u8868\u662F\u4E3A\u8282\u7EA6\u5185\u5B58\u2F7D\u5F00\u53D1\u7684\u987A\u5E8F\u6027\u6570\u636E\u7ED3\u6784\uFF0C\u5B83\u53EF\u4EE5\u5305\u542B\u4EFB\u610F\u591A\u4E2A\u8282\u70B9\uFF0C\u6BCF\u4E2A\u8282\u70B9\u53EF\u4EE5\u4FDD\u5B58\u2F00\u4E2A\u5B57\u8282\u6570\u7EC4\u6216\u8005\u6574\u6570\u503C\u3002</h4><p><img src="https://cdn.nlark.com/yuque/0/2022/png/21883277/1663306603079-164465e8-3b12-4139-ac8c-7d1162c0b6a1.png#averageHue=%23fefbfb&amp;clientId=ucf814711-336e-4&amp;errorMessage=unknown error&amp;from=paste&amp;id=u36a75efb&amp;originHeight=145&amp;originWidth=1072&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=error&amp;style=none&amp;taskId=uc4870412-5952-44de-a00b-b2b703acaab&amp;title=" alt=""></p><h4 id="_1-7-quicklist-3-2" tabindex="-1"><a class="header-anchor" href="#_1-7-quicklist-3-2" aria-hidden="true">#</a> 1.7 quicklist (3.2)</h4>',70),c={href:"https://github.com/redis/redis/blob/unstable/src/quicklist.h#L46",target:"_blank",rel:"noopener noreferrer"},m=e("https://github.com/redis/redis/blob/unstable/src/quicklist.h#L46"),u=e(" quicklist \u7684\u8BBE\u8BA1\uFF0C\u5176\u5B9E\u662F\u7ED3\u5408\u4E86\u94FE\u8868\u548C ziplist \u5404\u81EA\u7684\u4F18\u52BF\u3002\u7B80\u5355\u6765\u8BF4\uFF0C\u4E00\u4E2A quicklist \u5C31\u662F\u4E00\u4E2A\u94FE\u8868\uFF0C\u800C\u94FE\u8868\u4E2D\u7684\u6BCF\u4E2A\u5143\u7D20\u53C8\u662F\u4E00\u4E2A ziplist\u3002 "),g=a("img",{src:"https://cdn.nlark.com/yuque/0/2022/png/21883277/1664765504793-e0a010b2-9e6a-4c3b-bc71-7646eb42c2b9.png#averageHue=%23d7e0e3&clientId=u9123ff3d-10a3-4&from=paste&id=udb7186ee&originHeight=890&originWidth=2000&originalType=url&ratio=1&rotation=0&showTitle=false&size=233698&status=done&style=none&taskId=uc9dc9a2b-3e0d-4a9a-a982-50670f085a5&title=",alt:"image.png"},null,-1),b=i(`<div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">quicklist</span> <span class="token punctuation">{</span>
    quicklistNode <span class="token operator">*</span>head<span class="token punctuation">;</span>
    quicklistNode <span class="token operator">*</span>tail<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> count<span class="token punctuation">;</span>        <span class="token comment">/* total count of all entries in all ziplists */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> len<span class="token punctuation">;</span>          <span class="token comment">/* number of quicklistNodes */</span>
    <span class="token keyword">int</span> fill <span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">;</span>              <span class="token comment">/* fill factor for individual nodes */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> compress <span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">;</span> <span class="token comment">/* depth of end nodes not to compress;0=off */</span>
<span class="token punctuation">}</span> quicklist<span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">quicklistNode</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">quicklistNode</span> <span class="token operator">*</span>prev<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">quicklistNode</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>zl<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> sz<span class="token punctuation">;</span>             <span class="token comment">/* ziplist size in bytes */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> count <span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">;</span>     <span class="token comment">/* count of items in ziplist */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> encoding <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">;</span>   <span class="token comment">/* RAW==1 or LZF==2 */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> container <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token comment">/* NONE==1 or ZIPLIST==2 */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> recompress <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* was this node previous compressed? */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> attempted_compress <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* node can&#39;t compress; too small */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> extra <span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">/* more bits to steal for future usage */</span>
<span class="token punctuation">}</span> quicklistNode<span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">quicklistEntry</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> quicklist <span class="token operator">*</span>quicklist<span class="token punctuation">;</span>
    quicklistNode <span class="token operator">*</span>node<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>zi<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>value<span class="token punctuation">;</span>
    <span class="token keyword">long</span> <span class="token keyword">long</span> longval<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> sz<span class="token punctuation">;</span>
    <span class="token keyword">int</span> offset<span class="token punctuation">;</span>
<span class="token punctuation">}</span> quicklistEntry<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><ul><li>quicklist \u662F\u4E00\u4E2A\u53CC\u5411\u94FE\u8868\uFF0Chead\u3001tail\u5206\u522B\u6307\u5411\u5934\u5C3E\u8282\u70B9</li><li>quicklistNode \u662F\u53CC\u5411\u94FE\u8868\u7684\u8282\u70B9\uFF0Cprev\u3001next\u5206\u522B\u6307\u5411\u524D\u9A71\u3001\u540E\u7EE7\u7ED3\u70B9</li><li>quicklistNode.zl \u6307\u5411\u4E00\u4E2Aziplist\uFF08\u6216\u8005quicklistLZF\u7ED3\u6784\uFF09</li><li>quicklistEntry \u5305\u88F9\u7740list\u7684\u6BCF\u4E00\u4E2A\u503C\uFF0C\u4F5C\u4E3Aziplist\u7684\u4E00\u4E2A\u8282\u70B9</li></ul><p>\u53EF\u4EE5\u60F3\u8C61\u5F97\u5230\uFF0C\u5F53\u4E00\u4E2A\u7A7A\u7684quicklist\u52A0\u5165\u4E00\u4E2A\u503Cvalue\u65F6\uFF0C\u4F1A\u6709\u4EE5\u4E0B\u64CD\u4F5C\uFF08\u4E0D\u4E00\u5B9A\u4EE5\u8FD9\u4E2A\u987A\u5E8F\uFF09\uFF1A</p><ol><li>\u4F7F\u7528Entry\u5305\u88F9value</li><li>\u521B\u5EFA\u4E00\u4E2Aziplist\uFF0C\u628AEntry\u52A0\u5165\u5230ziplist\u4E2D</li><li>\u521B\u5EFA\u4E00\u4E2ANode\uFF0CNode.zl\u6307\u5411ziplist</li><li>\u521B\u5EFAquicklist\uFF0C\u5C06Node\u52A0\u5165quicklist\u4E2D</li></ol><h4 id="_1-8-listpack-5-0" tabindex="-1"><a class="header-anchor" href="#_1-8-listpack-5-0" aria-hidden="true">#</a> 1.8 listpack (5.0)</h4><p>\u800C Redis \u9664\u4E86\u8BBE\u8BA1\u4E86 quicklist \u7ED3\u6784\u6765\u5E94\u5BF9 ziplist \u7684\u95EE\u9898\u4EE5\u5916\uFF0C\u8FD8\u5728 5.0 \u7248\u672C\u4E2D\u65B0\u589E\u4E86 listpack \u6570\u636E\u7ED3\u6784\uFF0C\u7528\u6765\u5F7B\u5E95\u907F\u514D\u8FDE\u9501\u66F4\u65B0\u3002 listpack \u4E5F\u53EB\u7D27\u51D1\u5217\u8868\uFF0C\u5B83\u7684\u7279\u70B9\u5C31\u662F\u7528\u4E00\u5757\u8FDE\u7EED\u7684\u5185\u5B58\u7A7A\u95F4\u6765\u7D27\u51D1\u5730\u4FDD\u5B58\u6570\u636E\uFF0C\u540C\u65F6\u4E3A\u4E86\u8282\u7701\u5185\u5B58\u7A7A\u95F4\uFF0Clistpack \u5217\u8868\u9879\u4F7F\u7528\u4E86\u591A\u79CD\u7F16\u7801\u65B9\u5F0F\uFF0C\u6765\u8868\u793A\u4E0D\u540C\u957F\u5EA6\u7684\u6570\u636E\uFF0C\u8FD9\u4E9B\u6570\u636E\u5305\u62EC\u6574\u6570\u548C\u5B57\u7B26\u4E32\u3002</p><h3 id="_2-redis-\u7684-sds-\u548C-c-\u4E2D\u5B57\u7B26\u4E32\u76F8\u6BD4\u6709\u4EC0\u4E48\u4F18\u52BF" tabindex="-1"><a class="header-anchor" href="#_2-redis-\u7684-sds-\u548C-c-\u4E2D\u5B57\u7B26\u4E32\u76F8\u6BD4\u6709\u4EC0\u4E48\u4F18\u52BF" aria-hidden="true">#</a> 2. Redis \u7684 SDS \u548C C \u4E2D\u5B57\u7B26\u4E32\u76F8\u6BD4\u6709\u4EC0\u4E48\u4F18\u52BF\uFF1F</h3><p>C \u8BED\u8A00\u4F7F\u7528\u4E86\u4E00\u4E2A\u957F\u5EA6\u4E3A N+1 \u7684\u5B57\u7B26\u6570\u7EC4\u6765\u8868\u793A\u957F\u5EA6\u4E3A N \u7684\u5B57\u7B26\u4E32\uFF0C\u5E76\u4E14\u5B57\u7B26\u6570\u7EC4\u6700\u540E\u4E00\u4E2A\u5143\u7D20\u603B\u662F<code> \\0</code>\uFF0C\u8FD9\u79CD\u7B80\u5355\u7684\u5B57\u7B26\u4E32\u8868\u793A\u65B9\u5F0F \u4E0D\u7B26\u5408 Redis \u5BF9\u5B57\u7B26\u4E32\u5728\u5B89\u5168\u6027\u3001\u6548\u7387\u4EE5\u53CA\u529F\u80FD\u65B9\u9762\u7684\u8981\u6C42\u3002 <img src="https://cdn.nlark.com/yuque/0/2022/png/21883277/1663306743256-258a437d-2467-43c4-bc6d-71b0783747c2.png#averageHue=%23fdfcfb&amp;clientId=ucf814711-336e-4&amp;errorMessage=unknown error&amp;from=paste&amp;id=uec8ec9de&amp;originHeight=197&amp;originWidth=635&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=error&amp;style=none&amp;taskId=u4ea4e9c0-82cd-47dc-af98-81f5ccc3acf&amp;title=" alt=""><strong>C\u8BED\u8A00\u7684\u5B57\u7B26\u4E32\u53EF\u80FD\u6709\u4EC0\u4E48\u95EE\u9898\uFF1F</strong> \u8FD9\u6837\u7B80\u5355\u7684\u6570\u636E\u7ED3\u6784\u53EF\u80FD\u4F1A\u9020\u6210\u4EE5\u4E0B\u4E00\u4E9B\u95EE\u9898\uFF1A</p><ul><li><strong>\u83B7\u53D6\u5B57\u7B26\u4E32\u957F\u5EA6\u590D\u6742\u5EA6\u9AD8</strong> \uFF1A\u56E0\u4E3A C \u4E0D\u4FDD\u5B58\u6570\u7EC4\u7684\u957F\u5EA6\uFF0C\u6BCF\u6B21\u90FD\u9700\u8981\u904D\u5386\u4E00\u904D\u6574\u4E2A\u6570\u7EC4\uFF0C\u65F6\u95F4\u590D\u6742\u5EA6\u4E3AO(n)\uFF1B</li><li>\u4E0D\u80FD\u675C\u7EDD <strong>\u7F13\u51B2\u533A\u6EA2\u51FA/\u5185\u5B58\u6CC4\u6F0F</strong> \u7684\u95EE\u9898 : C\u5B57\u7B26\u4E32\u4E0D\u8BB0\u5F55\u81EA\u8EAB\u957F\u5EA6\u5E26\u6765\u7684\u53E6\u5916\u4E00\u4E2A\u95EE\u9898\u662F\u5BB9\u6613\u9020\u6210\u7F13\u5B58\u533A\u6EA2\u51FA\uFF08buffer overflow\uFF09\uFF0C\u4F8B\u5982\u5728\u5B57\u7B26\u4E32\u62FC\u63A5\u7684\u65F6\u5019\uFF0C\u65B0\u7684</li><li>C \u5B57\u7B26\u4E32 <strong>\u53EA\u80FD\u4FDD\u5B58\u6587\u672C\u6570\u636E</strong> \u2192 \u56E0\u4E3A C \u8BED\u8A00\u4E2D\u7684\u5B57\u7B26\u4E32\u5FC5\u987B\u7B26\u5408\u67D0\u79CD\u7F16\u7801\uFF08\u6BD4\u5982 ASCII\uFF09\uFF0C\u4F8B\u5982\u4E2D\u95F4\u51FA\u73B0\u7684 &#39;\\0&#39; \u53EF\u80FD\u4F1A\u88AB\u5224\u5B9A\u4E3A\u63D0\u524D\u7ED3\u675F\u7684\u5B57\u7B26\u4E32\u800C\u8BC6\u522B\u4E0D\u4E86\uFF1B</li></ul><p><strong>Redis\u5982\u4F55\u89E3\u51B3\uFF1F\u4F18\u52BF\uFF1F</strong><img src="https://cdn.nlark.com/yuque/0/2022/png/21883277/1663306743350-3b816b24-7047-4033-99c5-b04effe20a15.png#averageHue=%23fefdfd&amp;clientId=ucf814711-336e-4&amp;errorMessage=unknown error&amp;from=paste&amp;id=ub11370f3&amp;originHeight=243&amp;originWidth=693&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=error&amp;style=none&amp;taskId=u131df744-2498-4f1c-921d-4deeec623f2&amp;title=" alt=""> \u7B80\u5355\u6765\u8BF4\u4E00\u4E0B Redis \u5982\u4F55\u89E3\u51B3\u7684\uFF1A</p><ol><li><strong>\u591A\u589E\u52A0 len \u8868\u793A\u5F53\u524D\u5B57\u7B26\u4E32\u7684\u957F\u5EA6</strong>\uFF1A\u8FD9\u6837\u5C31\u53EF\u4EE5\u76F4\u63A5\u83B7\u53D6\u957F\u5EA6\u4E86\uFF0C\u590D\u6742\u5EA6 O(1)\uFF1B</li><li><strong>\u81EA\u52A8\u6269\u5C55\u7A7A\u95F4</strong>\uFF1A\u5F53 SDS \u9700\u8981\u5BF9\u5B57\u7B26\u4E32\u8FDB\u884C\u4FEE\u6539\u65F6\uFF0C\u9996\u5148\u501F\u52A9\u4E8E len \u548C alloc \u68C0\u67E5\u7A7A\u95F4\u662F\u5426\u6EE1\u8DB3\u4FEE\u6539\u6240\u9700\u7684\u8981\u6C42\uFF0C\u5982\u679C\u7A7A\u95F4\u4E0D\u591F\u7684\u8BDD\uFF0CSDS \u4F1A\u81EA\u52A8\u6269\u5C55\u7A7A\u95F4\uFF0C\u907F\u514D\u4E86\u50CF C \u5B57\u7B26\u4E32\u64CD\u4F5C\u4E2D\u7684\u6EA2\u51FA\u60C5\u51B5\uFF1B</li><li><strong>\u6709\u6548\u964D\u4F4E\u5185\u5B58\u5206\u914D\u6B21\u6570</strong>\uFF1AC \u5B57\u7B26\u4E32\u5728\u6D89\u53CA\u589E\u52A0\u6216\u8005\u6E05\u9664\u64CD\u4F5C\u65F6\u4F1A\u6539\u53D8\u5E95\u5C42\u6570\u7EC4\u7684\u5927\u5C0F\u9020\u6210\u91CD\u65B0\u5206\u914D\uFF0CSDS \u4F7F\u7528\u4E86 <strong>\u7A7A\u95F4\u9884\u5206\u914D</strong> \u548C <strong>\u60F0\u6027\u7A7A\u95F4\u91CA\u653E</strong> \u673A\u5236\uFF0C\u7B80\u5355\u7406\u89E3\u5C31\u662F\u6BCF\u6B21\u5728\u6269\u5C55\u65F6\u662F\u6210\u500D\u7684\u591A\u5206\u914D\u7684\uFF0C\u5728\u7F29\u5BB9\u662F\u4E5F\u662F\u5148\u7559\u7740\u5E76\u4E0D\u6B63\u5F0F\u5F52\u8FD8\u7ED9 OS\uFF1B</li><li><strong>\u4E8C\u8FDB\u5236\u5B89\u5168</strong>\uFF1AC \u8BED\u8A00\u5B57\u7B26\u4E32\u53EA\u80FD\u4FDD\u5B58 ascii \u7801\uFF0C\u5BF9\u4E8E\u56FE\u7247\u3001\u97F3\u9891\u7B49\u4FE1\u606F\u65E0\u6CD5\u4FDD\u5B58\uFF0CSDS \u662F\u4E8C\u8FDB\u5236\u5B89\u5168\u7684\uFF0C\u5199\u5165\u4EC0\u4E48\u8BFB\u53D6\u5C31\u662F\u4EC0\u4E48\uFF0C\u4E0D\u505A\u4EFB\u4F55\u8FC7\u6EE4\u548C\u9650\u5236\uFF1B</li></ol><h3 id="_3-\u5B57\u5178\u662F\u5982\u4F55\u5B9E\u73B0\u7684-rehash-\u4E86\u89E3\u5417" tabindex="-1"><a class="header-anchor" href="#_3-\u5B57\u5178\u662F\u5982\u4F55\u5B9E\u73B0\u7684-rehash-\u4E86\u89E3\u5417" aria-hidden="true">#</a> 3. \u5B57\u5178\u662F\u5982\u4F55\u5B9E\u73B0\u7684\uFF1FRehash \u4E86\u89E3\u5417\uFF1F</h3><p>\u5B57\u5178\u662F Redis \u670D\u52A1\u5668\u4E2D\u51FA\u73B0\u6700\u4E3A\u9891\u7E41\u7684\u590D\u5408\u578B\u6570\u636E\u7ED3\u6784\u3002\u9664\u4E86 <strong>hash</strong> \u7ED3\u6784\u7684\u6570\u636E\u4F1A\u7528\u5230\u5B57\u5178\u5916\uFF0C\u6574\u4E2A Redis \u6570\u636E\u5E93\u7684\u6240\u6709 key \u548C value \u4E5F\u7EC4\u6210\u4E86\u4E00\u4E2A <strong>\u5168\u5C40\u5B57\u5178</strong>\uFF0C\u8FD8\u6709\u5E26\u8FC7\u671F\u65F6\u95F4\u7684 key \u4E5F\u662F\u4E00\u4E2A\u5B57\u5178\u3002<em>(\u5B58\u50A8\u5728 RedisDb \u6570\u636E\u7ED3\u6784\u4E2D)</em><strong>\u5B57\u5178\u7ED3\u6784\u662F\u4EC0\u4E48\u6837\u7684\u5462\uFF1F</strong><strong>Redis</strong> \u4E2D\u7684\u5B57\u5178\u76F8\u5F53\u4E8E <strong>HashMap</strong>\uFF0C\u5185\u90E8\u5B9E\u73B0\u4E5F\u5DEE\u4E0D\u591A\u7C7B\u4F3C\uFF0C\u91C7\u7528\u54C8\u5E0C\u4E0E\u8FD0\u7B97\u8BA1\u7B97\u4E0B\u6807\u4F4D\u7F6E\uFF1B\u901A\u8FC7 <strong>&quot;\u6570\u7EC4 + \u94FE\u8868&quot; \u7684\u94FE\u5730\u5740\u6CD5</strong> \u6765\u89E3\u51B3\u54C8\u5E0C\u51B2\u7A81\uFF0C\u540C\u65F6\u8FD9\u6837\u7684\u7ED3\u6784\u4E5F\u5438\u6536\u4E86\u4E24\u79CD\u4E0D\u540C\u6570\u636E\u7ED3\u6784\u7684\u4F18\u70B9\u3002 <img src="https://cdn.nlark.com/yuque/0/2022/png/21883277/1663306743263-3b1df546-368f-4132-a83a-92935ce9b1f0.png#averageHue=%23fcfbfb&amp;clientId=ucf814711-336e-4&amp;errorMessage=unknown error&amp;from=paste&amp;id=u5b80191f&amp;originHeight=581&amp;originWidth=1179&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=error&amp;style=none&amp;taskId=uaa683de0-fd4c-4e56-b28c-1aaf0937941&amp;title=" alt=""><strong>\u5B57\u5178\u662F\u600E\u4E48\u6269\u5BB9\u7684\uFF1F</strong> \u5B57\u5178\u7ED3\u6784\u5185\u90E8\u5305\u542B <strong>\u4E24\u4E2A hashtable</strong>\uFF0C\u901A\u5E38\u60C5\u51B5\u4E0B\u53EA\u6709\u4E00\u4E2A\u54C8\u5E0C\u8868 ht[0] \u6709\u503C\uFF0C\u5728\u6269\u5BB9\u7684\u65F6\u5019\uFF0C\u628Aht[0]\u91CC\u7684\u503Crehash\u5230ht[1]\uFF0C\u7136\u540E\u8FDB\u884C <strong>\u6E10\u8FDB\u5F0Frehash</strong> \u2014\u2014\u6240\u8C13\u6E10\u8FDB\u5F0Frehash\uFF0C\u6307\u7684\u662F\u8FD9\u4E2Arehash\u7684\u52A8\u4F5C\u5E76\u4E0D\u662F\u4E00\u6B21\u6027\u3001\u96C6\u4E2D\u5F0F\u5730\u5B8C\u6210\u7684\uFF0C\u800C\u662F\u5206\u591A\u6B21\u3001\u6E10\u8FDB\u5F0F\u5730\u5B8C\u6210\u7684\u3002 \u5F85\u642C\u8FC1\u7ED3\u675F\u540E\uFF0Ch[1]\u5C31\u53D6\u4EE3h[0]\u5B58\u50A8\u5B57\u5178\u7684\u5143\u7D20\u3002 <img src="https://cdn.nlark.com/yuque/0/2023/png/21883277/1677033849966-7d0e38e9-6694-498f-8453-a9ac68d3745b.png#averageHue=%23d8d8d8&amp;clientId=u2cc5c76a-7886-4&amp;from=paste&amp;id=u80d8e069&amp;originHeight=311&amp;originWidth=1082&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u175818f8-b199-43dd-86bf-ada4bca09aa&amp;title=" alt=""></p><h3 id="_4-\u8DF3\u8DC3\u8868\u662F\u5982\u4F55\u5B9E\u73B0\u7684-\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_4-\u8DF3\u8DC3\u8868\u662F\u5982\u4F55\u5B9E\u73B0\u7684-\u539F\u7406" aria-hidden="true">#</a> 4. \u8DF3\u8DC3\u8868\u662F\u5982\u4F55\u5B9E\u73B0\u7684\uFF1F\u539F\u7406\uFF1F</h3><p>PS:\u8DF3\u8DC3\u8868\u662F\u6BD4\u8F83\u5E38\u95EE\u7684\u4E00\u79CD\u7ED3\u6784\u3002</p><h4 id="\u4EC0\u4E48\u662F\u8DF3\u8DC3\u8868" tabindex="-1"><a class="header-anchor" href="#\u4EC0\u4E48\u662F\u8DF3\u8DC3\u8868" aria-hidden="true">#</a> \u4EC0\u4E48\u662F\u8DF3\u8DC3\u8868</h4>`,16),f={href:"https://epaperpress.com/sortsearch/download/skiplist.pdf",target:"_blank",rel:"noopener noreferrer"},k=e("Skip Lists: A Probabilistic Alternative to Balanced Trees"),y=i(`<ul><li><strong>\u8DF3\u8DC3\u8868\u662F\u4E00\u79CD\u53EF\u4EE5\u7528\u6765\u4EE3\u66FF\u5E73\u8861\u6811\u7684\u6570\u636E\u7ED3\u6784\u3002</strong></li><li><strong>\u8DF3\u8DC3\u8868\u4F7F\u7528\u6982\u7387\u5E73\u8861\uFF0C\u800C\u4E0D\u662F\u4E25\u683C\u5F3A\u5236\u7684\u5E73\u8861\uFF0C</strong></li><li><strong>\u8DF3\u8DC3\u8868\u4E2D\u63D2\u5165\u548C\u5220\u9664\u7684\u7B97\u6CD5\u6BD4\u5E73\u8861\u6811\u7684\u7B49\u6548\u7B97\u6CD5\u7B80\u5355\u5F97\u591A\uFF0C\u901F\u5EA6\u4E5F\u5FEB\u5F97\u591A</strong></li></ul><blockquote><p><strong>\u5B9E\u8D28\u4E0A\u5C31\u662F\u4E00\u79CD\u53EF\u4EE5\u8FDB\u884C\u4E8C\u5206\u67E5\u627E\u7684\u6709\u5E8F\u94FE\u8868\u3002\u800C\u4E8C\u5206\u67E5\u627E\u7684\u57FA\u7840\u5C31\u662F\u5206\u5C42\u7D22\u5F15\u3002</strong></p></blockquote><p>eg: \u8BBA\u6587\u7B2C\u4E8C\u9875\u7ED9\u7684\u56FE <img src="https://cdn.nlark.com/yuque/0/2023/png/21883277/1676385578055-ab547216-fb54-4333-9fca-711bd89855c2.png#averageHue=%23dfa779&amp;clientId=u176d1acb-ad1a-4&amp;from=paste&amp;height=695&amp;id=ufbf42604&amp;originHeight=695&amp;originWidth=1171&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=275166&amp;status=done&amp;style=none&amp;taskId=u41fc9854-c217-4bfe-8620-8a619b2b8a4&amp;title=&amp;width=1171" alt="image.png"></p><blockquote><p><img src="https://cdn.nlark.com/yuque/0/2023/png/21883277/1676386433149-439cc0ce-d201-4e60-ac8e-a989a4d479ba.png#averageHue=%23f4f1ed&amp;clientId=u176d1acb-ad1a-4&amp;from=paste&amp;height=389&amp;id=uc33ee3b2&amp;originHeight=389&amp;originWidth=620&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=111774&amp;status=done&amp;style=none&amp;taskId=ue4a46dbe-8cb6-49aa-984e-34edcc4f430&amp;title=&amp;width=620" alt="image.png"></p></blockquote><h4 id="\u67E5\u627E\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u67E5\u627E\u6D41\u7A0B" aria-hidden="true">#</a> \u67E5\u627E\u6D41\u7A0B\uFF1A</h4><p><img src="https://cdn.nlark.com/yuque/0/2023/png/21883277/1676387365524-b1b61cc1-cd40-4316-bb8b-9a9ac2183748.png#averageHue=%23f2f0ee&amp;clientId=ucad2500e-86c9-4&amp;from=paste&amp;height=354&amp;id=u0408876e&amp;originHeight=354&amp;originWidth=558&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=65006&amp;status=done&amp;style=none&amp;taskId=u0530c1e0-b902-403c-9fc6-3b72b81f2cc&amp;title=&amp;width=558" alt="image.png"> \u5728\u5934\u9886\u8282\u70B9\u7684\u6700\u9AD8\u697C\u6CBF\u7740\u8DE8\u5EA6\u5411\u524D\u5BFB\u627E\uFF0C\u5982\u679C\u521A\u597D\u627E\u5230\u6240\u9700\u5143\u7D20\uFF0C\u5219\u76F4\u63A5\u8FD4\u56DE\uFF0C\u5426\u5219\u7EE7\u7EED\u5F80\u524D\u5BFB\u627E\uFF0C\u77E5\u9053\u9047\u5230\u6BD4\u5BFB\u627E\u7684\u5143\u7D20\u5927\u7684\u5143\u7D20\uFF0C\u7136\u540E\u8FD4\u56DE\u4E00\u4E2A\u8DE8\u5EA6\uFF0C\u5E76\u4E0B\u4E00\u5C42\u697C\u5BFB\u627E\u3002\u5982\u679C\u5728\u4E00\u697C\u4E5F\u627E\u4E0D\u5230\u8BF4\u660E\u5143\u7D20\u4E0D\u5B58\u5728\u3002</p><blockquote><p>\u6BCF\u4E2A\u697C\u5C42\u81F3\u5C11\u6709\u4E24\u4E2A\u5143\u7D20\uFF0C\u8DE8\u5EA6\u548C\u524D\u5411\u6307\u9488\u3002</p></blockquote><p>eg: \u63D2\u5165\uFF0C\u5220\u9664</p><blockquote><p><img src="https://cdn.nlark.com/yuque/0/2023/png/21883277/1676387535528-f2132331-ae3e-414e-a775-350ed6ee3ade.png#averageHue=%23f6f4f2&amp;clientId=ucad2500e-86c9-4&amp;from=paste&amp;height=540&amp;id=u09dfcfff&amp;originHeight=540&amp;originWidth=521&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=96059&amp;status=done&amp;style=none&amp;taskId=ud7915466-4d49-448c-9297-ca88fe6e0cf&amp;title=&amp;width=521" alt="image.png"></p></blockquote><p>\u8DF3\u8DC3\u8868\uFF08skiplist\uFF09\u662F\u4E00\u79CD\u6709\u5E8F\u6570\u636E\u7ED3\u6784\uFF0C\u5B83\u901A\u8FC7\u5728\u6BCF\u4E2A\u8282\u70B9\u4E2D\u7EF4\u6301\u591A\u4E2A\u6307\u5411\u5176\u5B83\u8282\u70B9\u7684\u6307\u9488\uFF0C\u4ECE\u800C\u8FBE\u5230\u5FEB\u901F\u8BBF\u95EE\u8282\u70B9\u7684\u76EE\u7684\u3002 <img src="https://cdn.nlark.com/yuque/0/2022/png/21883277/1663306743482-962c98a3-217c-4aa9-b912-bba8303e47d1.png#averageHue=%23fdfbfa&amp;clientId=ucf814711-336e-4&amp;errorMessage=unknown error&amp;from=paste&amp;id=u7f0feced&amp;originHeight=457&amp;originWidth=1122&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=error&amp;style=none&amp;taskId=u624b4282-b021-4824-805d-22fdf9d429b&amp;title=" alt=""></p><h4 id="\u4E3A\u4EC0\u4E48\u4F7F\u7528\u8DF3\u8DC3\u8868" tabindex="-1"><a class="header-anchor" href="#\u4E3A\u4EC0\u4E48\u4F7F\u7528\u8DF3\u8DC3\u8868" aria-hidden="true">#</a> \u4E3A\u4EC0\u4E48\u4F7F\u7528\u8DF3\u8DC3\u8868?</h4><p>\u9996\u5148\uFF0C\u56E0\u4E3A zset \u8981\u652F\u6301\u968F\u673A\u7684\u63D2\u5165\u548C\u5220\u9664\uFF0C\u6240\u4EE5\u5B83 <strong>\u4E0D\u5B9C\u4F7F\u7528\u6570\u7EC4\u6765\u5B9E\u73B0</strong>\uFF0C\u5173\u4E8E\u6392\u5E8F\u95EE\u9898\uFF0C\u6211\u4EEC\u4E5F\u5F88\u5BB9\u6613\u5C31\u60F3\u5230 <strong>\u7EA2\u9ED1\u6811/ \u5E73\u8861\u6811</strong> \u8FD9\u6837\u7684\u6811\u5F62\u7ED3\u6784\uFF0C\u4E3A\u4EC0\u4E48 Redis \u4E0D\u4F7F\u7528\u8FD9\u6837\u4E00\u4E9B\u7ED3\u6784\u5462\uFF1F</p><ol><li><strong>\u6027\u80FD\u8003\u8651\uFF1A</strong> \u5728\u9AD8\u5E76\u53D1\u7684\u60C5\u51B5\u4E0B\uFF0C\u6811\u5F62\u7ED3\u6784\u9700\u8981\u6267\u884C\u4E00\u4E9B\u7C7B\u4F3C\u4E8E rebalance \u8FD9\u6837\u7684\u53EF\u80FD\u6D89\u53CA\u6574\u68F5\u6811\u7684\u64CD\u4F5C\uFF0C\u76F8\u5BF9\u6765\u8BF4\u8DF3\u8DC3\u8868\u7684\u53D8\u5316\u53EA\u6D89\u53CA\u5C40\u90E8\uFF1B</li><li><strong>\u5B9E\u73B0\u8003\u8651\uFF1A</strong> \u5728\u590D\u6742\u5EA6\u4E0E\u7EA2\u9ED1\u6811\u76F8\u540C\u7684\u60C5\u51B5\u4E0B\uFF0C\u8DF3\u8DC3\u8868\u5B9E\u73B0\u8D77\u6765\u66F4\u7B80\u5355\uFF0C\u770B\u8D77\u6765\u4E5F\u66F4\u52A0\u76F4\u89C2\uFF1B</li></ol><p>\u57FA\u4E8E\u4EE5\u4E0A\u7684\u4E00\u4E9B\u8003\u8651\uFF0CRedis \u57FA\u4E8E <strong>William Pugh</strong> \u7684\u8BBA\u6587\u505A\u51FA\u4E00\u4E9B\u6539\u8FDB\u540E\u91C7\u7528\u4E86 <strong>\u8DF3\u8DC3\u8868</strong> \u8FD9\u6837\u7684\u7ED3\u6784\u3002 \u672C\u8D28\u662F\u89E3\u51B3\u67E5\u627E\u95EE\u9898\u3002</p><h4 id="\u8DF3\u8DC3\u8868\u662F\u600E\u4E48\u5B9E\u73B0\u7684" tabindex="-1"><a class="header-anchor" href="#\u8DF3\u8DC3\u8868\u662F\u600E\u4E48\u5B9E\u73B0\u7684" aria-hidden="true">#</a> \u8DF3\u8DC3\u8868\u662F\u600E\u4E48\u5B9E\u73B0\u7684\uFF1F</h4><p>\u8DF3\u8DC3\u8868\u7684\u8282\u70B9\u91CC\u6709\u8FD9\u4E9B\u5143\u7D20\uFF1A</p><ul><li><strong>\u5C42</strong> \u8DF3\u8DC3\u8868\u8282\u70B9\u7684level\u6570\u7EC4\u53EF\u4EE5\u5305\u542B\u591A\u4E2A\u5143\u7D20\uFF0C\u6BCF\u4E2A\u5143\u7D20\u90FD\u5305\u542B\u4E00\u4E2A\u6307\u5411\u5176\u5B83\u8282\u70B9\u7684\u6307\u9488\uFF0C\u7A0B\u5E8F\u53EF\u4EE5\u901A\u8FC7\u8FD9\u4E9B\u5C42\u6765\u52A0\u5FEB\u8BBF\u95EE\u5176\u5B83\u8282\u70B9\u7684\u901F\u5EA6\uFF0C\u4E00\u822C\u6765\u8BF4\uFF0C\u5C42\u7684\u6570\u91CF\u8D8A\u591A\uFF0C\u8BBF\u95EE\u5176\u5B83\u8282\u70B9\u7684\u901F\u5EA6\u5C31\u8D8A\u5FEB\u3002\u6BCF\u6B21\u521B\u5EFA\u4E00\u4E2A\u65B0\u7684\u8DF3\u8DC3\u8868\u8282\u70B9\u7684\u65F6\u5019\uFF0C\u7A0B\u5E8F\u90FD\u6839\u636E\u5E42\u6B21\u5B9A\u5F8B\uFF0C\u968F\u673A\u751F\u6210\u4E00\u4E2A\u4ECB\u4E8E1\u548C32\u4E4B\u95F4\u7684\u503C\u4F5C\u4E3Alevel\u6570\u7EC4\u7684\u5927\u5C0F\uFF0C\u8FD9\u4E2A\u5927\u5C0F\u5C31\u662F\u5C42\u7684\u201C\u9AD8\u5EA6\u201D</li><li><strong>\u524D\u8FDB\u6307\u9488</strong> \u6BCF\u4E2A\u5C42\u90FD\u6709\u4E00\u4E2A\u6307\u5411\u8868\u5C3E\u7684\u524D\u8FDB\u6307\u9488\uFF08level[i].forward\u5C5E\u6027\uFF09\uFF0C\u7528\u4E8E\u4ECE\u8868\u5934\u5411\u8868\u5C3E\u65B9\u5411\u8BBF\u95EE\u8282\u70B9\u3002\u6211\u4EEC\u770B\u4E00\u4E0B\u8DF3\u8DC3\u8868\u4ECE\u8868\u5934\u5230\u8868\u5C3E\uFF0C\u904D\u5386\u6240\u6709\u8282\u70B9\u7684\u8DEF\u5F84\uFF1A <img src="https://cdn.nlark.com/yuque/0/2022/png/21883277/1663306743544-adc87a85-a033-413d-a95b-3b5bbbda2504.png#averageHue=%23fdfaf9&amp;clientId=ucf814711-336e-4&amp;errorMessage=unknown error&amp;from=paste&amp;id=uf9f12a80&amp;originHeight=460&amp;originWidth=1146&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=error&amp;style=none&amp;taskId=u08b275f8-0b7a-4218-995c-b79370c4139&amp;title=" alt=""></li><li><strong>\u8DE8\u5EA6</strong> \u5C42\u7684\u8DE8\u5EA6\u7528\u4E8E\u8BB0\u5F55\u4E24\u4E2A\u8282\u70B9\u4E4B\u95F4\u7684\u8DDD\u79BB\u3002\u8DE8\u5EA6\u662F\u7528\u6765\u8BA1\u7B97\u6392\u4F4D\uFF08rank\uFF09\u7684\uFF1A\u5728\u67E5\u627E\u67D0\u4E2A\u8282\u70B9\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u5C06\u6CBF\u9014\u8BBF\u95EE\u8FC7\u7684\u6240\u6709\u5C42\u7684\u8DE8\u5EA6\u7D2F\u8BA1\u8D77\u6765\uFF0C\u5F97\u5230\u7684\u7ED3\u679C\u5C31\u662F\u76EE\u6807\u8282\u70B9\u5728\u8DF3\u8DC3\u8868\u4E2D\u7684\u6392\u4F4D\u3002\u4F8B\u5982\u67E5\u627E\uFF0C\u5206\u503C\u4E3A3.0\u3001\u6210\u5458\u5BF9\u8C61\u4E3Ao3\u7684\u8282\u70B9\u65F6\uFF0C\u6CBF\u9014\u7ECF\u5386\u7684\u5C42\uFF1A\u67E5\u627E\u7684\u8FC7\u7A0B\u53EA\u7ECF\u8FC7\u4E86\u4E00\u4E2A\u5C42\uFF0C\u5E76\u4E14\u5C42\u7684\u8DE8\u5EA6\u4E3A3\uFF0C\u6240\u4EE5\u76EE\u6807\u8282\u70B9\u5728\u8DF3\u8DC3\u8868\u4E2D\u7684\u6392\u4F4D\u4E3A3\u3002 <img src="https://cdn.nlark.com/yuque/0/2022/png/21883277/1663306743856-a8bcbf2a-454b-4678-887b-ae68a91946e6.png#averageHue=%23fdf9f9&amp;clientId=ucf814711-336e-4&amp;errorMessage=unknown error&amp;from=paste&amp;id=udec1dbb0&amp;originHeight=438&amp;originWidth=1127&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=error&amp;style=none&amp;taskId=ua9a54c2a-dd72-4d21-bbad-b1249f690f7&amp;title=" alt=""></li><li><strong>\u5206\u503C\u548C\u6210\u5458</strong> \u8282\u70B9\u7684\u5206\u503C\uFF08score\u5C5E\u6027\uFF09\u662F\u4E00\u4E2Adouble\u7C7B\u578B\u7684\u6D6E\u70B9\u6570\uFF0C\u8DF3\u8DC3\u8868\u4E2D\u6240\u6709\u7684\u8282\u70B9\u90FD\u6309\u5206\u503C\u4ECE\u5C0F\u5230\u5927\u6765\u6392\u5E8F\u3002\u8282\u70B9\u7684\u6210\u5458\u5BF9\u8C61\uFF08obj\u5C5E\u6027\uFF09\u662F\u4E00\u4E2A\u6307\u9488\uFF0C\u5B83\u6307\u5411\u4E00\u4E2A\u5B57\u7B26\u4E32\u5BF9\u8C61\uFF0C\u800C\u5B57\u7B26\u4E32\u5BF9\u8C61\u5219\u4FDD\u5B58\u8FD9\u4E00\u4E2ASDS\u503C\u3002</li></ul><h3 id="_5-\u538B\u7F29\u5217\u8868\u4E86\u89E3\u5417" tabindex="-1"><a class="header-anchor" href="#_5-\u538B\u7F29\u5217\u8868\u4E86\u89E3\u5417" aria-hidden="true">#</a> 5. \u538B\u7F29\u5217\u8868\u4E86\u89E3\u5417\uFF1F</h3><p>\u538B\u7F29\u5217\u8868\u662F Redis <strong>\u4E3A\u4E86\u8282\u7EA6\u5185\u5B58</strong> \u800C\u4F7F\u7528\u7684\u4E00\u79CD\u6570\u636E\u7ED3\u6784\uFF0C\u662F\u7531\u4E00\u7CFB\u5217\u7279\u6B8A\u7F16\u7801\u7684\u8FDE\u7EED\u5185\u5B58\u5FEB\u7EC4\u6210\u7684\u987A\u5E8F\u578B\u6570\u636E\u7ED3\u6784\u3002 \u4E00\u4E2A\u538B\u7F29\u5217\u8868\u53EF\u4EE5\u5305\u542B\u4EFB\u610F\u591A\u4E2A\u8282\u70B9\uFF08entry\uFF09\uFF0C\u6BCF\u4E2A\u8282\u70B9\u53EF\u4EE5\u4FDD\u5B58\u4E00\u4E2A\u5B57\u8282\u6570\u7EC4\u6216\u8005\u4E00\u4E2A\u6574\u6570\u503C\u3002 <img src="https://cdn.nlark.com/yuque/0/2022/png/21883277/1663306744035-b7f62385-757b-40c3-bf04-a08f4bf5fa23.png#averageHue=%23fefaf9&amp;clientId=ucf814711-336e-4&amp;errorMessage=unknown error&amp;from=paste&amp;id=u4eeb9e5e&amp;originHeight=98&amp;originWidth=1097&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=error&amp;style=none&amp;taskId=u30421cee-ea52-4591-8178-41c7662653d&amp;title=" alt="">\u538B\u7F29\u5217\u8868\u7531\u8FD9\u4E48\u51E0\u90E8\u5206\u7EC4\u6210\uFF1A</p><ul><li><strong>zlbyttes</strong>:\u8BB0\u5F55\u6574\u4E2A\u538B\u7F29\u5217\u8868\u5360\u7528\u7684\u5185\u5B58\u5B57\u8282\u6570</li><li><strong>zltail</strong>:\u8BB0\u5F55\u538B\u7F29\u5217\u8868\u8868\u5C3E\u8282\u70B9\u8DDD\u79BB\u538B\u7F29\u5217\u8868\u7684\u8D77\u59CB\u5730\u5740\u6709\u591A\u5C11\u5B57\u8282</li><li><strong>zllen</strong>:\u8BB0\u5F55\u538B\u7F29\u5217\u8868\u5305\u542B\u7684\u8282\u70B9\u6570\u91CF</li><li><strong>entryX</strong>:\u5217\u8868\u8282\u70B9</li><li><strong>zlend</strong>:\u7528\u4E8E\u6807\u8BB0\u538B\u7F29\u5217\u8868\u7684\u672B\u7AEF</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2022/png/21883277/1663306743976-0b8dd53d-1439-492d-bb85-717f3fe58d95.png#averageHue=%23fdfbfa&amp;clientId=ucf814711-336e-4&amp;errorMessage=unknown error&amp;from=paste&amp;id=u473a0898&amp;originHeight=177&amp;originWidth=972&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=error&amp;style=none&amp;taskId=u9b1ca784-d1de-4cd5-889c-6e51d56b945&amp;title=" alt=""></p><h3 id="_6-\u5FEB\u901F\u5217\u8868-quicklist-\u4E86\u89E3\u5417" tabindex="-1"><a class="header-anchor" href="#_6-\u5FEB\u901F\u5217\u8868-quicklist-\u4E86\u89E3\u5417" aria-hidden="true">#</a> 6. \u5FEB\u901F\u5217\u8868 quicklist \u4E86\u89E3\u5417\uFF1F</h3><p>Redis \u65E9\u671F\u7248\u672C\u5B58\u50A8 list \u5217\u8868\u6570\u636E\u7ED3\u6784\u4F7F\u7528\u7684\u662F\u538B\u7F29\u5217\u8868 ziplist \u548C\u666E\u901A\u7684\u53CC\u5411\u94FE\u8868 linkedlist\uFF0C\u4E5F\u5C31\u662F\u8BF4\u5F53\u5143\u7D20\u5C11\u65F6\u4F7F\u7528 ziplist\uFF0C\u5F53\u5143\u7D20\u591A\u65F6\u7528 linkedlist\u3002 \u4F46\u8003\u8651\u5230\u94FE\u8868\u7684\u9644\u52A0\u7A7A\u95F4\u76F8\u5BF9\u8F83\u9AD8\uFF0Cprev \u548C next \u6307\u9488\u5C31\u8981\u5360\u53BB 16 \u4E2A\u5B57\u8282\uFF0864 \u4F4D\u64CD\u4F5C\u7CFB\u7EDF\u5360\u7528 8 \u4E2A\u5B57\u8282\uFF09\uFF0C\u53E6\u5916\u6BCF\u4E2A\u8282\u70B9\u7684\u5185\u5B58\u90FD\u662F\u5355\u72EC\u5206\u914D\uFF0C\u4F1A\u5BB6\u5177\u5185\u5B58\u7684\u788E\u7247\u5316\uFF0C\u5F71\u54CD\u5185\u5B58\u7BA1\u7406\u6548\u7387\u3002 \u540E\u6765 Redis \u65B0\u7248\u672C\uFF083.2\uFF09\u5BF9\u5217\u8868\u6570\u636E\u7ED3\u6784\u8FDB\u884C\u4E86\u6539\u9020\uFF0C\u4F7F\u7528 quicklist \u4EE3\u66FF\u4E86 ziplist \u548C linkedlist\uFF0Cquicklist\u662F\u7EFC\u5408\u8003\u8651\u4E86\u65F6\u95F4\u6548\u7387\u4E0E\u7A7A\u95F4\u6548\u7387\u5F15\u5165\u7684\u65B0\u578B\u6570\u636E\u7ED3\u6784\u3002 quicklist\u7531list\u548Cziplist\u7ED3\u5408\u800C\u6210\uFF0C\u5B83\u662F\u4E00\u4E2A\u7531ziplist\u5145\u5F53\u8282\u70B9\u7684\u53CC\u5411\u94FE\u8868\u3002 <img src="https://cdn.nlark.com/yuque/0/2022/png/21883277/1663306744224-e4cf4efb-8842-4181-94b4-5c08b424b079.png#averageHue=%23cfcecd&amp;clientId=ucf814711-336e-4&amp;errorMessage=unknown error&amp;from=paste&amp;id=u4deba7f6&amp;originHeight=786&amp;originWidth=1340&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=error&amp;style=none&amp;taskId=ub2c3f708-3964-4105-8037-557a407b543&amp;title=" alt=""></p><h3 id="_7-\u6570\u636E\u7C7B\u578B\u7684\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_7-\u6570\u636E\u7C7B\u578B\u7684\u5B9E\u73B0" aria-hidden="true">#</a> 7. \u6570\u636E\u7C7B\u578B\u7684\u5B9E\u73B0</h3><p><img src="https://cdn.nlark.com/yuque/0/2022/png/21883277/1663307009707-496669fb-ba1f-4d38-9759-c2137d216d18.png#averageHue=%23faf7ed&amp;clientId=ucf814711-336e-4&amp;errorMessage=unknown error&amp;from=paste&amp;id=u858c35e1&amp;originHeight=830&amp;originWidth=1352&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=94050&amp;status=error&amp;style=none&amp;taskId=ud5dc364b-4014-42a0-8f2c-7ab4191cf4b&amp;title=" alt="image.png"></p><h3 id="_8-\u4EC0\u4E48\u662F\u7A7A\u95F4\u9884\u5206\u914D\u4EE5\u53CA\u60F0\u6027\u7A7A\u95F4\u91CA\u653E-sds-\u662F\u600E\u4E48\u5B9E\u73B0\u7684" tabindex="-1"><a class="header-anchor" href="#_8-\u4EC0\u4E48\u662F\u7A7A\u95F4\u9884\u5206\u914D\u4EE5\u53CA\u60F0\u6027\u7A7A\u95F4\u91CA\u653E-sds-\u662F\u600E\u4E48\u5B9E\u73B0\u7684" aria-hidden="true">#</a> 8. \u4EC0\u4E48\u662F\u7A7A\u95F4\u9884\u5206\u914D\u4EE5\u53CA\u60F0\u6027\u7A7A\u95F4\u91CA\u653E\uFF0CSDS \u662F\u600E\u4E48\u5B9E\u73B0\u7684</h3><p>\u9996\u5148\uFF0CSDS \u4E3B\u8981\u901A\u8FC7 \u672A\u4F7F\u7528\u7A7A\u95F4\u6765\u5B9E\u73B0\u7684\u3002</p><ul><li>\u7A7A\u95F4\u9884\u5206\u914D\uFF0C\u5728 SDS \u4E2D\u7684\u8868\u73B0\u662F\uFF0C\u5982\u679C\u5BF9 SDS \u7684\u957F\u5EA6\u8FDB\u884C\u4FEE\u6539\uFF0C\u7A0B\u5E8F\u4F1A\u591A\u5206\u914D\u4E00\u90E8\u5206\u7684\u672A\u4F7F\u7528\u7A7A\u95F4\uFF0C\u81F3\u4E8E\u5206\u914D\u591A\u5C11\u53D6\u51B3\u4E8E <code>len</code> \u5C5E\u6027\uFF0C\u5F53 <code>len&lt;1MB</code>\u65F6\uFF0C\u4F1A\u5206\u914D <code>len</code>\u7684\u672A\u4F7F\u7528\u7A7A\u95F4\uFF1B\u5426\u5219\u5206\u914D <code>1MB</code>\u3002</li></ul><blockquote><p>\u5982\u679C\u672A\u4F7F\u7528\u7A7A\u95F4\uFF0C\u8DB3\u4EE5\u653E\u4E0B\u4FEE\u6539\u540E\u7684\u5B57\u7B26\uFF0C<code>len</code>\u662F\u4E0D\u4F1A\u53D1\u751F\u53D8\u5316\u7684\u3002\u4E5F\u5C31\u662F\u8BF4\uFF0C\u7A7A\u95F4\u7684\u9884\u5206\u914D\u628A\u5B57\u7B26\u7684\u91CD\u5206\u914D\u6B21\u6570\u4ECE N \u6B21\uFF0C\u964D\u4E3A \u6700\u591A N \u6B21\u3002</p></blockquote><ul><li>\u60F0\u6027\u7A7A\u95F4\u91CA\u653E\uFF0C\u5728 SDS \u4E2D\u7684\u8868\u73B0\u662F\uFF0C\u5F53\u5B57\u7B26\u4E32\u7F29\u77ED\u65F6\uFF0C\u5E76\u4E0D\u7ACB\u5373\u91CA\u653E\u7A7A\u95F4\uFF0C\u800C\u662F\u4FDD\u7559\u4E3A\u672A\u4F7F\u7528\u7A7A\u95F4\uFF0C\u7559\u5F85\u540E\u7EED\u4F7F\u7528\u3002\uFF08\u5F53\u7136\u4E5F\u53EF\u4EE5\u624B\u52A8\u91CA\u653E\uFF09\u3002</li></ul><h3 id="_9-\u4E3A\u4EC0\u4E48\u8BF4-sds-\u662F\u4E8C\u8FDB\u5236\u5B89\u5168\u7684\u5462" tabindex="-1"><a class="header-anchor" href="#_9-\u4E3A\u4EC0\u4E48\u8BF4-sds-\u662F\u4E8C\u8FDB\u5236\u5B89\u5168\u7684\u5462" aria-hidden="true">#</a> 9. \u4E3A\u4EC0\u4E48\u8BF4 SDS \u662F\u4E8C\u8FDB\u5236\u5B89\u5168\u7684\u5462</h3><p>\u56E0\u4E3A SDS \u4E3B\u8981\u5229\u7528 <code>buffer + len + free</code>\uFF0C\u8868\u793A\u5B57\u7B26\u4E32\uFF0C\u7531\u5E95\u5C42\u7684\u5B57\u7B26\u6570\u7EC4 <code>buf</code>\u5B58\u50A8\u5B57\u7B26\uFF0C<code>len</code>\u8868\u793A\u6709\u6548\u7684\u5B57\u7B26\u957F\u5EA6\uFF0C\u7A0B\u5E8F\u4E0D\u4F1A\u5BF9 <code>buffer</code>\u4E2D\u6570\u636E\u8FDB\u884C\u4EFB\u4F55\u7684\u9650\u5236\u3001\u8FC7\u6EE4\u6216\u8005\u5047\u8BBE\u7B49\u64CD\u4F5C\u3002</p><h3 id="_10-\u8BF4\u8BF4-redis-\u91CC\u7684\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#_10-\u8BF4\u8BF4-redis-\u91CC\u7684\u5BF9\u8C61" aria-hidden="true">#</a> 10. \u8BF4\u8BF4 redis \u91CC\u7684\u5BF9\u8C61</h3><p>\u5BF9\u8C61\u4E5F\u5C31\u662F redis \u5728\u5E95\u5C42\u6570\u636E\u7ED3\u6784\u4E4B\u4E0A\u5305\u88C5\u7684\u4E00\u5C42 RedisObject\uFF08\u5BF9\u8C61\uFF09\uFF0C\u5E38\u89C1\u7684 RedisObject \u6709\u4E94\u79CD\uFF1A\u5B57\u7B26\u4E32\u5BF9\u8C61\u3001\u5217\u8868\u5BF9\u8C61\u3001\u54C8\u5E0C\u5BF9\u8C61\u3001\u96C6\u5408\u5BF9\u8C61\u548C\u6709\u5E8F\u96C6\u5408\u5BF9\u8C61\u3002</p><h3 id="_11-\u4F7F\u7528-redisobject-\u7684\u597D\u5904" tabindex="-1"><a class="header-anchor" href="#_11-\u4F7F\u7528-redisobject-\u7684\u597D\u5904" aria-hidden="true">#</a> 11. \u4F7F\u7528 RedisObject \u7684\u597D\u5904</h3><p>\u4F7F\u7528 RedisObject \u7684\u4F18\u70B9\u4E3B\u8981\u6709\u4E24\u4E2A\uFF0C\u5206\u522B\u662F\uFF1A</p><ol><li>\u901A\u8FC7\u4E0D\u540C\u7C7B\u578B\u7684\u5BF9\u8C61\uFF0CRedis \u53EF\u4EE5\u5728\u6267\u884C\u547D\u4EE4\u4E4B\u524D\uFF0C\u6839\u636E\u5BF9\u8C61\u7684\u7C7B\u578B\u6765\u5224\u65AD\u4E00\u4E2A\u5BF9\u8C61\u662F\u5426\u53EF\u4EE5\u6267\u884C\u7ED9\u5B9A\u7684\u547D\u4EE4\u3002</li><li>\u6211\u4EEC\u53EF\u4EE5\u9488\u5BF9\u4E0D\u540C\u7684\u4F7F\u7528\u573A\u666F\uFF0C\u4E3A\u5BF9\u8C61\u8BBE\u7F6E\u4E0D\u540C\u7684\u5B9E\u73B0\uFF0C\u4ECE\u800C\u4F18\u5316\u5185\u5B58\u6216\u67E5\u8BE2\u901F\u5EA6\u3002</li></ol><h3 id="_12-redisobject-\u7684\u5177\u4F53\u7ED3\u6784\u662F\u4EC0\u4E48" tabindex="-1"><a class="header-anchor" href="#_12-redisobject-\u7684\u5177\u4F53\u7ED3\u6784\u662F\u4EC0\u4E48" aria-hidden="true">#</a> 12. RedisObject \u7684\u5177\u4F53\u7ED3\u6784\u662F\u4EC0\u4E48</h3><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">redisObject</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u7C7B\u578B</span>
    <span class="token keyword">unsigned</span> type<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token comment">// \u7F16\u7801</span>
    <span class="token keyword">unsigned</span> encoding<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token comment">// \u6307\u5411\u5B9E\u9645\u503C\u7684\u6307\u9488</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token punctuation">}</span> robj<span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="" tabindex="-1"><a class="header-anchor" href="#" aria-hidden="true">#</a></h3><h2 id="\u6301\u4E45\u5316" tabindex="-1"><a class="header-anchor" href="#\u6301\u4E45\u5316" aria-hidden="true">#</a> \u6301\u4E45\u5316</h2><h3 id="_1-\u4EC0\u4E48\u662Fredis\u6301\u4E45\u5316" tabindex="-1"><a class="header-anchor" href="#_1-\u4EC0\u4E48\u662Fredis\u6301\u4E45\u5316" aria-hidden="true">#</a> 1. \u4EC0\u4E48\u662FRedis\u6301\u4E45\u5316\uFF1F</h3><p>\u6301\u4E45\u5316\u5C31\u662F\u628A\u5185\u5B58\u7684\u6570\u636E\u5199\u5230\u78C1\u76D8\u4E2D\u53BB\uFF0C\u9632\u6B62\u670D\u52A1\u5B95\u673A\u4E86\u5185\u5B58\u6570\u636E\u4E22\u5931\u3002</p><h3 id="_2-redis-\u7684\u6301\u4E45\u5316\u673A\u5236\u662F\u4EC0\u4E48-\u5404\u81EA\u7684\u4F18\u7F3A\u70B9" tabindex="-1"><a class="header-anchor" href="#_2-redis-\u7684\u6301\u4E45\u5316\u673A\u5236\u662F\u4EC0\u4E48-\u5404\u81EA\u7684\u4F18\u7F3A\u70B9" aria-hidden="true">#</a> 2. Redis \u7684\u6301\u4E45\u5316\u673A\u5236\u662F\u4EC0\u4E48\uFF1F\u5404\u81EA\u7684\u4F18\u7F3A\u70B9\uFF1F</h3><p>Redis \u63D0\u4F9B\u4E24\u79CD\u6301\u4E45\u5316\u673A\u5236 RDB\uFF08\u9ED8\u8BA4\uFF09 \u548C AOF \u673A\u5236\u3002</p><h4 id="_2-1-rdb-redis-database-\u5FEB\u7167" tabindex="-1"><a class="header-anchor" href="#_2-1-rdb-redis-database-\u5FEB\u7167" aria-hidden="true">#</a> 2.1 RDB\uFF08Redis DataBase\uFF09\uFF0C\u5FEB\u7167</h4><p>RDB\u662FRedis\u9ED8\u8BA4\u7684\u6301\u4E45\u5316\u65B9\u5F0F\u3002\u6309\u7167\u4E00\u5B9A\u7684\u65F6\u95F4\u5C06\u5185\u5B58\u7684\u6570\u636E\u4EE5\u5FEB\u7167\u7684\u5F62\u5F0F\u4FDD\u5B58\u5230\u786C\u76D8\u4E2D\uFF0C\u5BF9\u5E94\u4EA7\u751F\u7684\u6570\u636E\u6587\u4EF6\u4E3A <code>dump.rdb</code>\u3002\u901A\u8FC7\u914D\u7F6E\u6587\u4EF6\u4E2D\u7684save\u53C2\u6570\u6765\u5B9A\u4E49\u5FEB\u7167\u7684\u5468\u671F\u3002 <img src="https://cdn.nlark.com/yuque/0/2020/png/2517043/1599814784865-bef71e87-8835-401e-b916-9c633733e318.png#averageHue=%237ba373&amp;height=171&amp;id=EYeJY&amp;originHeight=342&amp;originWidth=1288&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=61807&amp;status=done&amp;style=none&amp;title=&amp;width=644" alt="image.png"> \u4F18\u70B9\uFF1A</p><ul><li><ol><li>\u53EA\u6709\u4E00\u4E2A\u6587\u4EF6 dump.rdb\uFF0C\u65B9\u4FBF\u6301\u4E45\u5316\u3002</li></ol></li><li><ol start="2"><li>\u5BB9\u707E\u6027\u597D\uFF0C\u4E00\u4E2A\u6587\u4EF6\u53EF\u4EE5\u4FDD\u5B58\u5230\u5B89\u5168\u7684\u78C1\u76D8\u3002</li></ol></li><li><ol start="3"><li>\u6027\u80FD\u6700\u5927\u5316\uFF0Cfork \u5B50\u8FDB\u7A0B\u6765\u5B8C\u6210\u5199\u64CD\u4F5C\uFF0C\u8BA9\u4E3B\u8FDB\u7A0B\u7EE7\u7EED\u5904\u7406\u547D\u4EE4\uFF0C\u6240\u4EE5\u662F IO \u6700\u5927\u5316\u3002\u4F7F\u7528\u5355\u72EC\u5B50\u8FDB\u7A0B\u6765\u8FDB\u884C\u6301\u4E45\u5316\uFF0C\u4E3B\u8FDB\u7A0B\u4E0D\u4F1A\u8FDB\u884C\u4EFB\u4F55 IO \u64CD\u4F5C\uFF0C\u4FDD\u8BC1\u4E86 redis \u7684\u9AD8\u6027\u80FD</li></ol></li><li><ol start="4"><li>\u76F8\u5BF9\u4E8E\u6570\u636E\u96C6\u5927\u65F6\uFF0C\u6BD4 AOF \u7684\u542F\u52A8\u6548\u7387\u66F4\u9AD8\u3002</li></ol></li></ul><p>\u7F3A\u70B9\uFF1A</p><ul><li><ol><li>\u6570\u636E\u5B89\u5168\u6027\u4F4E\u3002RDB \u662F\u95F4\u9694\u4E00\u6BB5\u65F6\u95F4\u8FDB\u884C\u6301\u4E45\u5316\uFF0C\u5982\u679C\u6301\u4E45\u5316\u4E4B\u95F4 redis \u53D1\u751F\u6545\u969C\uFF0C\u4F1A\u53D1\u751F\u6570\u636E\u4E22\u5931\u3002\u6240\u4EE5\u8FD9\u79CD\u65B9\u5F0F\u66F4\u9002\u5408\u6570\u636E\u8981\u6C42\u4E0D\u4E25\u8C28\u7684\u65F6\u5019)</li></ol></li></ul><h4 id="_2-2-aof-append-only-file-\u65E5\u5FD7" tabindex="-1"><a class="header-anchor" href="#_2-2-aof-append-only-file-\u65E5\u5FD7" aria-hidden="true">#</a> 2.2 AOF\uFF08Append Only File\uFF09\uFF0C\u65E5\u5FD7</h4><p>AOF\u6301\u4E45\u5316(\u5373Append Only File\u6301\u4E45\u5316)\uFF0C\u5219\u662F\u5C06Redis\u6267\u884C\u7684\u6BCF\u6B21\u5199\u547D\u4EE4\u8BB0\u5F55\u5230\u5355\u72EC\u7684\u65E5\u5FD7\u6587\u4EF6\u4E2D\uFF0C\u5F53\u91CD\u542FRedis\u4F1A\u91CD\u65B0\u5C06\u6301\u4E45\u5316\u7684\u65E5\u5FD7\u4E2D\u6587\u4EF6\u6062\u590D\u6570\u636E\u3002</p><blockquote><p>\u6240\u6709\u7684\u547D\u4EE4\u884C\u8BB0\u5F55\u4EE5 redis \u547D\u4EE4\u8BF7 \u6C42\u534F\u8BAE\u7684\u683C\u5F0F\u5B8C\u5168\u6301\u4E45\u5316\u5B58\u50A8)\u4FDD\u5B58\u4E3A aof \u6587\u4EF6\u3002</p></blockquote><p>\u5F53\u4E24\u79CD\u65B9\u5F0F\u540C\u65F6\u5F00\u542F\u65F6\uFF0C\u6570\u636E\u6062\u590DRedis\u4F1A\u4F18\u5148\u9009\u62E9AOF\u6062\u590D\u3002 <img src="https://cdn.nlark.com/yuque/0/2020/png/2517043/1599814807336-143a8c4f-1f92-42d5-bf3c-fd6594f77f82.png#averageHue=%23baeeaf&amp;height=277&amp;id=ffbyT&amp;originHeight=554&amp;originWidth=1264&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=565205&amp;status=done&amp;style=none&amp;title=&amp;width=632" alt="image.png"> \u4F18\u70B9\uFF1A</p><ul><li>1\u3001\u6570\u636E\u5B89\u5168\uFF0Caof \u6301\u4E45\u5316\u53EF\u4EE5\u914D\u7F6E <code>appendfsync</code> \u5C5E\u6027\uFF0C\u6709 always\uFF0C\u6BCF\u8FDB\u884C\u4E00\u6B21 \u547D\u4EE4\u64CD\u4F5C\u5C31\u8BB0\u5F55\u5230 aof \u6587\u4EF6\u4E2D\u4E00\u6B21\u3002</li><li>2\u3001\u901A\u8FC7 append \u6A21\u5F0F\u5199\u6587\u4EF6\uFF0C\u5373\u4F7F\u4E2D\u9014\u670D\u52A1\u5668\u5B95\u673A\uFF0C\u53EF\u4EE5\u901A\u8FC7 <code>redis-check-aof </code>\u5DE5\u5177\u89E3\u51B3\u6570\u636E\u4E00\u81F4\u6027\u95EE\u9898\u3002</li><li>3\u3001AOF \u673A\u5236\u7684 rewrite \u6A21\u5F0F\u3002AOF \u6587\u4EF6\u6CA1\u88AB rewrite \u4E4B\u524D\uFF08\u6587\u4EF6\u8FC7\u5927\u65F6\u4F1A\u5BF9\u547D\u4EE4 \u8FDB\u884C\u5408\u5E76\u91CD\u5199\uFF09\uFF0C\u53EF\u4EE5\u5220\u9664\u5176\u4E2D\u7684\u67D0\u4E9B\u547D\u4EE4\uFF08\u6BD4\u5982\u8BEF\u64CD\u4F5C\u7684 flushall\uFF09)</li></ul><p>\u7F3A\u70B9\uFF1A</p><ul><li>1\u3001AOF \u6587\u4EF6\u6BD4 RDB \u6587\u4EF6\u5927\uFF0C\u4E14\u6062\u590D\u901F\u5EA6\u6162\u3002</li><li>2\u3001\u6570\u636E\u96C6\u5927\u7684\u65F6\u5019\uFF0C\u6BD4 rdb \u542F\u52A8\u6548\u7387\u4F4E\u3002</li></ul><h3 id="_3-\u4F18\u7F3A\u70B9\u662F\u4EC0\u4E48" tabindex="-1"><a class="header-anchor" href="#_3-\u4F18\u7F3A\u70B9\u662F\u4EC0\u4E48" aria-hidden="true">#</a> 3. \u4F18\u7F3A\u70B9\u662F\u4EC0\u4E48\uFF1F</h3><ul><li>AOF\u6587\u4EF6\u6BD4RDB\u66F4\u65B0\u9891\u7387\u9AD8\uFF0C\u4F18\u5148\u4F7F\u7528AOF\u8FD8\u539F\u6570\u636E\u3002</li><li>AOF\u6BD4RDB\u66F4\u5B89\u5168\u4E5F\u66F4\u5927</li><li>RDB\u6027\u80FD\u6BD4AOF\u597D</li><li>\u5982\u679C\u4E24\u4E2A\u90FD\u914D\u4E86\u4F18\u5148\u52A0\u8F7DAOF</li></ul><h3 id="_4-\u5982\u4F55\u9009\u62E9\u5408\u9002\u7684\u6301\u4E45\u5316\u65B9\u5F0F" tabindex="-1"><a class="header-anchor" href="#_4-\u5982\u4F55\u9009\u62E9\u5408\u9002\u7684\u6301\u4E45\u5316\u65B9\u5F0F" aria-hidden="true">#</a> 4. \u5982\u4F55\u9009\u62E9\u5408\u9002\u7684\u6301\u4E45\u5316\u65B9\u5F0F</h3><ul><li>\u5982\u679C\u6781\u5EA6\u5173\u5FC3\u6570\u636E\u5B89\u5168\u6027\uFF0C\u4F60\u5E94\u8BE5\u540C\u65F6\u4F7F\u7528\u4E24\u79CD\u6301\u4E45\u5316\u529F\u80FD\u3002\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B\uFF0C\u5F53 Redis \u91CD\u542F\u7684\u65F6\u5019\u4F1A\u4F18\u5148\u8F7D\u5165AOF \u6587\u4EF6\u6765\u6062\u590D\u539F\u59CB\u7684\u6570\u636E\uFF0C\u56E0\u4E3A\u5728\u901A\u5E38\u60C5\u51B5\u4E0BAOF\u6587\u4EF6\u4FDD\u5B58\u7684\u6570\u636E\u96C6\u8981\u6BD4RDB\u6587\u4EF6\u4FDD\u5B58\u7684\u6570\u636E\u96C6\u8981\u5B8C\u6574\u3002</li><li>\u5982\u679C\u975E\u5E38\u5173\u5FC3\u4F60\u7684\u6570\u636E\uFF0C \u4F46\u4ECD\u7136\u53EF\u4EE5\u627F\u53D7\u6570\u5206\u949F\u4EE5\u5185\u7684\u6570\u636E\u4E22\u5931\uFF0C\u90A3\u4E48\u4F60\u53EF\u4EE5\u53EA\u4F7F\u7528RDB\u6301\u4E45\u5316\u3002</li><li>\u5982\u679C\u4F60\u53EA\u5E0C\u671B\u4F60\u7684\u6570\u636E\u5728\u670D\u52A1\u5668\u8FD0\u884C\u7684\u65F6\u5019\u5B58\u5728\uFF0C\u4F60\u4E5F\u53EF\u4EE5\u4E0D\u4F7F\u7528\u4EFB\u4F55\u6301\u4E45\u5316\u65B9\u5F0F\u3002</li><li>\u6709\u5F88\u591A\u7528\u6237\u90FD\u53EA\u4F7F\u7528 AOF \u6301\u4E45\u5316\uFF0C\u4F46\u5E76\u4E0D\u63A8\u8350\u8FD9\u79CD\u65B9\u5F0F\uFF0C\u56E0\u4E3A\u5B9A\u65F6\u751F\u6210 RDB \u5FEB\u7167\uFF08snapshot\uFF09\u975E\u5E38\u4FBF\u4E8E\u8FDB\u884C\u6570\u636E\u5E93\u5907\u4EFD\uFF0C \u5E76\u4E14 RDB \u6062\u590D\u6570\u636E\u96C6\u7684\u901F\u5EA6\u4E5F\u8981\u6BD4AOF\u6062\u590D\u7684\u901F\u5EA6\u8981\u5FEB\uFF0C\u9664\u6B64\u4E4B\u5916\uFF0C\u4F7F\u7528 RDB \u8FD8\u53EF\u4EE5\u907F\u514D AOF \u7A0B\u5E8F\u7684 bug \u3002</li></ul><h3 id="_5-redis\u6301\u4E45\u5316\u6570\u636E\u548C\u7F13\u5B58\u600E\u4E48\u505A\u6269\u5BB9" tabindex="-1"><a class="header-anchor" href="#_5-redis\u6301\u4E45\u5316\u6570\u636E\u548C\u7F13\u5B58\u600E\u4E48\u505A\u6269\u5BB9" aria-hidden="true">#</a> 5. Redis\u6301\u4E45\u5316\u6570\u636E\u548C\u7F13\u5B58\u600E\u4E48\u505A\u6269\u5BB9\uFF1F</h3><ul><li>\u5982\u679CRedis\u88AB\u5F53\u505A\u7F13\u5B58\u4F7F\u7528\uFF0C\u4F7F\u7528\u4E00\u81F4\u6027\u54C8\u5E0C\u5B9E\u73B0\u52A8\u6001\u6269\u5BB9\u7F29\u5BB9\u3002</li><li>\u5982\u679CRedis\u88AB\u5F53\u505A\u4E00\u4E2A\u6301\u4E45\u5316\u5B58\u50A8\u4F7F\u7528\uFF0C\u5FC5\u987B\u4F7F\u7528\u56FA\u5B9A\u7684 keys-to-nodes \u6620\u5C04\u5173\u7CFB\uFF0C\u8282\u70B9\u7684\u6570\u91CF\u4E00\u65E6\u786E\u5B9A\u4E0D\u80FD\u53D8\u5316\u3002\u5426\u5219\u7684\u8BDD( \u5373Redis\u8282\u70B9\u9700\u8981\u52A8\u6001\u53D8\u5316\u7684\u60C5\u51B5 \uFF09\uFF0C\u5FC5\u987B\u4F7F\u7528\u53EF\u4EE5\u5728\u8FD0\u884C\u65F6\u8FDB\u884C\u6570\u636E\u518D\u5E73\u8861\u7684\u4E00\u5957\u7CFB\u7EDF\uFF0C\u800C\u5F53\u524D\u53EA\u6709Redis\u96C6\u7FA4\u53EF\u4EE5\u505A\u5230\u8FD9\u6837\u3002</li></ul><h3 id="_6-redis-\u600E\u4E48\u786E\u4FDD-aof-\u4E0D\u4E22\u5931" tabindex="-1"><a class="header-anchor" href="#_6-redis-\u600E\u4E48\u786E\u4FDD-aof-\u4E0D\u4E22\u5931" aria-hidden="true">#</a> 6. Redis \u600E\u4E48\u786E\u4FDD Aof \u4E0D\u4E22\u5931</h3><p>\u9996\u5148\uFF0C\u8981 <code>AOF</code>\u5B8C\u5168\u4E0D\u4E22\u5931\uFF0C\u662F\u4E0D\u53EF\u80FD\u7684\uFF0C\u56E0\u4E3A aof \u7684\u5199\u56DE\u7B56\u7565\u53EA\u6709\u4E09\u79CD\uFF0C<code>always\uFF0CeverySec\uFF0C no</code>\uFF0C\u5C31\u7B97\u542F\u7528\u7684\u662F <code>always</code>\uFF0C\u7531\u4E8E redis \u662F\u5199\u540E\u65E5\u5FD7\uFF0C\u5F53\u6570\u636E\u5199\u5165\u6210\u529F\u7684\u77AC\u95F4\uFF0Credis \u5B9E\u4F8B\u5B95\u673A\u4E86\uFF0C\u4F9D\u7136\u4F1A\u5BFC\u81F4 aof \u4E22\u5931\uFF0C\u4F46\u662F\u6B64\u65F6\uFF0Credis \u6CA1\u6709\u54CD\u5E94\uFF0C\u6240\u4EE5\u53EF\u4EE5\u8BA4\u4E3A aof \u4E0D\u66FE\u4E22\u5931\uFF08\u56E0\u4E3A\u4E1A\u52A1\u6CA1\u6709\u6210\u529F\u54CD\u5E94\uFF09\u3002</p><h3 id="_7-aof-\u65E5\u5FD7\u662F\u5199\u524D\u8FD8\u662F\u5199\u540E\u65E5\u5FD7" tabindex="-1"><a class="header-anchor" href="#_7-aof-\u65E5\u5FD7\u662F\u5199\u524D\u8FD8\u662F\u5199\u540E\u65E5\u5FD7" aria-hidden="true">#</a> 7. Aof \u65E5\u5FD7\u662F\u5199\u524D\u8FD8\u662F\u5199\u540E\u65E5\u5FD7</h3><p>\u8BF4\u5230\u65E5\u5FD7\uFF0C\u6211\u4EEC\u6BD4\u8F83\u719F\u6089\u7684\u662F\u6570\u636E\u5E93\u7684\u5199\u524D\u65E5\u5FD7\uFF08Write Ahead Log, WAL\uFF09\uFF0C\u4E5F\u5C31\u662F\u8BF4\uFF0C\u5728\u5B9E\u9645\u5199\u6570\u636E\u524D\uFF0C\u5148\u628A\u4FEE\u6539\u7684\u6570\u636E\u8BB0\u5230\u65E5\u5FD7\u6587\u4EF6\u4E2D\uFF0C\u4EE5\u4FBF\u6545\u969C\u65F6\u8FDB\u884C\u6062\u590D\u3002\u4E0D\u8FC7\uFF0CAOF\u65E5\u5FD7\u6B63\u597D\u76F8\u53CD\uFF0C\u5B83\u662F\u5199\u540E\u65E5\u5FD7\uFF0C\u201C\u5199\u540E\u201D\u7684\u610F\u601D\u662FRedis\u662F\u5148\u6267\u884C\u547D\u4EE4\uFF0C\u628A\u6570\u636E\u5199\u5165\u5185\u5B58\uFF0C\u7136\u540E\u624D\u8BB0\u5F55\u65E5\u5FD7\u3002</p><h3 id="_8-aof\u4E3A\u4EC0\u4E48\u8981\u5148\u6267\u884C\u547D\u4EE4\u518D\u8BB0\u65E5\u5FD7" tabindex="-1"><a class="header-anchor" href="#_8-aof\u4E3A\u4EC0\u4E48\u8981\u5148\u6267\u884C\u547D\u4EE4\u518D\u8BB0\u65E5\u5FD7" aria-hidden="true">#</a> 8. AOF\u4E3A\u4EC0\u4E48\u8981\u5148\u6267\u884C\u547D\u4EE4\u518D\u8BB0\u65E5\u5FD7</h3><blockquote><p>\u8981\u56DE\u7B54\u8FD9\u4E2A\u95EE\u9898\uFF0C\u6211\u4EEC\u8981\u5148\u77E5\u9053AOF\u91CC\u8BB0\u5F55\u4E86\u4EC0\u4E48\u5185\u5BB9\u3002</p></blockquote><blockquote><p>\u4F20\u7EDF\u6570\u636E\u5E93\u7684\u65E5\u5FD7\uFF0C\u4F8B\u5982redo log\uFF08\u91CD\u505A\u65E5\u5FD7\uFF09\uFF0C\u8BB0\u5F55\u7684\u662F\u4FEE\u6539\u540E\u7684\u6570\u636E\uFF0C\u800CAOF\u91CC\u8BB0\u5F55\u7684\u662FRedis\u6536\u5230\u7684\u6BCF\u4E00\u6761\u547D\u4EE4\uFF0C\u8FD9\u4E9B\u547D\u4EE4\u662F\u4EE5\u6587\u672C\u5F62\u5F0F\u4FDD\u5B58\u7684\u3002</p></blockquote><blockquote><p>\u6211\u4EEC\u4EE5Redis\u6536\u5230\u201C set testkey testvalue \u201D\u547D\u4EE4\u540E\u8BB0\u5F55\u7684\u65E5\u5FD7\u4E3A\u4F8B\uFF0C\u770B\u770B AOF \u65E5\u5FD7\u7684\u5185\u5BB9\u3002\u5176\u4E2D\uFF0C\u201C*3\u201D\u8868\u793A\u5F53\u524D\u547D\u4EE4\u6709\u4E09\u4E2A\u90E8\u5206\uFF0C\u6BCF\u90E8\u5206\u90FD\u662F\u7531\u201C$+\u6570\u5B57\u201D\u5F00\u5934\uFF0C\u540E\u9762\u7D27\u8DDF\u7740\u5177\u4F53\u7684\u547D\u4EE4\u3001\u952E\u6216\u503C\u3002\u8FD9\u91CC\uFF0C\u201C\u6570\u5B57\u201D\u8868\u793A\u8FD9\u90E8\u5206\u4E2D\u7684\u547D\u4EE4\u3001\u952E\u6216\u503C\u4E00\u5171\u6709\u591A\u5C11\u5B57\u8282\u3002\u4F8B\u5982\uFF0C\u201C$3 set\u201D\u8868\u793A\u8FD9\u90E8\u5206\u67093\u4E2A\u5B57\u8282\uFF0C\u4E5F\u5C31\u662F\u201Cset\u201D\u547D\u4EE4\u3002</p></blockquote><hr><p>\u6700\u91CD\u8981\u7684\u539F\u56E0\u662F Redis \u4F5C\u4E3A\u4E00\u4E2A\u5185\u5B58\u6570\u636E\u5E93\u8FFD\u6C42\u6781\u81F4\u7684\u6027\u80FD\u3002 \u4E3A\u4E86\u907F\u514D\u989D\u5916\u7684\u68C0\u67E5\u5F00\u9500\uFF0CRedis\u5728\u5411AOF\u91CC\u9762\u8BB0\u5F55\u65E5\u5FD7\u7684\u65F6\u5019\uFF0C\u5E76\u4E0D\u4F1A\u5148\u53BB\u5BF9\u8FD9\u4E9B\u547D\u4EE4\u8FDB\u884C\u8BED\u6CD5\u68C0\u67E5\u3002\u6240\u4EE5\uFF0C\u5982\u679C\u5148\u8BB0\u65E5\u5FD7\u518D\u6267\u884C\u547D\u4EE4\u7684\u8BDD\uFF0C\u65E5\u5FD7\u4E2D\u5C31\u6709\u53EF\u80FD\u8BB0\u5F55\u4E86\u9519\u8BEF\u7684\u547D\u4EE4\uFF0CRedis\u5728\u4F7F\u7528\u65E5\u5FD7\u6062\u590D\u6570\u636E\u65F6\uFF0C\u5C31\u53EF\u80FD\u4F1A\u51FA\u9519\u3002 \u800C\u5199\u540E\u65E5\u5FD7\u8FD9\u79CD\u65B9\u5F0F\uFF0C\u5C31\u662F\u5148\u8BA9\u7CFB\u7EDF\u6267\u884C\u547D\u4EE4\uFF0C\u53EA\u6709\u547D\u4EE4\u80FD\u6267\u884C\u6210\u529F\uFF0C\u624D\u4F1A\u88AB\u8BB0\u5F55\u5230\u65E5\u5FD7\u4E2D\uFF0C\u5426\u5219\uFF0C\u7CFB\u7EDF\u5C31\u4F1A\u76F4\u63A5\u5411\u5BA2\u6237\u7AEF\u62A5\u9519\u3002\u6240\u4EE5\uFF0CRedis\u4F7F\u7528\u5199\u540E\u65E5\u5FD7\u8FD9\u4E00\u65B9\u5F0F\u7684\u4E00\u5927\u597D\u5904\u662F\uFF0C\u53EF\u4EE5\u907F\u514D\u51FA\u73B0\u8BB0\u5F55\u9519\u8BEF\u547D\u4EE4\u7684\u60C5\u51B5\u3002 \u9664\u6B64\u4E4B\u5916\uFF0CAOF\u8FD8\u6709\u4E00\u4E2A\u597D\u5904\uFF1A\u5B83\u662F\u5728\u547D\u4EE4\u6267\u884C\u540E\u624D\u8BB0\u5F55\u65E5\u5FD7\uFF0C\u6240\u4EE5\u4E0D\u4F1A\u963B\u585E\u5F53\u524D\u7684\u5199\u64CD\u4F5C\u3002</p><h3 id="_9-redis-aof-\u7684\u98CE\u9669" tabindex="-1"><a class="header-anchor" href="#_9-redis-aof-\u7684\u98CE\u9669" aria-hidden="true">#</a> 9. Redis Aof \u7684\u98CE\u9669</h3><p>AOF\u4E5F\u6709\u4E24\u4E2A\u6F5C\u5728\u7684\u98CE\u9669\u3002 \u9996\u5148\uFF0C\u5982\u679C\u521A\u6267\u884C\u5B8C\u4E00\u4E2A\u547D\u4EE4\uFF0C\u8FD8\u6CA1\u6709\u6765\u5F97\u53CA\u8BB0\u65E5\u5FD7\u5C31\u5B95\u673A\u4E86\uFF0C\u90A3\u4E48\u8FD9\u4E2A\u547D\u4EE4\u548C\u76F8\u5E94\u7684\u6570\u636E\u5C31\u6709\u4E22\u5931\u7684\u98CE\u9669\u3002\u5982\u679C\u6B64\u65F6Redis\u662F\u7528\u4F5C\u7F13\u5B58\uFF0C\u8FD8\u53EF\u4EE5\u4ECE\u540E\u7AEF\u6570\u636E\u5E93\u91CD\u65B0\u8BFB\u5165\u6570\u636E\u8FDB\u884C\u6062\u590D\uFF0C\u4F46\u662F\uFF0C\u5982\u679CRedis\u662F\u76F4\u63A5\u7528\u4F5C\u6570\u636E\u5E93\u7684\u8BDD\uFF0C\u6B64\u65F6\uFF0C\u56E0\u4E3A\u547D\u4EE4\u6CA1\u6709\u8BB0\u5165\u65E5\u5FD7\uFF0C\u6240\u4EE5\u5C31\u65E0\u6CD5\u7528\u65E5\u5FD7\u8FDB\u884C\u6062\u590D\u4E86\u3002 \u5176\u6B21\uFF0CAOF\u867D\u7136\u907F\u514D\u4E86\u5BF9\u5F53\u524D\u547D\u4EE4\u7684\u963B\u585E\uFF0C\u4F46\u53EF\u80FD\u4F1A\u7ED9\u4E0B\u4E00\u4E2A\u64CD\u4F5C\u5E26\u6765\u963B\u585E\u98CE\u9669\u3002\u8FD9\u662F\u56E0\u4E3A\uFF0CAOF\u65E5\u5FD7\u4E5F\u662F\u5728\u4E3B\u7EBF\u7A0B\u4E2D\u6267\u884C\u7684\uFF0C\u5982\u679C\u5728\u628A\u65E5\u5FD7\u6587\u4EF6\u5199\u5165\u78C1\u76D8\u65F6\uFF0C\u78C1\u76D8\u5199\u538B\u529B\u5927\uFF0C\u5C31\u4F1A\u5BFC\u81F4\u5199\u76D8\u5F88\u6162\uFF0C\u8FDB\u800C\u5BFC\u81F4\u540E\u7EED\u7684\u64CD\u4F5C\u4E5F\u65E0\u6CD5\u6267\u884C\u4E86\u3002 \u4ED4\u7EC6\u5206\u6790\u7684\u8BDD\uFF0C\u4F60\u5C31\u4F1A\u53D1\u73B0\uFF0C\u8FD9\u4E24\u4E2A\u98CE\u9669\u90FD\u662F\u548CAOF\u5199\u56DE\u78C1\u76D8\u7684\u65F6\u673A\u76F8\u5173\u7684\u3002\u8FD9\u4E5F\u5C31\u610F\u5473\u7740\uFF0C\u5982\u679C\u6211\u4EEC\u80FD\u591F\u63A7\u5236\u4E00\u4E2A\u5199\u547D\u4EE4\u6267\u884C\u5B8C\u540EAOF\u65E5\u5FD7\u5199\u56DE\u78C1\u76D8\u7684\u65F6\u673A\uFF0C\u8FD9\u4E24\u4E2A\u98CE\u9669\u5C31\u89E3\u9664\u4E86\u3002</p><h3 id="_10-redis-\u7684\u5199\u56DE\u7B56\u7565" tabindex="-1"><a class="header-anchor" href="#_10-redis-\u7684\u5199\u56DE\u7B56\u7565" aria-hidden="true">#</a> 10. Redis \u7684\u5199\u56DE\u7B56\u7565</h3><p>\u5176\u5B9E\uFF0C\u5BF9\u4E8E\u4E0A\u9762\u7684\u95EE\u9898\uFF0CAOF\u673A\u5236\u7ED9\u6211\u4EEC\u63D0\u4F9B\u4E86\u4E09\u4E2A\u9009\u62E9\uFF0C\u4E5F\u5C31\u662FAOF\u914D\u7F6E\u9879 <code>appendfsync</code>\u7684\u4E09\u4E2A\u53EF\u9009\u503C\u3002</p><ul><li><strong>Always</strong>\uFF0C\u540C\u6B65\u5199\u56DE\uFF1A\u6BCF\u4E2A\u5199\u547D\u4EE4\u6267\u884C\u5B8C\uFF0C\u7ACB\u9A6C\u540C\u6B65\u5730\u5C06\u65E5\u5FD7\u5199\u56DE\u78C1\u76D8\uFF1B</li><li><strong>Everysec</strong>\uFF0C\u6BCF\u79D2\u5199\u56DE\uFF1A\u6BCF\u4E2A\u5199\u547D\u4EE4\u6267\u884C\u5B8C\uFF0C\u53EA\u662F\u5148\u628A\u65E5\u5FD7\u5199\u5230AOF\u6587\u4EF6\u7684\u5185\u5B58\u7F13\u51B2\u533A\uFF0C\u6BCF\u9694\u4E00\u79D2\u628A\u7F13\u51B2\u533A\u4E2D\u7684\u5185\u5BB9\u5199\u5165\u78C1\u76D8\uFF1B</li><li><strong>No</strong>\uFF0C\u64CD\u4F5C\u7CFB\u7EDF\u63A7\u5236\u7684\u5199\u56DE\uFF1A\u6BCF\u4E2A\u5199\u547D\u4EE4\u6267\u884C\u5B8C\uFF0C\u53EA\u662F\u5148\u628A\u65E5\u5FD7\u5199\u5230AOF\u6587\u4EF6\u7684\u5185\u5B58\u7F13\u51B2\u533A\uFF0C\u7531\u64CD\u4F5C\u7CFB\u7EDF\u51B3\u5B9A\u4F55\u65F6\u5C06\u7F13\u51B2\u533A\u5185\u5BB9\u5199\u56DE\u78C1\u76D8\u3002</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2022/png/21883277/1663303712242-1a0e738b-1709-4a56-9e3c-c46a66d297f1.png#averageHue=%23efe09d&amp;clientId=u95bf923c-892f-4&amp;errorMessage=unknown error&amp;from=paste&amp;height=275&amp;id=u363c007d&amp;originHeight=303&amp;originWidth=997&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=134468&amp;status=error&amp;style=none&amp;taskId=ufa73ad39-1b33-429f-ba9a-c5bc26d581b&amp;title=&amp;width=906.3636167187341" alt="image.png"></p><blockquote><p>\u9488\u5BF9\u907F\u514D\u4E3B\u7EBF\u7A0B\u963B\u585E\u548C\u51CF\u5C11\u6570\u636E\u4E22\u5931\u95EE\u9898\uFF0C\u8FD9\u4E09\u79CD\u5199\u56DE\u7B56\u7565\u90FD\u65E0\u6CD5\u505A\u5230\u4E24\u5168\u5176\u7F8E\u3002\u6211\u4EEC\u6765\u5206\u6790\u4E0B\u5176\u4E2D\u7684\u539F\u56E0\u3002</p><ul><li>\u201C\u540C\u6B65\u5199\u56DE\u201D\u53EF\u4EE5\u505A\u5230\u57FA\u672C\u4E0D\u4E22\u6570\u636E\uFF0C\u4F46\u662F\u5B83\u5728\u6BCF\u4E00\u4E2A\u5199\u547D\u4EE4\u540E\u90FD\u6709\u4E00\u4E2A\u6162\u901F\u7684\u843D\u76D8\u64CD\u4F5C\uFF0C\u4E0D\u53EF\u907F\u514D\u5730\u4F1A\u5F71\u54CD\u4E3B\u7EBF\u7A0B\u6027\u80FD\uFF1B</li><li>\u867D\u7136\u201C\u64CD\u4F5C\u7CFB\u7EDF\u63A7\u5236\u7684\u5199\u56DE\u201D\u5728\u5199\u5B8C\u7F13\u51B2\u533A\u540E\uFF0C\u5C31\u53EF\u4EE5\u7EE7\u7EED\u6267\u884C\u540E\u7EED\u7684\u547D\u4EE4\uFF0C\u4F46\u662F\u843D\u76D8\u7684\u65F6\u673A\u5DF2\u7ECF\u4E0D\u5728Redis\u624B\u4E2D\u4E86\uFF0C\u53EA\u8981AOF\u8BB0\u5F55\u6CA1\u6709\u5199\u56DE\u78C1\u76D8\uFF0C\u4E00\u65E6\u5B95\u673A\u5BF9\u5E94\u7684\u6570\u636E\u5C31\u4E22\u5931\u4E86\uFF1B</li><li>\u201C\u6BCF\u79D2\u5199\u56DE\u201D\u91C7\u7528\u4E00\u79D2\u5199\u56DE\u4E00\u6B21\u7684\u9891\u7387\uFF0C\u907F\u514D\u4E86\u201C\u540C\u6B65\u5199\u56DE\u201D\u7684\u6027\u80FD\u5F00\u9500\uFF0C\u867D\u7136\u51CF\u5C11\u4E86\u5BF9\u7CFB\u7EDF\u6027\u80FD\u7684\u5F71\u54CD\uFF0C\u4F46\u662F\u5982\u679C\u53D1\u751F\u5B95\u673A\uFF0C\u4E0A\u4E00\u79D2\u5185\u672A\u843D\u76D8\u7684\u547D\u4EE4\u64CD\u4F5C\u4ECD\u7136\u4F1A\u4E22\u5931\u3002\u6240\u4EE5\uFF0C\u8FD9\u53EA\u80FD\u7B97\u662F\uFF0C\u5728\u907F\u514D\u5F71\u54CD\u4E3B\u7EBF\u7A0B\u6027\u80FD\u548C\u907F\u514D\u6570\u636E\u4E22\u5931\u4E24\u8005\u95F4\u53D6\u4E86\u4E2A\u6298\u4E2D\u3002</li></ul></blockquote><h3 id="_11-\u5982\u4F55\u9009\u62E9\u56DE\u5199\u7B56\u7565" tabindex="-1"><a class="header-anchor" href="#_11-\u5982\u4F55\u9009\u62E9\u56DE\u5199\u7B56\u7565" aria-hidden="true">#</a> 11. \u5982\u4F55\u9009\u62E9\u56DE\u5199\u7B56\u7565</h3><p>\u5176\u5B9E\u8FD9\u662F\u4E00\u4E2A\u9AD8\u6027\u80FD\u4EE5\u53CA\u9AD8\u53EF\u9760\u7684\u6743\u8861\u95EE\u9898\u3002 \u60F3\u8981\u83B7\u5F97\u9AD8\u6027\u80FD\uFF0C\u5C31\u9009\u62E9 No \u7B56\u7565\uFF1B \u5982\u679C\u60F3\u8981\u5F97\u5230\u9AD8\u53EF\u9760\u6027\u4FDD\u8BC1\uFF0C\u5C31\u9009\u62E9 Always \u7B56\u7565\uFF1B \u5982\u679C\u5141\u8BB8\u6570\u636E\u6709\u4E00\u70B9\u4E22\u5931\uFF0C\u53C8\u5E0C\u671B\u6027\u80FD\u522B\u53D7\u592A\u5927\u5F71\u54CD\u7684\u8BDD\uFF0C\u90A3\u4E48\u5C31\u9009\u62E9 Everysec \u7B56\u7565\u3002</p><h3 id="_12-redis-\u56DE\u5199\u6709\u4EC0\u4E48\u6027\u80FD\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_12-redis-\u56DE\u5199\u6709\u4EC0\u4E48\u6027\u80FD\u95EE\u9898" aria-hidden="true">#</a> 12. Redis \u56DE\u5199\u6709\u4EC0\u4E48\u6027\u80FD\u95EE\u9898</h3><p>\u4E3B\u8981\u5728\u4E8E\u4EE5\u4E0B\u4E09\u4E2A\u65B9\u9762\uFF1A</p><ol><li>\u6587\u4EF6\u7CFB\u7EDF\u672C\u8EAB\u5BF9\u6587\u4EF6\u5927\u5C0F\u6709\u9650\u5236\uFF0C\u65E0\u6CD5\u4FDD\u5B58\u8FC7\u5927\u7684\u6587\u4EF6\uFF1B</li><li>\u5982\u679C\u6587\u4EF6\u592A\u5927\uFF0C\u4E4B\u540E\u518D\u5F80\u91CC\u9762\u8FFD\u52A0\u547D\u4EE4\u8BB0\u5F55\u7684\u8BDD\uFF0C\u6548\u7387\u4E5F\u4F1A\u53D8\u4F4E\uFF1B</li><li>\u5982\u679C\u53D1\u751F\u5B95\u673A\uFF0CAOF\u4E2D\u8BB0\u5F55\u7684\u547D\u4EE4\u8981\u4E00\u4E2A\u4E2A\u88AB\u91CD\u65B0\u6267\u884C\uFF0C\u7528\u4E8E\u6545\u969C\u6062\u590D\uFF0C\u5982\u679C\u65E5\u5FD7\u6587\u4EF6\u592A\u5927\uFF0C\u6574\u4E2A\u6062\u590D\u8FC7\u7A0B\u5C31\u4F1A\u975E\u5E38\u7F13\u6162\uFF0C\u8FD9\u5C31\u4F1A\u5F71\u54CD\u5230Redis\u7684\u6B63\u5E38\u4F7F\u7528\u3002</li></ol><h3 id="_13-aof-\u65E5\u5FD7\u6587\u4EF6\u592A\u5927\u600E\u4E48\u529E" tabindex="-1"><a class="header-anchor" href="#_13-aof-\u65E5\u5FD7\u6587\u4EF6\u592A\u5927\u600E\u4E48\u529E" aria-hidden="true">#</a> 13. Aof \u65E5\u5FD7\u6587\u4EF6\u592A\u5927\u600E\u4E48\u529E</h3><p>\u53EF\u4EE5\u91CD\u5199Aof</p><h3 id="_14-redis-\u7684\u91CD\u5199\u673A\u5236\u4E86\u89E3\u5417" tabindex="-1"><a class="header-anchor" href="#_14-redis-\u7684\u91CD\u5199\u673A\u5236\u4E86\u89E3\u5417" aria-hidden="true">#</a> 14. redis \u7684\u91CD\u5199\u673A\u5236\u4E86\u89E3\u5417</h3><p>\u7B80\u5355\u6765\u8BF4\uFF0CAOF\u91CD\u5199\u673A\u5236\u5C31\u662F\u5728\u91CD\u5199\u65F6\uFF0CRedis\u6839\u636E\u6570\u636E\u5E93\u7684\u73B0\u72B6\u521B\u5EFA\u4E00\u4E2A\u65B0\u7684AOF\u6587\u4EF6\uFF0C\u4E5F\u5C31\u662F\u8BF4\uFF0C\u8BFB\u53D6\u6570\u636E\u5E93\u4E2D\u7684\u6240\u6709\u952E\u503C\u5BF9\uFF0C\u7136\u540E\u5BF9\u6BCF\u4E00\u4E2A\u952E\u503C\u5BF9\u7528\u4E00\u6761\u547D\u4EE4\u8BB0\u5F55\u5B83\u7684\u5199\u5165\u3002\u6BD4\u5982\u8BF4\uFF0C\u5F53\u8BFB\u53D6\u4E86\u952E\u503C\u5BF9 <code>\u201Ctestkey\u201D: \u201Ctestvalue\u201D</code>\u4E4B\u540E\uFF0C\u91CD\u5199\u673A\u5236\u4F1A\u8BB0\u5F55 <code>set testkey testvalue</code>\u8FD9\u6761\u547D\u4EE4\u3002\u8FD9\u6837\uFF0C\u5F53\u9700\u8981\u6062\u590D\u65F6\uFF0C\u53EF\u4EE5\u91CD\u65B0\u6267\u884C\u8BE5\u547D\u4EE4\uFF0C\u5B9E\u73B0<code>\u201Ctestkey\u201D: \u201Ctestvalue\u201D</code>\u7684\u5199\u5165\u3002</p><h3 id="_15-\u4E3A\u4EC0\u4E48\u91CD\u5199\u4F1A\u4F7F\u65E5\u5FD7\u6587\u4EF6\u53D8\u5C0F" tabindex="-1"><a class="header-anchor" href="#_15-\u4E3A\u4EC0\u4E48\u91CD\u5199\u4F1A\u4F7F\u65E5\u5FD7\u6587\u4EF6\u53D8\u5C0F" aria-hidden="true">#</a> 15. \u4E3A\u4EC0\u4E48\u91CD\u5199\u4F1A\u4F7F\u65E5\u5FD7\u6587\u4EF6\u53D8\u5C0F</h3><p>\u4E3B\u8981\u662F\u56E0\u4E3A\u91CD\u5199\u7684\u8FC7\u7A0B\u4E2D\u81EA\u52A8\u628A\u8FC7\u671F\u6570\u636E\u7B5B\u9664\u4E86\uFF0C\u8FBE\u5230 \u591A\u53D8\u4E00 \u7684\u76EE\u7684\u3002 \u6211\u4EEC\u77E5\u9053\uFF0CAOF\u6587\u4EF6\u662F\u4EE5\u8FFD\u52A0\u7684\u65B9\u5F0F\uFF0C\u9010\u4E00\u8BB0\u5F55\u63A5\u6536\u5230\u7684\u5199\u547D\u4EE4\u7684\u3002\u5F53\u4E00\u4E2A\u952E\u503C\u5BF9\u88AB\u591A\u6761\u5199\u547D\u4EE4\u53CD\u590D\u4FEE\u6539\u65F6\uFF0CAOF\u6587\u4EF6\u4F1A\u8BB0\u5F55\u76F8\u5E94\u7684\u591A\u6761\u547D\u4EE4\u3002\u4F46\u662F\uFF0C\u5728\u91CD\u5199\u7684\u65F6\u5019\uFF0C\u662F\u6839\u636E\u8FD9\u4E2A\u952E\u503C\u5BF9\u5F53\u524D\u7684\u6700\u65B0\u72B6\u6001\uFF0C\u4E3A\u5B83\u751F\u6210\u5BF9\u5E94\u7684\u5199\u5165\u547D\u4EE4\u3002\u8FD9\u6837\u4E00\u6765\uFF0C\u4E00\u4E2A\u952E\u503C\u5BF9\u5728\u91CD\u5199\u65E5\u5FD7\u4E2D\u53EA\u7528\u4E00\u6761\u547D\u4EE4\u5C31\u884C\u4E86\uFF0C\u800C\u4E14\uFF0C\u5728\u65E5\u5FD7\u6062\u590D\u65F6\uFF0C\u53EA\u7528\u6267\u884C\u8FD9\u6761\u547D\u4EE4\uFF0C\u5C31\u53EF\u4EE5\u76F4\u63A5\u5B8C\u6210\u8FD9\u4E2A\u952E\u503C\u5BF9\u7684\u5199\u5165\u4E86\u3002</p><h3 id="_16-aof-\u91CD\u5199\u4F1A\u5835\u585E\u4E3B\u7EBF\u7A0B\u5417" tabindex="-1"><a class="header-anchor" href="#_16-aof-\u91CD\u5199\u4F1A\u5835\u585E\u4E3B\u7EBF\u7A0B\u5417" aria-hidden="true">#</a> 16. AOF \u91CD\u5199\u4F1A\u5835\u585E\u4E3B\u7EBF\u7A0B\u5417</h3><p>\u548CAOF\u65E5\u5FD7\u7531\u4E3B\u7EBF\u7A0B\u5199\u56DE\u4E0D\u540C\uFF0C\u91CD\u5199\u8FC7\u7A0B\u662F\u7531\u540E\u53F0\u7EBF\u7A0B <code>bgrewriteaof</code>\u6765\u5B8C\u6210\u7684\uFF0C\u8FD9\u4E5F\u662F\u4E3A\u4E86\u907F\u514D\u963B\u585E\u4E3B\u7EBF\u7A0B\uFF0C\u5BFC\u81F4\u6570\u636E\u5E93\u6027\u80FD\u4E0B\u964D\u3002</p><h3 id="_17-\u91CD\u5199\u7684\u8FC7\u7A0B" tabindex="-1"><a class="header-anchor" href="#_17-\u91CD\u5199\u7684\u8FC7\u7A0B" aria-hidden="true">#</a> 17. \u91CD\u5199\u7684\u8FC7\u7A0B</h3><p>\u6211\u628A\u91CD\u5199\u7684\u8FC7\u7A0B\u603B\u7ED3\u4E3A\u201C<strong>\u4E00\u4E2A\u62F7\u8D1D\uFF0C\u4E24\u5904\u65E5\u5FD7</strong>\u201D\u3002 \u5728fork\u51FA\u5B50\u8FDB\u7A0B\u65F6\u7684\u62F7\u8D1D\uFF0C\u4EE5\u53CA\u5728\u91CD\u5199\u65F6\uFF0C\u5982\u679C\u6709\u65B0\u6570\u636E\u5199\u5165\uFF0C\u4E3B\u7EBF\u7A0B\u5C31\u4F1A\u5C06\u547D\u4EE4\u8BB0\u5F55\u5230\u4E24\u4E2Aaof\u65E5\u5FD7\u5185\u5B58\u7F13\u51B2\u533A\u4E2D\u3002 \u5982\u679CAOF\u5199\u56DE\u7B56\u7565\u914D\u7F6E\u7684\u662Falways\uFF0C\u5219\u76F4\u63A5\u5C06\u547D\u4EE4\u5199\u56DE\u65E7\u7684\u65E5\u5FD7\u6587\u4EF6\uFF0C\u5E76\u4E14\u4FDD\u5B58\u4E00\u4EFD\u547D\u4EE4\u81F3AOF\u91CD\u5199\u7F13\u51B2\u533A\uFF0C\u8FD9\u4E9B\u64CD\u4F5C\u5BF9\u65B0\u7684\u65E5\u5FD7\u6587\u4EF6\u662F\u4E0D\u5B58\u5728\u5F71\u54CD\u7684\u3002\uFF08\u65E7\u7684\u65E5\u5FD7\u6587\u4EF6\uFF1A\u4E3B\u7EBF\u7A0B\u4F7F\u7528\u7684\u65E5\u5FD7\u6587\u4EF6\uFF0C\u65B0\u7684\u65E5\u5FD7\u6587\u4EF6\uFF1Abgrewriteaof\u8FDB\u7A0B\u4F7F\u7528\u7684\u65E5\u5FD7\u6587\u4EF6\uFF09 \u800C\u5728bgrewriteaof\u5B50\u8FDB\u7A0B\u5B8C\u6210\u4F1A\u65E5\u5FD7\u6587\u4EF6\u7684\u91CD\u5199\u64CD\u4F5C\u540E\uFF0C\u4F1A\u63D0\u793A\u4E3B\u7EBF\u7A0B\u5DF2\u7ECF\u5B8C\u6210\u91CD\u5199\u64CD\u4F5C\uFF0C\u4E3B\u7EBF\u7A0B\u4F1A\u5C06AOF\u91CD\u5199\u7F13\u51B2\u4E2D\u7684\u547D\u4EE4\u8FFD\u52A0\u5230\u65B0\u7684\u65E5\u5FD7\u6587\u4EF6\u540E\u9762\u3002\u8FD9\u65F6\u5019\u5728\u9AD8\u5E76\u53D1\u7684\u60C5\u51B5\u4E0B\uFF0CAOF\u91CD\u5199\u7F13\u51B2\u533A\u79EF\u7D2F\u53EF\u80FD\u4F1A\u5F88\u5927\uFF0C\u8FD9\u6837\u5C31\u4F1A\u9020\u6210\u963B\u585E\uFF0CRedis\u540E\u6765\u901A\u8FC7Linux\u7BA1\u9053\u6280\u672F\u8BA9aof\u91CD\u5199\u671F\u95F4\u5C31\u80FD\u540C\u65F6\u8FDB\u884C\u56DE\u653E\uFF0C\u8FD9\u6837aof\u91CD\u5199\u7ED3\u675F\u540E\u53EA\u9700\u56DE\u653E\u5C11\u91CF\u5269\u4F59\u7684\u6570\u636E\u5373\u53EF\u3002 \u6700\u540E\u901A\u8FC7\u4FEE\u6539\u6587\u4EF6\u540D\u7684\u65B9\u5F0F\uFF0C\u4FDD\u8BC1\u6587\u4EF6\u5207\u6362\u7684\u539F\u5B50\u6027\u3002 \u5728AOF\u91CD\u5199\u65E5\u5FD7\u671F\u95F4\u53D1\u751F\u5B95\u673A\u7684\u8BDD\uFF0C\u56E0\u4E3A\u65E5\u5FD7\u6587\u4EF6\u8FD8\u6CA1\u5207\u6362\uFF0C\u6240\u4EE5\u6062\u590D\u6570\u636E\u65F6\uFF0C\u7528\u7684\u8FD8\u662F\u65E7\u7684\u65E5\u5FD7\u6587\u4EF6\u3002</p><hr><p>\u8457\u4F5C\u6743\u5F52@pdai\u6240\u6709 \u539F\u6587\u94FE\u63A5\uFF1Ahttps://pdai.tech/md/interview/x-interview.html</p><h4 id="-1" tabindex="-1"><a class="header-anchor" href="#-1" aria-hidden="true">#</a></h4><p><img src="https://cdn.nlark.com/yuque/0/2022/jpeg/21883277/1663304394600-7a4db216-6063-4578-adc1-797cb93251dc.jpeg#averageHue=%23f7f8e8&amp;clientId=u95bf923c-892f-4&amp;errorMessage=unknown error&amp;from=paste&amp;id=udaf1f07b&amp;originHeight=1872&amp;originWidth=4000&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=error&amp;style=none&amp;taskId=ud1dc83a7-892d-45c6-9de9-60b5eef4918&amp;title=" alt=""><img src="https://cdn.nlark.com/yuque/0/2023/png/21883277/1676389039987-98529ed9-d86a-4c4c-897a-f2ca3193bc16.png#averageHue=%23f7f7f7&amp;clientId=ubfe63528-9758-4&amp;from=paste&amp;height=784&amp;id=uf355135b&amp;originHeight=784&amp;originWidth=895&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=108871&amp;status=done&amp;style=none&amp;taskId=u3822d3ad-2e95-4463-91f1-5297f482ef9&amp;title=&amp;width=895" alt="image.png"></p><h3 id="_18-aof\u65E5\u5FD7\u91CD\u5199\u7684\u65F6\u5019-\u662F\u7531bgrewriteaof\u5B50\u8FDB\u7A0B\u6765\u5B8C\u6210\u7684-\u4E0D\u7528\u4E3B\u7EBF\u7A0B\u53C2\u4E0E-\u6211\u4EEC\u4ECA\u5929\u8BF4\u7684\u975E\u963B\u585E\u4E5F\u662F\u6307\u5B50\u8FDB\u7A0B\u7684\u6267\u884C\u4E0D\u963B\u585E\u4E3B\u7EBF\u7A0B\u3002\u4F46\u662F-\u4F60\u89C9\u5F97-\u8FD9\u4E2A\u91CD\u5199\u8FC7\u7A0B\u6709\u6CA1\u6709\u5176\u4ED6\u6F5C\u5728\u7684\u963B\u585E\u98CE\u9669\u5462-\u5982\u679C\u6709\u7684\u8BDD-\u4F1A\u5728\u54EA\u91CC\u963B\u585E" tabindex="-1"><a class="header-anchor" href="#_18-aof\u65E5\u5FD7\u91CD\u5199\u7684\u65F6\u5019-\u662F\u7531bgrewriteaof\u5B50\u8FDB\u7A0B\u6765\u5B8C\u6210\u7684-\u4E0D\u7528\u4E3B\u7EBF\u7A0B\u53C2\u4E0E-\u6211\u4EEC\u4ECA\u5929\u8BF4\u7684\u975E\u963B\u585E\u4E5F\u662F\u6307\u5B50\u8FDB\u7A0B\u7684\u6267\u884C\u4E0D\u963B\u585E\u4E3B\u7EBF\u7A0B\u3002\u4F46\u662F-\u4F60\u89C9\u5F97-\u8FD9\u4E2A\u91CD\u5199\u8FC7\u7A0B\u6709\u6CA1\u6709\u5176\u4ED6\u6F5C\u5728\u7684\u963B\u585E\u98CE\u9669\u5462-\u5982\u679C\u6709\u7684\u8BDD-\u4F1A\u5728\u54EA\u91CC\u963B\u585E" aria-hidden="true">#</a> 18. AOF\u65E5\u5FD7\u91CD\u5199\u7684\u65F6\u5019\uFF0C\u662F\u7531bgrewriteaof\u5B50\u8FDB\u7A0B\u6765\u5B8C\u6210\u7684\uFF0C\u4E0D\u7528\u4E3B\u7EBF\u7A0B\u53C2\u4E0E\uFF0C\u6211\u4EEC\u4ECA\u5929\u8BF4\u7684\u975E\u963B\u585E\u4E5F\u662F\u6307\u5B50\u8FDB\u7A0B\u7684\u6267\u884C\u4E0D\u963B\u585E\u4E3B\u7EBF\u7A0B\u3002\u4F46\u662F\uFF0C\u4F60\u89C9\u5F97\uFF0C\u8FD9\u4E2A\u91CD\u5199\u8FC7\u7A0B\u6709\u6CA1\u6709\u5176\u4ED6\u6F5C\u5728\u7684\u963B\u585E\u98CE\u9669\u5462\uFF1F\u5982\u679C\u6709\u7684\u8BDD\uFF0C\u4F1A\u5728\u54EA\u91CC\u963B\u585E\uFF1F</h3><p>a. fork\u5B50\u8FDB\u7A0B\uFF0Cfork\u8FD9\u4E2A\u77AC\u95F4\u4E00\u5B9A\u662F\u4F1A\u963B\u585E\u4E3B\u7EBF\u7A0B\u7684\uFF08\u6CE8\u610F\uFF0Cfork\u65F6\u5E76\u4E0D\u4F1A\u4E00\u6B21\u6027\u62F7\u8D1D\u6240\u6709\u5185\u5B58\u6570\u636E\u7ED9\u5B50\u8FDB\u7A0B\uFF0C\u8001\u5E08\u6587\u7AE0\u5199\u7684\u662F\u62F7\u8D1D\u6240\u6709\u5185\u5B58\u6570\u636E\u7ED9\u5B50\u8FDB\u7A0B\uFF0C\u6211\u4E2A\u4EBA\u8BA4\u4E3A\u662F\u6709\u6B67\u4E49\u7684\uFF09\uFF0Cfork\u91C7\u7528\u64CD\u4F5C\u7CFB\u7EDF\u63D0\u4F9B\u7684\u5199\u5B9E\u590D\u5236(Copy On Write)\u673A\u5236\uFF0C\u5C31\u662F\u4E3A\u4E86\u907F\u514D\u4E00\u6B21\u6027\u62F7\u8D1D\u5927\u91CF\u5185\u5B58\u6570\u636E\u7ED9\u5B50\u8FDB\u7A0B\u9020\u6210\u7684\u957F\u65F6\u95F4\u963B\u585E\u95EE\u9898\uFF0C\u4F46fork\u5B50\u8FDB\u7A0B\u9700\u8981\u62F7\u8D1D\u8FDB\u7A0B\u5FC5\u8981\u7684\u6570\u636E\u7ED3\u6784\uFF0C\u5176\u4E2D\u6709\u4E00\u9879\u5C31\u662F\u62F7\u8D1D\u5185\u5B58\u9875\u8868\uFF08\u865A\u62DF\u5185\u5B58\u548C\u7269\u7406\u5185\u5B58\u7684\u6620\u5C04\u7D22\u5F15\u8868\uFF09\uFF0C\u8FD9\u4E2A\u62F7\u8D1D\u8FC7\u7A0B\u4F1A\u6D88\u8017\u5927\u91CFCPU\u8D44\u6E90\uFF0C\u62F7\u8D1D\u5B8C\u6210\u4E4B\u524D\u6574\u4E2A\u8FDB\u7A0B\u662F\u4F1A\u963B\u585E\u7684\uFF0C\u963B\u585E\u65F6\u95F4\u53D6\u51B3\u4E8E\u6574\u4E2A\u5B9E\u4F8B\u7684\u5185\u5B58\u5927\u5C0F\uFF0C\u5B9E\u4F8B\u8D8A\u5927\uFF0C\u5185\u5B58\u9875\u8868\u8D8A\u5927\uFF0Cfork\u963B\u585E\u65F6\u95F4\u8D8A\u4E45\u3002\u62F7\u8D1D\u5185\u5B58\u9875\u8868\u5B8C\u6210\u540E\uFF0C\u5B50\u8FDB\u7A0B\u4E0E\u7236\u8FDB\u7A0B\u6307\u5411\u76F8\u540C\u7684\u5185\u5B58\u5730\u5740\u7A7A\u95F4\uFF0C\u4E5F\u5C31\u662F\u8BF4\u6B64\u65F6\u867D\u7136\u4EA7\u751F\u4E86\u5B50\u8FDB\u7A0B\uFF0C\u4F46\u662F\u5E76\u6CA1\u6709\u7533\u8BF7\u4E0E\u7236\u8FDB\u7A0B\u76F8\u540C\u7684\u5185\u5B58\u5927\u5C0F\u3002\u90A3\u4EC0\u4E48\u65F6\u5019\u7236\u5B50\u8FDB\u7A0B\u624D\u4F1A\u771F\u6B63\u5185\u5B58\u5206\u79BB\u5462\uFF1F\u201C\u5199\u5B9E\u590D\u5236\u201D\u987E\u540D\u601D\u4E49\uFF0C\u5C31\u662F\u5728\u5199\u53D1\u751F\u65F6\uFF0C\u624D\u771F\u6B63\u62F7\u8D1D\u5185\u5B58\u771F\u6B63\u7684\u6570\u636E\uFF0C\u8FD9\u4E2A\u8FC7\u7A0B\u4E2D\uFF0C\u7236\u8FDB\u7A0B\u4E5F\u53EF\u80FD\u4F1A\u4EA7\u751F\u963B\u585E\u7684\u98CE\u9669\uFF0C\u5C31\u662F\u4E0B\u9762\u4ECB\u7ECD\u7684\u573A\u666F\u3002</p><p>b. fork\u51FA\u7684\u5B50\u8FDB\u7A0B\u6307\u5411\u4E0E\u7236\u8FDB\u7A0B\u76F8\u540C\u7684\u5185\u5B58\u5730\u5740\u7A7A\u95F4\uFF0C\u6B64\u65F6\u5B50\u8FDB\u7A0B\u5C31\u53EF\u4EE5\u6267\u884CAOF\u91CD\u5199\uFF0C\u628A\u5185\u5B58\u4E2D\u7684\u6240\u6709\u6570\u636E\u5199\u5165\u5230AOF\u6587\u4EF6\u4E2D\u3002\u4F46\u662F\u6B64\u65F6\u7236\u8FDB\u7A0B\u4F9D\u65E7\u662F\u4F1A\u6709\u6D41\u91CF\u5199\u5165\u7684\uFF0C\u5982\u679C\u7236\u8FDB\u7A0B\u64CD\u4F5C\u7684\u662F\u4E00\u4E2A\u5DF2\u7ECF\u5B58\u5728\u7684key\uFF0C\u90A3\u4E48\u8FD9\u4E2A\u65F6\u5019\u7236\u8FDB\u7A0B\u5C31\u4F1A\u771F\u6B63\u62F7\u8D1D\u8FD9\u4E2Akey\u5BF9\u5E94\u7684\u5185\u5B58\u6570\u636E\uFF0C\u7533\u8BF7\u65B0\u7684\u5185\u5B58\u7A7A\u95F4\uFF0C\u8FD9\u6837\u9010\u6E10\u5730\uFF0C\u7236\u5B50\u8FDB\u7A0B\u5185\u5B58\u6570\u636E\u5F00\u59CB\u5206\u79BB\uFF0C\u7236\u5B50\u8FDB\u7A0B\u9010\u6E10\u62E5\u6709\u5404\u81EA\u72EC\u7ACB\u7684\u5185\u5B58\u7A7A\u95F4\u3002\u56E0\u4E3A\u5185\u5B58\u5206\u914D\u662F\u4EE5\u9875\u4E3A\u5355\u4F4D\u8FDB\u884C\u5206\u914D\u7684\uFF0C\u9ED8\u8BA44k\uFF0C\u5982\u679C\u7236\u8FDB\u7A0B\u6B64\u65F6\u64CD\u4F5C\u7684\u662F\u4E00\u4E2Abigkey\uFF0C\u91CD\u65B0\u7533\u8BF7\u5927\u5757\u5185\u5B58\u8017\u65F6\u4F1A\u53D8\u957F\uFF0C\u53EF\u80FD\u4F1A\u4EA7\u963B\u585E\u98CE\u9669\u3002\u53E6\u5916\uFF0C\u5982\u679C\u64CD\u4F5C\u7CFB\u7EDF\u5F00\u542F\u4E86\u5185\u5B58\u5927\u9875\u673A\u5236(Huge Page\uFF0C\u9875\u9762\u5927\u5C0F2M)\uFF0C\u90A3\u4E48\u7236\u8FDB\u7A0B\u7533\u8BF7\u5185\u5B58\u65F6\u963B\u585E\u7684\u6982\u7387\u5C06\u4F1A\u5927\u5927\u63D0\u9AD8\uFF0C\u6240\u4EE5\u5728Redis\u673A\u5668\u4E0A\u9700\u8981\u5173\u95EDHuge Page\u673A\u5236\u3002Redis\u6BCF\u6B21fork\u751F\u6210RDB\u6216AOF\u91CD\u5199\u5B8C\u6210\u540E\uFF0C\u90FD\u53EF\u4EE5\u5728Redis log\u4E2D\u770B\u5230\u7236\u8FDB\u7A0B\u91CD\u65B0\u7533\u8BF7\u4E86\u591A\u5927\u7684\u5185\u5B58\u7A7A\u95F4\u3002</p><h3 id="_19-aof\u91CD\u5199\u4E5F\u6709\u4E00\u4E2A\u91CD\u5199\u65E5\u5FD7-\u4E3A\u4EC0\u4E48\u5B83\u4E0D\u5171\u4EAB\u4F7F\u7528aof\u672C\u8EAB\u7684\u65E5\u5FD7\u5462" tabindex="-1"><a class="header-anchor" href="#_19-aof\u91CD\u5199\u4E5F\u6709\u4E00\u4E2A\u91CD\u5199\u65E5\u5FD7-\u4E3A\u4EC0\u4E48\u5B83\u4E0D\u5171\u4EAB\u4F7F\u7528aof\u672C\u8EAB\u7684\u65E5\u5FD7\u5462" aria-hidden="true">#</a> 19. AOF\u91CD\u5199\u4E5F\u6709\u4E00\u4E2A\u91CD\u5199\u65E5\u5FD7\uFF0C\u4E3A\u4EC0\u4E48\u5B83\u4E0D\u5171\u4EAB\u4F7F\u7528AOF\u672C\u8EAB\u7684\u65E5\u5FD7\u5462</h3><p>AOF\u91CD\u5199\u4E0D\u590D\u7528AOF\u672C\u8EAB\u7684\u65E5\u5FD7\uFF0C\u4E00\u4E2A\u539F\u56E0\u662F\u7236\u5B50\u8FDB\u7A0B\u5199\u540C\u4E00\u4E2A\u6587\u4EF6\u5FC5\u7136\u4F1A\u4EA7\u751F\u7ADE\u4E89\u95EE\u9898\uFF0C\u63A7\u5236\u7ADE\u4E89\u5C31\u610F\u5473\u7740\u4F1A\u5F71\u54CD\u7236\u8FDB\u7A0B\u7684\u6027\u80FD\u3002 \u4E8C\u662F\u5982\u679CAOF\u91CD\u5199\u8FC7\u7A0B\u4E2D\u5931\u8D25\u4E86\uFF0C\u90A3\u4E48\u539F\u672C\u7684AOF\u6587\u4EF6\u76F8\u5F53\u4E8E\u88AB\u6C61\u67D3\u4E86\uFF0C\u65E0\u6CD5\u505A\u6062\u590D\u4F7F\u7528\u3002\u6240\u4EE5Redis AOF\u91CD\u5199\u4E00\u4E2A\u65B0\u6587\u4EF6\uFF0C\u91CD\u5199\u5931\u8D25\u7684\u8BDD\uFF0C\u76F4\u63A5\u5220\u9664\u8FD9\u4E2A\u6587\u4EF6\u5C31\u597D\u4E86\uFF0C\u4E0D\u4F1A\u5BF9\u539F\u5148\u7684AOF\u6587\u4EF6\u4EA7\u751F\u5F71\u54CD\u3002\u7B49\u91CD\u5199\u5B8C\u6210\u4E4B\u540E\uFF0C\u76F4\u63A5\u66FF\u6362\u65E7\u6587\u4EF6\u5373\u53EF</p><h2 id="\u5783\u573E\u56DE\u6536" tabindex="-1"><a class="header-anchor" href="#\u5783\u573E\u56DE\u6536" aria-hidden="true">#</a> \u5783\u573E\u56DE\u6536</h2><h3 id="_1-redis\u7684\u8FC7\u671F\u952E\u7684\u5220\u9664\u7B56\u7565" tabindex="-1"><a class="header-anchor" href="#_1-redis\u7684\u8FC7\u671F\u952E\u7684\u5220\u9664\u7B56\u7565" aria-hidden="true">#</a> 1. Redis\u7684\u8FC7\u671F\u952E\u7684\u5220\u9664\u7B56\u7565</h3><p>\u6211\u4EEC\u90FD\u77E5\u9053\uFF0CRedis\u662Fkey-value\u6570\u636E\u5E93\uFF0C\u6211\u4EEC\u53EF\u4EE5\u8BBE\u7F6ERedis\u4E2D\u7F13\u5B58\u7684key\u7684\u8FC7\u671F\u65F6\u95F4\u3002Redis\u7684\u8FC7\u671F\u7B56\u7565\u5C31\u662F\u6307\u5F53Redis\u4E2D\u7F13\u5B58\u7684key\u8FC7\u671F\u4E86\uFF0CRedis\u5982\u4F55\u5904\u7406\u3002 \u8FC7\u671F\u7B56\u7565\u901A\u5E38\u6709\u4EE5\u4E0B\u4E09\u79CD\uFF1A</p><h4 id="\u5B9A\u65F6\u8FC7\u671F" tabindex="-1"><a class="header-anchor" href="#\u5B9A\u65F6\u8FC7\u671F" aria-hidden="true">#</a> \u5B9A\u65F6\u8FC7\u671F\uFF1A</h4><p>\u6BCF\u4E2A\u8BBE\u7F6E\u8FC7\u671F\u65F6\u95F4\u7684key\u90FD\u9700\u8981\u521B\u5EFA\u4E00\u4E2A\u5B9A\u65F6\u5668\uFF0C\u5230\u8FC7\u671F\u65F6\u95F4\u5C31\u4F1A\u7ACB\u5373\u6E05\u9664\u3002\u8BE5\u7B56\u7565\u53EF\u4EE5\u7ACB\u5373\u6E05\u9664\u8FC7\u671F\u7684\u6570\u636E\uFF0C\u5BF9\u5185\u5B58\u5F88\u53CB\u597D\uFF1B\u4F46\u662F\u4F1A\u5360\u7528\u5927\u91CF\u7684CPU\u8D44\u6E90\u53BB\u5904\u7406\u8FC7\u671F\u7684\u6570\u636E\uFF0C\u4ECE\u800C\u5F71\u54CD\u7F13\u5B58\u7684\u54CD\u5E94\u65F6\u95F4\u548C\u541E\u5410\u91CF\u3002</p><h4 id="\u60F0\u6027\u8FC7\u671F" tabindex="-1"><a class="header-anchor" href="#\u60F0\u6027\u8FC7\u671F" aria-hidden="true">#</a> \u60F0\u6027\u8FC7\u671F\uFF1A</h4><p>\u53EA\u6709\u5F53\u8BBF\u95EE\u4E00\u4E2Akey\u65F6\uFF0C\u624D\u4F1A\u5224\u65AD\u8BE5key\u662F\u5426\u5DF2\u8FC7\u671F\uFF0C\u8FC7\u671F\u5219\u6E05\u9664\u3002\u8BE5\u7B56\u7565\u53EF\u4EE5\u6700\u5927\u5316\u5730\u8282\u7701CPU\u8D44\u6E90\uFF0C\u5374\u5BF9\u5185\u5B58\u975E\u5E38\u4E0D\u53CB\u597D\u3002\u6781\u7AEF\u60C5\u51B5\u53EF\u80FD\u51FA\u73B0\u5927\u91CF\u7684\u8FC7\u671Fkey\u6CA1\u6709\u518D\u6B21\u88AB\u8BBF\u95EE\uFF0C\u4ECE\u800C\u4E0D\u4F1A\u88AB\u6E05\u9664\uFF0C\u5360\u7528\u5927\u91CF\u5185\u5B58\u3002</p><h4 id="\u5B9A\u671F\u8FC7\u671F" tabindex="-1"><a class="header-anchor" href="#\u5B9A\u671F\u8FC7\u671F" aria-hidden="true">#</a> \u5B9A\u671F\u8FC7\u671F\uFF1A</h4><p>\u6BCF\u9694\u4E00\u5B9A\u7684\u65F6\u95F4\uFF0C\u4F1A\u626B\u63CF\u4E00\u5B9A\u6570\u91CF\u7684\u6570\u636E\u5E93\u7684expires\u5B57\u5178\u4E2D\u4E00\u5B9A\u6570\u91CF\u7684key\uFF0C\u5E76\u6E05\u9664\u5176\u4E2D\u5DF2\u8FC7\u671F\u7684key\u3002\u8BE5\u7B56\u7565\u662F\u524D\u4E24\u8005\u7684\u4E00\u4E2A\u6298\u4E2D\u65B9\u6848\u3002\u901A\u8FC7\u8C03\u6574\u5B9A\u65F6\u626B\u63CF\u7684\u65F6\u95F4\u95F4\u9694\u548C\u6BCF\u6B21\u626B\u63CF\u7684\u9650\u5B9A\u8017\u65F6\uFF0C\u53EF\u4EE5\u5728\u4E0D\u540C\u60C5\u51B5\u4E0B\u4F7F\u5F97CPU\u548C\u5185\u5B58\u8D44\u6E90\u8FBE\u5230\u6700\u4F18\u7684\u5E73\u8861\u6548\u679C\u3002</p><p>(<code>expires</code>\u5B57\u5178\u4F1A\u4FDD\u5B58\u6240\u6709\u8BBE\u7F6E\u4E86\u8FC7\u671F\u65F6\u95F4\u7684key\u7684\u8FC7\u671F\u65F6\u95F4\u6570\u636E\uFF0C\u5176\u4E2D\uFF0Ckey\u662F\u6307\u5411\u952E\u7A7A\u95F4\u4E2D\u7684\u67D0\u4E2A\u952E\u7684\u6307\u9488\uFF0Cvalue\u662F\u8BE5\u952E\u7684\u6BEB\u79D2\u7CBE\u5EA6\u7684UNIX\u65F6\u95F4\u6233\u8868\u793A\u7684\u8FC7\u671F\u65F6\u95F4\u3002\u952E\u7A7A\u95F4\u662F\u6307\u8BE5Redis\u96C6\u7FA4\u4E2D\u4FDD\u5B58\u7684\u6240\u6709\u952E\u3002) Redis\u4E2D\u540C\u65F6\u4F7F\u7528\u4E86\u60F0\u6027\u8FC7\u671F\u548C\u5B9A\u671F\u8FC7\u671F\u4E24\u79CD\u8FC7\u671F\u7B56\u7565\u3002</p><h3 id="_2-redis-key\u7684\u8FC7\u671F\u65F6\u95F4\u548C\u6C38\u4E45\u6709\u6548\u5206\u522B\u600E\u4E48\u8BBE\u7F6E" tabindex="-1"><a class="header-anchor" href="#_2-redis-key\u7684\u8FC7\u671F\u65F6\u95F4\u548C\u6C38\u4E45\u6709\u6548\u5206\u522B\u600E\u4E48\u8BBE\u7F6E" aria-hidden="true">#</a> 2. Redis key\u7684\u8FC7\u671F\u65F6\u95F4\u548C\u6C38\u4E45\u6709\u6548\u5206\u522B\u600E\u4E48\u8BBE\u7F6E\uFF1F</h3><p>EXPIRE \u548C PERSIST \u547D\u4EE4\u3002</p><h3 id="_3-\u6211\u4EEC\u77E5\u9053\u901A\u8FC7-expire-\u6765\u8BBE\u7F6Ekey-\u7684\u8FC7\u671F\u65F6\u95F4-\u90A3\u4E48\u5BF9\u8FC7\u671F\u7684\u6570\u636E\u600E\u4E48\u5904\u7406\u5462" tabindex="-1"><a class="header-anchor" href="#_3-\u6211\u4EEC\u77E5\u9053\u901A\u8FC7-expire-\u6765\u8BBE\u7F6Ekey-\u7684\u8FC7\u671F\u65F6\u95F4-\u90A3\u4E48\u5BF9\u8FC7\u671F\u7684\u6570\u636E\u600E\u4E48\u5904\u7406\u5462" aria-hidden="true">#</a> 3. \u6211\u4EEC\u77E5\u9053\u901A\u8FC7 expire \u6765\u8BBE\u7F6Ekey \u7684\u8FC7\u671F\u65F6\u95F4\uFF0C\u90A3\u4E48\u5BF9\u8FC7\u671F\u7684\u6570\u636E\u600E\u4E48\u5904\u7406\u5462?</h3><p>\u5B9A\u65F6\u8FC7\u671F\u3001\u60F0\u6027\u8FC7\u671F\u3001\u5B9A\u671F\u8FC7\u671F\u3002</p><h3 id="_4-mysql\u91CC\u67092000w\u6570\u636E-redis\u4E2D\u53EA\u5B5820w\u7684\u6570\u636E-\u5982\u4F55\u4FDD\u8BC1redis\u4E2D\u7684\u6570\u636E\u90FD\u662F\u70ED\u70B9\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_4-mysql\u91CC\u67092000w\u6570\u636E-redis\u4E2D\u53EA\u5B5820w\u7684\u6570\u636E-\u5982\u4F55\u4FDD\u8BC1redis\u4E2D\u7684\u6570\u636E\u90FD\u662F\u70ED\u70B9\u6570\u636E" aria-hidden="true">#</a> 4. MySQL\u91CC\u67092000w\u6570\u636E\uFF0Credis\u4E2D\u53EA\u5B5820w\u7684\u6570\u636E\uFF0C\u5982\u4F55\u4FDD\u8BC1redis\u4E2D\u7684\u6570\u636E\u90FD\u662F\u70ED\u70B9\u6570\u636E</h3><p>redis\u5185\u5B58\u6570\u636E\u96C6\u5927\u5C0F\u4E0A\u5347\u5230\u4E00\u5B9A\u5927\u5C0F\u7684\u65F6\u5019\uFF0C\u5C31\u4F1A\u65BD\u884C\u6570\u636E\u6DD8\u6C70\u7B56\u7565\u3002</p><h3 id="_5-redis\u7684\u5185\u5B58\u6DD8\u6C70\u7B56\u7565\u6709\u54EA\u4E9B" tabindex="-1"><a class="header-anchor" href="#_5-redis\u7684\u5185\u5B58\u6DD8\u6C70\u7B56\u7565\u6709\u54EA\u4E9B" aria-hidden="true">#</a> 5. Redis\u7684\u5185\u5B58\u6DD8\u6C70\u7B56\u7565\u6709\u54EA\u4E9B</h3><p>Redis\u7684\u5185\u5B58\u6DD8\u6C70\u7B56\u7565\u662F\u6307\u5728Redis\u7684\u7528\u4E8E\u7F13\u5B58\u7684\u5185\u5B58\u4E0D\u8DB3\u65F6\uFF0C\u600E\u4E48\u5904\u7406\u9700\u8981\u65B0\u5199\u5165\u4E14\u9700\u8981\u7533\u8BF7\u989D\u5916\u7A7A\u95F4\u7684\u6570\u636E\u3002 <strong>\u5168\u5C40\u7684\u952E\u7A7A\u95F4\u9009\u62E9\u6027\u79FB\u9664</strong></p><ul><li>noeviction\uFF1A\u5F53\u5185\u5B58\u4E0D\u8DB3\u4EE5\u5BB9\u7EB3\u65B0\u5199\u5165\u6570\u636E\u65F6\uFF0C\u65B0\u5199\u5165\u64CD\u4F5C\u4F1A\u62A5\u9519\u3002</li><li>allkeys-lru\uFF1A\u5F53\u5185\u5B58\u4E0D\u8DB3\u4EE5\u5BB9\u7EB3\u65B0\u5199\u5165\u6570\u636E\u65F6\uFF0C\u5728\u952E\u7A7A\u95F4\u4E2D\uFF0C\u79FB\u9664\u6700\u8FD1\u6700\u5C11\u4F7F\u7528\u7684key\u3002\uFF08\u8FD9\u4E2A\u662F<strong>\u6700\u5E38\u7528</strong>\u7684\uFF09</li><li>allkeys-random\uFF1A\u5F53\u5185\u5B58\u4E0D\u8DB3\u4EE5\u5BB9\u7EB3\u65B0\u5199\u5165\u6570\u636E\u65F6\uFF0C\u5728\u952E\u7A7A\u95F4\u4E2D\uFF0C\u968F\u673A\u79FB\u9664\u67D0\u4E2Akey\u3002</li></ul><p><strong>\u8BBE\u7F6E\u8FC7\u671F\u65F6\u95F4\u7684\u952E\u7A7A\u95F4\u9009\u62E9\u6027\u79FB\u9664</strong></p><ul><li>volatile-lru\uFF1A\u5F53\u5185\u5B58\u4E0D\u8DB3\u4EE5\u5BB9\u7EB3\u65B0\u5199\u5165\u6570\u636E\u65F6\uFF0C\u5728\u8BBE\u7F6E\u4E86\u8FC7\u671F\u65F6\u95F4\u7684\u952E\u7A7A\u95F4\u4E2D\uFF0C\u79FB\u9664\u6700\u8FD1\u6700\u5C11\u4F7F\u7528\u7684key\u3002</li><li>volatile-random\uFF1A\u5F53\u5185\u5B58\u4E0D\u8DB3\u4EE5\u5BB9\u7EB3\u65B0\u5199\u5165\u6570\u636E\u65F6\uFF0C\u5728\u8BBE\u7F6E\u4E86\u8FC7\u671F\u65F6\u95F4\u7684\u952E\u7A7A\u95F4\u4E2D\uFF0C\u968F\u673A\u79FB\u9664\u67D0\u4E2Akey\u3002</li><li>volatile-ttl\uFF1A\u5F53\u5185\u5B58\u4E0D\u8DB3\u4EE5\u5BB9\u7EB3\u65B0\u5199\u5165\u6570\u636E\u65F6\uFF0C\u5728\u8BBE\u7F6E\u4E86\u8FC7\u671F\u65F6\u95F4\u7684\u952E\u7A7A\u95F4\u4E2D\uFF0C\u6709\u66F4\u65E9\u8FC7\u671F\u65F6\u95F4\u7684key\u4F18\u5148\u79FB\u9664\u3002</li></ul><p><strong>\u603B\u7ED3</strong> Redis\u7684\u5185\u5B58\u6DD8\u6C70\u7B56\u7565\u7684\u9009\u53D6\u5E76\u4E0D\u4F1A\u5F71\u54CD\u8FC7\u671F\u7684key\u7684\u5904\u7406\u3002\u5185\u5B58\u6DD8\u6C70\u7B56\u7565\u7528\u4E8E\u5904\u7406\u5185\u5B58\u4E0D\u8DB3\u65F6\u7684\u9700\u8981\u7533\u8BF7\u989D\u5916\u7A7A\u95F4\u7684\u6570\u636E\uFF1B\u8FC7\u671F\u7B56\u7565\u7528\u4E8E\u5904\u7406\u8FC7\u671F\u7684\u7F13\u5B58\u6570\u636E\u3002</p><h3 id="_6-redis\u4E3B\u8981\u6D88\u8017\u4EC0\u4E48\u7269\u7406\u8D44\u6E90" tabindex="-1"><a class="header-anchor" href="#_6-redis\u4E3B\u8981\u6D88\u8017\u4EC0\u4E48\u7269\u7406\u8D44\u6E90" aria-hidden="true">#</a> 6. Redis\u4E3B\u8981\u6D88\u8017\u4EC0\u4E48\u7269\u7406\u8D44\u6E90\uFF1F</h3><p>\u5185\u5B58\u3002</p><h3 id="_7-redis\u7684\u5185\u5B58\u7528\u5B8C\u4E86\u4F1A\u53D1\u751F\u4EC0\u4E48" tabindex="-1"><a class="header-anchor" href="#_7-redis\u7684\u5185\u5B58\u7528\u5B8C\u4E86\u4F1A\u53D1\u751F\u4EC0\u4E48" aria-hidden="true">#</a> 7. Redis\u7684\u5185\u5B58\u7528\u5B8C\u4E86\u4F1A\u53D1\u751F\u4EC0\u4E48\uFF1F</h3><p>\u5982\u679C\u8FBE\u5230\u8BBE\u7F6E\u7684\u4E0A\u9650\uFF0CRedis\u7684\u5199\u547D\u4EE4\u4F1A\u8FD4\u56DE\u9519\u8BEF\u4FE1\u606F\uFF08\u4F46\u662F\u8BFB\u547D\u4EE4\u8FD8\u53EF\u4EE5\u6B63\u5E38\u8FD4\u56DE\u3002\uFF09\u6216\u8005\u4F60\u53EF\u4EE5\u914D\u7F6E\u5185\u5B58\u6DD8\u6C70\u673A\u5236\uFF0C\u5F53Redis\u8FBE\u5230\u5185\u5B58\u4E0A\u9650\u65F6\u4F1A\u51B2\u5237\u6389\u65E7\u7684\u5185\u5BB9\u3002</p><h3 id="_8-redis\u5982\u4F55\u505A\u5185\u5B58\u4F18\u5316" tabindex="-1"><a class="header-anchor" href="#_8-redis\u5982\u4F55\u505A\u5185\u5B58\u4F18\u5316" aria-hidden="true">#</a> 8. Redis\u5982\u4F55\u505A\u5185\u5B58\u4F18\u5316\uFF1F</h3><p>\u53EF\u4EE5\u597D\u597D\u5229\u7528 <code>Hash,list,sorted set,set</code> \u7B49\u96C6\u5408\u7C7B\u578B\u6570\u636E\uFF0C\u56E0\u4E3A\u901A\u5E38\u60C5\u51B5\u4E0B\u5F88\u591A\u5C0F\u7684 Key-Value \u53EF\u4EE5\u7528\u66F4\u7D27\u51D1\u7684\u65B9\u5F0F\u5B58\u653E\u5230\u4E00\u8D77\u3002 \u5C3D\u53EF\u80FD\u4F7F\u7528\u6563\u5217\u8868\uFF08hashes\uFF09\uFF0C\u6563\u5217\u8868\uFF08\u662F\u8BF4\u6563\u5217\u8868\u91CC\u9762\u5B58\u50A8\u7684\u6570\u5C11\uFF09\u4F7F\u7528\u7684\u5185\u5B58\u975E\u5E38\u5C0F\uFF0C\u6240\u4EE5\u4F60\u5E94\u8BE5\u5C3D\u53EF\u80FD\u7684\u5C06\u4F60\u7684\u6570\u636E\u6A21\u578B\u62BD\u8C61\u5230\u4E00\u4E2A\u6563\u5217\u8868\u91CC\u9762\u3002 \u6BD4\u5982\u4F60\u7684web\u7CFB\u7EDF\u4E2D\u6709\u4E00\u4E2A\u7528\u6237\u5BF9\u8C61\uFF0C\u4E0D\u8981\u4E3A\u8FD9\u4E2A\u7528\u6237\u7684\u540D\u79F0\uFF0C\u59D3\u6C0F\uFF0C\u90AE\u7BB1\uFF0C\u5BC6\u7801\u8BBE\u7F6E\u5355\u72EC\u7684key\uFF0C\u800C\u662F\u5E94\u8BE5\u628A\u8FD9\u4E2A\u7528\u6237\u7684\u6240\u6709\u4FE1\u606F\u5B58\u50A8\u5230\u4E00\u5F20\u6563\u5217\u8868\u91CC\u9762\u3002</p><h3 id="_9-redis\u56DE\u6536\u8FDB\u7A0B\u5982\u4F55\u5DE5\u4F5C\u7684" tabindex="-1"><a class="header-anchor" href="#_9-redis\u56DE\u6536\u8FDB\u7A0B\u5982\u4F55\u5DE5\u4F5C\u7684" aria-hidden="true">#</a> 9. Redis\u56DE\u6536\u8FDB\u7A0B\u5982\u4F55\u5DE5\u4F5C\u7684\uFF1F</h3><ol><li>\u4E00\u4E2A\u5BA2\u6237\u7AEF\u8FD0\u884C\u4E86\u65B0\u7684\u547D\u4EE4\uFF0C\u6DFB\u52A0\u4E86\u65B0\u7684\u6570\u636E\u3002</li><li>Redis\u68C0\u67E5\u5185\u5B58\u4F7F\u7528\u60C5\u51B5\uFF0C\u5982\u679C\u5927\u4E8Emaxmemory\u7684\u9650\u5236\uFF0C \u5219\u6839\u636E\u8BBE\u5B9A\u597D\u7684\u5185\u5B58\u6DD8\u6C70\u7B56\u7565\u8FDB\u884C\u56DE\u6536\u3002</li><li>\u4E00\u4E2A\u65B0\u7684\u547D\u4EE4\u88AB\u6267\u884C\uFF0C\u7B49\u7B49\u3002</li><li>\u6240\u4EE5\u6211\u4EEC\u4E0D\u65AD\u5730\u7A7F\u8D8A\u5185\u5B58\u9650\u5236\u7684\u8FB9\u754C\uFF0C\u901A\u8FC7\u4E0D\u65AD\u8FBE\u5230\u8FB9\u754C\u7136\u540E\u4E0D\u65AD\u5730\u56DE\u6536\u56DE\u5230\u8FB9\u754C\u4EE5\u4E0B\u3002</li></ol><p>\u5982\u679C\u4E00\u4E2A\u547D\u4EE4\u7684\u7ED3\u679C\u5BFC\u81F4\u5927\u91CF\u5185\u5B58\u88AB\u4F7F\u7528\uFF08\u4F8B\u5982\u5F88\u5927\u7684\u96C6\u5408\u7684\u4EA4\u96C6\u4FDD\u5B58\u5230\u4E00\u4E2A\u65B0\u7684\u952E\uFF09\uFF0C\u4E0D\u7528\u591A\u4E45\u5185\u5B58\u9650\u5236\u5C31\u4F1A\u88AB\u8FD9\u4E2A\u5185\u5B58\u4F7F\u7528\u91CF\u8D85\u8D8A\u3002</p><h3 id="_10-redis\u56DE\u6536\u4F7F\u7528\u7684\u662F\u4EC0\u4E48\u7B97\u6CD5" tabindex="-1"><a class="header-anchor" href="#_10-redis\u56DE\u6536\u4F7F\u7528\u7684\u662F\u4EC0\u4E48\u7B97\u6CD5" aria-hidden="true">#</a> 10. Redis\u56DE\u6536\u4F7F\u7528\u7684\u662F\u4EC0\u4E48\u7B97\u6CD5\uFF1F</h3><p>LRU\u7B97\u6CD5\u3002</p><blockquote><p>LRU\u662FLeast Recently Used\u7684\u7F29\u5199\uFF0C\u5373\u6700\u8FD1\u6700\u5C11\u4F7F\u7528\u9875\u9762\u7F6E\u6362\u7B97\u6CD5\uFF0C\u662F\u4E3A\u865A\u62DF\u9875\u5F0F\u5B58\u50A8\u7BA1\u7406\u670D\u52A1\u7684\uFF0C\u662F\u6839\u636E\u9875\u9762\u8C03\u5165\u5185\u5B58\u540E\u7684\u4F7F\u7528\u60C5\u51B5\u8FDB\u884C\u51B3\u7B56\u3002\u7531\u4E8E\u65E0\u6CD5\u9884\u6D4B\u5404\u9875\u9762\u5C06\u6765\u7684\u4F7F\u7528\u60C5\u51B5\uFF0C\u53EA\u80FD\u5229\u7528\u201C\u6700\u8FD1\u7684\u8FC7\u53BB\u201D\u4F5C\u4E3A\u201C\u6700\u8FD1\u7684\u5C06\u6765\u201D\u7684\u8FD1\u4F3C\uFF0C\u56E0\u6B64\uFF0CLRU\u7B97\u6CD5\u5C31\u662F\u5C06\u6700\u8FD1\u6700\u4E45\u672A\u4F7F\u7528\u7684\u9875\u9762\u4E88\u4EE5\u6DD8\u6C70\u3002</p></blockquote><h2 id="\u7EBF\u7A0B\u6A21\u578B" tabindex="-1"><a class="header-anchor" href="#\u7EBF\u7A0B\u6A21\u578B" aria-hidden="true">#</a> \u7EBF\u7A0B\u6A21\u578B</h2><h3 id="_1-redis\u7EBF\u7A0B\u6A21\u578B" tabindex="-1"><a class="header-anchor" href="#_1-redis\u7EBF\u7A0B\u6A21\u578B" aria-hidden="true">#</a> 1. Redis\u7EBF\u7A0B\u6A21\u578B</h3><p>Redis\u57FA\u4E8E Reactor \u6A21\u5F0F\u5F00\u53D1\u4E86\u7F51\u7EDC\u4E8B\u4EF6\u5904\u7406\u5668\uFF0C\u8FD9\u4E2A\u5904\u7406\u5668\u88AB\u79F0\u4E3A\u6587\u4EF6\u4E8B\u4EF6\u5904\u7406\u5668\uFF08file event handler\uFF09\u3002\u5B83\u7684\u7EC4\u6210\u7ED3\u6784\u4E3A4\u90E8\u5206\uFF1A\u591A\u4E2A\u5957\u63A5\u5B57\u3001IO\u591A\u8DEF\u590D\u7528\u7A0B\u5E8F\u3001\u6587\u4EF6\u4E8B\u4EF6\u5206\u6D3E\u5668\u3001\u4E8B\u4EF6\u5904\u7406\u5668\u3002\u56E0\u4E3A\u53EA\u6709\u4E00\u4E2A\u5DE5\u4F5C\u8005\u7EBF\u7A0B\uFF0C\u6240\u4EE5Redis\u624D\u53EB\u5355\u7EBF\u7A0B\u6A21\u578B\u3002</p><ul><li>\u6587\u4EF6\u4E8B\u4EF6\u5904\u7406\u5668\u4F7F\u7528 I/O \u591A\u8DEF\u590D\u7528\uFF08multiplexing\uFF09\u7A0B\u5E8F\u6765\u540C\u65F6\u76D1\u542C\u591A\u4E2A\u5957\u63A5\u5B57\uFF0C \u5E76\u6839\u636E\u5957\u63A5\u5B57\u76EE\u524D\u6267\u884C\u7684\u4EFB\u52A1\u6765\u4E3A\u5957\u63A5\u5B57\u5173\u8054\u4E0D\u540C\u7684\u4E8B\u4EF6\u5904\u7406\u5668\u3002</li><li>\u5F53\u88AB\u76D1\u542C\u7684\u5957\u63A5\u5B57\u51C6\u5907\u597D\u6267\u884C\u8FDE\u63A5\u5E94\u7B54\uFF08accept\uFF09\u3001\u8BFB\u53D6\uFF08read\uFF09\u3001\u5199\u5165\uFF08write\uFF09\u3001\u5173\u95ED\uFF08close\uFF09\u7B49\u64CD\u4F5C\u65F6\uFF0C \u4E0E\u64CD\u4F5C\u76F8\u5BF9\u5E94\u7684\u6587\u4EF6\u4E8B\u4EF6\u5C31\u4F1A\u4EA7\u751F\uFF0C \u8FD9\u65F6\u6587\u4EF6\u4E8B\u4EF6\u5904\u7406\u5668\u5C31\u4F1A\u8C03\u7528\u5957\u63A5\u5B57\u4E4B\u524D\u5173\u8054\u597D\u7684\u4E8B\u4EF6\u5904\u7406\u5668\u6765\u5904\u7406\u8FD9\u4E9B\u4E8B\u4EF6\u3002</li></ul><p>\u867D\u7136 worker \u662F\u5355\u7EBF\u7A0B\u65B9\u5F0F\u8FD0\u884C\uFF0C \u4F46\u901A\u8FC7\u4F7F\u7528 I/O \u591A\u8DEF\u590D\u7528\u7A0B\u5E8F\u6765\u76D1\u542C\u591A\u4E2A\u5957\u63A5\u5B57\uFF0C \u6587\u4EF6\u4E8B\u4EF6\u5904\u7406\u5668\u65E2\u5B9E\u73B0\u4E86\u9AD8\u6027\u80FD\u7684\u7F51\u7EDC\u901A\u4FE1\u6A21\u578B\uFF0C \u53C8\u53EF\u4EE5\u5F88\u597D\u5730\u4E0E redis \u670D\u52A1\u5668\u4E2D\u5176\u4ED6\u540C\u6837\u4EE5\u5355\u7EBF\u7A0B\u65B9\u5F0F\u8FD0\u884C\u7684\u6A21\u5757\u8FDB\u884C\u5BF9\u63A5\uFF0C \u8FD9\u4FDD\u6301\u4E86 Redis \u5185\u90E8\u5355\u7EBF\u7A0B\u8BBE\u8BA1\u7684\u7B80\u5355\u6027\u3002</p><h3 id="_2-\u5355\u7EBF\u7A0B\u4E3A\u4EC0\u4E48\u5FEB" tabindex="-1"><a class="header-anchor" href="#_2-\u5355\u7EBF\u7A0B\u4E3A\u4EC0\u4E48\u5FEB" aria-hidden="true">#</a> 2. \u5355\u7EBF\u7A0B\u4E3A\u4EC0\u4E48\u5FEB</h3><p>redis \u5229\u7528 epoll \u8FDB\u884C\u591A\u8DEF\u590D\u7528\u7BA1\u7406\u5BA2\u6237\u7AEF\u8FDE\u63A5\uFF0C\u901A\u8FC7\u76D1\u542C epoll \u4E8B\u4EF6\uFF0C\u5BF9\u5BA2\u6237\u7684\u8BF7\u6C42\u64CD\u4F5C\u653E\u5230\u5DE5\u4F5C\u8005\u7EBF\u7A0B\u53BB\u5904\u7406\u3002\u7531\u4E8E\u5DE5\u4F5C\u8005\u7EBF\u7A0B\u662F\u5355\u7EBF\u7A0B\uFF0C\u6240\u4EE5\u4ED6\u5E76\u4E0D\u5B58\u5728\u6570\u636E\u51B2\u7A81\u95EE\u9898\uFF0C\u4E5F\u5C31\u662F\u8BF4\u5B83\u4E0D\u9700\u8981\u5F00\u542F\u4E8B\u52A1\u6216\u8005\u8BF4\u52A0\u9501\u6765\u89E3\u51B3\u5E76\u53D1\u6240\u5E26\u6765\u7684\u7EBF\u7A0B\u5B89\u5168\u95EE\u9898\u3002 \u6240\u4EE5\u6211\u8BA4\u4E3A redis \u5355\u7EBF\u7A0B\u5FEB\uFF0C\u5C31\u662F\u56E0\u4E3A\u5B83\u7684\u4E00\u4E2A\u903B\u8F91\u5904\u7406\u4E0A\u907F\u514D\u4E86\u7EBF\u7A0B\u5B89\u5168\u95EE\u9898\uFF0C\u51CF\u5C11\u4E86\u4E8B\u52A1\u6216\u8005\u9501\u7684\u5F00\u9500\uFF0C\u4ECE\u800C\u52A0\u5FEB\u6570\u636E\u7684\u8BA1\u7B97\u901F\u5EA6\u3002</p><h2 id="\u4E8B\u52A1" tabindex="-1"><a class="header-anchor" href="#\u4E8B\u52A1" aria-hidden="true">#</a> \u4E8B\u52A1</h2><h3 id="_1-\u4EC0\u4E48\u662F\u4E8B\u52A1" tabindex="-1"><a class="header-anchor" href="#_1-\u4EC0\u4E48\u662F\u4E8B\u52A1" aria-hidden="true">#</a> 1. \u4EC0\u4E48\u662F\u4E8B\u52A1\uFF1F</h3><p>\u5728 redis \u4E2D\uFF0C\u4E8B\u52A1\u662F\u4E00\u4E2A\u5355\u72EC\u7684\u9694\u79BB\u64CD\u4F5C\uFF1A\u4E8B\u52A1\u4E2D\u7684\u6240\u6709\u547D\u4EE4\u90FD\u4F1A\u5E8F\u5217\u5316\u3001\u6309\u987A\u5E8F\u5730\u6267\u884C\u3002\u4E8B\u52A1\u5728\u6267\u884C\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u4E0D\u4F1A\u88AB\u5176\u4ED6\u5BA2\u6237\u7AEF\u53D1\u9001\u6765\u7684\u547D\u4EE4\u8BF7\u6C42\u6240\u6253\u65AD\u3002 \u4E8B\u52A1\u662F\u4E00\u4E2A\u539F\u5B50\u64CD\u4F5C\uFF1A\u4E8B\u52A1\u4E2D\u7684\u547D\u4EE4\u8981\u4E48\u5168\u90E8\u88AB\u6267\u884C\uFF0C\u8981\u4E48\u5168\u90E8\u90FD\u4E0D\u6267\u884C\u3002</p><h3 id="_2-redis\u4E8B\u52A1\u7684\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_2-redis\u4E8B\u52A1\u7684\u6982\u5FF5" aria-hidden="true">#</a> 2. Redis\u4E8B\u52A1\u7684\u6982\u5FF5</h3><p>Redis \u4E8B\u52A1\u7684\u672C\u8D28\u662F\u901A\u8FC7MULTI\u3001EXEC\u3001WATCH\u7B49\u4E00\u7EC4\u547D\u4EE4\u7684\u96C6\u5408\u3002\u4E8B\u52A1\u652F\u6301\u4E00\u6B21\u6267\u884C\u591A\u4E2A\u547D\u4EE4\uFF0C\u4E00\u4E2A\u4E8B\u52A1\u4E2D\u6240\u6709\u547D\u4EE4\u90FD\u4F1A\u88AB\u5E8F\u5217\u5316\u3002\u5728\u4E8B\u52A1\u6267\u884C\u8FC7\u7A0B\uFF0C\u4F1A\u6309\u7167\u987A\u5E8F\u4E32\u884C\u5316\u6267\u884C\u961F\u5217\u4E2D\u7684\u547D\u4EE4\uFF0C\u5176\u4ED6\u5BA2\u6237\u7AEF\u63D0\u4EA4\u7684\u547D\u4EE4\u8BF7\u6C42\u4E0D\u4F1A\u63D2\u5165\u5230\u4E8B\u52A1\u6267\u884C\u547D\u4EE4\u5E8F\u5217\u4E2D\u3002 \u603B\u7ED3\u8BF4\uFF1Aredis\u4E8B\u52A1\u5C31\u662F\u4E00\u6B21\u6027\u3001\u987A\u5E8F\u6027\u3001\u6392\u4ED6\u6027\u7684\u6267\u884C\u4E00\u4E2A\u961F\u5217\u4E2D\u7684\u4E00\u7CFB\u5217\u547D\u4EE4\u3002</p><h3 id="_3-redis\u4E8B\u52A1\u7684\u4E09\u4E2A\u9636\u6BB5" tabindex="-1"><a class="header-anchor" href="#_3-redis\u4E8B\u52A1\u7684\u4E09\u4E2A\u9636\u6BB5" aria-hidden="true">#</a> 3. Redis\u4E8B\u52A1\u7684\u4E09\u4E2A\u9636\u6BB5</h3><ol><li>\u4E8B\u52A1\u5F00\u59CB MULTI</li><li>\u547D\u4EE4\u5165\u961F</li><li>\u4E8B\u52A1\u6267\u884C EXEC</li></ol><p>\u4E8B\u52A1\u6267\u884C\u8FC7\u7A0B\u4E2D\uFF0C\u5982\u679C\u670D\u52A1\u7AEF\u6536\u5230\u6709EXEC\u3001DISCARD\u3001WATCH\u3001MULTI\u4E4B\u5916\u7684\u8BF7\u6C42\uFF0C\u5C06\u4F1A\u628A\u8BF7\u6C42\u653E\u5165\u961F\u5217\u4E2D\u6392\u961F\u3002</p><h3 id="_4-redis\u4E8B\u52A1\u76F8\u5173\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#_4-redis\u4E8B\u52A1\u76F8\u5173\u547D\u4EE4" aria-hidden="true">#</a> 4. Redis\u4E8B\u52A1\u76F8\u5173\u547D\u4EE4</h3><p>Redis\u4E8B\u52A1\u529F\u80FD\u662F\u901A\u8FC7 MULTI\u3001EXEC\u3001DISCARD \u548C WATCH \u56DB\u4E2A\u539F\u8BED\u5B9E\u73B0\u7684 Redis\u4F1A\u5C06\u4E00\u4E2A\u4E8B\u52A1\u4E2D\u7684\u6240\u6709\u547D\u4EE4\u5E8F\u5217\u5316\uFF0C\u7136\u540E\u6309\u987A\u5E8F\u6267\u884C\u3002</p><ol><li><strong>redis \u4E0D\u652F\u6301\u56DE\u6EDA</strong>\uFF0C\u201CRedis \u5728\u4E8B\u52A1\u5931\u8D25\u65F6\u4E0D\u8FDB\u884C\u56DE\u6EDA\uFF0C\u800C\u662F\u7EE7\u7EED\u6267\u884C\u4F59\u4E0B\u7684\u547D\u4EE4\u201D\uFF0C \u6240\u4EE5 Redis \u7684\u5185\u90E8\u53EF\u4EE5\u4FDD\u6301\u7B80\u5355\u4E14\u5FEB\u901F\u3002</li><li><strong>\u5982\u679C\u5728\u4E00\u4E2A\u4E8B\u52A1\u4E2D\u7684\u547D\u4EE4\u51FA\u73B0\u9519\u8BEF\uFF0C\u90A3\u4E48\u6240\u6709\u7684\u547D\u4EE4\u90FD\u4E0D\u4F1A\u6267\u884C</strong>\uFF1B</li><li><strong>\u5982\u679C\u5728\u4E00\u4E2A\u4E8B\u52A1\u4E2D\u51FA\u73B0\u8FD0\u884C\u9519\u8BEF\uFF0C\u90A3\u4E48\u6B63\u786E\u7684\u547D\u4EE4\u4F1A\u88AB\u6267\u884C</strong>\u3002</li></ol><ul><li>WATCH \u547D\u4EE4\u662F\u4E00\u4E2A\u4E50\u89C2\u9501\uFF0C\u53EF\u4EE5\u4E3A Redis \u4E8B\u52A1\u63D0\u4F9B check-and-set \uFF08CAS\uFF09\u884C\u4E3A\u3002 \u53EF\u4EE5\u76D1\u63A7\u4E00\u4E2A\u6216\u591A\u4E2A\u952E\uFF0C\u4E00\u65E6\u5176\u4E2D\u6709\u4E00\u4E2A\u952E\u88AB\u4FEE\u6539\uFF08\u6216\u5220\u9664\uFF09\uFF0C\u4E4B\u540E\u7684\u4E8B\u52A1\u5C31\u4E0D\u4F1A\u6267\u884C\uFF0C\u76D1\u63A7\u4E00\u76F4\u6301\u7EED\u5230EXEC\u547D\u4EE4\u3002</li><li>MULTI \u547D\u4EE4\u7528\u4E8E\u5F00\u542F\u4E00\u4E2A\u4E8B\u52A1\uFF0C\u5B83\u603B\u662F\u8FD4\u56DEOK\u3002 MULTI \u6267\u884C\u4E4B\u540E\uFF0C\u5BA2\u6237\u7AEF\u53EF\u4EE5\u7EE7\u7EED\u5411\u670D\u52A1\u5668\u53D1\u9001\u4EFB\u610F\u591A\u6761\u547D\u4EE4\uFF0C\u8FD9\u4E9B\u547D\u4EE4\u4E0D\u4F1A\u7ACB\u5373\u88AB\u6267\u884C\uFF0C\u800C\u662F\u88AB\u653E\u5230\u4E00\u4E2A\u961F\u5217\u4E2D\uFF0C\u5F53 EXEC \u547D\u4EE4\u88AB\u8C03\u7528\u65F6\uFF0C\u6240\u6709\u961F\u5217\u4E2D\u7684\u547D\u4EE4\u624D\u4F1A\u88AB\u6267\u884C\u3002</li><li>EXEC\uFF1A\u6267\u884C\u6240\u6709\u4E8B\u52A1\u5757\u5185\u7684\u547D\u4EE4\u3002\u8FD4\u56DE\u4E8B\u52A1\u5757\u5185\u6240\u6709\u547D\u4EE4\u7684\u8FD4\u56DE\u503C\uFF0C\u6309\u547D\u4EE4\u6267\u884C\u7684\u5148\u540E\u987A\u5E8F\u6392\u5217\u3002 \u5F53\u64CD\u4F5C\u88AB\u6253\u65AD\u65F6\uFF0C\u8FD4\u56DE\u7A7A\u503C nil \u3002</li><li>\u901A\u8FC7\u8C03\u7528 DISCARD\uFF0C\u5BA2\u6237\u7AEF\u53EF\u4EE5\u6E05\u7A7A\u4E8B\u52A1\u961F\u5217\uFF0C\u5E76\u653E\u5F03\u6267\u884C\u4E8B\u52A1\uFF0C \u5E76\u4E14\u5BA2\u6237\u7AEF\u4F1A\u4ECE\u4E8B\u52A1\u72B6\u6001\u4E2D\u9000\u51FA\u3002</li><li>UNWATCH \u547D\u4EE4\u53EF\u4EE5\u53D6\u6D88watch\u5BF9\u6240\u6709key\u7684\u76D1\u63A7\u3002</li></ul><h3 id="_5-\u4E8B\u52A1\u7BA1\u7406-acid-\u6982\u8FF0" tabindex="-1"><a class="header-anchor" href="#_5-\u4E8B\u52A1\u7BA1\u7406-acid-\u6982\u8FF0" aria-hidden="true">#</a> 5. \u4E8B\u52A1\u7BA1\u7406\uFF08ACID\uFF09\u6982\u8FF0</h3><h4 id="\u539F\u5B50\u6027-atomicity" tabindex="-1"><a class="header-anchor" href="#\u539F\u5B50\u6027-atomicity" aria-hidden="true">#</a> \u539F\u5B50\u6027\uFF08Atomicity\uFF09</h4><p>\u539F\u5B50\u6027\u662F\u6307\u4E8B\u52A1\u662F\u4E00\u4E2A\u4E0D\u53EF\u5206\u5272\u7684\u5DE5\u4F5C\u5355\u4F4D\uFF0C\u4E8B\u52A1\u4E2D\u7684\u64CD\u4F5C\u8981\u4E48\u90FD\u53D1\u751F\uFF0C\u8981\u4E48\u90FD\u4E0D\u53D1\u751F\u3002</p><h4 id="\u4E00\u81F4\u6027-consistency" tabindex="-1"><a class="header-anchor" href="#\u4E00\u81F4\u6027-consistency" aria-hidden="true">#</a> \u4E00\u81F4\u6027\uFF08Consistency\uFF09</h4><p>\u4E8B\u52A1\u524D\u540E\u6570\u636E\u7684\u5B8C\u6574\u6027\u5FC5\u987B\u4FDD\u6301\u4E00\u81F4\u3002</p><h4 id="\u9694\u79BB\u6027-isolation" tabindex="-1"><a class="header-anchor" href="#\u9694\u79BB\u6027-isolation" aria-hidden="true">#</a> \u9694\u79BB\u6027\uFF08Isolation\uFF09</h4><p>\u591A\u4E2A\u4E8B\u52A1\u5E76\u53D1\u6267\u884C\u65F6\uFF0C\u4E00\u4E2A\u4E8B\u52A1\u7684\u6267\u884C\u4E0D\u5E94\u5F71\u54CD\u5176\u4ED6\u4E8B\u52A1\u7684\u6267\u884C</p><h4 id="\u6301\u4E45\u6027-durability" tabindex="-1"><a class="header-anchor" href="#\u6301\u4E45\u6027-durability" aria-hidden="true">#</a> \u6301\u4E45\u6027\uFF08Durability\uFF09</h4><p>\u6301\u4E45\u6027\u662F\u6307\u4E00\u4E2A\u4E8B\u52A1\u4E00\u65E6\u88AB\u63D0\u4EA4\uFF0C\u5B83\u5BF9\u6570\u636E\u5E93\u4E2D\u6570\u636E\u7684\u6539\u53D8\u5C31\u662F\u6C38\u4E45\u6027\u7684\uFF0C\u63A5\u4E0B\u6765\u5373\u4F7F\u6570\u636E\u5E93\u53D1\u751F\u6545\u969C\u4E5F\u4E0D\u5E94\u8BE5\u5BF9\u5176\u6709\u4EFB\u4F55\u5F71\u54CD\u3002</p><p><strong>Redis\u7684\u4E8B\u52A1\u603B\u662F\u5177\u6709ACID\u4E2D\u7684\u4E00\u81F4\u6027\u548C\u9694\u79BB\u6027</strong>\uFF0C\u5176\u4ED6\u7279\u6027\u662F\u4E0D\u652F\u6301\u7684\u3002\u5F53\u670D\u52A1\u5668\u8FD0\u884C\u5728_AOF _\u6301\u4E45\u5316\u6A21\u5F0F\u4E0B\uFF0C\u5E76\u4E14appendfsync \u9009\u9879\u7684\u503C\u4E3A always \u65F6\uFF0C\u4E8B\u52A1\u4E5F\u5177\u6709\u8010\u4E45\u6027\u3002</p><h3 id="_6-redis\u4E8B\u52A1\u652F\u6301\u9694\u79BB\u6027\u5417" tabindex="-1"><a class="header-anchor" href="#_6-redis\u4E8B\u52A1\u652F\u6301\u9694\u79BB\u6027\u5417" aria-hidden="true">#</a> 6. Redis\u4E8B\u52A1\u652F\u6301\u9694\u79BB\u6027\u5417</h3><p>Redis \u53EA\u6709\u4E00\u4E2A\u5DE5\u4F5C\u8005\u7EBF\u7A0B\uFF0C\u5E76\u4E14\u5B83\u4FDD\u8BC1\u5728\u6267\u884C\u4E8B\u52A1\u65F6\uFF0C\u4E0D\u4F1A\u5BF9\u4E8B\u52A1\u8FDB\u884C\u4E2D\u65AD\uFF0C\u4E8B\u52A1\u53EF\u4EE5\u8FD0\u884C\u76F4\u5230\u6267\u884C\u5B8C\u6240\u6709\u4E8B\u52A1\u961F\u5217\u4E2D\u7684\u547D\u4EE4\u4E3A\u6B62\u3002\u56E0\u6B64\uFF0C<strong>Redis \u7684\u4E8B\u52A1\u662F\u603B\u662F\u5E26\u6709\u9694\u79BB\u6027\u7684</strong>\u3002</p><h3 id="_7-redis\u4E8B\u52A1\u4FDD\u8BC1\u539F\u5B50\u6027\u5417-\u652F\u6301\u56DE\u6EDA\u5417" tabindex="-1"><a class="header-anchor" href="#_7-redis\u4E8B\u52A1\u4FDD\u8BC1\u539F\u5B50\u6027\u5417-\u652F\u6301\u56DE\u6EDA\u5417" aria-hidden="true">#</a> 7. Redis\u4E8B\u52A1\u4FDD\u8BC1\u539F\u5B50\u6027\u5417\uFF0C\u652F\u6301\u56DE\u6EDA\u5417</h3><p>Redis\u4E2D\uFF0C\u5355\u6761\u547D\u4EE4\u662F\u539F\u5B50\u6027\u6267\u884C\u7684\uFF0C\u4F46<strong>\u4E8B\u52A1\u4E0D\u4FDD\u8BC1\u539F\u5B50\u6027\uFF0C\u4E14\u6CA1\u6709\u56DE\u6EDA</strong>\u3002\u4E8B\u52A1\u4E2D\u4EFB\u610F\u547D\u4EE4\u6267\u884C\u5931\u8D25\uFF0C\u5176\u4F59\u7684\u547D\u4EE4\u4ECD\u4F1A\u88AB\u6267\u884C\u3002</p><h3 id="_8-redis\u4E8B\u52A1\u5176\u4ED6\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_8-redis\u4E8B\u52A1\u5176\u4ED6\u5B9E\u73B0" aria-hidden="true">#</a> 8. Redis\u4E8B\u52A1\u5176\u4ED6\u5B9E\u73B0</h3><ul><li>\u57FA\u4E8ELua\u811A\u672C\uFF0CRedis\u53EF\u4EE5\u4FDD\u8BC1\u811A\u672C\u5185\u7684\u547D\u4EE4\u4E00\u6B21\u6027\u3001\u6309\u987A\u5E8F\u5730\u6267\u884C\uFF0C\u5176\u540C\u65F6\u4E5F\u4E0D\u63D0\u4F9B\u4E8B\u52A1\u8FD0\u884C\u9519\u8BEF\u7684\u56DE\u6EDA\uFF0C\u6267\u884C\u8FC7\u7A0B\u4E2D\u5982\u679C\u90E8\u5206\u547D\u4EE4\u8FD0\u884C\u9519\u8BEF\uFF0C\u5269\u4E0B\u7684\u547D\u4EE4\u8FD8\u662F\u4F1A\u7EE7\u7EED\u8FD0\u884C\u5B8C\u3002</li><li>\u57FA\u4E8E\u4E2D\u95F4\u6807\u8BB0\u53D8\u91CF\uFF0C\u901A\u8FC7\u53E6\u5916\u7684\u6807\u8BB0\u53D8\u91CF\u6765\u6807\u8BC6\u4E8B\u52A1\u662F\u5426\u6267\u884C\u5B8C\u6210\uFF0C\u8BFB\u53D6\u6570\u636E\u65F6\u5148\u8BFB\u53D6\u8BE5\u6807\u8BB0\u53D8\u91CF\u5224\u65AD\u662F\u5426\u4E8B\u52A1\u6267\u884C\u5B8C\u6210\u3002\u4F46\u8FD9\u6837\u4F1A\u9700\u8981\u989D\u5916\u5199\u4EE3\u7801\u5B9E\u73B0\uFF0C\u6BD4\u8F83\u7E41\u7410\u3002</li></ul><h3 id="_9-redis-\u4E8B\u52A1\u3001\u6D41\u6C34\u7EBF-\u4E0E-lua-\u811A\u672C\u6709\u4EC0\u4E48\u533A\u522B" tabindex="-1"><a class="header-anchor" href="#_9-redis-\u4E8B\u52A1\u3001\u6D41\u6C34\u7EBF-\u4E0E-lua-\u811A\u672C\u6709\u4EC0\u4E48\u533A\u522B" aria-hidden="true">#</a> 9. redis \u4E8B\u52A1\u3001\u6D41\u6C34\u7EBF \u4E0E lua \u811A\u672C\u6709\u4EC0\u4E48\u533A\u522B</h3><h4 id="pipeline-\u6D41\u6C34\u7EBF" tabindex="-1"><a class="header-anchor" href="#pipeline-\u6D41\u6C34\u7EBF" aria-hidden="true">#</a> Pipeline \u6D41\u6C34\u7EBF</h4><p>\u5C06\u6307\u4EE4\u5728\u5BA2\u6237\u7AEF\u7684\u7F13\u51B2\u533A\u91CC\u6253\u5305\uFF0C\u6700\u540E\u4E00\u6B21\u6027\u53D1\u9001\uFF0C\u91CD\u70B9\u5728\u4E8E\u8282\u7701\u591A\u6B21\u53D1\u9001\u6307\u4EE4\u7684\u7F51\u7EDC\u5F00\u9500\u3002 \u548C\u4E8B\u52A1&amp;Lua\u6709\u4EE5\u4E0B\u51E0\u4E2A\u533A\u522B\uFF1A</p><ol><li>\u8FD9\u662F\u7EAF\u5BA2\u6237\u7AEF\u884C\u4E3A\uFF0C\u670D\u52A1\u7AEF\u65E0\u611F\u77E5\uFF0C\u4E5F\u6CA1\u6709\u8FDB\u884C\u5BF9\u5E94\u7684\u7279\u6B8A\u5904\u7406\u3002</li><li>\u4E0D\u963B\u585E\u670D\u52A1\u7AEF\u6267\u884C\u5176\u4ED6\u5BA2\u6237\u7AEF\u7684\u6307\u4EE4\uFF0C\u5373\u6CA1\u6709\u4E32\u884C\u5316</li><li>\u65E0\u6CD5\u5728\u4E00\u4E2APPL\u5185\uFF0C\u4E00\u4E2A\u6307\u4EE4\u8BFB\u53D6\u4E0A\u4E00\u4E2A\u6307\u4EE4\u7684\u7ED3\u679C</li></ol><h4 id="\u4E8B\u52A1-1" tabindex="-1"><a class="header-anchor" href="#\u4E8B\u52A1-1" aria-hidden="true">#</a> \u4E8B\u52A1</h4><p>\u5C06\u6BCF\u6761\u547D\u4EE4\u7F13\u5B58\u5728\u670D\u52A1\u7AEF\u7684\u4E00\u4E2A\u961F\u5217\u4E2D\uFF0C\u63D0\u4EA4\u65F6\u518D\u4E00\u6B21\u6027\u6267\u884C\u3002 \u548CPipeline\u7684\u533A\u522B\u5982\u4E0B\uFF1A</p><ol><li>\u670D\u52A1\u7AEF\u611F\u77E5\uFF0C\u6BCF\u6B21\u5BA2\u6237\u7AEF\u53D1\u9001\u5355\u6307\u4EE4\u90FD\u548C\u670D\u52A1\u7AEF\u4EA4\u4E92\u3002</li><li>\u4E25\u683C\u4E32\u884C\u5316\uFF0C\u4F1A\u963B\u585E\u4E8B\u52A1\u4E4B\u5916\u5176\u4ED6\u5BA2\u6237\u7AEF\u547D\u4EE4\u7684\u6267\u884C\u3002</li><li>\u5982\u679C\u9047\u5230\u6307\u4EE4\u7684\u8BED\u6CD5\u9519\u8BEF\uFF0C\u4F1A\u5728\u63D0\u4EA4\u524D\u5373\u5165\u961F\u5217\u65F6\u66B4\u9732\u51FA\u6765\u3002</li><li>\u62E5\u6709 watch \u6307\u4EE4\u529F\u80FD\uFF0C\u76F8\u5F53\u4E8E\u4E00\u79CD\u4E50\u89C2\u9501\u3002</li></ol><h4 id="lua-\u811A\u672C" tabindex="-1"><a class="header-anchor" href="#lua-\u811A\u672C" aria-hidden="true">#</a> Lua \u811A\u672C</h4><p>Lua \u76F8\u5F53\u4E8E Pipeline \u548C \u4E8B\u52A1\u4F18\u52BF\u7684\u7ED3\u5408\uFF0C\u5E76\u63D0\u4F9B\u4E86\u66F4\u5F3A\u5927\u7684\u80FD\u529B\u3002\u4E00\u822C\u5728\u5F00\u53D1\u4E2D\u4EE3\u66FF\u539F\u751F\u63D0\u4F9B\u7684\u4E8B\u52A1\u3002 \u4E3B\u8981\u7684\u533A\u522B\u5728\u4E8E\uFF1A</p><ol><li>\u53EF\u81EA\u5B9A\u4E49\u590D\u6742\u903B\u8F91\uFF0C\u5982if-else\uFF0C\u9AD8\u7EA7\u8FD0\u7B97\u7B26\u7B49\u3002</li><li>\u5177\u6709\u7F16\u8BD1\u7F13\u5B58\u80FD\u529B\uFF0C\u53EF\u4EE5\u4F7F\u7528 sha \u8C03\u7528\u7F13\u5B58\u5728\u670D\u52A1\u5668\u7684\u540C\u4E00\u811A\u672C\uFF0C\u8FDB\u4E00\u6B65\u63D0\u9AD8\u6027\u80FD\u3002</li></ol><h3 id="_10-\u4E86\u89E3-watch-\u547D\u4EE4\u5417" tabindex="-1"><a class="header-anchor" href="#_10-\u4E86\u89E3-watch-\u547D\u4EE4\u5417" aria-hidden="true">#</a> 10. \u4E86\u89E3 WATCH \u547D\u4EE4\u5417</h3><p>Watch \u547D\u4EE4\u662FExec\u547D\u4EE4\u7684\u6267\u884C\u6761\u4EF6\uFF0C\u5982\u679CWatch\u7684Key\u6CA1\u6709\u88AB\u4FEE\u6539\u5219Redis\u6267\u884C\u4E8B\u52A1\uFF0C\u5426\u5219\u4E8B\u52A1\u4E0D\u4F1A\u88AB\u6267\u884C\u3002 Watch \u547D\u4EE4\u53EF\u4EE5\u88AB\u8C03\u7528\u591A\u6B21\uFF0C\u4E00\u4E2A Watch \u547D\u4EE4\u53EF\u4EE5\u76D1\u63A7\u591A\u4E2A key \u3002Watch \u547D\u4EE4\u8C03\u7528\u5373\u542F\u52A8\u76D1\u63A7\u529F\u80FD\uFF0C\u4ECEWatch \u547D\u4EE4\u5F00\u59CB\u70B9\u5230\u6267\u884C EXEC \u547D\u4EE4\u7EC8\u6B62\u3002\u4E00\u65E6 EXEC \u88AB\u8C03\u7528\uFF0C\u6240\u6709\u7684\u952E\u90FD\u5C06\u4E0D\u88AB\u76D1\u89C6\uFF0C\u65E0\u8BBA\u6240\u8BA8\u8BBA\u7684\u4E8B\u52A1\u662F\u5426\u88AB\u4E2D\u6B62\u3002\u5173\u95ED\u5BA2\u6237\u7AEF\u8FDE\u63A5\u4E5F\u4F1A\u89E6\u53D1\u6240\u6709\u7684\u952E\u88AB\u53D6\u6D88\u76D1\u89C6\u3002 Redis Watch \u547D\u4EE4\u7ED9\u4E8B\u52A1\u63D0\u4F9Bcheck-and-set (CAS) \u673A\u5236\u3002\u88AB Watch \u7684 Key \u88AB\u6301\u7EED\u76D1\u63A7\uFF0C\u5982\u679C key \u5728 Exec \u547D\u4EE4\u6267\u884C\u524D\u6709\u6539\u53D8\uFF0C\u90A3\u4E48\u6574\u4E2A\u4E8B\u52A1\u88AB\u53D6\u6D88\uFF0CExec\u8FD4\u56DEnull\u8868\u793A\u4E8B\u52A1\u6CA1\u6709\u6210\u529F\u3002 \u8BF7\u770B\u4E0B\u9762\u793A\u4F8B\uFF0C\u6211\u4EEC\u9700\u8981\u7ED9key\u7684\u503C\u52A0\u4E00\uFF0C\u4F7F\u7528\u4E0B\u9762\u547D\u4EE4\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>num <span class="token operator">=</span> GET sampleKey
num <span class="token operator">=</span> num + <span class="token number">1</span>
SET sampleKey <span class="token variable">$num</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u4E0A\u9762\u547D\u4EE4\u5728\u5355\u7528\u6237\u6267\u884C\u73AF\u5883\u4E0B\u6CA1\u6709\u4EFB\u4F55\u95EE\u9898\u3002\u5982\u679C\u591A\u4E2A\u7528\u6237\u5C1D\u8BD5\u540C\u65F6\u6B63\u952E\u7684\u503C\u4F1A\u4EA7\u751F\u95EE\u9898\uFF0C\u5047\u8BBEsampleKey \u539F\u6765\u503C\u4E3A13\uFF0C\u4E24\u4E2A\u5BA2\u6237\u7AEF\u5C1D\u8BD5\u540C\u65F6\u589E\u52A0\u503C\u3002\u4E24\u8005\u90FD\u5C06\u952E\u8BBE\u4E3A14\uFF0C\u6700\u7EC8\u7ED3\u679C\u4E3A14\u800C\u4E0D\u662F15\u3002 \u4F7F\u7528watch\u547D\u4EE4\u53EF\u4EE5\u89E3\u51B3\u8BE5\u95EE\u9898\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>WATCH sampleKey
num <span class="token operator">=</span> GET sampleKey
num <span class="token operator">=</span> num + <span class="token number">1</span>
MULTI
SET sampleKey <span class="token variable">$num</span>
EXEC
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u4F7F\u7528\u4E0A\u9762\u4EE3\u7801\uFF0C\u5982\u679C\u7ADE\u4E89\u6761\u4EF6\u53D1\u751F\uFF0C\u56E0\u4E3A\u952E\u88AB\u76D1\u63A7\uFF0CExec\u4F1A\u6267\u884C\u5931\u8D25\u3002\u53EA\u6709\u5F53\u6CA1\u6709\u7ADE\u4E89\u6761\u4EF6\u65F6\u624D\u80FD\u6B63\u786E\u6267\u884C\u4E8B\u52A1\u3002\u8FD9\u79CD\u9501\u5904\u7406\u4E5F\u79F0\u4E3A\u201C\u4E50\u89C2\u9501\u201D\uFF0C\u5B83\u63D0\u4F9B\u6709\u6548\u6602\u662F\u4FDD\u969C\u7ADE\u4E89\u6761\u4EF6\u3002\u5927\u591A\u6570\u60C5\u51B5\u4E0B\u4E0D\u540C\u5BA2\u6237\u7AEF\u8BBF\u95EE\u4E0D\u540C\u7684\u952E\uFF0C\u56E0\u6B64\u51B2\u7A81\u7684\u6982\u7387\u76F8\u5F53\u5C0F\uFF0C\u4E8B\u52A1\u4E0D\u592A\u53EF\u80FD\u9700\u8981\u91CD\u590D\u6267\u884C\u3002</p><h3 id="_11-redis-\u4E8B\u52A1\u7684\u5B89\u5168\u6027\u5982\u4F55\u4FDD\u8BC1" tabindex="-1"><a class="header-anchor" href="#_11-redis-\u4E8B\u52A1\u7684\u5B89\u5168\u6027\u5982\u4F55\u4FDD\u8BC1" aria-hidden="true">#</a> 11. redis \u4E8B\u52A1\u7684\u5B89\u5168\u6027\u5982\u4F55\u4FDD\u8BC1</h3><p>redis \u4E8B\u52A1\u7684\u5B89\u5168\u6027\uFF0C\u53EF\u4EE5\u5229\u7528 Watch \u63D0\u4F9B\u7684\u76D1\u89C6\u673A\u5236\uFF0C\u542F\u7528 cas \u4E50\u89C2\u9501\u6807\u5FD7\uFF0C\u5728\u591A\u6781\u574F\u5883\u4E0B\uFF0C\u5BA2\u6237\u7AEF a \u5F00\u542F\u76D1\u89C6\u540E\u542F\u7528\u4E8B\u52A1\u8FC7\u7A0B\u4E2D\uFF0C\u5982\u679C\u5BA2\u6237\u7AEFb\u4FEE\u6539\u4E86\u76D1\u89C6\u7684\u952E\uFF0C\u90A3\u4E48 <code>REDIS_DIRTY_CAS</code>\u4F1A\u6253\u5F00\uFF0C\u5F53\u5BA2\u6237\u7AEF a \u6267\u884C <code>EXEC</code> \u7684\u65F6\u5019\uFF0C\u670D\u52A1\u5668\u4F1A\u62D2\u7EDD\u6267\u884C\u5B83\u63D0\u4EA4\u7684\u4E8B\u52A1\uFF0C\u4EE5\u6B64\u6765\u4FDD\u8BC1\u4E8B\u52A1\u7684\u6570\u636E\u5B89\u5168\u3002</p><h2 id="lua-\u811A\u672C-1" tabindex="-1"><a class="header-anchor" href="#lua-\u811A\u672C-1" aria-hidden="true">#</a> LUA \u811A\u672C</h2><h3 id="_1-redis-\u4E3A\u4EC0\u4E48\u8981\u5F15\u5165-lua-\u811A\u672C" tabindex="-1"><a class="header-anchor" href="#_1-redis-\u4E3A\u4EC0\u4E48\u8981\u5F15\u5165-lua-\u811A\u672C" aria-hidden="true">#</a> 1. redis \u4E3A\u4EC0\u4E48\u8981\u5F15\u5165 lua \u811A\u672C</h3><p>\u56E0\u4E3A Redis \u867D\u7136\u63D0\u4F9B\u4E86\u975E\u5E38\u4E30\u5BCC\u7684\u6307\u4EE4\u96C6\uFF0C\u5B98\u7F51\u4E0A\u63D0\u4F9B\u4E86200\u591A\u4E2A\u547D\u4EE4\u3002\u4F46\u662F\u67D0\u4E9B\u7279\u5B9A\u9886\u57DF\uFF0C\u9700\u8981\u6269\u5145\u82E5\u5E72\u6307\u4EE4\u539F\u5B50\u6027\u6267\u884C\u65F6\uFF0C\u4EC5\u4F7F\u7528\u539F\u751F\u547D\u4EE4\u4FBF\u65E0\u6CD5\u5B8C\u6210\u3002 Redis \u4E3A\u8FD9\u6837\u7684\u7528\u6237\u573A\u666F\u63D0\u4F9B\u4E86 lua \u811A\u672C\u652F\u6301\uFF0C\u7528\u6237\u53EF\u4EE5\u5411\u670D\u52A1\u5668\u53D1\u9001 lua \u811A\u672C\u6765\u6267\u884C\u81EA\u5B9A\u4E49\u52A8\u4F5C\uFF0C\u83B7\u53D6\u811A\u672C\u7684\u54CD\u5E94\u6570\u636E\u3002</p><h3 id="_2-redis-\u4F7F\u7528-lua-\u6709\u4EC0\u4E48\u7279\u6027" tabindex="-1"><a class="header-anchor" href="#_2-redis-\u4F7F\u7528-lua-\u6709\u4EC0\u4E48\u7279\u6027" aria-hidden="true">#</a> 2. redis \u4F7F\u7528 lua \u6709\u4EC0\u4E48\u7279\u6027</h3><ol><li>\u51CF\u5C11\u7F51\u7EDC\u5F00\u9500\u3002\u53EF\u4EE5\u5C06\u591A\u4E2A\u8BF7\u6C42\u901A\u8FC7\u811A\u672C\u7684\u5F62\u5F0F\u4E00\u6B21\u53D1\u9001\uFF0C\u51CF\u5C11\u7F51\u7EDC\u65F6\u5EF6\u3002</li><li>\u539F\u5B50\u64CD\u4F5C\u3002Redis\u4F1A\u5C06\u6574\u4E2A\u811A\u672C\u4F5C\u4E3A\u4E00\u4E2A\u6574\u4F53\u6267\u884C\uFF0C\u4E2D\u95F4\u4E0D\u4F1A\u88AB\u5176\u4ED6\u8BF7\u6C42\u63D2\u5165\u3002\u56E0\u6B64\u5728\u811A\u672C\u8FD0\u884C\u8FC7\u7A0B\u4E2D\u65E0\u9700\u62C5\u5FC3\u4F1A\u51FA\u73B0\u7ADE\u6001\u6761\u4EF6\uFF0C\u65E0\u9700\u4F7F\u7528\u4E8B\u52A1\u3002</li><li>\u590D\u7528\u3002\u5BA2\u6237\u7AEF\u53D1\u9001\u7684\u811A\u672C\u53EF\u4EE5\u4F7F\u7528 load \u52A0\u8F7D\u7136\u540E\u7F13\u5B58\u8D77\u6765\u83B7\u5F97\u8BE5\u811A\u672C\u7684 sha \u503C\uFF0C\u8FD9\u6837\u5176\u4ED6\u5BA2\u6237\u7AEF\u53EF\u4EE5\u6839\u636E sha \u590D\u7528\u8FD9\u4E00\u811A\u672C\uFF0C\u800C\u4E0D\u9700\u8981\u4F7F\u7528\u4EE3\u7801\u5B8C\u6210\u76F8\u540C\u7684\u903B\u8F91\u3002</li></ol><h3 id="_3-lua-\u811A\u672C\u6267\u884C\u4E00\u534A-\u673A\u5668\u65AD\u7535\u4E86\u4F1A\u600E\u4E48\u6837" tabindex="-1"><a class="header-anchor" href="#_3-lua-\u811A\u672C\u6267\u884C\u4E00\u534A-\u673A\u5668\u65AD\u7535\u4E86\u4F1A\u600E\u4E48\u6837" aria-hidden="true">#</a> 3. lua \u811A\u672C\u6267\u884C\u4E00\u534A\uFF0C\u673A\u5668\u65AD\u7535\u4E86\u4F1A\u600E\u4E48\u6837</h3><p>Redis\u662F\u57FA\u4E8E\u5185\u5B58\u7684\u6570\u636E\u5E93\uFF0C\u6240\u4EE5\u5F53\u53D1\u751F\u5B95\u673A\u6216\u8005\u505C\u6B62\u540E\u91CD\u65B0\u542F\u52A8\u65F6\uFF0CRedis\u4F1A\u4F7F\u7528\u78C1\u76D8\u4E0A\u7684\u6301\u4E45\u5316\u6587\u4EF6\u6765\u6062\u590D\u6570\u636E\uFF0C\u6240\u4EE5\u662F\u5426\u80FD\u6062\u590D\u6570\u636E\uFF0C\u80FD\u6062\u590D\u591A\u5C11\u6570\u636E\uFF0C\u53D6\u51B3\u4E8E\u4F7F\u7528\u54EA\u4E00\u79CD\u6301\u4E45\u5316\u7B56\u7565\u3002</p><ul><li>\u5982\u679C\u662F\u4F7F\u7528 rdb\uFF0C\u5F88\u663E\u7136\u6062\u590D\u5F00\u673A\u4E4B\u540E\uFF0C\u53EA\u4F1A\u6062\u590D \u6211\u4EEC\u5907\u4EFD\u65F6\u7684\u6570\u636E\u3002</li><li>\u5982\u679C\u662F\u4F7F\u7528AOF\u7684\u8BDD\uFF0C\u5982\u679C\u5728Redis\u4E8B\u52A1\u6267\u884C\u671F\u95F4\u5B95\u673A\uFF0C\u90A3\u4E48\u8FD9\u6B21\u4E8B\u52A1\u8FD8\u662F\u76F8\u5F53\u4E8E&quot;\u6CA1\u6709\u6267\u884C&quot;\uFF0C\u7531\u4E8E\u547D\u4EE4\u8FD8\u6CA1\u6765\u53CA\u5199\u5165AOF\uFF0C\u5728\u670D\u52A1\u6062\u590D\u540E\u66F4\u4E0D\u53EF\u80FD\u6062\u590D\u6570\u636E\u3002\u5BF9\u4E8ERedis\u5BA2\u6237\u7AEF\u800C\u8A00\uFF0C\u4F1A\u6536\u5230\u670D\u52A1\u7AEF\u7684\u5F02\u5E38\u54CD\u5E94\u3002\u5199\u5165AOF\u7684\u8FC7\u7A0B\u4E5F\u662F\u4F1A\u88AB\u6253\u65AD\u7684\uFF0CRedis \u6587\u6863\u4E2D\u63D0\u5230\uFF0C\u5982\u679CRedis\u670D\u52A1\u5668\u7A81\u7136\u5D29\u6E83\uFF0C\u5BFC\u81F4\u51FA\u73B0\u4E86&quot;\u534A\u5199\u72B6\u6001&quot;\u7684AOF\u6587\u4EF6\u65F6\uFF0C\u670D\u52A1\u5668\u91CD\u65B0\u542F\u52A8\u65F6\uFF0C\u4F1A\u68C0\u6D4B\u5230\u8FD9\u79CD\u60C5\u51B5\uFF0C\u5E76\u4E14\u9000\u51FA\u63D0\u793A\u7528\u6237\u4F7F\u7528 redis-check-aof \u4FEE\u590D AOF \u6587\u4EF6\u3002&quot;\u534A\u5199\u72B6\u6001&quot;\u7684\u4E8B\u52A1\u6216\u8005\u547D\u4EE4\u4F1A\u88AB\u5220\u9664\uFF0C\u670D\u52A1\u5668\u53EF\u4EE5\u91CD\u65B0\u542F\u52A8\u3002</li></ul><h3 id="_4-lua-\u811A\u672C\u8DDF\u4E8B\u52A1\u6709\u4EC0\u4E48\u5DEE\u522B" tabindex="-1"><a class="header-anchor" href="#_4-lua-\u811A\u672C\u8DDF\u4E8B\u52A1\u6709\u4EC0\u4E48\u5DEE\u522B" aria-hidden="true">#</a> 4. lua \u811A\u672C\u8DDF\u4E8B\u52A1\u6709\u4EC0\u4E48\u5DEE\u522B</h3><p>redis \u4E8B\u52A1\u6267\u884C\u4E2D\uFF0C\u6BCF\u4E00\u6761\u6307\u4EE4\u4E4B\u95F4\u662F\u76F8\u4E92\u72EC\u7ACB\u7684\uFF0C\u6211\u4EEC\u65E0\u6CD5\u8BA9\u540E\u9762\u7684\u64CD\u4F5C\u4F9D\u8D56\u524D\u9762\u547D\u540D\u7684\u7ED3\u679C\uFF0C\u8FD9\u5C31\u8BA9\u6574\u4E2A\u4E8B\u52A1\u4EC5\u4EC5\u6210\u4E3A\u4E86\u4E00\u4E2A\u547D\u4EE4\u96C6\u5408\uFF0C\u5728\u547D\u4EE4\u4E4B\u95F4\u6211\u4EEC\u5B8C\u5168\u65E0\u6CD5\u505A\u4EFB\u4F55\u4E8B\u3002 \u4F46\u662F\uFF0CLua \u4F5C\u4E3A\u4E00\u4E2A\u811A\u672C\u8BED\u8A00\uFF0C\u53EF\u4EE5\u62E5\u6709\u5206\u652F\u3001\u5FAA\u73AF\u7B49\u8BED\u6CD5\u7ED3\u6784\uFF0C\u53EF\u4EE5\u8FDB\u884C\u4E1A\u52A1\u903B\u8F91\u7684\u7F16\u5199</p><h2 id="\u5206\u5E03\u5F0F\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#\u5206\u5E03\u5F0F\u95EE\u9898" aria-hidden="true">#</a> \u5206\u5E03\u5F0F\u95EE\u9898</h2><h3 id="_1-redis\u5B9E\u73B0\u5206\u5E03\u5F0F\u9501" tabindex="-1"><a class="header-anchor" href="#_1-redis\u5B9E\u73B0\u5206\u5E03\u5F0F\u9501" aria-hidden="true">#</a> 1. Redis\u5B9E\u73B0\u5206\u5E03\u5F0F\u9501</h3><p>Redis\u4E3A\u5355\u8FDB\u7A0B\u5355\u7EBF\u7A0B\u6A21\u5F0F\uFF0C\u91C7\u7528\u961F\u5217\u6A21\u5F0F\u5C06\u5E76\u53D1\u8BBF\u95EE\u53D8\u6210\u4E32\u884C\u8BBF\u95EE\uFF0C\u4E14\u591A\u5BA2\u6237\u7AEF\u5BF9Redis\u7684\u8FDE\u63A5\u5E76\u4E0D\u5B58\u5728\u7ADE\u4E89\u5173\u7CFB Redis \u4E2D\u53EF\u4EE5\u4F7F\u7528 SETNX \u547D\u4EE4\u5B9E\u73B0\u5206\u5E03\u5F0F\u9501\u3002 \u5F53\u4E14\u4EC5\u5F53 key \u4E0D\u5B58\u5728\uFF0C\u5C06 key \u7684\u503C\u8BBE\u4E3A value\u3002 \u82E5\u7ED9\u5B9A\u7684 key \u5DF2\u7ECF\u5B58\u5728\uFF0C\u5219 SETNX \u4E0D\u505A\u4EFB\u4F55\u52A8\u4F5C <img src="https://cdn.nlark.com/yuque/0/2020/png/2517043/1599815015830-53e07a45-8b86-490b-acd4-2ca177a4c0ec.png#averageHue=%234d4d4d&amp;height=226&amp;id=pjXA0&amp;originHeight=452&amp;originWidth=1320&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=159615&amp;status=done&amp;style=none&amp;title=&amp;width=660" alt="image.png"> \u4F7F\u7528 SETNX \u5B8C\u6210\u540C\u6B65\u9501\u7684\u6D41\u7A0B\u53CA\u4E8B\u9879\u5982\u4E0B\uFF1A \u4F7F\u7528 SETNX \u547D\u4EE4\u83B7\u53D6\u9501\uFF0C\u82E5\u8FD4\u56DE0\uFF08key\u5DF2\u5B58\u5728\uFF0C\u9501\u5DF2\u5B58\u5728\uFF09\u5219\u83B7\u53D6\u5931\u8D25\uFF0C\u53CD\u4E4B\u83B7\u53D6\u6210\u529F \u4E3A\u4E86\u9632\u6B62\u83B7\u53D6\u9501\u540E\u7A0B\u5E8F\u51FA\u73B0\u5F02\u5E38\uFF0C\u5BFC\u81F4\u5176\u4ED6\u7EBF\u7A0B/\u8FDB\u7A0B\u8C03\u7528SETNX\u547D\u4EE4\u603B\u662F\u8FD4\u56DE0\u800C\u8FDB\u5165\u6B7B\u9501\u72B6\u6001\uFF0C\u9700\u8981\u4E3A\u8BE5key\u8BBE\u7F6E\u4E00\u4E2A\u201C\u5408\u7406\u201D\u7684\u8FC7\u671F\u65F6\u95F4 \u91CA\u653E\u9501\uFF0C\u4F7F\u7528DEL\u547D\u4EE4\u5C06\u9501\u6570\u636E\u5220\u9664</p><h3 id="_2-\u5982\u4F55\u89E3\u51B3-redis-\u7684\u5E76\u53D1\u7ADE\u4E89-key-\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_2-\u5982\u4F55\u89E3\u51B3-redis-\u7684\u5E76\u53D1\u7ADE\u4E89-key-\u95EE\u9898" aria-hidden="true">#</a> 2. \u5982\u4F55\u89E3\u51B3 Redis \u7684\u5E76\u53D1\u7ADE\u4E89 Key \u95EE\u9898</h3>`,205),_=e("\u6240\u8C13 Redis \u7684\u5E76\u53D1\u7ADE\u4E89 Key \u7684\u95EE\u9898\u4E5F\u5C31\u662F\u591A\u4E2A\u7CFB\u7EDF\u540C\u65F6\u5BF9\u4E00\u4E2A key \u8FDB\u884C\u64CD\u4F5C\uFF0C\u4F46\u662F\u6700\u540E\u6267\u884C\u7684\u987A\u5E8F\u548C\u6211\u4EEC\u671F\u671B\u7684\u987A\u5E8F\u4E0D\u540C\uFF0C\u8FD9\u6837\u4E5F\u5C31\u5BFC\u81F4\u4E86\u7ED3\u679C\u7684\u4E0D\u540C\uFF01 \u63A8\u8350\u4E00\u79CD\u65B9\u6848\uFF1A\u5206\u5E03\u5F0F\u9501\uFF08zookeeper \u548C redis \u90FD\u53EF\u4EE5\u5B9E\u73B0\u5206\u5E03\u5F0F\u9501\uFF09\u3002\uFF08\u5982\u679C\u4E0D\u5B58\u5728 Redis \u7684\u5E76\u53D1\u7ADE\u4E89 Key \u95EE\u9898\uFF0C\u4E0D\u8981\u4F7F\u7528\u5206\u5E03\u5F0F\u9501\uFF0C\u8FD9\u6837\u4F1A\u5F71\u54CD\u6027\u80FD\uFF09 \u57FA\u4E8Ezookeeper\u4E34\u65F6\u6709\u5E8F\u8282\u70B9\u53EF\u4EE5\u5B9E\u73B0\u7684\u5206\u5E03\u5F0F\u9501\u3002\u5927\u81F4\u601D\u60F3\u4E3A\uFF1A\u6BCF\u4E2A\u5BA2\u6237\u7AEF\u5BF9\u67D0\u4E2A\u65B9\u6CD5\u52A0\u9501\u65F6\uFF0C\u5728zookeeper\u4E0A\u7684\u4E0E\u8BE5\u65B9\u6CD5\u5BF9\u5E94\u7684\u6307\u5B9A\u8282\u70B9\u7684\u76EE\u5F55\u4E0B\uFF0C\u751F\u6210\u4E00\u4E2A\u552F\u4E00\u7684\u77AC\u65F6\u6709\u5E8F\u8282\u70B9\u3002 \u5224\u65AD\u662F\u5426\u83B7\u53D6\u9501\u7684\u65B9\u5F0F\u5F88\u7B80\u5355\uFF0C\u53EA\u9700\u8981\u5224\u65AD\u6709\u5E8F\u8282\u70B9\u4E2D\u5E8F\u53F7\u6700\u5C0F\u7684\u4E00\u4E2A\u3002 \u5F53\u91CA\u653E\u9501\u7684\u65F6\u5019\uFF0C\u53EA\u9700\u5C06\u8FD9\u4E2A\u77AC\u65F6\u8282\u70B9\u5220\u9664\u5373\u53EF\u3002\u540C\u65F6\uFF0C\u5176\u53EF\u4EE5\u907F\u514D\u670D\u52A1\u5B95\u673A\u5BFC\u81F4\u7684\u9501\u65E0\u6CD5\u91CA\u653E\uFF0C\u800C\u4EA7\u751F\u7684\u6B7B\u9501\u95EE\u9898\u3002\u5B8C\u6210\u4E1A\u52A1\u6D41\u7A0B\u540E\uFF0C\u5220\u9664\u5BF9\u5E94\u7684\u5B50\u8282\u70B9\u91CA\u653E\u9501\u3002 \u5728\u5B9E\u8DF5\u4E2D\uFF0C\u5F53\u7136\u662F\u4ECE\u4EE5\u53EF\u9760\u6027\u4E3A\u4E3B\u3002\u6240\u4EE5\u9996\u63A8Zookeeper\u3002 \u53C2\u8003\uFF1A"),R={href:"https://www.jianshu.com/p/8bddd381de06",target:"_blank",rel:"noopener noreferrer"},x=e("https://www.jianshu.com/p/8bddd381de06"),w=i('<h3 id="_3-\u5206\u5E03\u5F0Fredis\u662F\u524D\u671F\u505A\u8FD8\u662F\u540E\u671F\u89C4\u6A21\u4E0A\u6765\u4E86\u518D\u505A\u597D-\u4E3A\u4EC0\u4E48" tabindex="-1"><a class="header-anchor" href="#_3-\u5206\u5E03\u5F0Fredis\u662F\u524D\u671F\u505A\u8FD8\u662F\u540E\u671F\u89C4\u6A21\u4E0A\u6765\u4E86\u518D\u505A\u597D-\u4E3A\u4EC0\u4E48" aria-hidden="true">#</a> 3. \u5206\u5E03\u5F0FRedis\u662F\u524D\u671F\u505A\u8FD8\u662F\u540E\u671F\u89C4\u6A21\u4E0A\u6765\u4E86\u518D\u505A\u597D\uFF1F\u4E3A\u4EC0\u4E48\uFF1F</h3><p>\u65E2\u7136Redis\u662F\u5982\u6B64\u7684\u8F7B\u91CF\uFF08\u5355\u5B9E\u4F8B\u53EA\u4F7F\u75281M\u5185\u5B58\uFF09\uFF0C\u4E3A\u9632\u6B62\u4EE5\u540E\u7684\u6269\u5BB9\uFF0C\u6700\u597D\u7684\u529E\u6CD5\u5C31\u662F\u4E00\u5F00\u59CB\u5C31\u542F\u52A8\u8F83\u591A\u5B9E\u4F8B\u3002\u5373\u4FBF\u4F60\u53EA\u6709\u4E00\u53F0\u670D\u52A1\u5668\uFF0C\u4F60\u4E5F\u53EF\u4EE5\u4E00\u5F00\u59CB\u5C31\u8BA9Redis\u4EE5\u5206\u5E03\u5F0F\u7684\u65B9\u5F0F\u8FD0\u884C\uFF0C\u4F7F\u7528\u5206\u533A\uFF0C\u5728\u540C\u4E00\u53F0\u670D\u52A1\u5668\u4E0A\u542F\u52A8\u591A\u4E2A\u5B9E\u4F8B\u3002 \u4E00\u5F00\u59CB\u5C31\u591A\u8BBE\u7F6E\u51E0\u4E2ARedis\u5B9E\u4F8B\uFF0C\u4F8B\u598232\u6216\u800564\u4E2A\u5B9E\u4F8B\uFF0C\u5BF9\u5927\u591A\u6570\u7528\u6237\u6765\u8BF4\u8FD9\u64CD\u4F5C\u8D77\u6765\u53EF\u80FD\u6BD4\u8F83\u9EBB\u70E6\uFF0C\u4F46\u662F\u4ECE\u957F\u4E45\u6765\u770B\u505A\u8FD9\u70B9\u727A\u7272\u662F\u503C\u5F97\u7684\u3002 \u8FD9\u6837\u7684\u8BDD\uFF0C\u5F53\u4F60\u7684\u6570\u636E\u4E0D\u65AD\u589E\u957F\uFF0C\u9700\u8981\u66F4\u591A\u7684Redis\u670D\u52A1\u5668\u65F6\uFF0C\u4F60\u9700\u8981\u505A\u7684\u5C31\u662F\u4EC5\u4EC5\u5C06Redis\u5B9E\u4F8B\u4ECE\u4E00\u53F0\u670D\u52A1\u8FC1\u79FB\u5230\u53E6\u5916\u4E00\u53F0\u670D\u52A1\u5668\u800C\u5DF2\uFF08\u800C\u4E0D\u7528\u8003\u8651\u91CD\u65B0\u5206\u533A\u7684\u95EE\u9898\uFF09\u3002\u4E00\u65E6\u4F60\u6DFB\u52A0\u4E86\u53E6\u4E00\u53F0\u670D\u52A1\u5668\uFF0C\u4F60\u9700\u8981\u5C06\u4F60\u4E00\u534A\u7684Redis\u5B9E\u4F8B\u4ECE\u7B2C\u4E00\u53F0\u673A\u5668\u8FC1\u79FB\u5230\u7B2C\u4E8C\u53F0\u673A\u5668\u3002</p><h3 id="_4-\u4EC0\u4E48\u662F-redlock" tabindex="-1"><a class="header-anchor" href="#_4-\u4EC0\u4E48\u662F-redlock" aria-hidden="true">#</a> 4. \u4EC0\u4E48\u662F RedLock</h3><p>Redis \u5B98\u65B9\u7AD9\u63D0\u51FA\u4E86\u4E00\u79CD\u6743\u5A01\u7684\u57FA\u4E8E Redis \u5B9E\u73B0\u5206\u5E03\u5F0F\u9501\u7684\u65B9\u5F0F\u540D\u53EB <em>Redlock</em>\uFF0C\u6B64\u79CD\u65B9\u5F0F\u6BD4\u539F\u5148\u7684\u5355\u8282\u70B9\u7684\u65B9\u6CD5\u66F4\u5B89\u5168\u3002\u5B83\u53EF\u4EE5\u4FDD\u8BC1\u4EE5\u4E0B\u7279\u6027\uFF1A</p><ol><li>\u5B89\u5168\u7279\u6027\uFF1A\u4E92\u65A5\u8BBF\u95EE\uFF0C\u5373\u6C38\u8FDC\u53EA\u6709\u4E00\u4E2A client \u80FD\u62FF\u5230\u9501</li><li>\u907F\u514D\u6B7B\u9501\uFF1A\u6700\u7EC8 client \u90FD\u53EF\u80FD\u62FF\u5230\u9501\uFF0C\u4E0D\u4F1A\u51FA\u73B0\u6B7B\u9501\u7684\u60C5\u51B5\uFF0C\u5373\u4F7F\u539F\u672C\u9501\u4F4F\u67D0\u8D44\u6E90\u7684 client crash \u4E86\u6216\u8005\u51FA\u73B0\u4E86\u7F51\u7EDC\u5206\u533A</li><li>\u5BB9\u9519\u6027\uFF1A\u53EA\u8981\u5927\u90E8\u5206 Redis \u8282\u70B9\u5B58\u6D3B\u5C31\u53EF\u4EE5\u6B63\u5E38\u63D0\u4F9B\u670D\u52A1</li></ol><h2 id="\u7F13\u5B58\u5F02\u5E38" tabindex="-1"><a class="header-anchor" href="#\u7F13\u5B58\u5F02\u5E38" aria-hidden="true">#</a> \u7F13\u5B58\u5F02\u5E38</h2><h3 id="_1-\u7F13\u5B58\u96EA\u5D29" tabindex="-1"><a class="header-anchor" href="#_1-\u7F13\u5B58\u96EA\u5D29" aria-hidden="true">#</a> 1. \u7F13\u5B58\u96EA\u5D29</h3><p><strong>\u7F13\u5B58\u96EA\u5D29</strong>\u662F\u6307\u7F13\u5B58\u540C\u4E00\u65F6\u95F4\u5927\u9762\u79EF\u7684\u5931\u6548\uFF0C\u6240\u4EE5\uFF0C\u540E\u9762\u7684\u8BF7\u6C42\u90FD\u4F1A\u843D\u5230\u6570\u636E\u5E93\u4E0A\uFF0C\u9020\u6210\u6570\u636E\u5E93\u77ED\u65F6\u95F4\u5185\u627F\u53D7\u5927\u91CF\u8BF7\u6C42\u800C\u5D29\u6389\u3002 <strong>\u89E3\u51B3\u65B9\u6848</strong></p><ol><li>\u7F13\u5B58\u6570\u636E\u7684\u8FC7\u671F\u65F6\u95F4\u8BBE\u7F6E\u968F\u673A\uFF0C\u9632\u6B62\u540C\u4E00\u65F6\u95F4\u5927\u91CF\u6570\u636E\u8FC7\u671F\u73B0\u8C61\u53D1\u751F\u3002</li><li>\u4E00\u822C\u5E76\u53D1\u91CF\u4E0D\u662F\u7279\u522B\u591A\u7684\u65F6\u5019\uFF0C\u4F7F\u7528\u6700\u591A\u7684\u89E3\u51B3\u65B9\u6848\u662F\u52A0\u9501\u6392\u961F\u3002</li><li>\u7ED9\u6BCF\u4E00\u4E2A\u7F13\u5B58\u6570\u636E\u589E\u52A0\u76F8\u5E94\u7684\u7F13\u5B58\u6807\u8BB0\uFF0C\u8BB0\u5F55\u7F13\u5B58\u7684\u662F\u5426\u5931\u6548\uFF0C\u5982\u679C\u7F13\u5B58\u6807\u8BB0\u5931\u6548\uFF0C\u5219\u66F4\u65B0\u6570\u636E\u7F13\u5B58\u3002</li></ol><h3 id="_2-\u7F13\u5B58\u7A7F\u900F" tabindex="-1"><a class="header-anchor" href="#_2-\u7F13\u5B58\u7A7F\u900F" aria-hidden="true">#</a> 2. \u7F13\u5B58\u7A7F\u900F</h3><p><strong>\u7F13\u5B58\u7A7F\u900F</strong>\u662F\u6307\u7F13\u5B58\u548C\u6570\u636E\u5E93\u4E2D\u90FD\u6CA1\u6709\u7684\u6570\u636E\uFF0C\u5BFC\u81F4\u6240\u6709\u7684\u8BF7\u6C42\u90FD\u843D\u5230\u6570\u636E\u5E93\u4E0A\uFF0C\u9020\u6210\u6570\u636E\u5E93\u77ED\u65F6\u95F4\u5185\u627F\u53D7\u5927\u91CF\u8BF7\u6C42\u800C\u5D29\u6389\u3002 <strong>\u89E3\u51B3\u65B9\u6848</strong></p><ol><li>\u63A5\u53E3\u5C42\u589E\u52A0\u6821\u9A8C\uFF0C\u5982\u7528\u6237\u9274\u6743\u6821\u9A8C\uFF0Cid\u505A\u57FA\u7840\u6821\u9A8C\uFF0Cid&lt;=0\u7684\u76F4\u63A5\u62E6\u622A\uFF1B</li><li>\u4ECE\u7F13\u5B58\u53D6\u4E0D\u5230\u7684\u6570\u636E\uFF0C\u5728\u6570\u636E\u5E93\u4E2D\u4E5F\u6CA1\u6709\u53D6\u5230\uFF0C\u8FD9\u65F6\u4E5F\u53EF\u4EE5\u5C06key-value\u5BF9\u5199\u4E3Akey-null\uFF0C\u7F13\u5B58\u6709\u6548\u65F6\u95F4\u53EF\u4EE5\u8BBE\u7F6E\u77ED\u70B9\uFF0C\u598230\u79D2\uFF08\u8BBE\u7F6E\u592A\u957F\u4F1A\u5BFC\u81F4\u6B63\u5E38\u60C5\u51B5\u4E5F\u6CA1\u6CD5\u4F7F\u7528\uFF09\u3002\u8FD9\u6837\u53EF\u4EE5\u9632\u6B62\u653B\u51FB\u7528\u6237\u53CD\u590D\u7528\u540C\u4E00\u4E2Aid\u66B4\u529B\u653B\u51FB</li><li>\u91C7\u7528\u5E03\u9686\u8FC7\u6EE4\u5668\uFF0C\u5C06\u6240\u6709\u53EF\u80FD\u5B58\u5728\u7684\u6570\u636E\u54C8\u5E0C\u5230\u4E00\u4E2A\u8DB3\u591F\u5927\u7684 bitmap \u4E2D\uFF0C\u4E00\u4E2A\u4E00\u5B9A\u4E0D\u5B58\u5728\u7684\u6570\u636E\u4F1A\u88AB\u8FD9\u4E2A bitmap \u62E6\u622A\u6389\uFF0C\u4ECE\u800C\u907F\u514D\u4E86\u5BF9\u5E95\u5C42\u5B58\u50A8\u7CFB\u7EDF\u7684\u67E5\u8BE2\u538B\u529B</li></ol><p><strong>\u9644\u52A0</strong> \u5BF9\u4E8E\u7A7A\u95F4\u7684\u5229\u7528\u5230\u8FBE\u4E86\u4E00\u79CD\u6781\u81F4\uFF0C\u90A3\u5C31\u662FBitmap\u548C\u5E03\u9686\u8FC7\u6EE4\u5668(Bloom Filter)\u3002 Bitmap\uFF1A \u5178\u578B\u7684\u5C31\u662F\u54C8\u5E0C\u8868 \u7F3A\u70B9\u662F\uFF0CBitmap\u5BF9\u4E8E\u6BCF\u4E2A\u5143\u7D20\u53EA\u80FD\u8BB0\u5F551bit\u4FE1\u606F\uFF0C\u5982\u679C\u8FD8\u60F3\u5B8C\u6210\u989D\u5916\u7684\u529F\u80FD\uFF0C\u6050\u6015\u53EA\u80FD\u9760\u727A\u7272\u66F4\u591A\u7684\u7A7A\u95F4\u3001\u65F6\u95F4\u6765\u5B8C\u6210\u4E86\u3002 \u5E03\u9686\u8FC7\u6EE4\u5668\uFF08\u63A8\u8350\uFF09 \u5C31\u662F\u5F15\u5165\u4E86<code>k(k&gt;1)</code>\u4E2A\u76F8\u4E92\u72EC\u7ACB\u7684\u54C8\u5E0C\u51FD\u6570\uFF0C\u4FDD\u8BC1\u5728\u7ED9\u5B9A\u7684\u7A7A\u95F4\u3001\u8BEF\u5224\u7387\u4E0B\uFF0C\u5B8C\u6210\u5143\u7D20\u5224\u91CD\u7684\u8FC7\u7A0B\u3002 \u5B83\u7684\u4F18\u70B9\u662F\u7A7A\u95F4\u6548\u7387\u548C\u67E5\u8BE2\u65F6\u95F4\u90FD\u8FDC\u8FDC\u8D85\u8FC7\u4E00\u822C\u7684\u7B97\u6CD5\uFF0C\u7F3A\u70B9\u662F\u6709\u4E00\u5B9A\u7684\u8BEF\u8BC6\u522B\u7387\u548C\u5220\u9664\u56F0\u96BE\u3002 Bloom-Filter\u7B97\u6CD5\u7684\u6838\u5FC3\u601D\u60F3\u5C31\u662F\u5229\u7528\u591A\u4E2A\u4E0D\u540C\u7684Hash\u51FD\u6570\u6765\u89E3\u51B3\u201C\u51B2\u7A81\u201D\u3002 Hash\u5B58\u5728\u4E00\u4E2A\u51B2\u7A81\uFF08\u78B0\u649E\uFF09\u7684\u95EE\u9898\uFF0C\u7528\u540C\u4E00\u4E2AHash\u5F97\u5230\u7684\u4E24\u4E2AURL\u7684\u503C\u6709\u53EF\u80FD\u76F8\u540C\u3002\u4E3A\u4E86\u51CF\u5C11\u51B2\u7A81\uFF0C\u6211\u4EEC\u53EF\u4EE5\u591A\u5F15\u5165\u51E0\u4E2AHash\uFF0C\u5982\u679C\u901A\u8FC7\u5176\u4E2D\u7684\u4E00\u4E2AHash\u503C\u6211\u4EEC\u5F97\u51FA\u67D0\u5143\u7D20\u4E0D\u5728\u96C6\u5408\u4E2D\uFF0C\u90A3\u4E48\u8BE5\u5143\u7D20\u80AF\u5B9A\u4E0D\u5728\u96C6\u5408\u4E2D\u3002\u53EA\u6709\u5728\u6240\u6709\u7684Hash\u51FD\u6570\u544A\u8BC9\u6211\u4EEC\u8BE5\u5143\u7D20\u5728\u96C6\u5408\u4E2D\u65F6\uFF0C\u624D\u80FD\u786E\u5B9A\u8BE5\u5143\u7D20\u5B58\u5728\u4E8E\u96C6\u5408\u4E2D\u3002\u8FD9\u4FBF\u662FBloom-Filter\u7684\u57FA\u672C\u601D\u60F3\u3002 Bloom-Filter\u4E00\u822C\u7528\u4E8E\u5728\u5927\u6570\u636E\u91CF\u7684\u96C6\u5408\u4E2D\u5224\u5B9A\u67D0\u5143\u7D20\u662F\u5426\u5B58\u5728\u3002</p><h3 id="_3-\u7F13\u5B58\u51FB\u7A7F" tabindex="-1"><a class="header-anchor" href="#_3-\u7F13\u5B58\u51FB\u7A7F" aria-hidden="true">#</a> 3. \u7F13\u5B58\u51FB\u7A7F</h3><p><strong>\u7F13\u5B58\u51FB\u7A7F</strong>\u662F\u6307\u7F13\u5B58\u4E2D\u6CA1\u6709\u4F46\u6570\u636E\u5E93\u4E2D\u6709\u7684\u6570\u636E\uFF08\u4E00\u822C\u662F\u7F13\u5B58\u65F6\u95F4\u5230\u671F\uFF09\uFF0C\u8FD9\u65F6\u7531\u4E8E\u5E76\u53D1\u7528\u6237\u7279\u522B\u591A\uFF0C\u540C\u65F6\u8BFB\u7F13\u5B58\u6CA1\u8BFB\u5230\u6570\u636E\uFF0C\u53C8\u540C\u65F6\u53BB\u6570\u636E\u5E93\u53BB\u53D6\u6570\u636E\uFF0C\u5F15\u8D77\u6570\u636E\u5E93\u538B\u529B\u77AC\u95F4\u589E\u5927\uFF0C\u9020\u6210\u8FC7\u5927\u538B\u529B\u3002\u548C\u7F13\u5B58\u96EA\u5D29\u4E0D\u540C\u7684\u662F\uFF0C\u7F13\u5B58\u51FB\u7A7F\u6307\u5E76\u53D1\u67E5\u540C\u4E00\u6761\u6570\u636E\uFF0C\u7F13\u5B58\u96EA\u5D29\u662F\u4E0D\u540C\u6570\u636E\u90FD\u8FC7\u671F\u4E86\uFF0C\u5F88\u591A\u6570\u636E\u90FD\u67E5\u4E0D\u5230\u4ECE\u800C\u67E5\u6570\u636E\u5E93\u3002 <strong>\u89E3\u51B3\u65B9\u6848</strong></p><ol><li>\u8BBE\u7F6E\u70ED\u70B9\u6570\u636E\u6C38\u8FDC\u4E0D\u8FC7\u671F\u3002</li><li>\u52A0\u4E92\u65A5\u9501\uFF0C\u4E92\u65A5\u9501</li></ol><h3 id="_4-\u7F13\u5B58\u9884\u70ED" tabindex="-1"><a class="header-anchor" href="#_4-\u7F13\u5B58\u9884\u70ED" aria-hidden="true">#</a> 4. \u7F13\u5B58\u9884\u70ED</h3><p><strong>\u7F13\u5B58\u9884\u70ED</strong>\u5C31\u662F\u7CFB\u7EDF\u4E0A\u7EBF\u540E\uFF0C\u5C06\u76F8\u5173\u7684\u7F13\u5B58\u6570\u636E\u76F4\u63A5\u52A0\u8F7D\u5230\u7F13\u5B58\u7CFB\u7EDF\u3002\u8FD9\u6837\u5C31\u53EF\u4EE5\u907F\u514D\u5728\u7528\u6237\u8BF7\u6C42\u7684\u65F6\u5019\uFF0C\u5148\u67E5\u8BE2\u6570\u636E\u5E93\uFF0C\u7136\u540E\u518D\u5C06\u6570\u636E\u7F13\u5B58\u7684\u95EE\u9898\uFF01\u7528\u6237\u76F4\u63A5\u67E5\u8BE2\u4E8B\u5148\u88AB\u9884\u70ED\u7684\u7F13\u5B58\u6570\u636E\uFF01 <strong>\u89E3\u51B3\u65B9\u6848</strong></p><ol><li>\u76F4\u63A5\u5199\u4E2A\u7F13\u5B58\u5237\u65B0\u9875\u9762\uFF0C\u4E0A\u7EBF\u65F6\u624B\u5DE5\u64CD\u4F5C\u4E00\u4E0B\uFF1B</li><li>\u6570\u636E\u91CF\u4E0D\u5927\uFF0C\u53EF\u4EE5\u5728\u9879\u76EE\u542F\u52A8\u7684\u65F6\u5019\u81EA\u52A8\u8FDB\u884C\u52A0\u8F7D\uFF1B</li><li>\u5B9A\u65F6\u5237\u65B0\u7F13\u5B58\uFF1B</li></ol><h3 id="_5-\u7F13\u5B58\u964D\u7EA7" tabindex="-1"><a class="header-anchor" href="#_5-\u7F13\u5B58\u964D\u7EA7" aria-hidden="true">#</a> 5. \u7F13\u5B58\u964D\u7EA7</h3><p>\u5F53\u8BBF\u95EE\u91CF\u5267\u589E\u3001\u670D\u52A1\u51FA\u73B0\u95EE\u9898\uFF08\u5982\u54CD\u5E94\u65F6\u95F4\u6162\u6216\u4E0D\u54CD\u5E94\uFF09\u6216\u975E\u6838\u5FC3\u670D\u52A1\u5F71\u54CD\u5230\u6838\u5FC3\u6D41\u7A0B\u7684\u6027\u80FD\u65F6\uFF0C\u4ECD\u7136\u9700\u8981\u4FDD\u8BC1\u670D\u52A1\u8FD8\u662F\u53EF\u7528\u7684\uFF0C\u5373\u4F7F\u662F\u6709\u635F\u670D\u52A1\u3002\u7CFB\u7EDF\u53EF\u4EE5\u6839\u636E\u4E00\u4E9B\u5173\u952E\u6570\u636E\u8FDB\u884C\u81EA\u52A8\u964D\u7EA7\uFF0C\u4E5F\u53EF\u4EE5\u914D\u7F6E\u5F00\u5173\u5B9E\u73B0\u4EBA\u5DE5\u964D\u7EA7\u3002 <strong>\u7F13\u5B58\u964D\u7EA7</strong>\u7684\u6700\u7EC8\u76EE\u7684\u662F\u4FDD\u8BC1\u6838\u5FC3\u670D\u52A1\u53EF\u7528\uFF0C\u5373\u4F7F\u662F\u6709\u635F\u7684\u3002\u800C\u4E14\u6709\u4E9B\u670D\u52A1\u662F\u65E0\u6CD5\u964D\u7EA7\u7684\uFF08\u5982\u52A0\u5165\u8D2D\u7269\u8F66\u3001\u7ED3\u7B97\uFF09\u3002 \u5728\u8FDB\u884C\u964D\u7EA7\u4E4B\u524D\u8981\u5BF9\u7CFB\u7EDF\u8FDB\u884C\u68B3\u7406\uFF0C\u770B\u770B\u7CFB\u7EDF\u662F\u4E0D\u662F\u53EF\u4EE5\u4E22\u5352\u4FDD\u5E05\uFF1B\u4ECE\u800C\u68B3\u7406\u51FA\u54EA\u4E9B\u5FC5\u987B\u8A93\u6B7B\u4FDD\u62A4\uFF0C\u54EA\u4E9B\u53EF\u964D\u7EA7\uFF1B\u6BD4\u5982\u53EF\u4EE5\u53C2\u8003\u65E5\u5FD7\u7EA7\u522B\u8BBE\u7F6E\u9884\u6848\uFF1A</p><ol><li>\u4E00\u822C\uFF1A\u6BD4\u5982\u6709\u4E9B\u670D\u52A1\u5076\u5C14\u56E0\u4E3A\u7F51\u7EDC\u6296\u52A8\u6216\u8005\u670D\u52A1\u6B63\u5728\u4E0A\u7EBF\u800C\u8D85\u65F6\uFF0C\u53EF\u4EE5\u81EA\u52A8\u964D\u7EA7\uFF1B</li><li>\u8B66\u544A\uFF1A\u6709\u4E9B\u670D\u52A1\u5728\u4E00\u6BB5\u65F6\u95F4\u5185\u6210\u529F\u7387\u6709\u6CE2\u52A8\uFF08\u5982\u572895~100%\u4E4B\u95F4\uFF09\uFF0C\u53EF\u4EE5\u81EA\u52A8\u964D\u7EA7\u6216\u4EBA\u5DE5\u964D\u7EA7\uFF0C\u5E76\u53D1\u9001\u544A\u8B66\uFF1B</li><li>\u9519\u8BEF\uFF1A\u6BD4\u5982\u53EF\u7528\u7387\u4F4E\u4E8E90%\uFF0C\u6216\u8005\u6570\u636E\u5E93\u8FDE\u63A5\u6C60\u88AB\u6253\u7206\u4E86\uFF0C\u6216\u8005\u8BBF\u95EE\u91CF\u7A81\u7136\u731B\u589E\u5230\u7CFB\u7EDF\u80FD\u627F\u53D7\u7684\u6700\u5927\u9600\u503C\uFF0C\u6B64\u65F6\u53EF\u4EE5\u6839\u636E\u60C5\u51B5\u81EA\u52A8\u964D\u7EA7\u6216\u8005\u4EBA\u5DE5\u964D\u7EA7\uFF1B</li><li>\u4E25\u91CD\u9519\u8BEF\uFF1A\u6BD4\u5982\u56E0\u4E3A\u7279\u6B8A\u539F\u56E0\u6570\u636E\u9519\u8BEF\u4E86\uFF0C\u6B64\u65F6\u9700\u8981\u7D27\u6025\u4EBA\u5DE5\u964D\u7EA7\u3002</li></ol><p>\u670D\u52A1\u964D\u7EA7\u7684\u76EE\u7684\uFF0C\u662F\u4E3A\u4E86\u9632\u6B62Redis\u670D\u52A1\u6545\u969C\uFF0C\u5BFC\u81F4\u6570\u636E\u5E93\u8DDF\u7740\u4E00\u8D77\u53D1\u751F\u96EA\u5D29\u95EE\u9898\u3002\u56E0\u6B64\uFF0C\u5BF9\u4E8E\u4E0D\u91CD\u8981\u7684\u7F13\u5B58\u6570\u636E\uFF0C\u53EF\u4EE5\u91C7\u53D6\u670D\u52A1\u964D\u7EA7\u7B56\u7565\uFF0C\u4F8B\u5982\u4E00\u4E2A\u6BD4\u8F83\u5E38\u89C1\u7684\u505A\u6CD5\u5C31\u662F\uFF0CRedis\u51FA\u73B0\u95EE\u9898\uFF0C\u4E0D\u53BB\u6570\u636E\u5E93\u67E5\u8BE2\uFF0C\u800C\u662F\u76F4\u63A5\u8FD4\u56DE\u9ED8\u8BA4\u503C\u7ED9\u7528\u6237\u3002</p><h3 id="_6-\u70ED\u70B9\u6570\u636E\u548C\u51B7\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_6-\u70ED\u70B9\u6570\u636E\u548C\u51B7\u6570\u636E" aria-hidden="true">#</a> 6. \u70ED\u70B9\u6570\u636E\u548C\u51B7\u6570\u636E</h3><p>\u70ED\u70B9\u6570\u636E\uFF0C\u7F13\u5B58\u624D\u6709\u4EF7\u503C \u5BF9\u4E8E\u51B7\u6570\u636E\u800C\u8A00\uFF0C\u5927\u90E8\u5206\u6570\u636E\u53EF\u80FD\u8FD8\u6CA1\u6709\u518D\u6B21\u8BBF\u95EE\u5230\u5C31\u5DF2\u7ECF\u88AB\u6324\u51FA\u5185\u5B58\uFF0C\u4E0D\u4EC5\u5360\u7528\u5185\u5B58\uFF0C\u800C\u4E14\u4EF7\u503C\u4E0D\u5927\u3002\u9891\u7E41\u4FEE\u6539\u7684\u6570\u636E\uFF0C\u770B\u60C5\u51B5\u8003\u8651\u4F7F\u7528\u7F13\u5B58 \u5BF9\u4E8E\u70ED\u70B9\u6570\u636E\uFF0C\u6BD4\u5982\u6211\u4EEC\u7684\u67D0IM\u4EA7\u54C1\uFF0C\u751F\u65E5\u795D\u798F\u6A21\u5757\uFF0C\u5F53\u5929\u7684\u5BFF\u661F\u5217\u8868\uFF0C\u7F13\u5B58\u4EE5\u540E\u53EF\u80FD\u8BFB\u53D6\u6570\u5341\u4E07\u6B21\u3002\u518D\u4E3E\u4E2A\u4F8B\u5B50\uFF0C\u67D0\u5BFC\u822A\u4EA7\u54C1\uFF0C\u6211\u4EEC\u5C06\u5BFC\u822A\u4FE1\u606F\uFF0C\u7F13\u5B58\u4EE5\u540E\u53EF\u80FD\u8BFB\u53D6\u6570\u767E\u4E07\u6B21\u3002 \u6570\u636E\u66F4\u65B0\u524D\u81F3\u5C11\u8BFB\u53D6\u4E24\u6B21\uFF0C\u7F13\u5B58\u624D\u6709\u610F\u4E49\u3002\u8FD9\u4E2A\u662F\u6700\u57FA\u672C\u7684\u7B56\u7565\uFF0C\u5982\u679C\u7F13\u5B58\u8FD8\u6CA1\u6709\u8D77\u4F5C\u7528\u5C31\u5931\u6548\u4E86\uFF0C\u90A3\u5C31\u6CA1\u6709\u592A\u5927\u4EF7\u503C\u4E86\u3002 \u90A3\u5B58\u4E0D\u5B58\u5728\uFF0C\u4FEE\u6539\u9891\u7387\u5F88\u9AD8\uFF0C\u4F46\u662F\u53C8\u4E0D\u5F97\u4E0D\u8003\u8651\u7F13\u5B58\u7684\u573A\u666F\u5462\uFF1F\u6709\uFF01\u6BD4\u5982\uFF0C\u8FD9\u4E2A\u8BFB\u53D6\u63A5\u53E3\u5BF9\u6570\u636E\u5E93\u7684\u538B\u529B\u5F88\u5927\uFF0C\u4F46\u662F\u53C8\u662F\u70ED\u70B9\u6570\u636E\uFF0C\u8FD9\u4E2A\u65F6\u5019\u5C31\u9700\u8981\u8003\u8651\u901A\u8FC7\u7F13\u5B58\u624B\u6BB5\uFF0C\u51CF\u5C11\u6570\u636E\u5E93\u7684\u538B\u529B\uFF0C\u6BD4\u5982\u6211\u4EEC\u7684\u67D0\u52A9\u624B\u4EA7\u54C1\u7684\uFF0C\u70B9\u8D5E\u6570\uFF0C\u6536\u85CF\u6570\uFF0C\u5206\u4EAB\u6570\u7B49\u662F\u975E\u5E38\u5178\u578B\u7684\u70ED\u70B9\u6570\u636E\uFF0C\u4F46\u662F\u53C8\u4E0D\u65AD\u53D8\u5316\uFF0C\u6B64\u65F6\u5C31\u9700\u8981\u5C06\u6570\u636E\u540C\u6B65\u4FDD\u5B58\u5230Redis\u7F13\u5B58\uFF0C\u51CF\u5C11\u6570\u636E\u5E93\u538B\u529B\u3002</p><h3 id="_7-\u7F13\u5B58\u70ED\u70B9key" tabindex="-1"><a class="header-anchor" href="#_7-\u7F13\u5B58\u70ED\u70B9key" aria-hidden="true">#</a> 7. \u7F13\u5B58\u70ED\u70B9key</h3><p>\u7F13\u5B58\u4E2D\u7684\u4E00\u4E2AKey(\u6BD4\u5982\u4E00\u4E2A\u4FC3\u9500\u5546\u54C1)\uFF0C\u5728\u67D0\u4E2A\u65F6\u95F4\u70B9\u8FC7\u671F\u7684\u65F6\u5019\uFF0C\u6070\u597D\u5728\u8FD9\u4E2A\u65F6\u95F4\u70B9\u5BF9\u8FD9\u4E2AKey\u6709\u5927\u91CF\u7684\u5E76\u53D1\u8BF7\u6C42\u8FC7\u6765\uFF0C\u8FD9\u4E9B\u8BF7\u6C42\u53D1\u73B0\u7F13\u5B58\u8FC7\u671F\u4E00\u822C\u90FD\u4F1A\u4ECE\u540E\u7AEFDB\u52A0\u8F7D\u6570\u636E\u5E76\u56DE\u8BBE\u5230\u7F13\u5B58\uFF0C\u8FD9\u4E2A\u65F6\u5019\u5927\u5E76\u53D1\u7684\u8BF7\u6C42\u53EF\u80FD\u4F1A\u77AC\u95F4\u628A\u540E\u7AEFDB\u538B\u57AE\u3002 <strong>\u89E3\u51B3\u65B9\u6848</strong> \u5BF9\u7F13\u5B58\u67E5\u8BE2\u52A0\u9501\uFF0C\u5982\u679CKEY\u4E0D\u5B58\u5728\uFF0C\u5C31\u52A0\u9501\uFF0C\u7136\u540E\u67E5DB\u5165\u7F13\u5B58\uFF0C\u7136\u540E\u89E3\u9501\uFF1B\u5176\u4ED6\u8FDB\u7A0B\u5982\u679C\u53D1\u73B0\u6709\u9501\u5C31\u7B49\u5F85\uFF0C\u7136\u540E\u7B49\u89E3\u9501\u540E\u8FD4\u56DE\u6570\u636E\u6216\u8005\u8FDB\u5165DB\u67E5\u8BE2</p><h2 id="\u5176\u4ED6\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#\u5176\u4ED6\u95EE\u9898" aria-hidden="true">#</a> \u5176\u4ED6\u95EE\u9898</h2><h3 id="_1-\u5982\u4F55\u4FDD\u8BC1\u7F13\u5B58\u4E0E\u6570\u636E\u5E93\u53CC\u5199\u65F6\u7684\u6570\u636E\u4E00\u81F4\u6027" tabindex="-1"><a class="header-anchor" href="#_1-\u5982\u4F55\u4FDD\u8BC1\u7F13\u5B58\u4E0E\u6570\u636E\u5E93\u53CC\u5199\u65F6\u7684\u6570\u636E\u4E00\u81F4\u6027" aria-hidden="true">#</a> 1. \u5982\u4F55\u4FDD\u8BC1\u7F13\u5B58\u4E0E\u6570\u636E\u5E93\u53CC\u5199\u65F6\u7684\u6570\u636E\u4E00\u81F4\u6027\uFF1F</h3><p>\u4F60\u53EA\u8981\u7528\u7F13\u5B58\uFF0C\u5C31\u53EF\u80FD\u4F1A\u6D89\u53CA\u5230\u7F13\u5B58\u4E0E\u6570\u636E\u5E93\u53CC\u5B58\u50A8\u53CC\u5199\uFF0C\u4F60\u53EA\u8981\u662F\u53CC\u5199\uFF0C\u5C31\u4E00\u5B9A\u4F1A\u6709\u6570\u636E\u4E00\u81F4\u6027\u7684\u95EE\u9898\uFF0C\u90A3\u4E48\u4F60\u5982\u4F55\u89E3\u51B3\u4E00\u81F4\u6027\u95EE\u9898\uFF1F \u4E00\u822C\u6765\u8BF4\uFF0C\u5C31\u662F\u5982\u679C\u4F60\u7684\u7CFB\u7EDF\u4E0D\u662F\u4E25\u683C\u8981\u6C42\u7F13\u5B58+\u6570\u636E\u5E93\u5FC5\u987B\u4E00\u81F4\u6027\u7684\u8BDD\uFF0C\u7F13\u5B58\u53EF\u4EE5\u7A0D\u5FAE\u7684\u8DDF\u6570\u636E\u5E93\u5076\u5C14\u6709\u4E0D\u4E00\u81F4\u7684\u60C5\u51B5\uFF0C\u6700\u597D\u4E0D\u8981\u505A\u8FD9\u4E2A\u65B9\u6848\uFF0C\u8BFB\u8BF7\u6C42\u548C\u5199\u8BF7\u6C42\u4E32\u884C\u5316\uFF0C\u4E32\u5230\u4E00\u4E2A\u5185\u5B58\u961F\u5217\u91CC\u53BB\uFF0C\u8FD9\u6837\u5C31\u53EF\u4EE5\u4FDD\u8BC1\u4E00\u5B9A\u4E0D\u4F1A\u51FA\u73B0\u4E0D\u4E00\u81F4\u7684\u60C5\u51B5 \u4E32\u884C\u5316\u4E4B\u540E\uFF0C\u5C31\u4F1A\u5BFC\u81F4\u7CFB\u7EDF\u7684\u541E\u5410\u91CF\u4F1A\u5927\u5E45\u5EA6\u7684\u964D\u4F4E\uFF0C\u7528\u6BD4\u6B63\u5E38\u60C5\u51B5\u4E0B\u591A\u51E0\u500D\u7684\u673A\u5668\u53BB\u652F\u6491\u7EBF\u4E0A\u7684\u4E00\u4E2A\u8BF7\u6C42\u3002 \u8FD8\u6709\u4E00\u79CD\u65B9\u5F0F\u5C31\u662F\u53EF\u80FD\u4F1A\u6682\u65F6\u4EA7\u751F\u4E0D\u4E00\u81F4\u7684\u60C5\u51B5\uFF0C\u4F46\u662F\u53D1\u751F\u7684\u51E0\u7387\u7279\u522B\u5C0F\uFF0C\u5C31\u662F<strong>\u5148\u66F4\u65B0\u6570\u636E\u5E93\uFF0C\u7136\u540E\u518D\u5220\u9664\u7F13\u5B58\u3002</strong><img src="https://cdn.nlark.com/yuque/0/2020/png/2517043/1599815198319-cdb6cdd5-1538-499f-ae71-8dd1078621c3.png#averageHue=%23efefef&amp;height=285&amp;id=mYhqi&amp;originHeight=570&amp;originWidth=1922&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=164046&amp;status=done&amp;style=none&amp;title=&amp;width=961" alt="image.png"></p><h3 id="_2-redis\u5E38\u89C1\u6027\u80FD\u95EE\u9898\u548C\u89E3\u51B3\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#_2-redis\u5E38\u89C1\u6027\u80FD\u95EE\u9898\u548C\u89E3\u51B3\u65B9\u6848" aria-hidden="true">#</a> 2. Redis\u5E38\u89C1\u6027\u80FD\u95EE\u9898\u548C\u89E3\u51B3\u65B9\u6848\uFF1F</h3><ol><li>Master\u6700\u597D\u4E0D\u8981\u505A\u4EFB\u4F55\u6301\u4E45\u5316\u5DE5\u4F5C\uFF0C\u5305\u62EC\u5185\u5B58\u5FEB\u7167\u548CAOF\u65E5\u5FD7\u6587\u4EF6\uFF0C\u7279\u522B\u662F\u4E0D\u8981\u542F\u7528\u5185\u5B58\u5FEB\u7167\u505A\u6301\u4E45\u5316\u3002</li><li>\u5982\u679C\u6570\u636E\u6BD4\u8F83\u5173\u952E\uFF0C\u67D0\u4E2ASlave\u5F00\u542FAOF\u5907\u4EFD\u6570\u636E\uFF0C\u7B56\u7565\u4E3A\u6BCF\u79D2\u540C\u6B65\u4E00\u6B21\u3002</li><li>\u4E3A\u4E86\u4E3B\u4ECE\u590D\u5236\u7684\u901F\u5EA6\u548C\u8FDE\u63A5\u7684\u7A33\u5B9A\u6027\uFF0CSlave\u548CMaster\u6700\u597D\u5728\u540C\u4E00\u4E2A\u5C40\u57DF\u7F51\u5185\u3002</li><li>\u5C3D\u91CF\u907F\u514D\u5728\u538B\u529B\u8F83\u5927\u7684\u4E3B\u5E93\u4E0A\u589E\u52A0\u4ECE\u5E93</li><li>Master\u8C03\u7528BGREWRITEAOF\u91CD\u5199AOF\u6587\u4EF6\uFF0CAOF\u5728\u91CD\u5199\u7684\u65F6\u5019\u4F1A\u5360\u5927\u91CF\u7684CPU\u548C\u5185\u5B58\u8D44\u6E90\uFF0C\u5BFC\u81F4\u670D\u52A1load\u8FC7\u9AD8\uFF0C\u51FA\u73B0\u77ED\u6682\u670D\u52A1\u6682\u505C\u73B0\u8C61\u3002</li><li>\u4E3A\u4E86Master\u7684\u7A33\u5B9A\u6027\uFF0C\u4E3B\u4ECE\u590D\u5236\u4E0D\u8981\u7528\u56FE\u72B6\u7ED3\u6784\uFF0C\u7528\u5355\u5411\u94FE\u8868\u7ED3\u6784\u66F4\u7A33\u5B9A\uFF0C\u5373\u4E3B\u4ECE\u5173\u7CFB\u4E3A\uFF1AMaster&lt;\u2013Slave1&lt;\u2013Slave2&lt;\u2013Slave3\u2026\uFF0C\u8FD9\u6837\u7684\u7ED3\u6784\u4E5F\u65B9\u4FBF\u89E3\u51B3\u5355\u70B9\u6545\u969C\u95EE\u9898\uFF0C\u5B9E\u73B0Slave\u5BF9Master\u7684\u66FF\u6362\uFF0C\u4E5F\u5373\uFF0C\u5982\u679CMaster\u6302\u4E86\uFF0C\u53EF\u4EE5\u7ACB\u9A6C\u542F\u7528Slave1\u505AMaster\uFF0C\u5176\u4ED6\u4E0D\u53D8\u3002</li></ol><h3 id="_3-\u4E00\u4E2A\u5B57\u7B26\u4E32\u7C7B\u578B\u7684\u503C\u80FD\u5B58\u50A8\u6700\u5927\u5BB9\u91CF\u662F\u591A\u5C11" tabindex="-1"><a class="header-anchor" href="#_3-\u4E00\u4E2A\u5B57\u7B26\u4E32\u7C7B\u578B\u7684\u503C\u80FD\u5B58\u50A8\u6700\u5927\u5BB9\u91CF\u662F\u591A\u5C11" aria-hidden="true">#</a> 3. \u4E00\u4E2A\u5B57\u7B26\u4E32\u7C7B\u578B\u7684\u503C\u80FD\u5B58\u50A8\u6700\u5927\u5BB9\u91CF\u662F\u591A\u5C11\uFF1F</h3><p>512M</p><h3 id="_4-redis\u5982\u4F55\u505A\u5927\u91CF\u6570\u636E\u63D2\u5165" tabindex="-1"><a class="header-anchor" href="#_4-redis\u5982\u4F55\u505A\u5927\u91CF\u6570\u636E\u63D2\u5165" aria-hidden="true">#</a> 4. Redis\u5982\u4F55\u505A\u5927\u91CF\u6570\u636E\u63D2\u5165\uFF1F</h3><p>Redis2.6\u5F00\u59CBredis-cli\u652F\u6301\u4E00\u79CD\u65B0\u7684\u88AB\u79F0\u4E4B\u4E3Apipe mode\u7684\u65B0\u6A21\u5F0F\u7528\u4E8E\u6267\u884C\u5927\u91CF\u6570\u636E\u63D2\u5165\u5DE5\u4F5C\u3002</p><h3 id="_5-\u5047\u5982redis\u91CC\u9762\u67091\u4EBF\u4E2Akey-\u5176\u4E2D\u670910w\u4E2Akey\u662F\u4EE5\u67D0\u4E2A\u56FA\u5B9A\u7684\u5DF2\u77E5\u7684\u524D\u7F00\u5F00\u5934\u7684-\u5982\u679C\u5C06\u5B83\u4EEC\u5168\u90E8\u627E\u51FA\u6765" tabindex="-1"><a class="header-anchor" href="#_5-\u5047\u5982redis\u91CC\u9762\u67091\u4EBF\u4E2Akey-\u5176\u4E2D\u670910w\u4E2Akey\u662F\u4EE5\u67D0\u4E2A\u56FA\u5B9A\u7684\u5DF2\u77E5\u7684\u524D\u7F00\u5F00\u5934\u7684-\u5982\u679C\u5C06\u5B83\u4EEC\u5168\u90E8\u627E\u51FA\u6765" aria-hidden="true">#</a> 5. \u5047\u5982Redis\u91CC\u9762\u67091\u4EBF\u4E2Akey\uFF0C\u5176\u4E2D\u670910w\u4E2Akey\u662F\u4EE5\u67D0\u4E2A\u56FA\u5B9A\u7684\u5DF2\u77E5\u7684\u524D\u7F00\u5F00\u5934\u7684\uFF0C\u5982\u679C\u5C06\u5B83\u4EEC\u5168\u90E8\u627E\u51FA\u6765\uFF1F</h3><p>\u4F7F\u7528keys\u6307\u4EE4\u53EF\u4EE5\u626B\u51FA\u6307\u5B9A\u6A21\u5F0F\u7684key\u5217\u8868\u3002 \u5BF9\u65B9\u63A5\u7740\u8FFD\u95EE\uFF1A\u5982\u679C\u8FD9\u4E2Aredis\u6B63\u5728\u7ED9\u7EBF\u4E0A\u7684\u4E1A\u52A1\u63D0\u4F9B\u670D\u52A1\uFF0C\u90A3\u4F7F\u7528keys\u6307\u4EE4\u4F1A\u6709\u4EC0\u4E48\u95EE\u9898\uFF1F \u8FD9\u4E2A\u65F6\u5019\u4F60\u8981\u56DE\u7B54redis\u5173\u952E\u7684\u4E00\u4E2A\u7279\u6027\uFF1Aredis\u7684\u5355\u7EBF\u7A0B\u7684\u3002keys\u6307\u4EE4\u4F1A\u5BFC\u81F4\u7EBF\u7A0B\u963B\u585E\u4E00\u6BB5\u65F6\u95F4\uFF0C\u7EBF\u4E0A\u670D\u52A1\u4F1A\u505C\u987F\uFF0C\u76F4\u5230\u6307\u4EE4\u6267\u884C\u5B8C\u6BD5\uFF0C\u670D\u52A1\u624D\u80FD\u6062\u590D\u3002\u8FD9\u4E2A\u65F6\u5019\u53EF\u4EE5\u4F7F\u7528scan\u6307\u4EE4\uFF0Cscan\u6307\u4EE4\u53EF\u4EE5\u65E0\u963B\u585E\u7684\u63D0\u53D6\u51FA\u6307\u5B9A\u6A21\u5F0F\u7684key\u5217\u8868\uFF0C\u4F46\u662F\u4F1A\u6709\u4E00\u5B9A\u7684\u91CD\u590D\u6982\u7387\uFF0C\u5728\u5BA2\u6237\u7AEF\u505A\u4E00\u6B21\u53BB\u91CD\u5C31\u53EF\u4EE5\u4E86\uFF0C\u4F46\u662F\u6574\u4F53\u6240\u82B1\u8D39\u7684\u65F6\u95F4\u4F1A\u6BD4\u76F4\u63A5\u7528keys\u6307\u4EE4\u957F\u3002</p><h3 id="_6-\u4F7F\u7528redis\u505A\u8FC7\u5F02\u6B65\u961F\u5217\u5417-\u662F\u5982\u4F55\u5B9E\u73B0\u7684" tabindex="-1"><a class="header-anchor" href="#_6-\u4F7F\u7528redis\u505A\u8FC7\u5F02\u6B65\u961F\u5217\u5417-\u662F\u5982\u4F55\u5B9E\u73B0\u7684" aria-hidden="true">#</a> 6. \u4F7F\u7528Redis\u505A\u8FC7\u5F02\u6B65\u961F\u5217\u5417\uFF0C\u662F\u5982\u4F55\u5B9E\u73B0\u7684</h3><p>\u4F7F\u7528list\u7C7B\u578B\u4FDD\u5B58\u6570\u636E\u4FE1\u606F\uFF0Crpush\u751F\u4EA7\u6D88\u606F\uFF0Clpop\u6D88\u8D39\u6D88\u606F\uFF0C\u5F53lpop\u6CA1\u6709\u6D88\u606F\u65F6\uFF0C\u53EF\u4EE5sleep\u4E00\u6BB5\u65F6\u95F4\uFF0C\u7136\u540E\u518D\u68C0\u67E5\u6709\u6CA1\u6709\u4FE1\u606F\uFF0C\u5982\u679C\u4E0D\u60F3sleep\u7684\u8BDD\uFF0C\u53EF\u4EE5\u4F7F\u7528blpop, \u5728\u6CA1\u6709\u4FE1\u606F\u7684\u65F6\u5019\uFF0C\u4F1A\u4E00\u76F4\u963B\u585E\uFF0C\u76F4\u5230\u4FE1\u606F\u7684\u5230\u6765\u3002redis\u53EF\u4EE5\u901A\u8FC7pub/sub\u4E3B\u9898\u8BA2\u9605\u6A21\u5F0F\u5B9E\u73B0\u4E00\u4E2A\u751F\u4EA7\u8005\uFF0C\u591A\u4E2A\u6D88\u8D39\u8005\uFF0C\u5F53\u7136\u4E5F\u5B58\u5728\u4E00\u5B9A\u7684\u7F3A\u70B9\uFF0C\u5F53\u6D88\u8D39\u8005\u4E0B\u7EBF\u65F6\uFF0C\u751F\u4EA7\u7684\u6D88\u606F\u4F1A\u4E22\u5931\u3002</p><h3 id="_7-redis\u5982\u4F55\u5B9E\u73B0\u5EF6\u65F6\u961F\u5217" tabindex="-1"><a class="header-anchor" href="#_7-redis\u5982\u4F55\u5B9E\u73B0\u5EF6\u65F6\u961F\u5217" aria-hidden="true">#</a> 7. Redis\u5982\u4F55\u5B9E\u73B0\u5EF6\u65F6\u961F\u5217</h3><p>\u4F7F\u7528sortedset\uFF0C\u4F7F\u7528\u65F6\u95F4\u6233\u505Ascore, \u6D88\u606F\u5185\u5BB9\u4F5C\u4E3Akey\uFF0C\u8C03\u7528zadd\u6765\u751F\u4EA7\u6D88\u606F\uFF0C\u6D88\u8D39\u8005\u4F7F\u7528 zrangbyscore \u83B7\u53D6n \u79D2\u4E4B\u524D\u7684\u6570\u636E\u505A\u8F6E\u8BE2\u5904\u7406\u3002</p><h2 id="\u5927key" tabindex="-1"><a class="header-anchor" href="#\u5927key" aria-hidden="true">#</a> \u5927Key</h2><h3 id="_1-\u4EC0\u4E48\u662F-redis-\u5927-key-\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_1-\u4EC0\u4E48\u662F-redis-\u5927-key-\u95EE\u9898" aria-hidden="true">#</a> 1. \u4EC0\u4E48\u662F Redis \u5927 key \u95EE\u9898</h3><p>\u6839\u636E\u6570\u636E\u7C7B\u578B\u6765\u5206\uFF0C\u4E3B\u8981\u5206\u4E24\u5927\u7C7B \u5B57\u7B26\u578B\u548C\u5176\u4ED6\u3002</p><ul><li>\u5355\u4E2A\u7B80\u5355\u7684key\u5B58\u50A8\u7684value\u5F88\u5927\uFF0Csize\u8D85\u8FC710KB</li><li>hash\uFF0C set\uFF0Czset\uFF0Clist \u4E2D\u5B58\u50A8\u8FC7\u591A\u7684\u5143\u7D20\uFF08\u4EE5\u4E07\u4E3A\u5355\u4F4D\uFF09</li></ul><h3 id="_2-\u5927key\u4F1A\u9020\u6210\u4EC0\u4E48\u95EE\u9898\u5462" tabindex="-1"><a class="header-anchor" href="#_2-\u5927key\u4F1A\u9020\u6210\u4EC0\u4E48\u95EE\u9898\u5462" aria-hidden="true">#</a> 2. \u5927key\u4F1A\u9020\u6210\u4EC0\u4E48\u95EE\u9898\u5462\uFF1F</h3><ul><li>\u5BA2\u6237\u7AEF\u8017\u65F6\u589E\u52A0\uFF0C\u751A\u81F3\u8D85\u65F6</li><li>\u5BF9\u5927key\u8FDB\u884CIO\u64CD\u4F5C\u65F6\uFF0C\u4F1A\u4E25\u91CD\u5360\u7528\u5E26\u5BBD\u548CCPU</li><li>\u9020\u6210Redis\u96C6\u7FA4\u4E2D\u6570\u636E\u503E\u659C</li><li>\u4E3B\u52A8\u5220\u9664\u3001\u88AB\u52A8\u5220\u7B49\uFF0C\u53EF\u80FD\u4F1A\u5BFC\u81F4\u963B\u585E</li></ul><h3 id="_3-\u5982\u4F55\u627E\u5230\u5927key" tabindex="-1"><a class="header-anchor" href="#_3-\u5982\u4F55\u627E\u5230\u5927key" aria-hidden="true">#</a> 3. \u5982\u4F55\u627E\u5230\u5927key?</h3><ul><li>bigkeys\u547D\u4EE4\uFF1A\u4F7F\u7528 <code>bigkeys</code> \u547D\u4EE4\u4EE5\u904D\u5386\u7684\u65B9\u5F0F\u5206\u6790Redis\u5B9E\u4F8B\u4E2D\u7684\u6240\u6709Key\uFF0C\u5E76\u8FD4\u56DE\u6574\u4F53\u7EDF\u8BA1\u4FE1\u606F\u4E0E\u6BCF\u4E2A\u6570\u636E\u7C7B\u578B\u4E2DTop1\u7684\u5927Key</li><li>redis-rdb-tools\uFF1Aredis-rdb-tools\u662F\u7531Python\u5199\u7684\u7528\u6765\u5206\u6790Redis\u7684rdb\u5FEB\u7167\u6587\u4EF6\u7528\u7684\u5DE5\u5177\uFF0C\u5B83\u53EF\u4EE5\u628Ardb\u5FEB\u7167\u6587\u4EF6\u751F\u6210json\u6587\u4EF6\u6216\u8005\u751F\u6210\u62A5\u8868\u7528\u6765\u5206\u6790Redis\u7684\u4F7F\u7528\u8BE6\u60C5\u3002</li></ul><h3 id="_4-\u5982\u4F55\u5904\u7406\u5927key" tabindex="-1"><a class="header-anchor" href="#_4-\u5982\u4F55\u5904\u7406\u5927key" aria-hidden="true">#</a> 4. \u5982\u4F55\u5904\u7406\u5927key?</h3><p><img src="https://cdn.nlark.com/yuque/0/2022/png/21883277/1663306193057-9e22bc9f-4985-418d-b170-690d9c42d16c.png#averageHue=%23fef7f2&amp;clientId=ucf814711-336e-4&amp;errorMessage=unknown error&amp;from=paste&amp;id=ueb9da3e4&amp;originHeight=467&amp;originWidth=738&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=error&amp;style=none&amp;taskId=u2dcf2b3e-d4fa-4125-8c29-fa3c55cd413&amp;title=" alt=""></p><h4 id="_4-1-\u5220\u9664\u5927key" tabindex="-1"><a class="header-anchor" href="#_4-1-\u5220\u9664\u5927key" aria-hidden="true">#</a> 4.1 \u5220\u9664\u5927key</h4><ul><li>\u5F53Redis\u7248\u672C\u5927\u4E8E4.0\u65F6\uFF0C\u53EF\u4F7F\u7528UNLINK\u547D\u4EE4\u5B89\u5168\u5730\u5220\u9664\u5927Key\uFF0C\u8BE5\u547D\u4EE4\u80FD\u591F\u4EE5\u975E\u963B\u585E\u7684\u65B9\u5F0F\uFF0C\u9010\u6B65\u5730\u6E05\u7406\u4F20\u5165\u7684Key\u3002</li><li>\u5F53Redis\u7248\u672C\u5C0F\u4E8E4.0\u65F6\uFF0C\u907F\u514D\u4F7F\u7528\u963B\u585E\u5F0F\u547D\u4EE4KEYS\uFF0C\u800C\u662F\u5EFA\u8BAE\u901A\u8FC7SCAN\u547D\u4EE4\u6267\u884C\u589E\u91CF\u8FED\u4EE3\u626B\u63CFkey\uFF0C\u7136\u540E\u5224\u65AD\u8FDB\u884C\u5220\u9664\u3002</li></ul><h4 id="_4-2-\u538B\u7F29\u548C\u62C6\u5206key" tabindex="-1"><a class="header-anchor" href="#_4-2-\u538B\u7F29\u548C\u62C6\u5206key" aria-hidden="true">#</a> 4.2 \u538B\u7F29\u548C\u62C6\u5206key</h4><ul><li>\u5F53vaule\u662Fstring\u65F6\uFF0C\u6BD4\u8F83\u96BE\u62C6\u5206\uFF0C\u5219\u4F7F\u7528\u5E8F\u5217\u5316\u3001\u538B\u7F29\u7B97\u6CD5\u5C06key\u7684\u5927\u5C0F\u63A7\u5236\u5728\u5408\u7406\u8303\u56F4\u5185\uFF0C\u4F46\u662F\u5E8F\u5217\u5316\u548C\u53CD\u5E8F\u5217\u5316\u90FD\u4F1A\u5E26\u6765\u66F4\u591A\u65F6\u95F4\u4E0A\u7684\u6D88\u8017\u3002</li><li>\u5F53value\u662Fstring\uFF0C\u538B\u7F29\u4E4B\u540E\u4ECD\u7136\u662F\u5927key\uFF0C\u5219\u9700\u8981\u8FDB\u884C\u62C6\u5206\uFF0C\u4E00\u4E2A\u5927key\u5206\u4E3A\u4E0D\u540C\u7684\u90E8\u5206\uFF0C\u8BB0\u5F55\u6BCF\u4E2A\u90E8\u5206\u7684key\uFF0C\u4F7F\u7528multiget\u7B49\u64CD\u4F5C\u5B9E\u73B0\u4E8B\u52A1\u8BFB\u53D6\u3002</li><li>\u5F53value\u662Flist/set\u7B49\u96C6\u5408\u7C7B\u578B\u65F6\uFF0C\u6839\u636E\u9884\u4F30\u7684\u6570\u636E\u89C4\u6A21\u6765\u8FDB\u884C\u5206\u7247\uFF0C\u4E0D\u540C\u7684\u5143\u7D20\u8BA1\u7B97\u540E\u5206\u5230\u4E0D\u540C\u7684\u7247\u3002</li></ul><h2 id="\u96C6\u7FA4\u65B9\u6848-\u6821\u62DB\u57FA\u672C\u4E0D\u95EE" tabindex="-1"><a class="header-anchor" href="#\u96C6\u7FA4\u65B9\u6848-\u6821\u62DB\u57FA\u672C\u4E0D\u95EE" aria-hidden="true">#</a> \u96C6\u7FA4\u65B9\u6848 (\u6821\u62DB\u57FA\u672C\u4E0D\u95EE)</h2><h3 id="\u54E8\u5175\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#\u54E8\u5175\u6A21\u5F0F" aria-hidden="true">#</a> \u54E8\u5175\u6A21\u5F0F</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2517043/1599814861853-24fcf82c-93c7-46d8-9029-f3d6802fb079.png#averageHue=%23eaeae8&amp;height=717&amp;id=FDwPF&amp;originHeight=1434&amp;originWidth=1686&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=1676645&amp;status=done&amp;style=none&amp;title=&amp;width=843" alt="image.png"><strong>\u54E8\u5175\u7684\u4ECB\u7ECD</strong> sentinel\uFF0C\u4E2D\u6587\u540D\u662F\u54E8\u5175\u3002\u54E8\u5175\u662F redis \u96C6\u7FA4\u673A\u6784\u4E2D\u975E\u5E38\u91CD\u8981\u7684\u4E00\u4E2A\u7EC4\u4EF6\uFF0C\u4E3B\u8981\u6709\u4EE5\u4E0B\u529F\u80FD\uFF1A</p><ul><li>\u96C6\u7FA4\u76D1\u63A7\uFF1A\u8D1F\u8D23\u76D1\u63A7 redis master \u548C slave \u8FDB\u7A0B\u662F\u5426\u6B63\u5E38\u5DE5\u4F5C\u3002</li><li>\u6D88\u606F\u901A\u77E5\uFF1A\u5982\u679C\u67D0\u4E2A redis \u5B9E\u4F8B\u6709\u6545\u969C\uFF0C\u90A3\u4E48\u54E8\u5175\u8D1F\u8D23\u53D1\u9001\u6D88\u606F\u4F5C\u4E3A\u62A5\u8B66\u901A\u77E5\u7ED9\u7BA1\u7406\u5458\u3002</li><li>\u6545\u969C\u8F6C\u79FB\uFF1A\u5982\u679C master node \u6302\u6389\u4E86\uFF0C\u4F1A\u81EA\u52A8\u8F6C\u79FB\u5230 slave node \u4E0A\u3002</li><li>\u914D\u7F6E\u4E2D\u5FC3\uFF1A\u5982\u679C\u6545\u969C\u8F6C\u79FB\u53D1\u751F\u4E86\uFF0C\u901A\u77E5 client \u5BA2\u6237\u7AEF\u65B0\u7684 master \u5730\u5740\u3002</li></ul><p><strong>\u54E8\u5175\u7528\u4E8E\u5B9E\u73B0 redis \u96C6\u7FA4\u7684\u9AD8\u53EF\u7528</strong>\uFF0C\u672C\u8EAB\u4E5F\u662F\u5206\u5E03\u5F0F\u7684\uFF0C\u4F5C\u4E3A\u4E00\u4E2A\u54E8\u5175\u96C6\u7FA4\u53BB\u8FD0\u884C\uFF0C\u4E92\u76F8\u534F\u540C\u5DE5\u4F5C\u3002</p><ul><li>\u6545\u969C\u8F6C\u79FB\u65F6\uFF0C\u5224\u65AD\u4E00\u4E2A master node \u662F\u5426\u5B95\u673A\u4E86\uFF0C\u9700\u8981\u5927\u90E8\u5206\u7684\u54E8\u5175\u90FD\u540C\u610F\u624D\u884C\uFF0C\u6D89\u53CA\u5230\u4E86\u5206\u5E03\u5F0F\u9009\u4E3E\u7684\u95EE\u9898\u3002</li><li>\u5373\u4F7F\u90E8\u5206\u54E8\u5175\u8282\u70B9\u6302\u6389\u4E86\uFF0C\u54E8\u5175\u96C6\u7FA4\u8FD8\u662F\u80FD\u6B63\u5E38\u5DE5\u4F5C\u7684\uFF0C\u56E0\u4E3A\u5982\u679C\u4E00\u4E2A\u4F5C\u4E3A\u9AD8\u53EF\u7528\u673A\u5236\u91CD\u8981\u7EC4\u6210\u90E8\u5206\u7684\u6545\u969C\u8F6C\u79FB\u7CFB\u7EDF\u672C\u8EAB\u662F\u5355\u70B9\u7684\uFF0C\u90A3\u5C31\u5F88\u5751\u7239\u4E86\u3002</li></ul><p><strong>\u54E8\u5175\u7684\u6838\u5FC3\u77E5\u8BC6</strong></p><ul><li>\u54E8\u5175\u81F3\u5C11\u9700\u8981 3 \u4E2A\u5B9E\u4F8B\uFF0C\u6765\u4FDD\u8BC1\u81EA\u5DF1\u7684\u5065\u58EE\u6027\u3002</li><li>\u54E8\u5175 + redis \u4E3B\u4ECE\u7684\u90E8\u7F72\u67B6\u6784\uFF0C\u662F<strong>\u4E0D\u4FDD\u8BC1\u6570\u636E\u96F6\u4E22\u5931</strong>\u7684\uFF0C\u53EA\u80FD\u4FDD\u8BC1 redis \u96C6\u7FA4\u7684\u9AD8\u53EF\u7528\u6027\u3002</li><li>\u5BF9\u4E8E\u54E8\u5175 + redis \u4E3B\u4ECE\u8FD9\u79CD\u590D\u6742\u7684\u90E8\u7F72\u67B6\u6784\uFF0C\u5C3D\u91CF\u5728\u6D4B\u8BD5\u73AF\u5883\u548C\u751F\u4EA7\u73AF\u5883\uFF0C\u90FD\u8FDB\u884C\u5145\u8DB3\u7684\u6D4B\u8BD5\u548C\u6F14\u7EC3\u3002</li></ul><h3 id="\u5B98\u65B9redis-cluster-\u65B9\u6848-\u670D\u52A1\u7AEF\u8DEF\u7531\u67E5\u8BE2" tabindex="-1"><a class="header-anchor" href="#\u5B98\u65B9redis-cluster-\u65B9\u6848-\u670D\u52A1\u7AEF\u8DEF\u7531\u67E5\u8BE2" aria-hidden="true">#</a> \u5B98\u65B9Redis Cluster \u65B9\u6848(\u670D\u52A1\u7AEF\u8DEF\u7531\u67E5\u8BE2)</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2517043/1599814884134-3a18e3a8-9c4e-46a5-99ab-85d8b026ea83.png#averageHue=%23f6f5f1&amp;height=325&amp;id=crPZr&amp;originHeight=650&amp;originWidth=1510&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=166256&amp;status=done&amp;style=none&amp;title=&amp;width=755" alt="image.png"> redis \u96C6\u7FA4\u6A21\u5F0F\u7684\u5DE5\u4F5C\u539F\u7406\u80FD\u8BF4\u4E00\u4E0B\u4E48\uFF1F\u5728\u96C6\u7FA4\u6A21\u5F0F\u4E0B\uFF0Credis \u7684 key \u662F\u5982\u4F55\u5BFB\u5740\u7684\uFF1F\u5206\u5E03\u5F0F\u5BFB\u5740\u90FD\u6709\u54EA\u4E9B\u7B97\u6CD5\uFF1F\u4E86\u89E3\u4E00\u81F4\u6027 hash \u7B97\u6CD5\u5417\uFF1F <strong>\u7B80\u4ECB</strong> Redis Cluster\u662F\u4E00\u79CD\u670D\u52A1\u7AEFSharding\u6280\u672F\uFF0C3.0\u7248\u672C\u5F00\u59CB\u6B63\u5F0F\u63D0\u4F9B\u3002Redis Cluster\u5E76\u6CA1\u6709\u4F7F\u7528\u4E00\u81F4\u6027hash\uFF0C\u800C\u662F\u91C7\u7528slot(\u69FD)\u7684\u6982\u5FF5\uFF0C\u4E00\u5171\u5206\u621016384\u4E2A\u69FD\u3002\u5C06\u8BF7\u6C42\u53D1\u9001\u5230\u4EFB\u610F\u8282\u70B9\uFF0C\u63A5\u6536\u5230\u8BF7\u6C42\u7684\u8282\u70B9\u4F1A\u5C06\u67E5\u8BE2\u8BF7\u6C42\u53D1\u9001\u5230\u6B63\u786E\u7684\u8282\u70B9\u4E0A\u6267\u884C <strong>\u65B9\u6848\u8BF4\u660E</strong></p><ol><li>\u901A\u8FC7\u54C8\u5E0C\u7684\u65B9\u5F0F\uFF0C\u5C06\u6570\u636E\u5206\u7247\uFF0C\u6BCF\u4E2A\u8282\u70B9\u5747\u5206\u5B58\u50A8\u4E00\u5B9A\u54C8\u5E0C\u69FD(\u54C8\u5E0C\u503C)\u533A\u95F4\u7684\u6570\u636E\uFF0C\u9ED8\u8BA4\u5206\u914D\u4E8616384 \u4E2A\u69FD\u4F4D</li><li>\u6BCF\u4EFD\u6570\u636E\u5206\u7247\u4F1A\u5B58\u50A8\u5728\u591A\u4E2A\u4E92\u4E3A\u4E3B\u4ECE\u7684\u591A\u8282\u70B9\u4E0A</li><li>\u6570\u636E\u5199\u5165\u5148\u5199\u4E3B\u8282\u70B9\uFF0C\u518D\u540C\u6B65\u5230\u4ECE\u8282\u70B9(\u652F\u6301\u914D\u7F6E\u4E3A\u963B\u585E\u540C\u6B65)</li><li>\u540C\u4E00\u5206\u7247\u591A\u4E2A\u8282\u70B9\u95F4\u7684\u6570\u636E\u4E0D\u4FDD\u6301\u4E00\u81F4\u6027</li><li>\u8BFB\u53D6\u6570\u636E\u65F6\uFF0C\u5F53\u5BA2\u6237\u7AEF\u64CD\u4F5C\u7684key\u6CA1\u6709\u5206\u914D\u5728\u8BE5\u8282\u70B9\u4E0A\u65F6\uFF0Credis\u4F1A\u8FD4\u56DE\u8F6C\u5411\u6307\u4EE4\uFF0C\u6307\u5411\u6B63\u786E\u7684\u8282\u70B9</li><li>\u6269\u5BB9\u65F6\u65F6\u9700\u8981\u9700\u8981\u628A\u65E7\u8282\u70B9\u7684\u6570\u636E\u8FC1\u79FB\u4E00\u90E8\u5206\u5230\u65B0\u8282\u70B9</li></ol><p>\u5728 redis cluster \u67B6\u6784\u4E0B\uFF0C\u6BCF\u4E2A redis \u8981\u653E\u5F00\u4E24\u4E2A\u7AEF\u53E3\u53F7\uFF0C\u6BD4\u5982\u4E00\u4E2A\u662F 6379\uFF0C\u53E6\u5916\u4E00\u4E2A\u5C31\u662F \u52A01w \u7684\u7AEF\u53E3\u53F7\uFF0C\u6BD4\u5982 16379\u3002 16379 \u7AEF\u53E3\u53F7\u662F\u7528\u6765\u8FDB\u884C\u8282\u70B9\u95F4\u901A\u4FE1\u7684\uFF0C\u4E5F\u5C31\u662F cluster bus \u7684\u4E1C\u897F\uFF0Ccluster bus \u7684\u901A\u4FE1\uFF0C\u7528\u6765\u8FDB\u884C\u6545\u969C\u68C0\u6D4B\u3001\u914D\u7F6E\u66F4\u65B0\u3001\u6545\u969C\u8F6C\u79FB\u6388\u6743\u3002cluster bus \u7528\u4E86\u53E6\u5916\u4E00\u79CD\u4E8C\u8FDB\u5236\u7684\u534F\u8BAE\uFF0C<code>gossip</code> \u534F\u8BAE\uFF0C\u7528\u4E8E\u8282\u70B9\u95F4\u8FDB\u884C\u9AD8\u6548\u7684\u6570\u636E\u4EA4\u6362\uFF0C\u5360\u7528\u66F4\u5C11\u7684\u7F51\u7EDC\u5E26\u5BBD\u548C\u5904\u7406\u65F6\u95F4\u3002 <strong>\u8282\u70B9\u95F4\u7684\u5185\u90E8\u901A\u4FE1\u673A\u5236</strong> \u57FA\u672C\u901A\u4FE1\u539F\u7406 \u96C6\u7FA4\u5143\u6570\u636E\u7684\u7EF4\u62A4\u6709\u4E24\u79CD\u65B9\u5F0F\uFF1A\u96C6\u4E2D\u5F0F\u3001Gossip \u534F\u8BAE\u3002redis cluster \u8282\u70B9\u95F4\u91C7\u7528 gossip \u534F\u8BAE\u8FDB\u884C\u901A\u4FE1\u3002 <strong>\u5206\u5E03\u5F0F\u5BFB\u5740\u7B97\u6CD5</strong></p><ul><li>hash \u7B97\u6CD5\uFF08\u5927\u91CF\u7F13\u5B58\u91CD\u5EFA\uFF09</li><li>\u4E00\u81F4\u6027 hash \u7B97\u6CD5\uFF08\u81EA\u52A8\u7F13\u5B58\u8FC1\u79FB\uFF09+ \u865A\u62DF\u8282\u70B9\uFF08\u81EA\u52A8\u8D1F\u8F7D\u5747\u8861\uFF09</li><li>redis cluster \u7684 hash slot \u7B97\u6CD5</li></ul><p><strong>\u4F18\u70B9</strong></p><ul><li>\u65E0\u4E2D\u5FC3\u67B6\u6784\uFF0C\u652F\u6301\u52A8\u6001\u6269\u5BB9\uFF0C\u5BF9\u4E1A\u52A1\u900F\u660E</li><li>\u5177\u5907Sentinel\u7684\u76D1\u63A7\u548C\u81EA\u52A8Failover(\u6545\u969C\u8F6C\u79FB)\u80FD\u529B</li><li>\u5BA2\u6237\u7AEF\u4E0D\u9700\u8981\u8FDE\u63A5\u96C6\u7FA4\u6240\u6709\u8282\u70B9\uFF0C\u8FDE\u63A5\u96C6\u7FA4\u4E2D\u4EFB\u4F55\u4E00\u4E2A\u53EF\u7528\u8282\u70B9\u5373\u53EF</li><li>\u9AD8\u6027\u80FD\uFF0C\u5BA2\u6237\u7AEF\u76F4\u8FDEredis\u670D\u52A1\uFF0C\u514D\u53BB\u4E86proxy\u4EE3\u7406\u7684\u635F\u8017</li></ul><p><strong>\u7F3A\u70B9</strong></p><ul><li>\u8FD0\u7EF4\u4E5F\u5F88\u590D\u6742\uFF0C\u6570\u636E\u8FC1\u79FB\u9700\u8981\u4EBA\u5DE5\u5E72\u9884</li><li>\u53EA\u80FD\u4F7F\u75280\u53F7\u6570\u636E\u5E93</li><li>\u4E0D\u652F\u6301\u6279\u91CF\u64CD\u4F5C(pipeline\u7BA1\u9053\u64CD\u4F5C)</li><li>\u5206\u5E03\u5F0F\u903B\u8F91\u548C\u5B58\u50A8\u6A21\u5757\u8026\u5408\u7B49</li></ul><h3 id="\u57FA\u4E8E\u5BA2\u6237\u7AEF\u5206\u914D" tabindex="-1"><a class="header-anchor" href="#\u57FA\u4E8E\u5BA2\u6237\u7AEF\u5206\u914D" aria-hidden="true">#</a> \u57FA\u4E8E\u5BA2\u6237\u7AEF\u5206\u914D</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2517043/1599814909969-1dca2a44-89fd-4b30-8a57-c28a8385dd5a.png#averageHue=%23fefefe&amp;height=421&amp;id=pr3j0&amp;originHeight=842&amp;originWidth=1162&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=436156&amp;status=done&amp;style=none&amp;title=&amp;width=581" alt="image.png"><strong>\u7B80\u4ECB</strong> Redis Sharding\u662FRedis Cluster\u51FA\u6765\u4E4B\u524D\uFF0C\u4E1A\u754C\u666E\u904D\u4F7F\u7528\u7684\u591ARedis\u5B9E\u4F8B\u96C6\u7FA4\u65B9\u6CD5\u3002\u5176\u4E3B\u8981\u601D\u60F3\u662F\u91C7\u7528\u54C8\u5E0C\u7B97\u6CD5\u5C06Redis\u6570\u636E\u7684key\u8FDB\u884C\u6563\u5217\uFF0C\u901A\u8FC7hash\u51FD\u6570\uFF0C\u7279\u5B9A\u7684key\u4F1A\u6620\u5C04\u5230\u7279\u5B9A\u7684Redis\u8282\u70B9\u4E0A\u3002Java redis\u5BA2\u6237\u7AEF\u9A71\u52A8jedis\uFF0C\u652F\u6301Redis Sharding\u529F\u80FD\uFF0C\u5373ShardedJedis\u4EE5\u53CA\u7ED3\u5408\u7F13\u5B58\u6C60\u7684ShardedJedisPool <strong>\u4F18\u70B9</strong> \u4F18\u52BF\u5728\u4E8E\u975E\u5E38\u7B80\u5355\uFF0C\u670D\u52A1\u7AEF\u7684Redis\u5B9E\u4F8B\u5F7C\u6B64\u72EC\u7ACB\uFF0C\u76F8\u4E92\u65E0\u5173\u8054\uFF0C\u6BCF\u4E2ARedis\u5B9E\u4F8B\u50CF\u5355\u670D\u52A1\u5668\u4E00\u6837\u8FD0\u884C\uFF0C\u975E\u5E38\u5BB9\u6613\u7EBF\u6027\u6269\u5C55\uFF0C\u7CFB\u7EDF\u7684\u7075\u6D3B\u6027\u5F88\u5F3A <strong>\u7F3A\u70B9</strong></p><ul><li>\u7531\u4E8Esharding\u5904\u7406\u653E\u5230\u5BA2\u6237\u7AEF\uFF0C\u89C4\u6A21\u8FDB\u4E00\u6B65\u6269\u5927\u65F6\u7ED9\u8FD0\u7EF4\u5E26\u6765\u6311\u6218\u3002</li><li>\u5BA2\u6237\u7AEFsharding\u4E0D\u652F\u6301\u52A8\u6001\u589E\u5220\u8282\u70B9\u3002\u670D\u52A1\u7AEFRedis\u5B9E\u4F8B\u7FA4\u62D3\u6251\u7ED3\u6784\u6709\u53D8\u5316\u65F6\uFF0C\u6BCF\u4E2A\u5BA2\u6237\u7AEF\u90FD\u9700\u8981\u66F4\u65B0\u8C03\u6574\u3002\u8FDE\u63A5\u4E0D\u80FD\u5171\u4EAB\uFF0C\u5F53\u5E94\u7528\u89C4\u6A21\u589E\u5927\u65F6\uFF0C\u8D44\u6E90\u6D6A\u8D39\u5236\u7EA6\u4F18\u5316</li></ul><h3 id="\u57FA\u4E8E\u4EE3\u7406\u670D\u52A1\u5668\u5206\u7247" tabindex="-1"><a class="header-anchor" href="#\u57FA\u4E8E\u4EE3\u7406\u670D\u52A1\u5668\u5206\u7247" aria-hidden="true">#</a> \u57FA\u4E8E\u4EE3\u7406\u670D\u52A1\u5668\u5206\u7247</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2517043/1599814935464-fb60d7ad-4b3f-48b3-92d9-32af06453486.png#averageHue=%23fefefe&amp;height=427&amp;id=fJGmV&amp;originHeight=854&amp;originWidth=1294&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=343072&amp;status=done&amp;style=none&amp;title=&amp;width=647" alt="image.png"><strong>\u7B80\u4ECB</strong> \u5BA2\u6237\u7AEF\u53D1\u9001\u8BF7\u6C42\u5230\u4E00\u4E2A\u4EE3\u7406\u7EC4\u4EF6\uFF0C\u4EE3\u7406\u89E3\u6790\u5BA2\u6237\u7AEF\u7684\u6570\u636E\uFF0C\u5E76\u5C06\u8BF7\u6C42\u8F6C\u53D1\u81F3\u6B63\u786E\u7684\u8282\u70B9\uFF0C\u6700\u540E\u5C06\u7ED3\u679C\u56DE\u590D\u7ED9\u5BA2\u6237\u7AEF <strong>\u7279\u5F81</strong></p><ul><li>\u900F\u660E\u63A5\u5165\uFF0C\u4E1A\u52A1\u7A0B\u5E8F\u4E0D\u7528\u5173\u5FC3\u540E\u7AEFRedis\u5B9E\u4F8B\uFF0C\u5207\u6362\u6210\u672C\u4F4E</li><li>Proxy \u7684\u903B\u8F91\u548C\u5B58\u50A8\u7684\u903B\u8F91\u662F\u9694\u79BB\u7684</li><li>\u4EE3\u7406\u5C42\u591A\u4E86\u4E00\u6B21\u8F6C\u53D1\uFF0C\u6027\u80FD\u6709\u6240\u635F\u8017</li></ul><p><strong>\u4E1A\u754C\u5F00\u6E90\u65B9\u6848</strong></p><ul><li>Twtter\u5F00\u6E90\u7684Twemproxy</li><li>\u8C4C\u8C46\u835A\u5F00\u6E90\u7684Codis</li></ul><h3 id="redis-\u4E3B\u4ECE\u67B6\u6784" tabindex="-1"><a class="header-anchor" href="#redis-\u4E3B\u4ECE\u67B6\u6784" aria-hidden="true">#</a> Redis \u4E3B\u4ECE\u67B6\u6784</h3><p>\u5355\u673A\u7684 redis\uFF0C\u80FD\u591F\u627F\u8F7D\u7684 QPS \u5927\u6982\u5C31\u5728\u4E0A\u4E07\u5230\u51E0\u4E07\u4E0D\u7B49\u3002\u5BF9\u4E8E\u7F13\u5B58\u6765\u8BF4\uFF0C\u4E00\u822C\u90FD\u662F\u7528\u6765\u652F\u6491<strong>\u8BFB\u9AD8\u5E76\u53D1</strong>\u7684\u3002\u56E0\u6B64\u67B6\u6784\u505A\u6210\u4E3B\u4ECE(master-slave)\u67B6\u6784\uFF0C\u4E00\u4E3B\u591A\u4ECE\uFF0C\u4E3B\u8D1F\u8D23\u5199\uFF0C\u5E76\u4E14\u5C06\u6570\u636E\u590D\u5236\u5230\u5176\u5B83\u7684 slave \u8282\u70B9\uFF0C\u4ECE\u8282\u70B9\u8D1F\u8D23\u8BFB\u3002\u6240\u6709\u7684<strong>\u8BFB\u8BF7\u6C42\u5168\u90E8\u8D70\u4ECE\u8282\u70B9</strong>\u3002\u8FD9\u6837\u4E5F\u53EF\u4EE5\u5F88\u8F7B\u677E\u5B9E\u73B0\u6C34\u5E73\u6269\u5BB9\uFF0C<strong>\u652F\u6491\u8BFB\u9AD8\u5E76\u53D1</strong>\u3002 <img src="https://cdn.nlark.com/yuque/0/2020/png/2517043/1599814960582-0587ece4-90ca-4b73-9016-02121fd4640a.png#averageHue=%23f8f8f8&amp;height=392&amp;id=LCM7N&amp;originHeight=784&amp;originWidth=1138&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=68448&amp;status=done&amp;style=none&amp;title=&amp;width=569" alt="image.png"> redis replication -&gt; \u4E3B\u4ECE\u67B6\u6784 -&gt; \u8BFB\u5199\u5206\u79BB -&gt; \u6C34\u5E73\u6269\u5BB9\u652F\u6491\u8BFB\u9AD8\u5E76\u53D1 <strong>redis replication \u7684\u6838\u5FC3\u673A\u5236</strong></p><ul><li>redis \u91C7\u7528<strong>\u5F02\u6B65\u65B9\u5F0F</strong>\u590D\u5236\u6570\u636E\u5230 slave \u8282\u70B9\uFF0C\u4E0D\u8FC7 redis2.8 \u5F00\u59CB\uFF0Cslave node \u4F1A\u5468\u671F\u6027\u5730\u786E\u8BA4\u81EA\u5DF1\u6BCF\u6B21\u590D\u5236\u7684\u6570\u636E\u91CF\uFF1B</li><li>\u4E00\u4E2A master node \u662F\u53EF\u4EE5\u914D\u7F6E\u591A\u4E2A slave node \u7684\uFF1B</li><li>slave node \u4E5F\u53EF\u4EE5\u8FDE\u63A5\u5176\u4ED6\u7684 slave node\uFF1B</li><li>slave node \u505A\u590D\u5236\u7684\u65F6\u5019\uFF0C\u4E0D\u4F1A block master node \u7684\u6B63\u5E38\u5DE5\u4F5C\uFF1B</li><li>slave node \u5728\u505A\u590D\u5236\u7684\u65F6\u5019\uFF0C\u4E5F\u4E0D\u4F1A block \u5BF9\u81EA\u5DF1\u7684\u67E5\u8BE2\u64CD\u4F5C\uFF0C\u5B83\u4F1A\u7528\u65E7\u7684\u6570\u636E\u96C6\u6765\u63D0\u4F9B\u670D\u52A1\uFF1B\u4F46\u662F\u590D\u5236\u5B8C\u6210\u7684\u65F6\u5019\uFF0C\u9700\u8981\u5220\u9664\u65E7\u6570\u636E\u96C6\uFF0C\u52A0\u8F7D\u65B0\u6570\u636E\u96C6\uFF0C\u8FD9\u4E2A\u65F6\u5019\u5C31\u4F1A\u6682\u505C\u5BF9\u5916\u670D\u52A1\u4E86\uFF1B</li><li>slave node \u4E3B\u8981\u7528\u6765\u8FDB\u884C\u6A2A\u5411\u6269\u5BB9\uFF0C\u505A\u8BFB\u5199\u5206\u79BB\uFF0C\u6269\u5BB9\u7684 slave node \u53EF\u4EE5\u63D0\u9AD8\u8BFB\u7684\u541E\u5410\u91CF\u3002</li></ul><p>\u6CE8\u610F\uFF0C\u5982\u679C\u91C7\u7528\u4E86\u4E3B\u4ECE\u67B6\u6784\uFF0C\u90A3\u4E48\u5EFA\u8BAE\u5FC5\u987B<strong>\u5F00\u542F</strong> master node \u7684\u6301\u4E45\u5316\uFF0C\u4E0D\u5EFA\u8BAE\u7528 slave node \u4F5C\u4E3A master node \u7684\u6570\u636E\u70ED\u5907\uFF0C\u56E0\u4E3A\u90A3\u6837\u7684\u8BDD\uFF0C\u5982\u679C\u4F60\u5173\u6389 master \u7684\u6301\u4E45\u5316\uFF0C\u53EF\u80FD\u5728 master \u5B95\u673A\u91CD\u542F\u7684\u65F6\u5019\u6570\u636E\u662F\u7A7A\u7684\uFF0C\u7136\u540E\u53EF\u80FD\u4E00\u7ECF\u8FC7\u590D\u5236\uFF0C slave node \u7684\u6570\u636E\u4E5F\u4E22\u4E86\u3002 \u53E6\u5916\uFF0Cmaster \u7684\u5404\u79CD\u5907\u4EFD\u65B9\u6848\uFF0C\u4E5F\u9700\u8981\u505A\u3002\u4E07\u4E00\u672C\u5730\u7684\u6240\u6709\u6587\u4EF6\u4E22\u5931\u4E86\uFF0C\u4ECE\u5907\u4EFD\u4E2D\u6311\u9009\u4E00\u4EFD rdb \u53BB\u6062\u590D master\uFF0C\u8FD9\u6837\u624D\u80FD<strong>\u786E\u4FDD\u542F\u52A8\u7684\u65F6\u5019\uFF0C\u662F\u6709\u6570\u636E\u7684</strong>\uFF0C\u5373\u4F7F\u91C7\u7528\u4E86\u540E\u7EED\u8BB2\u89E3\u7684\u9AD8\u53EF\u7528\u673A\u5236\uFF0Cslave node \u53EF\u4EE5\u81EA\u52A8\u63A5\u7BA1 master node\uFF0C\u4F46\u4E5F\u53EF\u80FD sentinel \u8FD8\u6CA1\u68C0\u6D4B\u5230 master failure\uFF0Cmaster node \u5C31\u81EA\u52A8\u91CD\u542F\u4E86\uFF0C\u8FD8\u662F\u53EF\u80FD\u5BFC\u81F4\u4E0A\u9762\u6240\u6709\u7684 slave node \u6570\u636E\u88AB\u6E05\u7A7A\u3002 <strong>redis \u4E3B\u4ECE\u590D\u5236\u7684\u6838\u5FC3\u539F\u7406</strong> \u5F53\u542F\u52A8\u4E00\u4E2A slave node \u7684\u65F6\u5019\uFF0C\u5B83\u4F1A\u53D1\u9001\u4E00\u4E2A <code>PSYNC</code> \u547D\u4EE4\u7ED9 master node\u3002 \u5982\u679C\u8FD9\u662F slave node \u521D\u6B21\u8FDE\u63A5\u5230 master node\uFF0C\u90A3\u4E48\u4F1A\u89E6\u53D1\u4E00\u6B21 <code>full resynchronization</code> \u5168\u91CF\u590D\u5236\u3002\u6B64\u65F6 master \u4F1A\u542F\u52A8\u4E00\u4E2A\u540E\u53F0\u7EBF\u7A0B\uFF0C\u5F00\u59CB\u751F\u6210\u4E00\u4EFD <code>RDB</code> \u5FEB\u7167\u6587\u4EF6\uFF0C \u540C\u65F6\u8FD8\u4F1A\u5C06\u4ECE\u5BA2\u6237\u7AEF client \u65B0\u6536\u5230\u7684\u6240\u6709\u5199\u547D\u4EE4\u7F13\u5B58\u5728\u5185\u5B58\u4E2D\u3002<code>RDB</code> \u6587\u4EF6\u751F\u6210\u5B8C\u6BD5\u540E\uFF0C master \u4F1A\u5C06\u8FD9\u4E2A <code>RDB</code> \u53D1\u9001\u7ED9 slave\uFF0Cslave \u4F1A\u5148<strong>\u5199\u5165\u672C\u5730\u78C1\u76D8\uFF0C\u7136\u540E\u518D\u4ECE\u672C\u5730\u78C1\u76D8\u52A0\u8F7D\u5230\u5185\u5B58</strong>\u4E2D\uFF0C \u63A5\u7740 master \u4F1A\u5C06\u5185\u5B58\u4E2D\u7F13\u5B58\u7684\u5199\u547D\u4EE4\u53D1\u9001\u5230 slave\uFF0Cslave \u4E5F\u4F1A\u540C\u6B65\u8FD9\u4E9B\u6570\u636E\u3002 slave node \u5982\u679C\u8DDF master node \u6709\u7F51\u7EDC\u6545\u969C\uFF0C\u65AD\u5F00\u4E86\u8FDE\u63A5\uFF0C\u4F1A\u81EA\u52A8\u91CD\u8FDE\uFF0C\u8FDE\u63A5\u4E4B\u540E master node \u4EC5\u4F1A\u590D\u5236\u7ED9 slave \u90E8\u5206\u7F3A\u5C11\u7684\u6570\u636E\u3002 <img src="https://cdn.nlark.com/yuque/0/2020/png/2517043/1599814985259-19bbd138-d5e2-47fe-a2c3-8bc54a4e88b7.png#averageHue=%23f8f8f8&amp;height=294&amp;id=gAdtN&amp;originHeight=588&amp;originWidth=1400&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=68696&amp;status=done&amp;style=none&amp;title=&amp;width=700" alt="image.png"><strong>\u8FC7\u7A0B\u539F\u7406</strong></p><ol><li>\u5F53\u4ECE\u5E93\u548C\u4E3B\u5E93\u5EFA\u7ACBMS\u5173\u7CFB\u540E\uFF0C\u4F1A\u5411\u4E3B\u6570\u636E\u5E93\u53D1\u9001SYNC\u547D\u4EE4</li><li>\u4E3B\u5E93\u63A5\u6536\u5230SYNC\u547D\u4EE4\u540E\u4F1A\u5F00\u59CB\u5728\u540E\u53F0\u4FDD\u5B58\u5FEB\u7167(RDB\u6301\u4E45\u5316\u8FC7\u7A0B)\uFF0C\u5E76\u5C06\u671F\u95F4\u63A5\u6536\u5230\u7684\u5199\u547D\u4EE4\u7F13\u5B58\u8D77\u6765</li><li>\u5F53\u5FEB\u7167\u5B8C\u6210\u540E\uFF0C\u4E3BRedis\u4F1A\u5C06\u5FEB\u7167\u6587\u4EF6\u548C\u6240\u6709\u7F13\u5B58\u7684\u5199\u547D\u4EE4\u53D1\u9001\u7ED9\u4ECERedis</li><li>\u4ECERedis\u63A5\u6536\u5230\u540E\uFF0C\u4F1A\u8F7D\u5165\u5FEB\u7167\u6587\u4EF6\u5E76\u4E14\u6267\u884C\u6536\u5230\u7684\u7F13\u5B58\u7684\u547D\u4EE4</li><li>\u4E4B\u540E\uFF0C\u4E3BRedis\u6BCF\u5F53\u63A5\u6536\u5230\u5199\u547D\u4EE4\u65F6\u5C31\u4F1A\u5C06\u547D\u4EE4\u53D1\u9001\u4ECERedis\uFF0C\u4ECE\u800C\u4FDD\u8BC1\u6570\u636E\u7684\u4E00\u81F4</li></ol><p><strong>\u7F3A\u70B9</strong> \u6240\u6709\u7684slave\u8282\u70B9\u6570\u636E\u7684\u590D\u5236\u548C\u540C\u6B65\u90FD\u7531master\u8282\u70B9\u6765\u5904\u7406\uFF0C\u4F1A\u7167\u6210master\u8282\u70B9\u538B\u529B\u592A\u5927\uFF0C\u4F7F\u7528\u4E3B\u4ECE\u4ECE\u7ED3\u6784\u6765\u89E3\u51B3</p><h3 id="redis\u96C6\u7FA4\u7684\u4E3B\u4ECE\u590D\u5236\u6A21\u578B\u662F\u600E\u6837\u7684" tabindex="-1"><a class="header-anchor" href="#redis\u96C6\u7FA4\u7684\u4E3B\u4ECE\u590D\u5236\u6A21\u578B\u662F\u600E\u6837\u7684" aria-hidden="true">#</a> Redis\u96C6\u7FA4\u7684\u4E3B\u4ECE\u590D\u5236\u6A21\u578B\u662F\u600E\u6837\u7684\uFF1F</h3><p>\u4E3A\u4E86\u4F7F\u5728\u90E8\u5206\u8282\u70B9\u5931\u8D25\u6216\u8005\u5927\u90E8\u5206\u8282\u70B9\u65E0\u6CD5\u901A\u4FE1\u7684\u60C5\u51B5\u4E0B\u96C6\u7FA4\u4ECD\u7136\u53EF\u7528\uFF0C\u6240\u4EE5\u96C6\u7FA4\u4F7F\u7528\u4E86\u4E3B\u4ECE\u590D\u5236\u6A21\u578B\uFF0C\u6BCF\u4E2A\u8282\u70B9\u90FD\u4F1A\u6709N-1\u4E2A\u590D\u5236\u54C1</p><h3 id="\u751F\u4EA7\u73AF\u5883\u4E2D\u7684-redis-\u662F\u600E\u4E48\u90E8\u7F72\u7684" tabindex="-1"><a class="header-anchor" href="#\u751F\u4EA7\u73AF\u5883\u4E2D\u7684-redis-\u662F\u600E\u4E48\u90E8\u7F72\u7684" aria-hidden="true">#</a> \u751F\u4EA7\u73AF\u5883\u4E2D\u7684 redis \u662F\u600E\u4E48\u90E8\u7F72\u7684\uFF1F</h3><p>redis cluster\uFF0C10 \u53F0\u673A\u5668\uFF0C5 \u53F0\u673A\u5668\u90E8\u7F72\u4E86 redis \u4E3B\u5B9E\u4F8B\uFF0C\u53E6\u5916 5 \u53F0\u673A\u5668\u90E8\u7F72\u4E86 redis \u7684\u4ECE\u5B9E\u4F8B\uFF0C\u6BCF\u4E2A\u4E3B\u5B9E\u4F8B\u6302\u4E86\u4E00\u4E2A\u4ECE\u5B9E\u4F8B\uFF0C5 \u4E2A\u8282\u70B9\u5BF9\u5916\u63D0\u4F9B\u8BFB\u5199\u670D\u52A1\uFF0C\u6BCF\u4E2A\u8282\u70B9\u7684\u8BFB\u5199\u9AD8\u5CF0qps\u53EF\u80FD\u53EF\u4EE5\u8FBE\u5230\u6BCF\u79D2 5 \u4E07\uFF0C5 \u53F0\u673A\u5668\u6700\u591A\u662F 25 \u4E07\u8BFB\u5199\u8BF7\u6C42/s\u3002 \u673A\u5668\u662F\u4EC0\u4E48\u914D\u7F6E\uFF1F32G \u5185\u5B58+ 8 \u6838 CPU + 1T \u78C1\u76D8\uFF0C\u4F46\u662F\u5206\u914D\u7ED9 redis \u8FDB\u7A0B\u7684\u662F10g\u5185\u5B58\uFF0C\u4E00\u822C\u7EBF\u4E0A\u751F\u4EA7\u73AF\u5883\uFF0Credis \u7684\u5185\u5B58\u5C3D\u91CF\u4E0D\u8981\u8D85\u8FC7 10g\uFF0C\u8D85\u8FC7 10g \u53EF\u80FD\u4F1A\u6709\u95EE\u9898\u3002 5 \u53F0\u673A\u5668\u5BF9\u5916\u63D0\u4F9B\u8BFB\u5199\uFF0C\u4E00\u5171\u6709 50g \u5185\u5B58\u3002 \u56E0\u4E3A\u6BCF\u4E2A\u4E3B\u5B9E\u4F8B\u90FD\u6302\u4E86\u4E00\u4E2A\u4ECE\u5B9E\u4F8B\uFF0C\u6240\u4EE5\u662F\u9AD8\u53EF\u7528\u7684\uFF0C\u4EFB\u4F55\u4E00\u4E2A\u4E3B\u5B9E\u4F8B\u5B95\u673A\uFF0C\u90FD\u4F1A\u81EA\u52A8\u6545\u969C\u8FC1\u79FB\uFF0Credis \u4ECE\u5B9E\u4F8B\u4F1A\u81EA\u52A8\u53D8\u6210\u4E3B\u5B9E\u4F8B\u7EE7\u7EED\u63D0\u4F9B\u8BFB\u5199\u670D\u52A1\u3002 \u4F60\u5F80\u5185\u5B58\u91CC\u5199\u7684\u662F\u4EC0\u4E48\u6570\u636E\uFF1F\u6BCF\u6761\u6570\u636E\u7684\u5927\u5C0F\u662F\u591A\u5C11\uFF1F\u5546\u54C1\u6570\u636E\uFF0C\u6BCF\u6761\u6570\u636E\u662F 10kb\u3002100 \u6761\u6570\u636E\u662F 1mb\uFF0C10 \u4E07\u6761\u6570\u636E\u662F 1g\u3002\u5E38\u9A7B\u5185\u5B58\u7684\u662F 200 \u4E07\u6761\u5546\u54C1\u6570\u636E\uFF0C\u5360\u7528\u5185\u5B58\u662F 20g\uFF0C\u4EC5\u4EC5\u4E0D\u5230\u603B\u5185\u5B58\u7684 50%\u3002\u76EE\u524D\u9AD8\u5CF0\u671F\u6BCF\u79D2\u5C31\u662F 3500 \u5DE6\u53F3\u7684\u8BF7\u6C42\u91CF\u3002 \u5176\u5B9E\u5927\u578B\u7684\u516C\u53F8\uFF0C\u4F1A\u6709\u57FA\u7840\u67B6\u6784\u7684 team \u8D1F\u8D23\u7F13\u5B58\u96C6\u7FA4\u7684\u8FD0\u7EF4\u3002</p><h3 id="\u8BF4\u8BF4redis\u54C8\u5E0C\u69FD\u7684\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#\u8BF4\u8BF4redis\u54C8\u5E0C\u69FD\u7684\u6982\u5FF5" aria-hidden="true">#</a> \u8BF4\u8BF4Redis\u54C8\u5E0C\u69FD\u7684\u6982\u5FF5\uFF1F</h3><p>Redis\u96C6\u7FA4\u6CA1\u6709\u4F7F\u7528\u4E00\u81F4\u6027hash,\u800C\u662F\u5F15\u5165\u4E86\u54C8\u5E0C\u69FD\u7684\u6982\u5FF5\uFF0CRedis\u96C6\u7FA4\u670916384\u4E2A\u54C8\u5E0C\u69FD\uFF0C\u6BCF\u4E2Akey\u901A\u8FC7CRC16\u6821\u9A8C\u540E\u5BF916384\u53D6\u6A21\u6765\u51B3\u5B9A\u653E\u7F6E\u54EA\u4E2A\u69FD\uFF0C\u96C6\u7FA4\u7684\u6BCF\u4E2A\u8282\u70B9\u8D1F\u8D23\u4E00\u90E8\u5206hash\u69FD\u3002</p><h3 id="redis\u96C6\u7FA4\u4F1A\u6709\u5199\u64CD\u4F5C\u4E22\u5931\u5417-\u4E3A\u4EC0\u4E48" tabindex="-1"><a class="header-anchor" href="#redis\u96C6\u7FA4\u4F1A\u6709\u5199\u64CD\u4F5C\u4E22\u5931\u5417-\u4E3A\u4EC0\u4E48" aria-hidden="true">#</a> Redis\u96C6\u7FA4\u4F1A\u6709\u5199\u64CD\u4F5C\u4E22\u5931\u5417\uFF1F\u4E3A\u4EC0\u4E48\uFF1F</h3><p>Redis\u5E76\u4E0D\u80FD\u4FDD\u8BC1\u6570\u636E\u7684\u5F3A\u4E00\u81F4\u6027\uFF0C\u8FD9\u610F\u5473\u8FD9\u5728\u5B9E\u9645\u4E2D\u96C6\u7FA4\u5728\u7279\u5B9A\u7684\u6761\u4EF6\u4E0B\u53EF\u80FD\u4F1A\u4E22\u5931\u5199\u64CD\u4F5C\u3002</p><h3 id="redis\u96C6\u7FA4\u4E4B\u95F4\u662F\u5982\u4F55\u590D\u5236\u7684" tabindex="-1"><a class="header-anchor" href="#redis\u96C6\u7FA4\u4E4B\u95F4\u662F\u5982\u4F55\u590D\u5236\u7684" aria-hidden="true">#</a> Redis\u96C6\u7FA4\u4E4B\u95F4\u662F\u5982\u4F55\u590D\u5236\u7684\uFF1F</h3><p>\u5F02\u6B65\u590D\u5236</p><h3 id="redis\u96C6\u7FA4\u6700\u5927\u8282\u70B9\u4E2A\u6570\u662F\u591A\u5C11" tabindex="-1"><a class="header-anchor" href="#redis\u96C6\u7FA4\u6700\u5927\u8282\u70B9\u4E2A\u6570\u662F\u591A\u5C11" aria-hidden="true">#</a> Redis\u96C6\u7FA4\u6700\u5927\u8282\u70B9\u4E2A\u6570\u662F\u591A\u5C11\uFF1F</h3><p>16384\u4E2A</p><h3 id="redis\u96C6\u7FA4\u5982\u4F55\u9009\u62E9\u6570\u636E\u5E93" tabindex="-1"><a class="header-anchor" href="#redis\u96C6\u7FA4\u5982\u4F55\u9009\u62E9\u6570\u636E\u5E93" aria-hidden="true">#</a> Redis\u96C6\u7FA4\u5982\u4F55\u9009\u62E9\u6570\u636E\u5E93\uFF1F</h3><p>Redis\u96C6\u7FA4\u76EE\u524D\u65E0\u6CD5\u505A\u6570\u636E\u5E93\u9009\u62E9\uFF0C\u9ED8\u8BA4\u57280\u6570\u636E\u5E93\u3002</p><h2 id="\u5206\u533A-\u6821\u62DB\u57FA\u672C\u4E0D\u4F1A\u95EE" tabindex="-1"><a class="header-anchor" href="#\u5206\u533A-\u6821\u62DB\u57FA\u672C\u4E0D\u4F1A\u95EE" aria-hidden="true">#</a> \u5206\u533A\uFF08\u6821\u62DB\u57FA\u672C\u4E0D\u4F1A\u95EE\uFF09</h2><h3 id="redis\u662F\u5355\u7EBF\u7A0B\u7684-\u5982\u4F55\u63D0\u9AD8\u591A\u6838cpu\u7684\u5229\u7528\u7387" tabindex="-1"><a class="header-anchor" href="#redis\u662F\u5355\u7EBF\u7A0B\u7684-\u5982\u4F55\u63D0\u9AD8\u591A\u6838cpu\u7684\u5229\u7528\u7387" aria-hidden="true">#</a> Redis\u662F\u5355\u7EBF\u7A0B\u7684\uFF0C\u5982\u4F55\u63D0\u9AD8\u591A\u6838CPU\u7684\u5229\u7528\u7387\uFF1F</h3><p>\u53EF\u4EE5\u5728\u540C\u4E00\u4E2A\u670D\u52A1\u5668\u90E8\u7F72\u591A\u4E2ARedis\u7684\u5B9E\u4F8B\uFF0C\u5E76\u628A\u4ED6\u4EEC\u5F53\u4F5C\u4E0D\u540C\u7684\u670D\u52A1\u5668\u6765\u4F7F\u7528\uFF0C\u5728\u67D0\u4E9B\u65F6\u5019\uFF0C\u65E0\u8BBA\u5982\u4F55\u4E00\u4E2A\u670D\u52A1\u5668\u662F\u4E0D\u591F\u7684\uFF0C \u6240\u4EE5\uFF0C\u5982\u679C\u4F60\u60F3\u4F7F\u7528\u591A\u4E2ACPU\uFF0C\u4F60\u53EF\u4EE5\u8003\u8651\u4E00\u4E0B\u5206\u7247\uFF08shard\uFF09\u3002</p><h3 id="\u4E3A\u4EC0\u4E48\u8981\u505Aredis\u5206\u533A" tabindex="-1"><a class="header-anchor" href="#\u4E3A\u4EC0\u4E48\u8981\u505Aredis\u5206\u533A" aria-hidden="true">#</a> \u4E3A\u4EC0\u4E48\u8981\u505ARedis\u5206\u533A\uFF1F</h3><p>\u5206\u533A\u53EF\u4EE5\u8BA9Redis\u7BA1\u7406\u66F4\u5927\u7684\u5185\u5B58\uFF0CRedis\u5C06\u53EF\u4EE5\u4F7F\u7528\u6240\u6709\u673A\u5668\u7684\u5185\u5B58\u3002\u5982\u679C\u6CA1\u6709\u5206\u533A\uFF0C\u4F60\u6700\u591A\u53EA\u80FD\u4F7F\u7528\u4E00\u53F0\u673A\u5668\u7684\u5185\u5B58\u3002\u5206\u533A\u4F7FRedis\u7684\u8BA1\u7B97\u80FD\u529B\u901A\u8FC7\u7B80\u5355\u5730\u589E\u52A0\u8BA1\u7B97\u673A\u5F97\u5230\u6210\u500D\u63D0\u5347\uFF0CRedis\u7684\u7F51\u7EDC\u5E26\u5BBD\u4E5F\u4F1A\u968F\u7740\u8BA1\u7B97\u673A\u548C\u7F51\u5361\u7684\u589E\u52A0\u800C\u6210\u500D\u589E\u957F\u3002</p><h3 id="\u4F60\u77E5\u9053\u6709\u54EA\u4E9Bredis\u5206\u533A\u5B9E\u73B0\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#\u4F60\u77E5\u9053\u6709\u54EA\u4E9Bredis\u5206\u533A\u5B9E\u73B0\u65B9\u6848" aria-hidden="true">#</a> \u4F60\u77E5\u9053\u6709\u54EA\u4E9BRedis\u5206\u533A\u5B9E\u73B0\u65B9\u6848\uFF1F</h3><ul><li>\u5BA2\u6237\u7AEF\u5206\u533A\u5C31\u662F\u5728\u5BA2\u6237\u7AEF\u5C31\u5DF2\u7ECF\u51B3\u5B9A\u6570\u636E\u4F1A\u88AB\u5B58\u50A8\u5230\u54EA\u4E2Aredis\u8282\u70B9\u6216\u8005\u4ECE\u54EA\u4E2Aredis\u8282\u70B9\u8BFB\u53D6\u3002\u5927\u591A\u6570\u5BA2\u6237\u7AEF\u5DF2\u7ECF\u5B9E\u73B0\u4E86\u5BA2\u6237\u7AEF\u5206\u533A\u3002</li><li>\u4EE3\u7406\u5206\u533A \u610F\u5473\u7740\u5BA2\u6237\u7AEF\u5C06\u8BF7\u6C42\u53D1\u9001\u7ED9\u4EE3\u7406\uFF0C\u7136\u540E\u4EE3\u7406\u51B3\u5B9A\u53BB\u54EA\u4E2A\u8282\u70B9\u5199\u6570\u636E\u6216\u8005\u8BFB\u6570\u636E\u3002\u4EE3\u7406\u6839\u636E\u5206\u533A\u89C4\u5219\u51B3\u5B9A\u8BF7\u6C42\u54EA\u4E9BRedis\u5B9E\u4F8B\uFF0C\u7136\u540E\u6839\u636ERedis\u7684\u54CD\u5E94\u7ED3\u679C\u8FD4\u56DE\u7ED9\u5BA2\u6237\u7AEF\u3002redis\u548Cmemcached\u7684\u4E00\u79CD\u4EE3\u7406\u5B9E\u73B0\u5C31\u662FTwemproxy</li><li>\u67E5\u8BE2\u8DEF\u7531(Query routing) \u7684\u610F\u601D\u662F\u5BA2\u6237\u7AEF\u968F\u673A\u5730\u8BF7\u6C42\u4EFB\u610F\u4E00\u4E2Aredis\u5B9E\u4F8B\uFF0C\u7136\u540E\u7531Redis\u5C06\u8BF7\u6C42\u8F6C\u53D1\u7ED9\u6B63\u786E\u7684Redis\u8282\u70B9\u3002Redis Cluster\u5B9E\u73B0\u4E86\u4E00\u79CD\u6DF7\u5408\u5F62\u5F0F\u7684\u67E5\u8BE2\u8DEF\u7531\uFF0C\u4F46\u5E76\u4E0D\u662F\u76F4\u63A5\u5C06\u8BF7\u6C42\u4ECE\u4E00\u4E2Aredis\u8282\u70B9\u8F6C\u53D1\u5230\u53E6\u4E00\u4E2Aredis\u8282\u70B9\uFF0C\u800C\u662F\u5728\u5BA2\u6237\u7AEF\u7684\u5E2E\u52A9\u4E0B\u76F4\u63A5redirected\u5230\u6B63\u786E\u7684redis\u8282\u70B9\u3002</li></ul><h3 id="redis\u5206\u533A\u6709\u4EC0\u4E48\u7F3A\u70B9" tabindex="-1"><a class="header-anchor" href="#redis\u5206\u533A\u6709\u4EC0\u4E48\u7F3A\u70B9" aria-hidden="true">#</a> Redis\u5206\u533A\u6709\u4EC0\u4E48\u7F3A\u70B9\uFF1F</h3><ul><li>\u6D89\u53CA\u591A\u4E2Akey\u7684\u64CD\u4F5C\u901A\u5E38\u4E0D\u4F1A\u88AB\u652F\u6301\u3002\u4F8B\u5982\u4F60\u4E0D\u80FD\u5BF9\u4E24\u4E2A\u96C6\u5408\u6C42\u4EA4\u96C6\uFF0C\u56E0\u4E3A\u4ED6\u4EEC\u53EF\u80FD\u88AB\u5B58\u50A8\u5230\u4E0D\u540C\u7684Redis\u5B9E\u4F8B\uFF08\u5B9E\u9645\u4E0A\u8FD9\u79CD\u60C5\u51B5\u4E5F\u6709\u529E\u6CD5\uFF0C\u4F46\u662F\u4E0D\u80FD\u76F4\u63A5\u4F7F\u7528\u4EA4\u96C6\u6307\u4EE4\uFF09\u3002</li><li>\u540C\u65F6\u64CD\u4F5C\u591A\u4E2Akey,\u5219\u4E0D\u80FD\u4F7F\u7528Redis\u4E8B\u52A1.</li><li>\u5206\u533A\u4F7F\u7528\u7684\u7C92\u5EA6\u662Fkey\uFF0C\u4E0D\u80FD\u4F7F\u7528\u4E00\u4E2A\u975E\u5E38\u957F\u7684\u6392\u5E8Fkey\u5B58\u50A8\u4E00\u4E2A\u6570\u636E\u96C6\uFF08The partitioning granularity is the key, so it is not possible to shard a dataset with a single huge key like a very big sorted set\uFF09</li><li>\u5F53\u4F7F\u7528\u5206\u533A\u7684\u65F6\u5019\uFF0C\u6570\u636E\u5904\u7406\u4F1A\u975E\u5E38\u590D\u6742\uFF0C\u4F8B\u5982\u4E3A\u4E86\u5907\u4EFD\u4F60\u5FC5\u987B\u4ECE\u4E0D\u540C\u7684Redis\u5B9E\u4F8B\u548C\u4E3B\u673A\u540C\u65F6\u6536\u96C6RDB / AOF\u6587\u4EF6\u3002</li><li>\u5206\u533A\u65F6\u52A8\u6001\u6269\u5BB9\u6216\u7F29\u5BB9\u53EF\u80FD\u975E\u5E38\u590D\u6742\u3002Redis\u96C6\u7FA4\u5728\u8FD0\u884C\u65F6\u589E\u52A0\u6216\u8005\u5220\u9664Redis\u8282\u70B9\uFF0C\u80FD\u505A\u5230\u6700\u5927\u7A0B\u5EA6\u5BF9\u7528\u6237\u900F\u660E\u5730\u6570\u636E\u518D\u5E73\u8861\uFF0C\u4F46\u5176\u4ED6\u4E00\u4E9B\u5BA2\u6237\u7AEF\u5206\u533A\u6216\u8005\u4EE3\u7406\u5206\u533A\u65B9\u6CD5\u5219\u4E0D\u652F\u6301\u8FD9\u79CD\u7279\u6027\u3002\u7136\u800C\uFF0C\u6709\u4E00\u79CD\u9884\u5206\u7247\u7684\u6280\u672F\u4E5F\u53EF\u4EE5\u8F83\u597D\u7684\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\u3002</li></ul>',110);function v(T,q){const s=t("ExternalLinkIcon");return d(),p(l,null,[h,a("p",null,[a("a",c,[m,n(s)]),u,g]),b,a("p",null,[a("a",f,[k,n(s)])]),y,a("p",null,[_,a("a",R,[x,n(s)])]),w],64)}var H=r(o,[["render",v],["__file","Redis.html.vue"]]);export{H as default};
