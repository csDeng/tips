import{_ as r,r as u,o as i,c as k,b as n,a,w as t,F as b,d as s,e as p}from"./app.2a7ffa2e.js";var m="/assets/image-20220418235005495.db278647.png",d="/assets/image-20220421000920002.7d850102.png";const g={},f={class:"table-of-contents"},h=s("Go\u8BED\u8A00TCP Socket\u7F16\u7A0B"),y=s("\u4E00\u3001\u6A21\u578B"),_=s("\u4E8C\u3001TCP\u8FDE\u63A5\u7684\u5EFA\u7ACB"),w=s("\u5BF9\u4E8E\u5BA2\u6237\u7AEF\u800C\u8A00\uFF0C\u8FDE\u63A5\u7684\u5EFA\u7ACB\u4F1A\u9047\u5230\u5982\u4E0B\u51E0\u79CD\u60C5\u5F62\uFF1A"),v=s("1\u3001\u7F51\u7EDC\u4E0D\u53EF\u8FBE\u6216\u5BF9\u65B9\u670D\u52A1\u672A\u542F\u52A8"),x=s("2\u3001\u5BF9\u65B9\u670D\u52A1\u7684listen backlog\u6EE1"),P=s("3\u3001\u7F51\u7EDC\u5EF6\u8FDF\u8F83\u5927\uFF0CDial\u963B\u585E\u5E76\u8D85\u65F6"),S=s("\u4E09\u3001Socket\u8BFB\u5199"),C=s("conn.Read"),R=s("1\u3001Socket\u4E2D\u65E0\u6570\u636E"),q=s("2\u3001Socket\u4E2D\u6709\u90E8\u5206\u6570\u636E"),D=s("3\u3001Socket\u4E2D\u6709\u8DB3\u591F\u6570\u636E"),O=s("4\u3001Socket\u5173\u95ED"),W=s("5\u3001\u8BFB\u53D6\u64CD\u4F5C\u8D85\u65F6"),F=s("conn.Write"),A=s("1\u3001\u6210\u529F\u5199"),E=s("2\u3001\u5199\u963B\u585E"),T=s("3\u3001\u5199\u5165\u90E8\u5206\u6570\u636E"),I=s("4\u3001\u5199\u5165\u8D85\u65F6"),G=s("Goroutine safe"),N=s("\u56DB\u3001Socket\u5C5E\u6027"),L=s("\u4E94\u3001\u5173\u95ED\u8FDE\u63A5"),B=s("\u516D\u3001\u5C0F\u7ED3"),M=n("h1",{id:"go\u8BED\u8A00tcp-socket\u7F16\u7A0B",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#go\u8BED\u8A00tcp-socket\u7F16\u7A0B","aria-hidden":"true"},"#"),s(" Go\u8BED\u8A00TCP Socket\u7F16\u7A0B")],-1),z={class:"custom-container tip"},V=n("p",{class:"custom-container-title"},"\u58F0\u660E",-1),U=s("\u672C\u6587\u6E90\u4E8E"),$={href:"https://tonybai.com/2015/11/17/tcp-programming-in-golang/",target:"_blank",rel:"noopener noreferrer"},j=s("Go\u8BED\u8A00TCP Socket\u7F16\u7A0B | Tony Bai"),X=s("\uFF0C\u53EF\u80FD\u4F1A\u6709\u7A0D\u5FAE\u7684\u4FEE\u6539\u3002"),K=n("p",null,[n("code",null,"Golang"),s("\u7684\u4E3B\u8981 \u8BBE\u8BA1\u76EE\u6807\u4E4B\u4E00\u5C31\u662F\u9762\u5411\u5927\u89C4\u6A21\u540E\u7AEF\u670D\u52A1\u7A0B\u5E8F\uFF0C\u7F51\u7EDC\u901A\u4FE1\u8FD9\u5757\u662F\u670D\u52A1\u7AEF \u7A0B\u5E8F\u5FC5\u4E0D\u53EF\u5C11\u4E5F\u662F\u81F3\u5173\u91CD\u8981\u7684\u4E00\u90E8\u5206\u3002\u5728\u65E5\u5E38\u5E94\u7528\u4E2D\uFF0C\u6211\u4EEC\u4E5F\u53EF\u4EE5\u770B\u5230Go\u4E2D\u7684net\u4EE5\u53CA\u5176subdirectories\u4E0B\u7684\u5305\u5747\u662F\u201C\u9AD8\u9891+\u521A\u9700\u201D\uFF0C\u800CTCP socket\u5219\u662F\u7F51\u7EDC\u7F16\u7A0B\u7684\u4E3B\u6D41\uFF0C\u5373\u4FBF\u60A8\u6CA1\u6709\u76F4\u63A5\u4F7F\u7528\u5230net\u4E2D\u6709\u5173TCP Socket\u65B9\u9762\u7684\u63A5\u53E3\uFF0C\u4F46net/http\u603B\u662F\u7528\u5230\u4E86\u5427\uFF0Chttp\u5E95\u5C42\u4F9D\u65E7\u662F\u7528tcp socket\u5B9E\u73B0\u7684\u3002")],-1),Y=s("\u7F51\u7EDC\u7F16\u7A0B\u65B9\u9762\uFF0C\u6211\u4EEC\u6700\u5E38\u7528\u7684\u5C31\u662Ftcp socket\u7F16\u7A0B\u4E86\uFF0C\u5728posix\u6807\u51C6\u51FA\u6765\u540E\uFF0Csocket\u5728\u5404\u5927\u4E3B\u6D41OS\u5E73\u53F0\u4E0A\u90FD\u5F97\u5230\u4E86\u5F88\u597D\u7684\u652F\u6301\u3002\u5173\u4E8Etcp programming\uFF0C\u6700\u597D\u7684\u8D44\u6599\u83AB\u8FC7\u4E8E"),Z={href:"http://en.wikipedia.org/wiki/W._Richard_Stevens",target:"_blank",rel:"noopener noreferrer"},H=s("W. Richard Stevens"),J=s(" \u7684\u7F51\u7EDC\u7F16\u7A0B\u5723\u7ECF\u300A"),Q={href:"http://book.douban.com/subject/4859464/",target:"_blank",rel:"noopener noreferrer"},nn=s("UNIX\u7F51\u7EDC \u7F16\u7A0B \u53771\uFF1A\u5957\u63A5\u5B57\u8054\u7F51API"),sn=s("\u300B \u4E86\uFF0C\u4E66\u4E2D\u5173\u4E8Etcp socket\u63A5\u53E3\u7684\u5404\u79CD\u4F7F\u7528\u3001\u884C\u4E3A\u6A21\u5F0F\u3001\u5F02\u5E38\u5904\u7406\u8BB2\u89E3\u7684\u5341\u5206\u7EC6\u81F4\u3002Go\u662F\u81EA\u5E26runtime\u7684\u8DE8\u5E73\u53F0\u7F16\u7A0B\u8BED\u8A00\uFF0CGo\u4E2D\u66B4\u9732\u7ED9\u8BED\u8A00\u4F7F\u7528\u8005\u7684tcp socket api\u662F\u5EFA\u7ACBOS\u539F\u751Ftcp socket\u63A5\u53E3\u4E4B\u4E0A\u7684\u3002\u7531\u4E8EGo runtime\u8C03\u5EA6\u7684\u9700\u8981\uFF0Cgolang tcp socket\u63A5\u53E3\u5728\u884C\u4E3A\u7279\u70B9\u4E0E\u5F02\u5E38\u5904\u7406\u65B9\u9762\u4E0EOS\u539F\u751F\u63A5\u53E3\u6709\u7740\u4E00\u4E9B\u5DEE\u522B\u3002\u8FD9\u7BC7\u535A\u6587\u7684\u76EE\u6807\u5C31\u662F\u6574\u7406\u51FA\u5173\u4E8EGo tcp socket\u5728\u5404\u4E2A\u573A\u666F\u4E0B\u7684\u4F7F\u7528\u65B9\u6CD5\u3001\u884C\u4E3A\u7279\u70B9\u4EE5\u53CA\u6CE8\u610F\u4E8B\u9879\u3002"),an=n("h2",{id:"\u4E00\u3001\u6A21\u578B",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u4E00\u3001\u6A21\u578B","aria-hidden":"true"},"#"),s(" \u4E00\u3001\u6A21\u578B")],-1),tn=n("p",null,"\u4ECEtcp socket\u8BDE\u751F\u540E\uFF0C\u7F51\u7EDC\u7F16\u7A0B\u67B6\u6784\u6A21\u578B\u4E5F\u51E0\u7ECF\u6F14\u5316\uFF0C\u5927\u81F4\u662F\uFF1A\u201C\u6BCF\u8FDB\u7A0B\u4E00\u4E2A\u8FDE\u63A5\u201D \u2013> \u201C\u6BCF\u7EBF\u7A0B\u4E00\u4E2A\u8FDE\u63A5\u201D \u2013> \u201CNon-Block + I/O\u591A\u8DEF\u590D\u7528(linux epoll/windows iocp/freebsd darwin kqueue/solaris Event Port)\u201D\u3002\u4F34\u968F\u7740\u6A21\u578B\u7684\u6F14\u5316\uFF0C\u670D\u52A1\u7A0B\u5E8F\u6108\u52A0\u5F3A\u5927\uFF0C\u53EF\u4EE5\u652F\u6301\u66F4\u591A\u7684\u8FDE\u63A5\uFF0C\u83B7\u5F97\u66F4\u597D\u7684\u5904\u7406\u6027\u80FD\u3002",-1),en=s("\u76EE\u524D\u4E3B\u6D41web server\u4E00\u822C\u5747\u91C7\u7528\u7684\u90FD\u662F\u201DNon-Block + I/O\u591A\u8DEF\u590D\u7528\u201D\uFF08\u6709\u7684\u4E5F\u7ED3\u5408\u4E86\u591A\u7EBF\u7A0B\u3001\u591A\u8FDB\u7A0B\uFF09\u3002\u4E0D\u8FC7I/O\u591A\u8DEF\u590D\u7528\u4E5F\u7ED9\u4F7F\u7528\u8005\u5E26\u6765\u4E86\u4E0D\u5C0F\u7684\u590D\u6742\u5EA6\uFF0C\u4EE5\u81F3\u4E8E\u540E\u7EED\u51FA\u73B0\u4E86\u8BB8\u591A\u9AD8\u6027\u80FD\u7684I/O\u591A\u8DEF\u590D\u7528\u6846\u67B6\uFF0C \u6BD4\u5982"),on={href:"http://libevent.org/",target:"_blank",rel:"noopener noreferrer"},pn=s("libevent"),cn=s("\u3001"),ln={href:"http://software.schmorp.de/pkg/libev.html",target:"_blank",rel:"noopener noreferrer"},un=s("libev"),rn=s("\u3001"),kn={href:"https://github.com/joyent/libuv",target:"_blank",rel:"noopener noreferrer"},bn=s("libuv"),mn=s("\u7B49\uFF0C\u4EE5\u5E2E\u52A9\u5F00\u53D1\u8005\u7B80\u5316\u5F00\u53D1\u590D\u6742\u6027\uFF0C\u964D\u4F4E\u5FC3\u667A\u8D1F\u62C5\u3002\u4E0D\u8FC7Go\u7684\u8BBE\u8BA1\u8005\u4F3C\u4E4E\u8BA4\u4E3AI/O\u591A\u8DEF\u590D\u7528\u7684\u8FD9\u79CD\u901A\u8FC7\u56DE\u8C03\u673A\u5236\u5272\u88C2\u63A7\u5236\u6D41 \u7684\u65B9\u5F0F\u4F9D\u65E7\u590D\u6742\uFF0C\u4E14\u6709\u6096\u4E8E\u201C\u4E00\u822C\u903B\u8F91\u201D\u8BBE\u8BA1\uFF0C\u4E3A\u6B64Go\u8BED\u8A00\u5C06\u8BE5\u201C\u590D\u6742\u6027\u201D\u9690\u85CF\u5728"),dn=n("code",null,"Runtime",-1),gn=s("\u4E2D\u4E86\uFF1AGo\u5F00\u53D1\u8005\u65E0\u9700\u5173\u6CE8socket\u662F\u5426\u662F non-block\u7684\uFF0C\u4E5F\u65E0\u9700\u4EB2\u81EA\u6CE8\u518C\u6587\u4EF6\u63CF\u8FF0\u7B26\u7684\u56DE\u8C03\uFF0C\u53EA\u9700\u5728\u6BCF\u4E2A\u8FDE\u63A5\u5BF9\u5E94\u7684goroutine\u4E2D\u4EE5**\u201Cblock I/O\u201D**\u7684\u65B9\u5F0F\u5BF9\u5F85socket\u5904\u7406\u5373\u53EF\uFF0C\u8FD9\u53EF\u4EE5\u8BF4\u5927\u5927\u964D\u4F4E\u4E86\u5F00\u53D1\u4EBA\u5458\u7684\u5FC3\u667A\u8D1F\u62C5\u3002\u4E00\u4E2A\u5178\u578B\u7684"),fn=n("code",null,"Go server",-1),hn=s("\u7AEF\u7A0B\u5E8F\u5927\u81F4\u5982\u4E0B\uFF1A"),yn=p(`<details class="custom-container details"><summary>\u67E5\u770B\u4EE3\u7801</summary><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">//go-tcpsock/server.go</span>
<span class="token keyword">func</span> <span class="token function">handleConn</span><span class="token punctuation">(</span>c net<span class="token punctuation">.</span>Conn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">defer</span> c<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">{</span>
        <span class="token comment">// read from the connection</span>
        <span class="token comment">// ... ...</span>
        <span class="token comment">// write to the connection</span>
        <span class="token comment">//... ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    l<span class="token punctuation">,</span> err <span class="token operator">:=</span> net<span class="token punctuation">.</span><span class="token function">Listen</span><span class="token punctuation">(</span><span class="token string">&quot;tcp&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;:8888&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;listen error:&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token punctuation">{</span>
        c<span class="token punctuation">,</span> err <span class="token operator">:=</span> l<span class="token punctuation">.</span><span class="token function">Accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;accept error:&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// start a new goroutine to handle</span>
        <span class="token comment">// the new connection.</span>
        <span class="token keyword">go</span> <span class="token function">handleConn</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div></details><p>\u7528\u6237\u5C42\u773C\u4E2D\u770B\u5230\u7684goroutine\u4E2D\u7684\u201Cblock socket\u201D\uFF0C\u5B9E\u9645\u4E0A\u662F\u901A\u8FC7Go runtime\u4E2D\u7684netpoller\u901A\u8FC7Non-block socket + I/O\u591A\u8DEF\u590D\u7528\u673A\u5236\u201C\u6A21\u62DF\u201D\u51FA\u6765\u7684\uFF0C\u771F\u5B9E\u7684underlying socket\u5B9E\u9645\u4E0A\u662Fnon-block\u7684\uFF0C\u53EA\u662Fruntime\u62E6\u622A\u4E86\u5E95\u5C42socket\u7CFB\u7EDF\u8C03\u7528\u7684\u9519\u8BEF\u7801\uFF0C\u5E76\u901A\u8FC7netpoller\u548Cgoroutine \u8C03\u5EA6\u8BA9goroutine\u201C\u963B\u585E\u201D\u5728\u7528\u6237\u5C42\u5F97\u5230\u7684Socket fd\u4E0A\u3002\u6BD4\u5982\uFF1A\u5F53\u7528\u6237\u5C42\u9488\u5BF9\u67D0\u4E2Asocket fd\u53D1\u8D77read\u64CD\u4F5C\u65F6\uFF0C\u5982\u679C\u8BE5socket fd\u4E2D\u5C1A\u65E0\u6570\u636E\uFF0C\u90A3\u4E48runtime\u4F1A\u5C06\u8BE5socket fd\u52A0\u5165\u5230netpoller\u4E2D\u76D1\u542C\uFF0C\u540C\u65F6\u5BF9\u5E94\u7684goroutine\u88AB\u6302\u8D77\uFF0C\u76F4\u5230runtime\u6536\u5230socket fd \u6570\u636Eready\u7684\u901A\u77E5\uFF0Cruntime\u624D\u4F1A\u91CD\u65B0\u5524\u9192\u7B49\u5F85\u5728\u8BE5socket fd\u4E0A\u51C6\u5907read\u7684\u90A3\u4E2AGoroutine\u3002\u800C\u8FD9\u4E2A\u8FC7\u7A0B\u4ECEGoroutine\u7684\u89C6\u89D2\u6765\u770B\uFF0C\u5C31\u50CF\u662Fread\u64CD\u4F5C\u4E00\u76F4block\u5728\u90A3\u4E2Asocket fd\u4E0A\u4F3C\u7684\u3002\u5177\u4F53\u5B9E\u73B0\u7EC6\u8282\u5728\u540E\u7EED\u573A\u666F\u4E2D\u4F1A\u6709\u8865\u5145\u63CF\u8FF0\u3002</p><h2 id="\u4E8C\u3001tcp\u8FDE\u63A5\u7684\u5EFA\u7ACB" tabindex="-1"><a class="header-anchor" href="#\u4E8C\u3001tcp\u8FDE\u63A5\u7684\u5EFA\u7ACB" aria-hidden="true">#</a> \u4E8C\u3001TCP\u8FDE\u63A5\u7684\u5EFA\u7ACB</h2><p>\u4F17\u6240\u5468\u77E5\uFF0CTCP Socket\u7684\u8FDE\u63A5\u7684\u5EFA\u7ACB\u9700\u8981\u7ECF\u5386\u5BA2\u6237\u7AEF\u548C\u670D\u52A1\u7AEF\u7684\u4E09\u6B21\u63E1\u624B\u7684\u8FC7\u7A0B\u3002\u8FDE\u63A5\u5EFA\u7ACB\u8FC7\u7A0B\u4E2D\uFF0C\u670D\u52A1\u7AEF\u662F\u4E00\u4E2A\u6807\u51C6\u7684Listen + Accept\u7684\u7ED3\u6784(\u53EF\u53C2\u8003\u4E0A\u9762\u7684\u4EE3\u7801)\uFF0C\u800C\u5728\u5BA2\u6237\u7AEFGo\u8BED\u8A00\u4F7F\u7528<code>net.Dial</code>\u6216<code>DialTimeout</code>\u8FDB\u884C\u8FDE\u63A5\u5EFA\u7ACB\uFF1A</p><p>\u963B\u585EDial\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>conn<span class="token punctuation">,</span> err <span class="token operator">:=</span> net<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span><span class="token string">&quot;tcp&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;google.com:80&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token comment">//handle error</span>
<span class="token punctuation">}</span>
<span class="token comment">// read or write on conn</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u6216\u662F\u5E26\u4E0A\u8D85\u65F6\u673A\u5236\u7684Dial\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>conn<span class="token punctuation">,</span> err <span class="token operator">:=</span> net<span class="token punctuation">.</span><span class="token function">DialTimeout</span><span class="token punctuation">(</span><span class="token string">&quot;tcp&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;:8080&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token comment">//handle error</span>
<span class="token punctuation">}</span>
<span class="token comment">// read or write on conn</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><hr><h3 id="\u5BF9\u4E8E\u5BA2\u6237\u7AEF\u800C\u8A00-\u8FDE\u63A5\u7684\u5EFA\u7ACB\u4F1A\u9047\u5230\u5982\u4E0B\u51E0\u79CD\u60C5\u5F62" tabindex="-1"><a class="header-anchor" href="#\u5BF9\u4E8E\u5BA2\u6237\u7AEF\u800C\u8A00-\u8FDE\u63A5\u7684\u5EFA\u7ACB\u4F1A\u9047\u5230\u5982\u4E0B\u51E0\u79CD\u60C5\u5F62" aria-hidden="true">#</a> \u5BF9\u4E8E\u5BA2\u6237\u7AEF\u800C\u8A00\uFF0C\u8FDE\u63A5\u7684\u5EFA\u7ACB\u4F1A\u9047\u5230\u5982\u4E0B\u51E0\u79CD\u60C5\u5F62\uFF1A</h3><hr><h4 id="_1\u3001\u7F51\u7EDC\u4E0D\u53EF\u8FBE\u6216\u5BF9\u65B9\u670D\u52A1\u672A\u542F\u52A8" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u7F51\u7EDC\u4E0D\u53EF\u8FBE\u6216\u5BF9\u65B9\u670D\u52A1\u672A\u542F\u52A8" aria-hidden="true">#</a> 1\u3001\u7F51\u7EDC\u4E0D\u53EF\u8FBE\u6216\u5BF9\u65B9\u670D\u52A1\u672A\u542F\u52A8</h4><p>\u5982\u679C\u4F20\u7ED9Dial\u7684Addr\u662F\u53EF\u4EE5\u7ACB\u5373\u5224\u65AD\u51FA\u7F51\u7EDC\u4E0D\u53EF\u8FBE\uFF0C\u6216\u8005Addr\u4E2D\u7AEF\u53E3\u5BF9\u5E94\u7684\u670D\u52A1\u6CA1\u6709\u542F\u52A8\uFF0C\u7AEF\u53E3\u672A\u88AB\u76D1\u542C\uFF0CDial\u4F1A\u51E0\u4E4E\u7ACB\u5373\u8FD4\u56DE\u9519\u8BEF\uFF0C\u6BD4\u5982\uFF1A</p><details class="custom-container details"><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">//go-tcpsock/conn_establish/client1.go</span>
<span class="token operator">...</span> <span class="token operator">...</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;begin dial...&quot;</span><span class="token punctuation">)</span>
    conn<span class="token punctuation">,</span> err <span class="token operator">:=</span> net<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span><span class="token string">&quot;tcp&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;:8888&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;dial error:&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">defer</span> conn<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;dial ok&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>\u5982\u679C\u672C\u673A8888\u7AEF\u53E3\u672A\u6709\u670D\u52A1\u7A0B\u5E8F\u76D1\u542C\uFF0C\u90A3\u4E48\u6267\u884C\u4E0A\u9762\u7A0B\u5E8F\uFF0CDial\u4F1A\u5F88\u5FEB\u8FD4\u56DE\u9519\u8BEF\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>$<span class="token keyword">go</span> run client1<span class="token punctuation">.</span><span class="token keyword">go</span>
<span class="token number">2015</span><span class="token operator">/</span><span class="token number">11</span><span class="token operator">/</span><span class="token number">16</span> <span class="token number">14</span><span class="token punctuation">:</span><span class="token number">37</span><span class="token punctuation">:</span><span class="token number">41</span> begin dial<span class="token operator">...</span>
<span class="token number">2015</span><span class="token operator">/</span><span class="token number">11</span><span class="token operator">/</span><span class="token number">16</span> <span class="token number">14</span><span class="token punctuation">:</span><span class="token number">37</span><span class="token punctuation">:</span><span class="token number">41</span> dial <span class="token builtin">error</span><span class="token punctuation">:</span> dial tcp <span class="token punctuation">:</span><span class="token number">8888</span><span class="token punctuation">:</span> getsockopt<span class="token punctuation">:</span> connection refused
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></details><h4 id="_2\u3001\u5BF9\u65B9\u670D\u52A1\u7684listen-backlog\u6EE1" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u5BF9\u65B9\u670D\u52A1\u7684listen-backlog\u6EE1" aria-hidden="true">#</a> 2\u3001\u5BF9\u65B9\u670D\u52A1\u7684listen backlog\u6EE1</h4><p>\u8FD8\u6709\u4E00\u79CD\u573A\u666F\u5C31\u662F\u5BF9\u65B9\u670D\u52A1\u5668\u5F88\u5FD9\uFF0C\u77AC\u95F4\u6709\u5927\u91CFclient\u7AEF\u8FDE\u63A5\u5C1D\u8BD5\u5411server\u5EFA\u7ACB\uFF0Cserver\u7AEF\u7684listen backlog\u961F\u5217\u6EE1\uFF0Cserver accept\u4E0D\u53CA\u65F6((\u5373\u4FBF\u4E0Daccept\uFF0C\u90A3\u4E48\u5728backlog\u6570\u91CF\u8303\u7574\u91CC\u9762\uFF0Cconnect\u90FD\u4F1A\u662F\u6210\u529F\u7684\uFF0C\u56E0\u4E3Anew conn\u5DF2\u7ECF\u52A0\u5165\u5230server side\u7684listen queue\u4E2D\u4E86\uFF0Caccept\u53EA\u662F\u4ECEqueue\u4E2D\u53D6\u51FA\u4E00\u4E2Aconn\u800C\u5DF2)\uFF0C\u8FD9\u5C06\u5BFC\u81F4client\u7AEFDial\u963B\u585E\u3002\u6211\u4EEC\u8FD8\u662F\u901A\u8FC7\u4F8B\u5B50\u611F\u53D7Dial\u7684\u884C\u4E3A\u7279\u70B9\uFF1A</p><details class="custom-container details"><p>\u670D\u52A1\u7AEF\u4EE3\u7801\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">//go-tcpsock/conn_establish/server2.go</span>
<span class="token operator">...</span> <span class="token operator">...</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    l<span class="token punctuation">,</span> err <span class="token operator">:=</span> net<span class="token punctuation">.</span><span class="token function">Listen</span><span class="token punctuation">(</span><span class="token string">&quot;tcp&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;:8888&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;error listen:&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">defer</span> l<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;listen ok&quot;</span><span class="token punctuation">)</span>

    <span class="token keyword">var</span> i <span class="token builtin">int</span>
    <span class="token keyword">for</span> <span class="token punctuation">{</span>
        time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> l<span class="token punctuation">.</span><span class="token function">Accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;accept error:&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token punctuation">}</span>
        i<span class="token operator">++</span>
        log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d: accept a new connection\\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>\u5BA2\u6237\u7AEF\u4EE3\u7801\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">//go-tcpsock/conn_establish/client2.go</span>
<span class="token operator">...</span> <span class="token operator">...</span>
<span class="token keyword">func</span> <span class="token function">establishConn</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> net<span class="token punctuation">.</span>Conn <span class="token punctuation">{</span>
    conn<span class="token punctuation">,</span> err <span class="token operator">:=</span> net<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span><span class="token string">&quot;tcp&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;:8888&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d: dial error: %s&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span>
    <span class="token punctuation">}</span>
    log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token string">&quot;:connect to server ok&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> conn
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> sl <span class="token punctuation">[</span><span class="token punctuation">]</span>net<span class="token punctuation">.</span>Conn
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        conn <span class="token operator">:=</span> <span class="token function">establishConn</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        <span class="token keyword">if</span> conn <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            sl <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>sl<span class="token punctuation">,</span> conn<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">10000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>\u4ECE\u7A0B\u5E8F\u53EF\u4EE5\u770B\u51FA\uFF0C\u670D\u52A1\u7AEF\u5728listen\u6210\u529F\u540E\uFF0C\u6BCF\u969410s\u949Faccept\u4E00\u6B21\u3002\u5BA2\u6237\u7AEF\u5219\u662F\u4E32\u884C\u7684\u5C1D\u8BD5\u5EFA\u7ACB\u8FDE\u63A5\u3002\u8FD9\u4E24\u4E2A\u7A0B\u5E8F\u5728Darwin\u4E0B\u7684\u6267\u884C \u7ED3\u679C\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>$<span class="token keyword">go</span> run server2<span class="token punctuation">.</span><span class="token keyword">go</span>
<span class="token number">2015</span><span class="token operator">/</span><span class="token number">11</span><span class="token operator">/</span><span class="token number">16</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">55</span><span class="token punctuation">:</span><span class="token number">41</span> listen ok
<span class="token number">2015</span><span class="token operator">/</span><span class="token number">11</span><span class="token operator">/</span><span class="token number">16</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">55</span><span class="token punctuation">:</span><span class="token number">51</span> <span class="token number">1</span><span class="token punctuation">:</span> accept a <span class="token builtin">new</span> connection
<span class="token number">2015</span><span class="token operator">/</span><span class="token number">11</span><span class="token operator">/</span><span class="token number">16</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">56</span><span class="token punctuation">:</span><span class="token number">01</span> <span class="token number">2</span><span class="token punctuation">:</span> accept a <span class="token builtin">new</span> connection
<span class="token operator">...</span> <span class="token operator">...</span>

$<span class="token keyword">go</span> run client2<span class="token punctuation">.</span><span class="token keyword">go</span>
<span class="token number">2015</span><span class="token operator">/</span><span class="token number">11</span><span class="token operator">/</span><span class="token number">16</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">55</span><span class="token punctuation">:</span><span class="token number">44</span> <span class="token number">1</span> <span class="token punctuation">:</span>connect to server ok
<span class="token number">2015</span><span class="token operator">/</span><span class="token number">11</span><span class="token operator">/</span><span class="token number">16</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">55</span><span class="token punctuation">:</span><span class="token number">44</span> <span class="token number">2</span> <span class="token punctuation">:</span>connect to server ok
<span class="token number">2015</span><span class="token operator">/</span><span class="token number">11</span><span class="token operator">/</span><span class="token number">16</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">55</span><span class="token punctuation">:</span><span class="token number">44</span> <span class="token number">3</span> <span class="token punctuation">:</span>connect to server ok
<span class="token operator">...</span> <span class="token operator">...</span>

<span class="token number">2015</span><span class="token operator">/</span><span class="token number">11</span><span class="token operator">/</span><span class="token number">16</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">55</span><span class="token punctuation">:</span><span class="token number">44</span> <span class="token number">126</span> <span class="token punctuation">:</span>connect to server ok
<span class="token number">2015</span><span class="token operator">/</span><span class="token number">11</span><span class="token operator">/</span><span class="token number">16</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">55</span><span class="token punctuation">:</span><span class="token number">44</span> <span class="token number">127</span> <span class="token punctuation">:</span>connect to server ok
<span class="token number">2015</span><span class="token operator">/</span><span class="token number">11</span><span class="token operator">/</span><span class="token number">16</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">55</span><span class="token punctuation">:</span><span class="token number">44</span> <span class="token number">128</span> <span class="token punctuation">:</span>connect to server ok

<span class="token number">2015</span><span class="token operator">/</span><span class="token number">11</span><span class="token operator">/</span><span class="token number">16</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">55</span><span class="token punctuation">:</span><span class="token number">52</span> <span class="token number">129</span> <span class="token punctuation">:</span>connect to server ok
<span class="token number">2015</span><span class="token operator">/</span><span class="token number">11</span><span class="token operator">/</span><span class="token number">16</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">56</span><span class="token punctuation">:</span><span class="token number">03</span> <span class="token number">130</span> <span class="token punctuation">:</span>connect to server ok
<span class="token number">2015</span><span class="token operator">/</span><span class="token number">11</span><span class="token operator">/</span><span class="token number">16</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">56</span><span class="token punctuation">:</span><span class="token number">14</span> <span class="token number">131</span> <span class="token punctuation">:</span>connect to server ok
<span class="token operator">...</span> <span class="token operator">...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>\u53EF\u4EE5\u770B\u51FAClient\u521D\u59CB\u65F6\u6210\u529F\u5730\u4E00\u6B21\u6027\u5EFA\u7ACB\u4E86128\u4E2A\u8FDE\u63A5\uFF0C\u7136\u540E\u540E\u7EED\u6BCF\u963B\u585E\u8FD110s\u624D\u80FD\u6210\u529F\u5EFA\u7ACB\u4E00\u6761\u8FDE\u63A5\u3002\u4E5F\u5C31\u662F\u8BF4\u5728server\u7AEF backlog\u6EE1\u65F6(\u672A\u53CA\u65F6accept)\uFF0C\u5BA2\u6237\u7AEF\u5C06\u963B\u585E\u5728Dial\u4E0A\uFF0C\u76F4\u5230server\u7AEF\u8FDB\u884C\u4E00\u6B21accept\u3002\u81F3\u4E8E\u4E3A\u4EC0\u4E48\u662F128\uFF0C\u8FD9\u4E0Edarwin \u4E0B\u7684\u9ED8\u8BA4\u8BBE\u7F6E\u6709\u5173\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token variable">$sysctl</span> -a<span class="token operator">|</span><span class="token function">grep</span> kern.ipc.somaxconn
kern.ipc.somaxconn: <span class="token number">128</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u5982\u679C\u6211\u5728ubuntu 14.04\u4E0A\u8FD0\u884C\u4E0A\u8FF0server\u7A0B\u5E8F\uFF0C\u6211\u4EEC\u7684client\u7AEF\u521D\u59CB\u53EF\u4EE5\u6210\u529F\u5EFA\u7ACB499\u6761\u8FDE\u63A5\u3002</p><p>\u5982\u679Cserver\u4E00\u76F4\u4E0Daccept\uFF0Cclient\u7AEF\u4F1A\u4E00\u76F4\u963B\u585E\u4E48\uFF1F\u6211\u4EEC\u53BB\u6389accept\u540E\u7684\u7ED3\u679C\u662F\uFF1A\u5728Darwin\u4E0B\uFF0Cclient\u7AEF\u4F1A\u963B\u585E\u5927 \u7EA61\u5206\u591A\u949F\u624D\u4F1A\u8FD4\u56DEtimeout\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token number">2015</span><span class="token operator">/</span><span class="token number">11</span><span class="token operator">/</span><span class="token number">16</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">31</span> <span class="token number">128</span> <span class="token punctuation">:</span>connect to server ok
<span class="token number">2015</span><span class="token operator">/</span><span class="token number">11</span><span class="token operator">/</span><span class="token number">16</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">:</span><span class="token number">48</span> <span class="token number">129</span><span class="token punctuation">:</span> dial <span class="token builtin">error</span><span class="token punctuation">:</span> dial tcp <span class="token punctuation">:</span><span class="token number">8888</span><span class="token punctuation">:</span> getsockopt<span class="token punctuation">:</span> operation timed out
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u800C\u5982\u679Cserver\u8FD0\u884C\u5728ubuntu 14.04\u4E0A\uFF0Cclient\u4F3C\u4E4E\u4E00\u76F4\u963B\u585E\uFF0C\u6211\u7B49\u4E8610\u591A\u5206\u949F\u4F9D\u65E7\u6CA1\u6709\u8FD4\u56DE\u3002 \u963B\u585E\u4E0E\u5426\u770B\u6765\u4E0Eserver\u7AEF\u7684\u7F51\u7EDC\u5B9E\u73B0\u548C\u8BBE\u7F6E\u6709\u5173\u3002</p><blockquote><p>tips: \u7ECF\u6D4B\u8BD5\uFF0C\u786E\u5B9E\u77AC\u95F4\u8FDE\u63A5\u7684\u6210\u529F\u91CF\u4E0D\u4E00\u6837\uFF0C\u6211\u7684\u662F201.</p></blockquote></details><h4 id="_3\u3001\u7F51\u7EDC\u5EF6\u8FDF\u8F83\u5927-dial\u963B\u585E\u5E76\u8D85\u65F6" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u7F51\u7EDC\u5EF6\u8FDF\u8F83\u5927-dial\u963B\u585E\u5E76\u8D85\u65F6" aria-hidden="true">#</a> 3\u3001\u7F51\u7EDC\u5EF6\u8FDF\u8F83\u5927\uFF0CDial\u963B\u585E\u5E76\u8D85\u65F6</h4><p>\u5982\u679C\u7F51\u7EDC\u5EF6\u8FDF\u8F83\u5927\uFF0CTCP\u63E1\u624B\u8FC7\u7A0B\u5C06\u66F4\u52A0\u8270\u96BE\u574E\u5777\uFF08\u5404\u79CD\u4E22\u5305\uFF09\uFF0C\u65F6\u95F4\u6D88\u8017\u7684\u81EA\u7136\u4E5F\u4F1A\u66F4\u957F\u3002Dial\u8FD9\u65F6\u4F1A\u963B\u585E\uFF0C\u5982\u679C\u957F\u65F6\u95F4\u4F9D\u65E7\u65E0\u6CD5\u5EFA\u7ACB\u8FDE\u63A5\uFF0C\u5219Dial\u4E5F\u4F1A\u8FD4\u56DE\u201C getsockopt: operation timed out\u201D\u9519\u8BEF\u3002</p><hr><p>\u5728\u8FDE\u63A5\u5EFA\u7ACB\u9636\u6BB5\uFF0C\u591A\u6570\u60C5\u51B5\u4E0B\uFF0CDial\u662F\u53EF\u4EE5\u6EE1\u8DB3\u9700\u6C42\u7684\uFF0C\u5373\u4FBF\u963B\u585E\u4E00\u5C0F\u4F1A\u513F\u3002\u4F46\u5BF9\u4E8E\u67D0\u4E9B\u7A0B\u5E8F\u800C\u8A00\uFF0C\u9700\u8981\u6709\u4E25\u683C\u7684\u8FDE\u63A5\u65F6\u95F4\u9650\u5B9A\uFF0C\u5982\u679C\u4E00\u5B9A\u65F6\u95F4\u5185\u6CA1\u80FD\u6210\u529F\u5EFA\u7ACB\u8FDE\u63A5\uFF0C\u7A0B\u5E8F\u53EF\u80FD\u4F1A\u9700\u8981\u6267\u884C\u4E00\u6BB5\u201C\u5F02\u5E38\u201D\u5904\u7406\u903B\u8F91\uFF0C\u4E3A\u6B64\u6211\u4EEC\u5C31\u9700\u8981DialTimeout\u4E86\u3002\u4E0B\u9762\u7684\u4F8B\u5B50\u5C06Dial\u7684\u6700\u957F\u963B\u585E\u65F6\u95F4\u9650\u5236\u57282s\u5185\uFF0C\u8D85\u51FA\u8FD9\u4E2A\u65F6\u957F\uFF0CDial\u5C06\u8FD4\u56DEtimeout error\uFF1A</p><details class="custom-container details"><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">//go-tcpsock/conn_establish/client3.go</span>
<span class="token operator">...</span> <span class="token operator">...</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;begin dial...&quot;</span><span class="token punctuation">)</span>
    conn<span class="token punctuation">,</span> err <span class="token operator">:=</span> net<span class="token punctuation">.</span><span class="token function">DialTimeout</span><span class="token punctuation">(</span><span class="token string">&quot;tcp&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;104.236.176.96:80&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;dial error:&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">defer</span> conn<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;dial ok&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>\u6267\u884C\u7ED3\u679C\u5982\u4E0B\uFF08\u9700\u8981\u6A21\u62DF\u4E00\u4E2A\u5EF6\u8FDF\u8F83\u5927\u7684\u7F51\u7EDC\u73AF\u5883\uFF09\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>$<span class="token keyword">go</span> run client3<span class="token punctuation">.</span><span class="token keyword">go</span>
<span class="token number">2015</span><span class="token operator">/</span><span class="token number">11</span><span class="token operator">/</span><span class="token number">17</span> <span class="token number">09</span><span class="token punctuation">:</span><span class="token number">28</span><span class="token punctuation">:</span><span class="token number">34</span> begin dial<span class="token operator">...</span>
<span class="token number">2015</span><span class="token operator">/</span><span class="token number">11</span><span class="token operator">/</span><span class="token number">17</span> <span class="token number">09</span><span class="token punctuation">:</span><span class="token number">28</span><span class="token punctuation">:</span><span class="token number">36</span> dial <span class="token builtin">error</span><span class="token punctuation">:</span> dial tcp <span class="token number">104.236</span><span class="token number">.176</span><span class="token number">.96</span><span class="token punctuation">:</span><span class="token number">80</span><span class="token punctuation">:</span> i<span class="token operator">/</span>o timeout
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>\u7ECF\u672C\u4EBA\u9A8C\u8BC1\uFF0C\u786E\u5B9E\u662F\u8FD9\u6837\u7684\u7ED3\u679C\u3002</p></blockquote></details><h2 id="\u4E09\u3001socket\u8BFB\u5199" tabindex="-1"><a class="header-anchor" href="#\u4E09\u3001socket\u8BFB\u5199" aria-hidden="true">#</a> \u4E09\u3001Socket\u8BFB\u5199</h2><p>\u8FDE\u63A5\u5EFA\u7ACB\u8D77\u6765\u540E\uFF0C\u6211\u4EEC\u5C31\u8981\u5728conn\u4E0A\u8FDB\u884C\u8BFB\u5199\uFF0C\u4EE5\u5B8C\u6210\u4E1A\u52A1\u903B\u8F91\u3002\u524D\u9762\u8BF4\u8FC7Go runtime\u9690\u85CF\u4E86I/O\u591A\u8DEF\u590D\u7528\u7684\u590D\u6742\u6027\u3002\u8BED\u8A00\u4F7F\u7528\u8005\u53EA\u9700\u91C7\u7528goroutine+Block I/O\u7684\u6A21\u5F0F\u5373\u53EF\u6EE1\u8DB3\u5927\u90E8\u5206\u573A\u666F\u9700\u6C42\u3002Dial\u6210\u529F\u540E\uFF0C\u65B9\u6CD5\u8FD4\u56DE\u4E00\u4E2Anet.Conn\u63A5\u53E3\u7C7B\u578B\u53D8\u91CF\u503C\uFF0C\u8FD9\u4E2A\u63A5\u53E3\u53D8\u91CF\u7684\u52A8\u6001\u7C7B\u578B\u4E3A\u4E00\u4E2A<code>*TCPConn</code>\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">//$GOROOT/src/net/tcpsock_posix.go</span>
<span class="token keyword">type</span> TCPConn <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    conn
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>TCPConn\u5185\u5D4C\u4E86\u4E00\u4E2A<code>unexported</code>\u7C7B\u578B\uFF1A<code>conn</code>\uFF0C\u56E0\u6B64TCPConn\u201D\u7EE7\u627F\u201D\u4E86conn\u7684Read\u548CWrite\u65B9\u6CD5\uFF0C\u540E\u7EED\u901A\u8FC7Dial\u8FD4\u56DE\u503C\u8C03\u7528\u7684Write\u548CRead\u65B9\u6CD5\u5747\u662F<code>net.conn</code>\u7684\u65B9\u6CD5\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">//$GOROOT/src/net/net.go</span>
<span class="token keyword">type</span> conn <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    fd <span class="token operator">*</span>netFD
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>conn<span class="token punctuation">)</span> <span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> c <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> c<span class="token punctuation">.</span>fd <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">}</span>

<span class="token comment">// Implementation of the Conn interface.</span>

<span class="token comment">// Read implements the Conn Read method.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>conn<span class="token punctuation">)</span> <span class="token function">Read</span><span class="token punctuation">(</span>b <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token operator">!</span>c<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> syscall<span class="token punctuation">.</span>EINVAL
    <span class="token punctuation">}</span>
    n<span class="token punctuation">,</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span>fd<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> err <span class="token operator">!=</span> io<span class="token punctuation">.</span>EOF <span class="token punctuation">{</span>
        err <span class="token operator">=</span> <span class="token operator">&amp;</span>OpError<span class="token punctuation">{</span>Op<span class="token punctuation">:</span> <span class="token string">&quot;read&quot;</span><span class="token punctuation">,</span> Net<span class="token punctuation">:</span> c<span class="token punctuation">.</span>fd<span class="token punctuation">.</span>net<span class="token punctuation">,</span> Source<span class="token punctuation">:</span> c<span class="token punctuation">.</span>fd<span class="token punctuation">.</span>laddr<span class="token punctuation">,</span> Addr<span class="token punctuation">:</span> c<span class="token punctuation">.</span>fd<span class="token punctuation">.</span>raddr<span class="token punctuation">,</span> Err<span class="token punctuation">:</span> err<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> n<span class="token punctuation">,</span> err
<span class="token punctuation">}</span>

<span class="token comment">// Write implements the Conn Write method.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>conn<span class="token punctuation">)</span> <span class="token function">Write</span><span class="token punctuation">(</span>b <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token operator">!</span>c<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> syscall<span class="token punctuation">.</span>EINVAL
    <span class="token punctuation">}</span>
    n<span class="token punctuation">,</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span>fd<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        err <span class="token operator">=</span> <span class="token operator">&amp;</span>OpError<span class="token punctuation">{</span>Op<span class="token punctuation">:</span> <span class="token string">&quot;write&quot;</span><span class="token punctuation">,</span> Net<span class="token punctuation">:</span> c<span class="token punctuation">.</span>fd<span class="token punctuation">.</span>net<span class="token punctuation">,</span> Source<span class="token punctuation">:</span> c<span class="token punctuation">.</span>fd<span class="token punctuation">.</span>laddr<span class="token punctuation">,</span> Addr<span class="token punctuation">:</span> c<span class="token punctuation">.</span>fd<span class="token punctuation">.</span>raddr<span class="token punctuation">,</span> Err<span class="token punctuation">:</span> err<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> n<span class="token punctuation">,</span> err
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="conn-read" tabindex="-1"><a class="header-anchor" href="#conn-read" aria-hidden="true">#</a> <code>conn.Read</code></h3><p>\u4E0B\u9762\u6211\u4EEC\u5148\u6765\u901A\u8FC7\u51E0\u4E2A\u573A\u666F\u6765\u603B\u7ED3\u4E00\u4E0Bconn.Read\u7684\u884C\u4E3A\u7279\u70B9\u3002</p><hr><h4 id="_1\u3001socket\u4E2D\u65E0\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_1\u3001socket\u4E2D\u65E0\u6570\u636E" aria-hidden="true">#</a> 1\u3001Socket\u4E2D\u65E0\u6570\u636E</h4><p>\u8FDE\u63A5\u5EFA\u7ACB\u540E\uFF0C\u5982\u679C\u5BF9\u65B9\u672A\u53D1\u9001\u6570\u636E\u5230socket\uFF0C\u63A5\u6536\u65B9(Server)\u4F1A\u963B\u585E\u5728Read\u64CD\u4F5C\u4E0A\uFF0C\u8FD9\u548C\u524D\u9762\u63D0\u5230\u7684\u201C\u6A21\u578B\u201D\u539F\u7406\u662F\u4E00\u81F4\u7684\u3002\u6267\u884C\u8BE5Read\u64CD\u4F5C\u7684goroutine\u4E5F\u4F1A\u88AB\u6302\u8D77\u3002runtime\u4F1A\u76D1\u89C6\u8BE5socket\uFF0C\u76F4\u5230\u5176\u6709\u6570\u636E\u624D\u4F1A\u91CD\u65B0 \u8C03\u5EA6\u8BE5socket\u5BF9\u5E94\u7684Goroutine\u5B8C\u6210read\u3002</p>`,32),_n={class:"custom-container details"},wn=n("div",{class:"language-go ext-go line-numbers-mode"},[n("pre",{class:"language-go"},[n("code",null,[n("span",{class:"token keyword"},"package"),s(` main

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"("),s(`
	`),n("span",{class:"token string"},'"log"'),s(`
	`),n("span",{class:"token string"},'"net"'),s(`
`),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function"},"process"),n("span",{class:"token punctuation"},"("),s("con net"),n("span",{class:"token punctuation"},"."),s("Conn"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
	`),n("span",{class:"token keyword"},"defer"),s(" con"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Close"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"{"),s(`
		`),n("span",{class:"token keyword"},"var"),s(" buf "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"make"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token builtin"},"byte"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"128"),n("span",{class:"token punctuation"},")"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"begin--"'),n("span",{class:"token punctuation"},")"),s(`
		n`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" con"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Read"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},")"),s(`

		`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
			log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"conn read occur error: "'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
			`),n("span",{class:"token keyword"},"return"),s(`
		`),n("span",{class:"token punctuation"},"}"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Printf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"read %d bytes, content is %s\\n"'),n("span",{class:"token punctuation"},","),s(" n"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token function"},"string"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},":"),s("n"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
	listen`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" net"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Listen"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"tcp"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'":8000"'),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Fatalln"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"listen occur error: "'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`

	`),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"{"),s(`
		c`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" listen"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Accept"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
			log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"accept occur error: "'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
			`),n("span",{class:"token keyword"},"break"),s(`
		`),n("span",{class:"token punctuation"},"}"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"accept a new connection"'),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"go"),s(),n("span",{class:"token function"},"process"),n("span",{class:"token punctuation"},"("),s("c"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br"),n("span",{class:"line-number"},"32"),n("br"),n("span",{class:"line-number"},"33"),n("br"),n("span",{class:"line-number"},"34"),n("br"),n("span",{class:"line-number"},"35"),n("br"),n("span",{class:"line-number"},"36"),n("br"),n("span",{class:"line-number"},"37"),n("br"),n("span",{class:"line-number"},"38"),n("br"),n("span",{class:"line-number"},"39"),n("br")])],-1),vn=n("div",{class:"language-go ext-go line-numbers-mode"},[n("pre",{class:"language-go"},[n("code",null,[n("span",{class:"token keyword"},"package"),s(` main

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"("),s(`
	`),n("span",{class:"token string"},'"log"'),s(`
	`),n("span",{class:"token string"},'"net"'),s(`
	`),n("span",{class:"token string"},'"time"'),s(`
`),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
	log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"dial begin--"'),n("span",{class:"token punctuation"},")"),s(`
	con`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" net"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Dial"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"tcp"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'":8000"'),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"connect occur error: "'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"return"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
	`),n("span",{class:"token keyword"},"defer"),s(" con"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Close"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
	log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"dial ok"'),n("span",{class:"token punctuation"},")"),s(`
	time`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Sleep"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"100"),s(),n("span",{class:"token operator"},"*"),s(" time"),n("span",{class:"token punctuation"},"."),s("Second"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br")])],-1),xn=n("p",null,"\u8FD0\u884C\u7ED3\u679C\uFF1A",-1),Pn=n("div",{class:"language-bash ext-sh line-numbers-mode"},[n("pre",{class:"language-bash"},[n("code",null,[s("PS"),n("span",{class:"token operator"},">"),s(" go run ."),n("span",{class:"token punctuation"},"\\"),s(`server1.go
`),n("span",{class:"token number"},"2022"),s("/04/18 "),n("span",{class:"token number"},"23"),s(`:30:19 accept a new connection
`),n("span",{class:"token number"},"2022"),s("/04/18 "),n("span",{class:"token number"},"23"),s(`:30:19 begin--
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br")])],-1),Sn=n("div",{class:"language-bash ext-sh line-numbers-mode"},[n("pre",{class:"language-bash"},[n("code",null,[s("PS"),n("span",{class:"token operator"},">"),s(" go run ."),n("span",{class:"token punctuation"},"\\"),s(`client1.go
`),n("span",{class:"token number"},"2022"),s("/04/18 "),n("span",{class:"token number"},"23"),s(`:30:19 dial begin--
`),n("span",{class:"token number"},"2022"),s("/04/18 "),n("span",{class:"token number"},"23"),s(`:30:19 dial ok
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br")])],-1),Cn=n("p",null,[s("\u53EF\u4EE5\u770B\u5230"),n("code",null,"server"),s("\u7684"),n("code",null,"process"),s("\u534F\u7A0B\u5835\u585E\u5728"),n("code",null,"read"),s("\u64CD\u4F5C\u3002")],-1),Rn=n("h4",{id:"_2\u3001socket\u4E2D\u6709\u90E8\u5206\u6570\u636E",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_2\u3001socket\u4E2D\u6709\u90E8\u5206\u6570\u636E","aria-hidden":"true"},"#"),s(" 2\u3001Socket\u4E2D\u6709\u90E8\u5206\u6570\u636E")],-1),qn=n("p",null,"\u5982\u679Csocket\u4E2D\u6709\u90E8\u5206\u6570\u636E\uFF0C\u4E14\u957F\u5EA6\u5C0F\u4E8E\u4E00\u6B21Read\u64CD\u4F5C\u6240\u671F\u671B\u8BFB\u51FA\u7684\u6570\u636E\u957F\u5EA6\uFF0C\u90A3\u4E48Read\u5C06\u4F1A\u6210\u529F\u8BFB\u51FA\u8FD9\u90E8\u5206\u6570\u636E\u5E76\u8FD4\u56DE\uFF0C\u800C\u4E0D\u662F\u7B49\u5F85\u6240\u6709\u671F\u671B\u6570\u636E\u5168\u90E8\u8BFB\u53D6\u540E\u518D\u8FD4\u56DE\u3002",-1),Dn={class:"custom-container details"},On=n("div",{class:"language-go ext-go line-numbers-mode"},[n("pre",{class:"language-go"},[n("code",null,[s(`
`),n("span",{class:"token operator"},"..."),s(),n("span",{class:"token operator"},"..."),s(`
`),n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token function"},"len"),n("span",{class:"token punctuation"},"("),s("os"),n("span",{class:"token punctuation"},"."),s("Args"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"<="),s(),n("span",{class:"token number"},"1"),s(),n("span",{class:"token punctuation"},"{"),s(`
        fmt`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"usage: go run client2.go YOUR_CONTENT"'),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token keyword"},"return"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"begin dial..."'),n("span",{class:"token punctuation"},")"),s(`
    conn`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" net"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Dial"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"tcp"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'":8888"'),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
        log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"dial error:"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token keyword"},"return"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token keyword"},"defer"),s(" conn"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Close"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
    log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"dial ok"'),n("span",{class:"token punctuation"},")"),s(`

    time`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Sleep"),n("span",{class:"token punctuation"},"("),s("time"),n("span",{class:"token punctuation"},"."),s("Second "),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},")"),s(`
    data `),n("span",{class:"token operator"},":="),s(" os"),n("span",{class:"token punctuation"},"."),s("Args"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},"]"),s(`
    conn`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Write"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token function"},"byte"),n("span",{class:"token punctuation"},"("),s("data"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`

    time`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Sleep"),n("span",{class:"token punctuation"},"("),s("time"),n("span",{class:"token punctuation"},"."),s("Second "),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"10000"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br")])],-1),Wn=n("div",{class:"language-go ext-go line-numbers-mode"},[n("pre",{class:"language-go"},[n("code",null,[s(`
`),n("span",{class:"token operator"},"..."),s(),n("span",{class:"token operator"},"..."),s(`
`),n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function"},"handleConn"),n("span",{class:"token punctuation"},"("),s("c net"),n("span",{class:"token punctuation"},"."),s("Conn"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"defer"),s(" c"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Close"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token comment"},"// read from the connection"),s(`
        `),n("span",{class:"token keyword"},"var"),s(" buf "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"make"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token builtin"},"byte"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},")"),s(`
        log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"start to read from conn"'),n("span",{class:"token punctuation"},")"),s(`
        n`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" c"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Read"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
            log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"conn read error:"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
            `),n("span",{class:"token keyword"},"return"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
        log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Printf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"read %d bytes, content is %s\\n"'),n("span",{class:"token punctuation"},","),s(" n"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token function"},"string"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},":"),s("n"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token operator"},"..."),s(),n("span",{class:"token operator"},"..."),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br")])],-1),Fn=s(" \u8FD0\u884C\u7ED3\u679C: "),An=n("p",null,[n("img",{src:m,alt:"image-20220418235005495"})],-1),En=n("blockquote",null,[n("p",null,[s("Client\u5411socket\u4E2D\u5199\u5165\u4E94\u4E2A\u5B57\u8282\u6570\u636E(\u201C"),n("code",null,"world"),s("\u201D)\uFF0CServer\u7AEF\u521B\u5EFA\u4E00\u4E2A"),n("code",null,"len = 10"),s("\u7684slice\uFF0C\u7B49\u5F85Read\u5C06\u8BFB\u53D6\u7684\u6570\u636E\u653E\u5165slice\uFF1BServer\u968F\u540E\u8BFB\u53D6\u5230\u90A3\u4E94\u4E2A\u5B57\u8282\uFF1A\u201D"),n("code",null,"world"),s("\u201D\u3002Read\u6210\u529F\u8FD4\u56DE\uFF0C"),n("code",null,"n =5 \uFF0Cerr = nil"),s("\u3002")])],-1),Tn=p('<h4 id="_3\u3001socket\u4E2D\u6709\u8DB3\u591F\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_3\u3001socket\u4E2D\u6709\u8DB3\u591F\u6570\u636E" aria-hidden="true">#</a> 3\u3001Socket\u4E2D\u6709\u8DB3\u591F\u6570\u636E</h4><p>\u5982\u679Csocket\u4E2D\u6709\u6570\u636E\uFF0C\u4E14\u957F\u5EA6\u5927\u4E8E\u7B49\u4E8E\u4E00\u6B21Read\u64CD\u4F5C\u6240\u671F\u671B\u8BFB\u51FA\u7684\u6570\u636E\u957F\u5EA6\uFF0C\u90A3\u4E48Read\u5C06\u4F1A\u6210\u529F\u8BFB\u51FA\u8FD9\u90E8\u5206\u6570\u636E\u5E76\u8FD4\u56DE\u3002\u8FD9\u4E2A\u60C5\u666F\u662F\u6700\u7B26\u5408\u6211\u4EEC\u5BF9Read\u7684\u671F\u5F85\u7684\u4E86\uFF1ARead\u5C06\u7528Socket\u4E2D\u7684\u6570\u636E\u5C06\u6211\u4EEC\u4F20\u5165\u7684slice\u586B\u6EE1\u540E\u8FD4\u56DE\uFF1An = 10, err = nil\u3002</p><p>\u6211\u4EEC\u901A\u8FC7client2.go\u5411Server2\u53D1\u9001\u5982\u4E0B\u5185\u5BB9\uFF1A<code>worldsadasda</code>\uFF0C\u5219</p><blockquote><p>client\u7AEF\u53D1\u9001\u7684\u5185\u5BB9\u957F\u5EA6\u4E3A12\u4E2A\u5B57\u8282\uFF0CServer\u7AEFRead buffer\u7684\u957F\u5EA6\u4E3A10\uFF0C\u56E0\u6B64Server Read\u7B2C\u4E00\u6B21\u8FD4\u56DE\u65F6\u53EA\u4F1A\u8BFB\u53D610\u4E2A\u5B57\u8282\uFF1BSocket\u4E2D\u8FD8\u5269\u4F592\u4E2A\u5B57\u8282\u6570\u636E\uFF0CServer\u518D\u6B21Read\u65F6\u4F1A\u628A\u5269\u4F59\u6570\u636E\u8BFB\u51FA\u3002</p></blockquote><h4 id="_4\u3001socket\u5173\u95ED" tabindex="-1"><a class="header-anchor" href="#_4\u3001socket\u5173\u95ED" aria-hidden="true">#</a> 4\u3001Socket\u5173\u95ED</h4><p>\u5982\u679Cclient\u7AEF\u4E3B\u52A8\u5173\u95ED\u4E86socket\uFF0C\u90A3\u4E48Server\u7684Read\u5C06\u4F1A\u8BFB\u5230\u4EC0\u4E48\u5462\uFF1F\u8FD9\u91CC\u5206\u4E3A\u201C\u6709\u6570\u636E\u5173\u95ED\u201D\u548C\u201C\u65E0\u6570\u636E\u5173\u95ED\u201D\u3002</p><p>\u201C\u6709\u6570\u636E\u5173\u95ED\u201D\u662F\u6307\u5728client\u5173\u95ED\u65F6\uFF0Csocket\u4E2D\u8FD8\u6709server\u7AEF\u672A\u8BFB\u53D6\u7684\u6570\u636E\uFF0C\u6211\u4EEC\u5728<code>client3.go</code>\u548C<code>server3.go</code>\u4E2D\u6A21\u62DF\u8FD9\u79CD\u60C5\u51B5\uFF1A</p>',7),In={class:"custom-container details"},Gn=n("div",{class:"language-go ext-go line-numbers-mode"},[n("pre",{class:"language-go"},[n("code",null,[n("span",{class:"token keyword"},"package"),s(` main

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"("),s(`
	`),n("span",{class:"token string"},'"log"'),s(`
	`),n("span",{class:"token string"},'"net"'),s(`
	`),n("span",{class:"token string"},'"time"'),s(`
`),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function"},"handleConn"),n("span",{class:"token punctuation"},"("),s("c net"),n("span",{class:"token punctuation"},"."),s("Conn"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
	`),n("span",{class:"token keyword"},"defer"),s(" c"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Close"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"{"),s(`
		`),n("span",{class:"token comment"},"// read from the connection"),s(`
		time`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Sleep"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"10"),s(),n("span",{class:"token operator"},"*"),s(" time"),n("span",{class:"token punctuation"},"."),s("Second"),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"var"),s(" buf "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"make"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token builtin"},"byte"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},")"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"start to read from conn"'),n("span",{class:"token punctuation"},")"),s(`
		n`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" c"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Read"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
			log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"conn read error:"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
			`),n("span",{class:"token keyword"},"return"),s(`
		`),n("span",{class:"token punctuation"},"}"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Printf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"read %d bytes, content is %s\\n"'),n("span",{class:"token punctuation"},","),s(" n"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token function"},"string"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},":"),s("n"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
	l`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" net"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Listen"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"tcp"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'":8888"'),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"listen error:"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"return"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`

	`),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"{"),s(`
		c`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" l"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Accept"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
			log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"accept error:"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
			`),n("span",{class:"token keyword"},"break"),s(`
		`),n("span",{class:"token punctuation"},"}"),s(`
		`),n("span",{class:"token comment"},"// start a new goroutine to handle"),s(`
		`),n("span",{class:"token comment"},"// the new connection."),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"accept a new connection"'),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"go"),s(),n("span",{class:"token function"},"handleConn"),n("span",{class:"token punctuation"},"("),s("c"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`



`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br"),n("span",{class:"line-number"},"32"),n("br"),n("span",{class:"line-number"},"33"),n("br"),n("span",{class:"line-number"},"34"),n("br"),n("span",{class:"line-number"},"35"),n("br"),n("span",{class:"line-number"},"36"),n("br"),n("span",{class:"line-number"},"37"),n("br"),n("span",{class:"line-number"},"38"),n("br"),n("span",{class:"line-number"},"39"),n("br"),n("span",{class:"line-number"},"40"),n("br"),n("span",{class:"line-number"},"41"),n("br"),n("span",{class:"line-number"},"42"),n("br"),n("span",{class:"line-number"},"43"),n("br"),n("span",{class:"line-number"},"44"),n("br"),n("span",{class:"line-number"},"45"),n("br"),n("span",{class:"line-number"},"46"),n("br")])],-1),Nn=n("div",{class:"language-go ext-go line-numbers-mode"},[n("pre",{class:"language-go"},[n("code",null,[n("span",{class:"token keyword"},"package"),s(` main

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"("),s(`
	`),n("span",{class:"token string"},'"fmt"'),s(`
	`),n("span",{class:"token string"},'"log"'),s(`
	`),n("span",{class:"token string"},'"net"'),s(`
	`),n("span",{class:"token string"},'"os"'),s(`
	`),n("span",{class:"token string"},'"time"'),s(`
`),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
	`),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token function"},"len"),n("span",{class:"token punctuation"},"("),s("os"),n("span",{class:"token punctuation"},"."),s("Args"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"<="),s(),n("span",{class:"token number"},"1"),s(),n("span",{class:"token punctuation"},"{"),s(`
		fmt`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"usage: go run client3.go YOUR_CONTENT"'),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"return"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
	log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"begin dial..."'),n("span",{class:"token punctuation"},")"),s(`
	conn`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" net"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Dial"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"tcp"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'":8888"'),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"dial error:"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"return"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
	`),n("span",{class:"token keyword"},"defer"),s(" conn"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Close"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
	log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"dial ok"'),n("span",{class:"token punctuation"},")"),s(`

	time`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Sleep"),n("span",{class:"token punctuation"},"("),s("time"),n("span",{class:"token punctuation"},"."),s("Second "),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},")"),s(`
	data `),n("span",{class:"token operator"},":="),s(" os"),n("span",{class:"token punctuation"},"."),s("Args"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},"]"),s(`
	conn`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Write"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token function"},"byte"),n("span",{class:"token punctuation"},"("),s("data"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`


`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br")])],-1),Ln=p(`<p>\u8F93\u51FA\u7ED3\u679C</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token operator">&gt;</span> go run .<span class="token punctuation">\\</span>server3.go
<span class="token number">2022</span>/04/18 <span class="token number">23</span>:56:11 accept a new connection2022/04/18 <span class="token number">23</span>:56:21 start to <span class="token builtin class-name">read</span> from conn
<span class="token number">2022</span>/04/18 <span class="token number">23</span>:56:21 <span class="token builtin class-name">read</span> <span class="token number">5</span> bytes, content is hello
<span class="token number">2022</span>/04/18 <span class="token number">23</span>:56:31 start to <span class="token builtin class-name">read</span> from conn
<span class="token number">2022</span>/04/18 <span class="token number">23</span>:56:31 conn <span class="token builtin class-name">read</span> error: EOF


<span class="token punctuation">..</span>.

<span class="token operator">&gt;</span> go run .<span class="token punctuation">\\</span>client3.go hello
<span class="token number">2022</span>/04/18 <span class="token number">23</span>:56:11 begin dial<span class="token punctuation">..</span>.
<span class="token number">2022</span>/04/18 <span class="token number">23</span>:56:11 dial ok



</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>\u4ECE\u8F93\u51FA\u7ED3\u679C\u6765\u770B\uFF0C\u5F53client\u7AEFclose socket\u9000\u51FA\u540E\uFF0Cserver3\u4F9D\u65E7\u6CA1\u6709\u5F00\u59CBRead\uFF0C10s\u540E\u7B2C\u4E00\u6B21Read\u6210\u529F\u8BFB\u51FA\u4E865\u4E2A\u5B57\u8282\u7684\u6570\u636E\uFF0C\u5F53\u7B2C\u4E8C\u6B21Read\u65F6\uFF0C\u7531\u4E8Eclient\u7AEF socket\u5173\u95ED\uFF0CRead\u8FD4\u56DE<code>EOF error</code>\u3002</p>`,3),Bn=n("p",null,"\u901A\u8FC7\u4E0A\u9762\u8FD9\u4E2A\u4F8B\u5B50\uFF0C\u6211\u4EEC\u4E5F\u53EF\u4EE5\u731C\u6D4B\u51FA\u201C\u65E0\u6570\u636E\u5173\u95ED\u201D\u60C5\u5F62\u4E0B\u7684\u7ED3\u679C\uFF0C\u90A3\u5C31\u662FRead\u76F4\u63A5\u8FD4\u56DEEOF error\u3002",-1),Mn=n("h4",{id:"_5\u3001\u8BFB\u53D6\u64CD\u4F5C\u8D85\u65F6",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_5\u3001\u8BFB\u53D6\u64CD\u4F5C\u8D85\u65F6","aria-hidden":"true"},"#"),s(" 5\u3001\u8BFB\u53D6\u64CD\u4F5C\u8D85\u65F6")],-1),zn=n("p",null,"\u6709\u4E9B\u573A\u5408\u5BF9Read\u7684\u963B\u585E\u65F6\u95F4\u6709\u4E25\u683C\u9650\u5236\uFF0C\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B\uFF0CRead\u7684\u884C\u4E3A\u5230\u5E95\u662F\u4EC0\u4E48\u6837\u7684\u5462\uFF1F\u5728\u8FD4\u56DE\u8D85\u65F6\u9519\u8BEF\u65F6\uFF0C\u662F\u5426\u4E5F\u540C\u65F6Read\u4E86\u4E00\u90E8\u5206\u6570\u636E\u4E86\u5462\uFF1F\u8FD9\u4E2A\u5B9E\u9A8C\u6BD4\u8F83\u96BE\u4E8E\u6A21\u62DF\uFF0C\u4E0B\u9762\u7684\u6D4B\u8BD5\u7ED3\u679C\u4E5F\u672A\u5FC5\u80FD\u53CD\u6620\u51FA\u6240\u6709\u53EF\u80FD\u7ED3\u679C\u3002\u6211\u4EEC\u7F16\u5199\u4E86client4.go\u548Cserver4.go\u6765\u6A21\u62DF\u8FD9\u4E00\u60C5\u5F62\u3002",-1),Vn={class:"custom-container details"},Un=n("div",{class:"language-go ext-go line-numbers-mode"},[n("pre",{class:"language-go"},[n("code",null,[n("span",{class:"token keyword"},"package"),s(` main

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"("),s(`
	`),n("span",{class:"token string"},'"log"'),s(`
	`),n("span",{class:"token string"},'"net"'),s(`
	`),n("span",{class:"token string"},'"time"'),s(`
`),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function"},"process"),n("span",{class:"token punctuation"},"("),s("c net"),n("span",{class:"token punctuation"},"."),s("Conn"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
	`),n("span",{class:"token keyword"},"defer"),s(" c"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Close"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"{"),s(`
		`),n("span",{class:"token comment"},"// read from the connection"),s(`
		time`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Sleep"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"10"),s(),n("span",{class:"token operator"},"*"),s(" time"),n("span",{class:"token punctuation"},"."),s("Second"),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"var"),s(" buf "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"make"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token builtin"},"byte"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"65536"),n("span",{class:"token punctuation"},")"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"start to read from conn"'),n("span",{class:"token punctuation"},")"),s(`
		c`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"SetReadDeadline"),n("span",{class:"token punctuation"},"("),s("time"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Now"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Add"),n("span",{class:"token punctuation"},"("),s("time"),n("span",{class:"token punctuation"},"."),s("Microsecond "),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
		n`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" c"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Read"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
			log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Printf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"conn read %d bytes,  error: %s"'),n("span",{class:"token punctuation"},","),s(" n"),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
			`),n("span",{class:"token keyword"},"if"),s(" nerr"),n("span",{class:"token punctuation"},","),s(" ok "),n("span",{class:"token operator"},":="),s(" err"),n("span",{class:"token punctuation"},"."),n("span",{class:"token punctuation"},"("),s("net"),n("span",{class:"token punctuation"},"."),s("Error"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(" ok "),n("span",{class:"token operator"},"&&"),s(" nerr"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Timeout"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
				`),n("span",{class:"token keyword"},"continue"),s(`
			`),n("span",{class:"token punctuation"},"}"),s(`
			`),n("span",{class:"token keyword"},"return"),s(`
		`),n("span",{class:"token punctuation"},"}"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Printf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"read %d bytes, content is %s\\n"'),n("span",{class:"token punctuation"},","),s(" n"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token function"},"string"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},":"),s("n"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
	listen`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" net"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Listen"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"tcp"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'":8001"'),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"listen occurs an error"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
	`),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"{"),s(`
		con`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" listen"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Accept"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
			log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"accept occurs an error: "'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token punctuation"},"}"),s(`
		`),n("span",{class:"token keyword"},"go"),s(),n("span",{class:"token function"},"process"),n("span",{class:"token punctuation"},"("),s("con"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`



`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br"),n("span",{class:"line-number"},"32"),n("br"),n("span",{class:"line-number"},"33"),n("br"),n("span",{class:"line-number"},"34"),n("br"),n("span",{class:"line-number"},"35"),n("br"),n("span",{class:"line-number"},"36"),n("br"),n("span",{class:"line-number"},"37"),n("br"),n("span",{class:"line-number"},"38"),n("br"),n("span",{class:"line-number"},"39"),n("br"),n("span",{class:"line-number"},"40"),n("br"),n("span",{class:"line-number"},"41"),n("br"),n("span",{class:"line-number"},"42"),n("br"),n("span",{class:"line-number"},"43"),n("br"),n("span",{class:"line-number"},"44"),n("br")])],-1),$n=n("div",{class:"language-go ext-go line-numbers-mode"},[n("pre",{class:"language-go"},[n("code",null,[n("span",{class:"token keyword"},"package"),s(` main

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"("),s(`
	`),n("span",{class:"token string"},'"log"'),s(`
	`),n("span",{class:"token string"},'"net"'),s(`
	`),n("span",{class:"token string"},'"time"'),s(`
`),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
	log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"begin dial..."'),n("span",{class:"token punctuation"},")"),s(`
	conn`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" net"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Dial"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"tcp"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'":8001"'),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"dial error:"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"return"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
	`),n("span",{class:"token keyword"},"defer"),s(" conn"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Close"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
	log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"dial ok"'),n("span",{class:"token punctuation"},")"),s(`

	data `),n("span",{class:"token operator"},":="),s(),n("span",{class:"token function"},"make"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token builtin"},"byte"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"65536"),n("span",{class:"token punctuation"},")"),s(`
	conn`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Write"),n("span",{class:"token punctuation"},"("),s("data"),n("span",{class:"token punctuation"},")"),s(`

	time`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Sleep"),n("span",{class:"token punctuation"},"("),s("time"),n("span",{class:"token punctuation"},"."),s("Second "),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"10000"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`



`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br")])],-1),jn=n("p",null,"\u5728Server\u7AEF\u6211\u4EEC\u901A\u8FC7Conn\u7684SetReadDeadline\u65B9\u6CD5\u8BBE\u7F6E\u4E8610\u5FAE\u79D2\u7684\u8BFB\u8D85\u65F6\u65F6\u95F4\uFF0CServer\u7684\u6267\u884C\u7ED3\u679C\u5982\u4E0B\uFF1A",-1),Xn=n("div",{class:"language-bash ext-sh line-numbers-mode"},[n("pre",{class:"language-bash"},[n("code",null,[s(`
`),n("span",{class:"token operator"},">"),s(` go version
go version go1.17 windows/amd64


`),n("span",{class:"token operator"},">"),s(" go run ."),n("span",{class:"token punctuation"},"\\"),s(`server4.go
`),n("span",{class:"token number"},"2022"),s("/04/20 "),n("span",{class:"token number"},"22"),s(":26:30 start to "),n("span",{class:"token builtin class-name"},"read"),s(` from conn
`),n("span",{class:"token number"},"2022"),s("/04/20 "),n("span",{class:"token number"},"22"),s(":26:30 "),n("span",{class:"token builtin class-name"},"read"),s(),n("span",{class:"token number"},"65536"),s(` bytes, content is 
`),n("span",{class:"token number"},"2022"),s("/04/20 "),n("span",{class:"token number"},"22"),s(":26:40 start to "),n("span",{class:"token builtin class-name"},"read"),s(` from conn
`),n("span",{class:"token number"},"2022"),s("/04/20 "),n("span",{class:"token number"},"22"),s(":26:40 conn "),n("span",{class:"token builtin class-name"},"read"),s(),n("span",{class:"token number"},"0"),s(" bytes,  error: "),n("span",{class:"token builtin class-name"},"read"),s(" tcp "),n("span",{class:"token number"},"127.0"),s(".0.1:8001-"),n("span",{class:"token operator"},">"),n("span",{class:"token number"},"127.0"),s(".0.1:50548: i/o "),n("span",{class:"token function"},"timeout"),s(`
`),n("span",{class:"token number"},"2022"),s("/04/20 "),n("span",{class:"token number"},"22"),s(":26:50 start to "),n("span",{class:"token builtin class-name"},"read"),s(` from conn
`),n("span",{class:"token number"},"2022"),s("/04/20 "),n("span",{class:"token number"},"22"),s(":26:50 conn "),n("span",{class:"token builtin class-name"},"read"),s(),n("span",{class:"token number"},"0"),s(" bytes,  error: "),n("span",{class:"token builtin class-name"},"read"),s(" tcp "),n("span",{class:"token number"},"127.0"),s(".0.1:8001-"),n("span",{class:"token operator"},">"),n("span",{class:"token number"},"127.0"),s(".0.1:50548: i/o "),n("span",{class:"token function"},"timeout"),s(`
`),n("span",{class:"token number"},"2022"),s("/04/20 "),n("span",{class:"token number"},"22"),s(":27:00 start to "),n("span",{class:"token builtin class-name"},"read"),s(` from conn
`),n("span",{class:"token number"},"2022"),s("/04/20 "),n("span",{class:"token number"},"22"),s(":27:00 conn "),n("span",{class:"token builtin class-name"},"read"),s(),n("span",{class:"token number"},"0"),s(" bytes,  error: "),n("span",{class:"token builtin class-name"},"read"),s(" tcp "),n("span",{class:"token number"},"127.0"),s(".0.1:8001-"),n("span",{class:"token operator"},">"),n("span",{class:"token number"},"127.0"),s(".0.1:50548: i/o "),n("span",{class:"token function"},"timeout"),s(`
`),n("span",{class:"token number"},"2022"),s("/04/20 "),n("span",{class:"token number"},"22"),s(":27:10 start to "),n("span",{class:"token builtin class-name"},"read"),s(` from conn
`),n("span",{class:"token number"},"2022"),s("/04/20 "),n("span",{class:"token number"},"22"),s(":27:10 conn "),n("span",{class:"token builtin class-name"},"read"),s(),n("span",{class:"token number"},"0"),s(" bytes,  error: "),n("span",{class:"token builtin class-name"},"read"),s(" tcp "),n("span",{class:"token number"},"127.0"),s(".0.1:8001-"),n("span",{class:"token operator"},">"),n("span",{class:"token number"},"127.0"),s(".0.1:50548: i/o "),n("span",{class:"token function"},"timeout"),s(`
`),n("span",{class:"token number"},"2022"),s("/04/20 "),n("span",{class:"token number"},"22"),s(":27:20 start to "),n("span",{class:"token builtin class-name"},"read"),s(` from conn
`),n("span",{class:"token number"},"2022"),s("/04/20 "),n("span",{class:"token number"},"22"),s(":27:20 conn "),n("span",{class:"token builtin class-name"},"read"),s(),n("span",{class:"token number"},"0"),s(" bytes,  error: "),n("span",{class:"token builtin class-name"},"read"),s(" tcp "),n("span",{class:"token number"},"127.0"),s(".0.1:8001-"),n("span",{class:"token operator"},">"),n("span",{class:"token number"},"127.0"),s(".0.1:50548: i/o "),n("span",{class:"token function"},"timeout"),s(`

`),n("span",{class:"token builtin class-name"},"exit"),s(` status 0xc000013a

`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br")])],-1),Kn=n("div",{class:"language-bash ext-sh line-numbers-mode"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token operator"},">"),s(" go run ."),n("span",{class:"token punctuation"},"\\"),s(`client4.go
`),n("span",{class:"token number"},"2022"),s("/04/20 "),n("span",{class:"token number"},"22"),s(":26:20 begin dial"),n("span",{class:"token punctuation"},".."),s(`.
`),n("span",{class:"token number"},"2022"),s("/04/20 "),n("span",{class:"token number"},"22"),s(`:26:20 dial ok

`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br")])],-1),Yn=s(" \u7B2C\u4E00\u6B21\u8BFB\u53D6\u6240\u6709\u6570\u636E\u6210\u529F\uFF0C\u6CA1\u6709\u8D85\u65F6\u3002\u540E\u9762\u5168\u662F`read 0 bytes ... i/o timeout`,\u56E0\u4E3A`client`\u4EC5\u4EC5\u662F`sleep`\u800C\u6CA1\u6709`down`\uFF0C\u800C`server`\u4E00\u76F4\u5EF6\u65F6`10us` \u5728\u8BFB\u53D6\u3002 "),Zn=p('<hr><h3 id="conn-write" tabindex="-1"><a class="header-anchor" href="#conn-write" aria-hidden="true">#</a> <code>conn.Write</code></h3><p>\u548C\u8BFB\u76F8\u6BD4\uFF0CWrite\u9047\u5230\u7684\u60C5\u5F62\u4E00\u6837\u4E0D\u5C11\uFF0C\u6211\u4EEC\u4E5F\u9010\u4E00\u770B\u4E00\u4E0B\u3002</p><hr><h4 id="_1\u3001\u6210\u529F\u5199" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u6210\u529F\u5199" aria-hidden="true">#</a> 1\u3001\u6210\u529F\u5199</h4><p>\u524D\u9762\u4F8B\u5B50\u7740\u91CD\u4E8ERead\uFF0Cclient\u7AEF\u5728Write\u65F6\u5E76\u672A\u5224\u65ADWrite\u7684\u8FD4\u56DE\u503C\u3002\u6240\u8C13\u201C\u6210\u529F\u5199\u201D\u6307\u7684\u5C31\u662FWrite\u8C03\u7528\u8FD4\u56DE\u7684n\u4E0E\u9884\u671F\u8981\u5199\u5165\u7684\u6570\u636E\u957F\u5EA6\u76F8\u7B49\uFF0C\u4E14<code>error == nil</code>\u3002\u8FD9\u662F\u6211\u4EEC\u5728\u8C03\u7528Write\u65F6\u9047\u5230\u7684\u6700\u5E38\u89C1\u7684\u60C5\u5F62\uFF0C\u8FD9\u91CC\u4E0D\u518D\u4E3E\u4F8B\u4E86\u3002</p><h4 id="_2\u3001\u5199\u963B\u585E" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u5199\u963B\u585E" aria-hidden="true">#</a> 2\u3001\u5199\u963B\u585E</h4><p>TCP\u8FDE\u63A5\u901A\u4FE1\u4E24\u7AEF\u7684OS\u90FD\u4F1A\u4E3A\u8BE5\u8FDE\u63A5\u4FDD\u7559\u6570\u636E\u7F13\u51B2\uFF0C\u4E00\u7AEF\u8C03\u7528Write\u540E\uFF0C\u5B9E\u9645\u4E0A\u6570\u636E\u662F\u5199\u5165\u5230OS\u7684\u534F\u8BAE\u6808\u7684\u6570\u636E\u7F13\u51B2\u7684\u3002TCP\u662F\u5168\u53CC\u5DE5\u901A\u4FE1\uFF0C\u56E0\u6B64\u6BCF\u4E2A\u65B9\u5411\u90FD\u6709\u72EC\u7ACB\u7684\u6570\u636E\u7F13\u51B2\u3002\u5F53\u53D1\u9001\u65B9\u5C06\u5BF9\u65B9\u7684\u63A5\u6536\u7F13\u51B2\u533A\u4EE5\u53CA\u81EA\u8EAB\u7684\u53D1\u9001\u7F13\u51B2\u533A\u5199\u6EE1\u540E\uFF0CWrite\u5C31\u4F1A\u963B\u585E\u3002\u6211\u4EEC\u6765\u770B\u4E00\u4E2A\u4F8B\u5B50\uFF1Aclient5.go\u548Cserver.go\u3002</p>',8),Hn={class:"custom-container details"},Jn=n("div",{class:"language-go ext-go line-numbers-mode"},[n("pre",{class:"language-go"},[n("code",null,[n("span",{class:"token keyword"},"package"),s(` main

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"("),s(`
	`),n("span",{class:"token string"},'"log"'),s(`
	`),n("span",{class:"token string"},'"net"'),s(`
	`),n("span",{class:"token string"},'"time"'),s(`
`),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function"},"handleConn"),n("span",{class:"token punctuation"},"("),s("c net"),n("span",{class:"token punctuation"},"."),s("Conn"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
	`),n("span",{class:"token keyword"},"defer"),s(" c"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Close"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
	time`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Sleep"),n("span",{class:"token punctuation"},"("),s("time"),n("span",{class:"token punctuation"},"."),s("Second "),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"{"),s(`
		`),n("span",{class:"token comment"},"// read from the connection"),s(`
		time`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Sleep"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"5"),s(),n("span",{class:"token operator"},"*"),s(" time"),n("span",{class:"token punctuation"},"."),s("Second"),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"var"),s(" buf "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"make"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token builtin"},"byte"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"60000"),n("span",{class:"token punctuation"},")"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"start to read from conn"'),n("span",{class:"token punctuation"},")"),s(`
		n`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" c"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Read"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
			log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Printf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"conn read %d bytes,  error: %s"'),n("span",{class:"token punctuation"},","),s(" n"),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
			`),n("span",{class:"token keyword"},"if"),s(" nerr"),n("span",{class:"token punctuation"},","),s(" ok "),n("span",{class:"token operator"},":="),s(" err"),n("span",{class:"token punctuation"},"."),n("span",{class:"token punctuation"},"("),s("net"),n("span",{class:"token punctuation"},"."),s("Error"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(" ok "),n("span",{class:"token operator"},"&&"),s(" nerr"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Timeout"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
				`),n("span",{class:"token keyword"},"continue"),s(`
			`),n("span",{class:"token punctuation"},"}"),s(`
		`),n("span",{class:"token punctuation"},"}"),s(`

		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Printf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"read %d bytes, content is %s\\n"'),n("span",{class:"token punctuation"},","),s(" n"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token function"},"string"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},":"),s("n"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
	listen`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" net"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Listen"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"tcp"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'":8001"'),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"listen occurs an error: "'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"return"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
	`),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"{"),s(`
		con`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" listen"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Accept"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
			log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"accept occurs error: "'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
			`),n("span",{class:"token keyword"},"continue"),s(`
		`),n("span",{class:"token punctuation"},"}"),s(`
		`),n("span",{class:"token function"},"handleConn"),n("span",{class:"token punctuation"},"("),s("con"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br"),n("span",{class:"line-number"},"32"),n("br"),n("span",{class:"line-number"},"33"),n("br"),n("span",{class:"line-number"},"34"),n("br"),n("span",{class:"line-number"},"35"),n("br"),n("span",{class:"line-number"},"36"),n("br"),n("span",{class:"line-number"},"37"),n("br"),n("span",{class:"line-number"},"38"),n("br"),n("span",{class:"line-number"},"39"),n("br"),n("span",{class:"line-number"},"40"),n("br"),n("span",{class:"line-number"},"41"),n("br"),n("span",{class:"line-number"},"42"),n("br"),n("span",{class:"line-number"},"43"),n("br"),n("span",{class:"line-number"},"44"),n("br")])],-1),Qn=n("div",{class:"language-go ext-go line-numbers-mode"},[n("pre",{class:"language-go"},[n("code",null,[n("span",{class:"token keyword"},"package"),s(` main

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"("),s(`
	`),n("span",{class:"token string"},'"log"'),s(`
	`),n("span",{class:"token string"},'"net"'),s(`
	`),n("span",{class:"token string"},'"time"'),s(`
`),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
	log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"begin dial..."'),n("span",{class:"token punctuation"},")"),s(`
	conn`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" net"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Dial"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"tcp"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'":8001"'),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"dial error:"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"return"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
	`),n("span",{class:"token keyword"},"defer"),s(" conn"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Close"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
	log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"dial ok"'),n("span",{class:"token punctuation"},")"),s(`

	data `),n("span",{class:"token operator"},":="),s(),n("span",{class:"token function"},"make"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token builtin"},"byte"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"65536"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"var"),s(" total "),n("span",{class:"token builtin"},"int"),s(`
	`),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"{"),s(`
		n`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" conn"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Write"),n("span",{class:"token punctuation"},"("),s("data"),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
			total `),n("span",{class:"token operator"},"+="),s(` n
			log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Printf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"write %d bytes, error:%s\\n"'),n("span",{class:"token punctuation"},","),s(" n"),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
			`),n("span",{class:"token keyword"},"break"),s(`
		`),n("span",{class:"token punctuation"},"}"),s(`
		total `),n("span",{class:"token operator"},"+="),s(` n
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Printf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"write %d bytes this time, %d bytes in total\\n"'),n("span",{class:"token punctuation"},","),s(" n"),n("span",{class:"token punctuation"},","),s(" total"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`

	log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Printf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"write %d bytes in total\\n"'),n("span",{class:"token punctuation"},","),s(" total"),n("span",{class:"token punctuation"},")"),s(`
	time`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Sleep"),n("span",{class:"token punctuation"},"("),s("time"),n("span",{class:"token punctuation"},"."),s("Second "),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"10000"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br"),n("span",{class:"line-number"},"32"),n("br"),n("span",{class:"line-number"},"33"),n("br"),n("span",{class:"line-number"},"34"),n("br"),n("span",{class:"line-number"},"35"),n("br")])],-1),ns=n("p",null,"\u7ED3\u679C",-1),ss=n("div",{class:"language-go ext-go line-numbers-mode"},[n("pre",{class:"language-go"},[n("code",null,[n("span",{class:"token operator"},">"),s(),n("span",{class:"token keyword"},"go"),s(" run "),n("span",{class:"token punctuation"},"."),s("\\server5"),n("span",{class:"token punctuation"},"."),n("span",{class:"token keyword"},"go"),s(`
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"46"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"13"),s(` start to read from conn
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"46"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"13"),s(" read "),n("span",{class:"token number"},"60000"),s(" bytes"),n("span",{class:"token punctuation"},","),s(` content is 
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"46"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"18"),s(` start to read from conn
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"46"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"18"),s(" read "),n("span",{class:"token number"},"60000"),s(" bytes"),n("span",{class:"token punctuation"},","),s(` content is 
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"46"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"23"),s(` start to read from conn
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"46"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"23"),s(" read "),n("span",{class:"token number"},"60000"),s(" bytes"),n("span",{class:"token punctuation"},","),s(` content is 
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"46"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"28"),s(` start to read from conn
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"46"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"28"),s(" read "),n("span",{class:"token number"},"60000"),s(" bytes"),n("span",{class:"token punctuation"},","),s(` content is 
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"46"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"33"),s(` start to read from conn
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"46"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"33"),s(" read "),n("span",{class:"token number"},"60000"),s(" bytes"),n("span",{class:"token punctuation"},","),s(` content is 
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"46"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"38"),s(` start to read from conn
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"46"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"38"),s(" read "),n("span",{class:"token number"},"60000"),s(" bytes"),n("span",{class:"token punctuation"},","),s(` content is 
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"46"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"43"),s(` start to read from conn
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"46"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"43"),s(" read "),n("span",{class:"token number"},"60000"),s(" bytes"),n("span",{class:"token punctuation"},","),s(` content is 
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"46"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"48"),s(` start to read from conn
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"46"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"48"),s(" read "),n("span",{class:"token number"},"60000"),s(" bytes"),n("span",{class:"token punctuation"},","),s(` content is 
exit status `),n("span",{class:"token number"},"0xc000013a"),s(`

`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br")])],-1),as=n("div",{class:"language-go ext-go line-numbers-mode"},[n("pre",{class:"language-go"},[n("code",null,[n("span",{class:"token operator"},">"),s(),n("span",{class:"token keyword"},"go"),s(" run "),n("span",{class:"token punctuation"},"."),s("\\client5"),n("span",{class:"token punctuation"},"."),n("span",{class:"token keyword"},"go"),s(`
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"45"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"58"),s(" begin dial"),n("span",{class:"token operator"},"..."),s(`
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"45"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"58"),s(` dial ok
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"45"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"58"),s(" write "),n("span",{class:"token number"},"65536"),s(" bytes this time"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"65536"),s(` bytes in total

`),n("span",{class:"token operator"},"..."),s(`


`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"46"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"18"),s(" write "),n("span",{class:"token number"},"65536"),s(" bytes this time"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"4390912"),s(` bytes in total
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"46"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"18"),s(" write "),n("span",{class:"token number"},"65536"),s(" bytes this time"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"4456448"),s(` bytes in total
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"46"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"18"),s(" write "),n("span",{class:"token number"},"65536"),s(" bytes this time"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"4521984"),s(` bytes in total
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"46"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"18"),s(" write "),n("span",{class:"token number"},"65536"),s(" bytes this time"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"4587520"),s(` bytes in total
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"46"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"18"),s(" write "),n("span",{class:"token number"},"65536"),s(" bytes this time"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"4653056"),s(` bytes in total
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"46"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"50"),s(" write "),n("span",{class:"token number"},"0"),s(" bytes"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token builtin"},"error"),n("span",{class:"token punctuation"},":"),s("write tcp "),n("span",{class:"token number"},"127.0"),n("span",{class:"token number"},".0"),n("span",{class:"token number"},".1"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"49307"),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),n("span",{class:"token number"},"127.0"),n("span",{class:"token number"},".0"),n("span",{class:"token number"},".1"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"8001"),n("span",{class:"token punctuation"},":"),s(" wsasend"),n("span",{class:"token punctuation"},":"),s(" An existing connection was forcibly closed by the remote host"),n("span",{class:"token punctuation"},"."),s(`
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"22"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"46"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"50"),s(" write "),n("span",{class:"token number"},"4653056"),s(` bytes in total
exit status `),n("span",{class:"token number"},"0xc000013a"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br")])],-1),ts=n("blockquote",null,[n("p",null,"Server5\u5728\u524D10s\u4E2D\u5E76\u4E0DRead\u6570\u636E\uFF0C\u56E0\u6B64\u5F53client5\u4E00\u76F4\u5C1D\u8BD5\u5199\u5165\u65F6\uFF0C\u5199\u5230\u4E00\u5B9A\u91CF\u540E\u5C31\u4F1A\u53D1\u751F\u963B\u585E")],-1),es=p(`<p>\u5728Darwin\u4E0A\uFF0C\u8FD9\u4E2Asize\u5927\u7EA6\u5728<code>679468</code>bytes\u3002\u540E\u7EED\u5F53server5\u6BCF\u96945s\u8FDB\u884CRead\u65F6\uFF0COS socket\u7F13\u51B2\u533A\u817E\u51FA\u4E86\u7A7A\u95F4\uFF0Cclient5\u5C31\u53C8\u53EF\u4EE5\u5199\u5165\u4E86\uFF1A</p><h4 id="_3\u3001\u5199\u5165\u90E8\u5206\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5199\u5165\u90E8\u5206\u6570\u636E" aria-hidden="true">#</a> 3\u3001\u5199\u5165\u90E8\u5206\u6570\u636E</h4><p>Write\u64CD\u4F5C\u5B58\u5728\u5199\u5165\u90E8\u5206\u6570\u636E\u7684\u60C5\u51B5\uFF0C\u6BD4\u5982\u4E0A\u9762\u4F8B\u5B50\u4E2D\uFF0C\u5F53client\u7AEF\u8F93\u51FA\u65E5\u5FD7\u505C\u7559\u5728\u201Cwrite 65536 bytes this time, 655360 bytes in total\u201D\u65F6\uFF0C\u6211\u4EEC\u6740\u6389server5\uFF0C\u8FD9\u65F6\u6211\u4EEC\u4F1A\u770B\u5230client5\u8F93\u51FA\u4EE5\u4E0B\u65E5\u5FD7\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">..</span>.
<span class="token operator">&gt;</span> go run .<span class="token punctuation">\\</span>client5.go
<span class="token number">2022</span>/04/20 <span class="token number">22</span>:55:03 begin dial<span class="token punctuation">..</span>.
<span class="token number">2022</span>/04/20 <span class="token number">22</span>:55:03 dial ok
<span class="token punctuation">..</span>.

<span class="token number">2022</span>/04/20 <span class="token number">22</span>:55:03 <span class="token function">write</span> <span class="token number">65536</span> bytes this time, <span class="token number">2293760</span> bytes <span class="token keyword">in</span> total
<span class="token number">2022</span>/04/20 <span class="token number">22</span>:55:06 <span class="token function">write</span> <span class="token number">0</span> bytes, error:write tcp <span class="token number">127.0</span>.0.1:50077-<span class="token operator">&gt;</span><span class="token number">127.0</span>.0.1:8001: wsasend: An existing connection was forcibly closed by the remote host.
<span class="token number">2022</span>/04/20 <span class="token number">22</span>:55:06 <span class="token function">write</span> <span class="token number">2293760</span> bytes <span class="token keyword">in</span> total
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u6D4B\u8BD5\u4E86\u5F88\u591A\u6B21\uFF0C\u5E76\u6CA1\u6709\u51FA\u73B0\u4EE5\u4E0B\u7ED3\u679C\uFF0C\u53EF\u80FD\u662F\u56E0\u4E3A\u7248\u672C\u7684\u95EE\u9898\u3002</p><blockquote><p>\u663E\u7136Write\u5E76\u975E\u572865536\u8FD9\u4E2A\u5730\u65B9\u963B\u585E\u7684\uFF0C\u800C\u662F\u540E\u7EED\u53C8\u5199\u5165<strong>\u5F88\u591A\u6570\u636E</strong>\u540E\u53D1\u751F\u4E86\u963B\u585E\uFF0Cserver\u7AEFsocket\u5173\u95ED\u540E\uFF0C\u6211\u4EEC\u770B\u5230Wrote\u8FD4\u56DEer != nil\u4E14n = 24108\uFF0C\u7A0B\u5E8F\u9700\u8981\u5BF9\u8FD9\u90E8\u5206\u5199\u5165\u768424108\u5B57\u8282\u505A\u7279\u5B9A\u5904\u7406\u3002</p></blockquote><h4 id="_4\u3001\u5199\u5165\u8D85\u65F6" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u5199\u5165\u8D85\u65F6" aria-hidden="true">#</a> 4\u3001\u5199\u5165\u8D85\u65F6</h4><p>\u5982\u679C\u975E\u8981\u7ED9Write\u589E\u52A0\u4E00\u4E2A\u671F\u9650\uFF0C\u90A3\u6211\u4EEC\u53EF\u4EE5\u8C03\u7528SetWriteDeadline\u65B9\u6CD5\u3002</p>`,8),os={class:"custom-container details"},ps=n("div",{class:"language-go ext-go line-numbers-mode"},[n("pre",{class:"language-go"},[n("code",null,[n("span",{class:"token keyword"},"package"),s(` main

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"("),s(`
	`),n("span",{class:"token string"},'"log"'),s(`
	`),n("span",{class:"token string"},'"net"'),s(`
	`),n("span",{class:"token string"},'"time"'),s(`
`),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function"},"handleConn"),n("span",{class:"token punctuation"},"("),s("c net"),n("span",{class:"token punctuation"},"."),s("Conn"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
	`),n("span",{class:"token keyword"},"defer"),s(" c"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Close"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
	time`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Sleep"),n("span",{class:"token punctuation"},"("),s("time"),n("span",{class:"token punctuation"},"."),s("Second "),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"{"),s(`
		`),n("span",{class:"token comment"},"// read from the connection"),s(`
		time`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Sleep"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"5"),s(),n("span",{class:"token operator"},"*"),s(" time"),n("span",{class:"token punctuation"},"."),s("Second"),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"var"),s(" buf "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"make"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token builtin"},"byte"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"60000"),n("span",{class:"token punctuation"},")"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"start to read from conn"'),n("span",{class:"token punctuation"},")"),s(`
		n`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" c"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Read"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
			log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Printf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"conn read %d bytes,  error: %s"'),n("span",{class:"token punctuation"},","),s(" n"),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
			`),n("span",{class:"token keyword"},"if"),s(" nerr"),n("span",{class:"token punctuation"},","),s(" ok "),n("span",{class:"token operator"},":="),s(" err"),n("span",{class:"token punctuation"},"."),n("span",{class:"token punctuation"},"("),s("net"),n("span",{class:"token punctuation"},"."),s("Error"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(" ok "),n("span",{class:"token operator"},"&&"),s(" nerr"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Timeout"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
				`),n("span",{class:"token keyword"},"continue"),s(`
			`),n("span",{class:"token punctuation"},"}"),s(`
		`),n("span",{class:"token punctuation"},"}"),s(`

		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Printf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"read %d bytes, content is %s\\n"'),n("span",{class:"token punctuation"},","),s(" n"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token function"},"string"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},":"),s("n"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
	listen`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" net"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Listen"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"tcp"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'":8001"'),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"listen occurs an error: "'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"return"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
	`),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"{"),s(`
		con`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" listen"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Accept"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
			log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"accept occurs error: "'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
			`),n("span",{class:"token keyword"},"continue"),s(`
		`),n("span",{class:"token punctuation"},"}"),s(`
		`),n("span",{class:"token function"},"handleConn"),n("span",{class:"token punctuation"},"("),s("con"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br"),n("span",{class:"line-number"},"32"),n("br"),n("span",{class:"line-number"},"33"),n("br"),n("span",{class:"line-number"},"34"),n("br"),n("span",{class:"line-number"},"35"),n("br"),n("span",{class:"line-number"},"36"),n("br"),n("span",{class:"line-number"},"37"),n("br"),n("span",{class:"line-number"},"38"),n("br"),n("span",{class:"line-number"},"39"),n("br"),n("span",{class:"line-number"},"40"),n("br"),n("span",{class:"line-number"},"41"),n("br"),n("span",{class:"line-number"},"42"),n("br"),n("span",{class:"line-number"},"43"),n("br"),n("span",{class:"line-number"},"44"),n("br")])],-1),cs=n("div",{class:"language-go ext-go line-numbers-mode"},[n("pre",{class:"language-go"},[n("code",null,[n("span",{class:"token keyword"},"package"),s(` main

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"("),s(`
	`),n("span",{class:"token string"},'"log"'),s(`
	`),n("span",{class:"token string"},'"net"'),s(`
	`),n("span",{class:"token string"},'"time"'),s(`
`),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
	log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"begin dial..."'),n("span",{class:"token punctuation"},")"),s(`
	conn`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" net"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Dial"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"tcp"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'":8001"'),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"dial error:"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"return"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
	`),n("span",{class:"token keyword"},"defer"),s(" conn"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Close"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
	log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"dial ok"'),n("span",{class:"token punctuation"},")"),s(`

	data `),n("span",{class:"token operator"},":="),s(),n("span",{class:"token function"},"make"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token builtin"},"byte"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"65536"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"var"),s(" total "),n("span",{class:"token builtin"},"int"),s(`
	`),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"{"),s(`
		`),n("span",{class:"token comment"},"// \u8BBE\u7F6E\u5199\u8D85\u65F6"),s(`
		conn`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"SetWriteDeadline"),n("span",{class:"token punctuation"},"("),s(`
			time`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Now"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Add"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"10"),s(),n("span",{class:"token operator"},"*"),s(" time"),n("span",{class:"token punctuation"},"."),s("Microsecond"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
		n`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" conn"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Write"),n("span",{class:"token punctuation"},"("),s("data"),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
			total `),n("span",{class:"token operator"},"+="),s(` n
			log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Printf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"write %d bytes, error:%s\\n"'),n("span",{class:"token punctuation"},","),s(" n"),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
			`),n("span",{class:"token keyword"},"break"),s(`
		`),n("span",{class:"token punctuation"},"}"),s(`
		total `),n("span",{class:"token operator"},"+="),s(` n
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Printf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"write %d bytes this time, %d bytes in total\\n"'),n("span",{class:"token punctuation"},","),s(" n"),n("span",{class:"token punctuation"},","),s(" total"),n("span",{class:"token punctuation"},")"),s(`
		time`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Sleep"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"100"),s(),n("span",{class:"token operator"},"*"),s(" time"),n("span",{class:"token punctuation"},"."),s("Millisecond"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`

	log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Printf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"write %d bytes in total\\n"'),n("span",{class:"token punctuation"},","),s(" total"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`


`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br"),n("span",{class:"line-number"},"32"),n("br"),n("span",{class:"line-number"},"33"),n("br"),n("span",{class:"line-number"},"34"),n("br"),n("span",{class:"line-number"},"35"),n("br"),n("span",{class:"line-number"},"36"),n("br"),n("span",{class:"line-number"},"37"),n("br"),n("span",{class:"line-number"},"38"),n("br"),n("span",{class:"line-number"},"39"),n("br")])],-1),ls=n("p",null,"\u542F\u52A8server6.go\uFF0C\u542F\u52A8client6.go\uFF0C\u6211\u4EEC\u53EF\u4EE5\u770B\u5230\u5199\u5165\u8D85\u65F6\u7684\u60C5\u51B5\u4E0B\uFF0CWrite\u7684\u8FD4\u56DE\u7ED3\u679C\uFF1A",-1),us={class:"custom-container details"},rs=n("div",{class:"language-go ext-go line-numbers-mode"},[n("pre",{class:"language-go"},[n("code",null,[n("span",{class:"token operator"},">"),s(),n("span",{class:"token keyword"},"go"),s(" run "),n("span",{class:"token punctuation"},"."),s("\\client6"),n("span",{class:"token punctuation"},"."),n("span",{class:"token keyword"},"go"),s(`
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"23"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"02"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"50"),s(" begin dial"),n("span",{class:"token operator"},"..."),s(`
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"23"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"02"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"50"),s(` dial ok
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"23"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"02"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"50"),s(" write "),n("span",{class:"token number"},"65536"),s(" bytes this time"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"65536"),s(` bytes in total
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"23"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"02"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"50"),s(" write "),n("span",{class:"token number"},"65536"),s(" bytes this time"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"131072"),s(` bytes in total
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"23"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"02"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"50"),s(" write "),n("span",{class:"token number"},"65536"),s(" bytes this time"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"196608"),s(` bytes in total
`),n("span",{class:"token operator"},"..."),s(`
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"23"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"02"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"53"),s(" write "),n("span",{class:"token number"},"65536"),s(" bytes this time"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"2228224"),s(` bytes in total
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"23"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"02"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"53"),s(" write "),n("span",{class:"token number"},"65536"),s(" bytes this time"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"2293760"),s(` bytes in total
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"23"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"02"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"54"),s(" write "),n("span",{class:"token number"},"0"),s(" bytes"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token builtin"},"error"),n("span",{class:"token punctuation"},":"),s("write tcp "),n("span",{class:"token number"},"127.0"),n("span",{class:"token number"},".0"),n("span",{class:"token number"},".1"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"50553"),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),n("span",{class:"token number"},"127.0"),n("span",{class:"token number"},".0"),n("span",{class:"token number"},".1"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"8001"),n("span",{class:"token punctuation"},":"),s(" i"),n("span",{class:"token operator"},"/"),s(`o timeout
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"23"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"02"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"54"),s(" write "),n("span",{class:"token number"},"2293760"),s(` bytes in total
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br")])],-1),is=n("div",{class:"language-go ext-go line-numbers-mode"},[n("pre",{class:"language-go"},[n("code",null,[n("span",{class:"token operator"},">"),s(),n("span",{class:"token keyword"},"go"),s(" run "),n("span",{class:"token punctuation"},"."),s("\\server5"),n("span",{class:"token punctuation"},"."),n("span",{class:"token keyword"},"go"),s(`
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"23"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"03"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"05"),s(` start to read from conn
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"23"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"03"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"05"),s(" read "),n("span",{class:"token number"},"60000"),s(" bytes"),n("span",{class:"token punctuation"},","),s(` content is 
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"23"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"03"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"10"),s(` start to read from conn
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"23"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"03"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"10"),s(" read "),n("span",{class:"token number"},"60000"),s(" bytes"),n("span",{class:"token punctuation"},","),s(` content is 

`),n("span",{class:"token operator"},"..."),s(`

`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"23"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"05"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"05"),s(` start to read from conn
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"23"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"05"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"05"),s(" read "),n("span",{class:"token number"},"60000"),s(" bytes"),n("span",{class:"token punctuation"},","),s(` content is 
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"23"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"05"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"10"),s(` start to read from conn
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"23"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"05"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"10"),s(" conn read "),n("span",{class:"token number"},"0"),s(" bytes"),n("span",{class:"token punctuation"},","),s("  "),n("span",{class:"token builtin"},"error"),n("span",{class:"token punctuation"},":"),s(" read tcp "),n("span",{class:"token number"},"127.0"),n("span",{class:"token number"},".0"),n("span",{class:"token number"},".1"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"8001"),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),n("span",{class:"token number"},"127.0"),n("span",{class:"token number"},".0"),n("span",{class:"token number"},".1"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"50553"),n("span",{class:"token punctuation"},":"),s(" wsarecv"),n("span",{class:"token punctuation"},":"),s(" An existing connection was forcibly closed by the remote host"),n("span",{class:"token punctuation"},"."),s(`
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"23"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"05"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"10"),s(" read "),n("span",{class:"token number"},"0"),s(" bytes"),n("span",{class:"token punctuation"},","),s(` content is 
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"23"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"05"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"15"),s(` start to read from conn

`),n("span",{class:"token operator"},"..."),s(`

`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"23"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"06"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"25"),s(` start to read from conn
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"23"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"06"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"25"),s(" conn read "),n("span",{class:"token number"},"0"),s(" bytes"),n("span",{class:"token punctuation"},","),s("  "),n("span",{class:"token builtin"},"error"),n("span",{class:"token punctuation"},":"),s(" read tcp "),n("span",{class:"token number"},"127.0"),n("span",{class:"token number"},".0"),n("span",{class:"token number"},".1"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"8001"),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),n("span",{class:"token number"},"127.0"),n("span",{class:"token number"},".0"),n("span",{class:"token number"},".1"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"50553"),n("span",{class:"token punctuation"},":"),s(" wsarecv"),n("span",{class:"token punctuation"},":"),s(" An existing connection was forcibly closed by the remote host"),n("span",{class:"token punctuation"},"."),s(`
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"20"),s(),n("span",{class:"token number"},"23"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"06"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"25"),s(" read "),n("span",{class:"token number"},"0"),s(" bytes"),n("span",{class:"token punctuation"},","),s(` content is
exit status `),n("span",{class:"token number"},"0xc000013a"),s(`

`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br")])],-1),ks=n("p",null,"\u53EF\u4EE5\u770B\u5230\u5728\u5199\u5165\u8D85\u65F6\u65F6\uFF0C\u4F9D\u65E7\u5B58\u5728\u90E8\u5206\u6570\u636E\u5199\u5165\u7684\u60C5\u51B5\u3002",-1),bs=p('<hr><p>\u7EFC\u4E0A\u4F8B\u5B50\uFF0C\u867D\u7136<code>Go</code>\u7ED9\u6211\u4EEC\u63D0\u4F9B\u4E86\u963B\u585E<code>I/O</code>\u7684\u4FBF\u5229\uFF0C\u4F46\u5728\u8C03\u7528 <code>Read</code> \u548C <code>Write</code> \u65F6\u4F9D\u65E7\u8981\u7EFC\u5408\u9700\u8981\u65B9\u6CD5\u8FD4\u56DE\u7684<code>n</code>\u548C<code>err</code>\u7684\u7ED3\u679C\uFF0C\u4EE5\u505A\u51FA\u6B63\u786E\u5904\u7406\u3002<code>net.conn</code>\u5B9E\u73B0\u4E86<code>io.Reader</code>\u548C<code>io.Writer</code>\u63A5\u53E3\uFF0C\u56E0\u6B64\u53EF\u4EE5\u8BD5\u7528\u4E00\u4E9Bwrapper\u5305\u8FDB\u884C<code>socket</code>\u8BFB\u5199\uFF0C\u6BD4\u5982<code>bufio</code>\u5305\u4E0B\u9762\u7684<code>Writer</code>\u548C<code>Reader</code>\u3001<code>io/ioutil</code>\u4E0B\u7684\u51FD\u6570\u7B49\u3002</p><h3 id="goroutine-safe" tabindex="-1"><a class="header-anchor" href="#goroutine-safe" aria-hidden="true">#</a> Goroutine safe</h3><p>\u57FA\u4E8Egoroutine\u7684\u7F51\u7EDC\u67B6\u6784\u6A21\u578B\uFF0C\u5B58\u5728\u5728\u4E0D\u540Cgoroutine\u95F4\u5171\u4EABconn\u7684\u60C5\u51B5\uFF0C\u90A3\u4E48conn\u7684\u8BFB\u5199\u662F\u5426\u662F<code>goroutine safe</code>\u7684\u5462\uFF1F\u5728\u6DF1\u5165\u8FD9\u4E2A\u95EE\u9898\u4E4B\u524D\uFF0C\u6211\u4EEC\u5148\u4ECE\u5E94\u7528\u610F\u4E49\u4E0A\u6765\u770Bread\u64CD\u4F5C\u548Cwrite\u64CD\u4F5C\u7684goroutine-safe\u5FC5\u8981\u6027\u3002</p><p>\u5BF9\u4E8Eread\u64CD\u4F5C\u800C\u8A00\uFF0C\u7531\u4E8E <code>TCP</code> \u662F\u9762\u5411\u5B57\u8282\u6D41\uFF0C<code>conn.Read</code> \u65E0\u6CD5\u6B63\u786E\u533A\u5206\u6570\u636E\u7684\u4E1A\u52A1\u8FB9\u754C\uFF0C\u56E0\u6B64\u591A\u4E2Agoroutine\u5BF9\u540C\u4E00\u4E2Aconn\u8FDB\u884Cread\u7684\u610F\u4E49\u4E0D\u5927\uFF0Cgoroutine\u8BFB\u5230\u4E0D\u5B8C\u6574\u7684\u4E1A\u52A1\u5305\u53CD\u5012\u662F\u589E\u52A0\u4E86\u4E1A\u52A1\u5904\u7406\u7684\u96BE\u5EA6\u3002\u5BF9\u4E0E <code>Write</code> \u64CD\u4F5C\u800C\u8A00\uFF0C\u5012\u662F\u6709\u591A\u4E2A<code>goroutine</code>\u5E76\u53D1\u5199\u7684\u60C5\u51B5\u3002</p><p>\u4E0D\u8FC7conn\u8BFB\u5199\u662F\u5426goroutine-safe\u7684\u6D4B\u8BD5\u4E0D\u662F\u5F88\u597D\u505A\uFF0C\u6211\u4EEC\u5148\u6DF1\u5165\u4E00\u4E0Bruntime\u4EE3\u7801\uFF0C\u5148\u4ECE\u7406\u8BBA\u4E0A\u7ED9\u8FD9\u4E2A\u95EE\u9898\u5B9A\u4E2A\u6027\uFF1A</p>',6),ms={class:"custom-container tip"},ds=n("p",{class:"custom-container-title"},"TIP",-1),gs=s("\u6E90\u7801\u4F4D\u7F6E "),fs={href:"https://github.com/golang/go/blob/master/src/net/net.go",target:"_blank",rel:"noopener noreferrer"},hs=s("go/net.go at master \xB7 golang/go (github.com)"),ys={class:"custom-container details"},_s=p(`<p><code>net.conn</code>\u53EA\u662F<code>*netFD</code>\u7684wrapper\u7ED3\u6784\uFF0C\u6700\u7EC8Write\u548CRead\u90FD\u4F1A\u843D\u5728\u5176\u4E2D\u7684fd\u4E0A\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> conn <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    fd <span class="token operator">*</span>netFD
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div>`,2),ws=s("netFD\u5728\u4E0D\u540C\u5E73\u53F0\u4E0A\u6709\u7740\u4E0D\u540C\u7684\u5B9E\u73B0\uFF0C\u6211\u4EEC\u4EE5"),vs={href:"https://github.com/golang/go/blob/master/src/net/fd_plan9.go",target:"_blank",rel:"noopener noreferrer"},xs=s("go/fd_plan9.go at master \xB7 golang/go (github.com)"),Ps=s("\u4E2D\u7684netFD\u4E3A\u4F8B\uFF1A"),Ss=p(`<div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// Network file descriptor.</span>
<span class="token keyword">type</span> netFD <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	pfd poll<span class="token punctuation">.</span>FD

	<span class="token comment">// immutable until Close</span>
	net               <span class="token builtin">string</span>
	n                 <span class="token builtin">string</span>
	dir               <span class="token builtin">string</span>
	listen<span class="token punctuation">,</span> ctl<span class="token punctuation">,</span> data <span class="token operator">*</span>os<span class="token punctuation">.</span>File
	laddr<span class="token punctuation">,</span> raddr      Addr
	isStream          <span class="token builtin">bool</span>
<span class="token punctuation">}</span>

<span class="token operator">...</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>fd <span class="token operator">*</span>netFD<span class="token punctuation">)</span> <span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> fd <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> fd<span class="token punctuation">.</span>ctl <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>fd <span class="token operator">*</span>netFD<span class="token punctuation">)</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>fd<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	err <span class="token operator">:=</span> fd<span class="token punctuation">.</span>ctl<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> fd<span class="token punctuation">.</span>data <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> err1 <span class="token operator">:=</span> fd<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err1 <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			err <span class="token operator">=</span> err1
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> fd<span class="token punctuation">.</span>listen <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> err1 <span class="token operator">:=</span> fd<span class="token punctuation">.</span>listen<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err1 <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			err <span class="token operator">=</span> err1
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	fd<span class="token punctuation">.</span>ctl <span class="token operator">=</span> <span class="token boolean">nil</span>
	fd<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token boolean">nil</span>
	fd<span class="token punctuation">.</span>listen <span class="token operator">=</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>fd <span class="token operator">*</span>netFD<span class="token punctuation">)</span> <span class="token function">Read</span><span class="token punctuation">(</span>b <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>fd<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> fd<span class="token punctuation">.</span>data <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> syscall<span class="token punctuation">.</span>EINVAL
	<span class="token punctuation">}</span>
	n<span class="token punctuation">,</span> err <span class="token operator">=</span> fd<span class="token punctuation">.</span>pfd<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>fd<span class="token punctuation">.</span>data<span class="token punctuation">.</span>Read<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
	<span class="token keyword">if</span> fd<span class="token punctuation">.</span>net <span class="token operator">==</span> <span class="token string">&quot;udp&quot;</span> <span class="token operator">&amp;&amp;</span> err <span class="token operator">==</span> io<span class="token punctuation">.</span>EOF <span class="token punctuation">{</span>
		n <span class="token operator">=</span> <span class="token number">0</span>
		err <span class="token operator">=</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>fd <span class="token operator">*</span>netFD<span class="token punctuation">)</span> <span class="token function">Write</span><span class="token punctuation">(</span>b <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>fd<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> fd<span class="token punctuation">.</span>data <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> syscall<span class="token punctuation">.</span>EINVAL
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> fd<span class="token punctuation">.</span>pfd<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>fd<span class="token punctuation">.</span>data<span class="token punctuation">.</span>Write<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token operator">...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div>`,1),Cs=n("p",null,[n("code",null,"poll.FD")],-1),Rs={href:"https://github.com/golang/go/blob/master/src/internal/poll/fd_unix.go#L18",target:"_blank",rel:"noopener noreferrer"},qs=s("go/fd_unix.go at master \xB7 golang/go (github.com)"),Ds=p(`<div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// FD is a file descriptor. The net and os packages use this type as a</span>
<span class="token comment">// field of a larger type representing a network connection or OS file.</span>
<span class="token keyword">type</span> FD <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	<span class="token comment">// Lock sysfd and serialize access to Read and Write methods.</span>
	fdmu fdMutex

	<span class="token comment">// System file descriptor. Immutable until Close.</span>
	Sysfd <span class="token builtin">int</span>

	<span class="token comment">// I/O poller.</span>
	pd pollDesc

	<span class="token comment">// Writev cache.</span>
	iovecs <span class="token operator">*</span><span class="token punctuation">[</span><span class="token punctuation">]</span>syscall<span class="token punctuation">.</span>Iovec

	<span class="token comment">// Semaphore signaled when file is closed.</span>
	csema <span class="token builtin">uint32</span>

	<span class="token comment">// Non-zero if this file has been set to blocking mode.</span>
	isBlocking <span class="token builtin">uint32</span>

	<span class="token comment">// Whether this is a streaming descriptor, as opposed to a</span>
	<span class="token comment">// packet-based descriptor like a UDP socket. Immutable.</span>
	IsStream <span class="token builtin">bool</span>

	<span class="token comment">// Whether a zero byte read indicates EOF. This is false for a</span>
	<span class="token comment">// message based socket connection.</span>
	ZeroReadIsEOF <span class="token builtin">bool</span>

	<span class="token comment">// Whether this is a file rather than a network socket.</span>
	isFile <span class="token builtin">bool</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>\u6211\u4EEC\u770B\u5230<code>poll.FD</code>\u4E2D\u5305\u542B\u4E86<code>fdMutex</code>\u7C7B\u578B\u5B57\u6BB5\uFF0C\u4ECE\u6CE8\u91CA\u4E0A\u6765\u770B\uFF0C\u8BE5<code>fdMutex</code>\u7528\u6765\u4E32\u884C\u5316\u5BF9\u8BE5<code>netFD</code>\u5BF9\u5E94\u7684<code>sysfd</code>\u7684<code>Write</code>\u548C<code>Read</code>\u64CD\u4F5C\u3002\u4ECE\u8FD9\u4E2A\u6CE8\u91CA\u4E0A\u6765\u770B\uFF0C\u6240\u6709\u5BF9<code>conn</code>\u7684<code>Read</code>\u548C<code>Write</code>\u64CD\u4F5C\u90FD\u662F\u6709<code>fdMutex</code>\u4E92\u65A5\u7684\uFF0C\u4ECEnetFD\u7684Read\u548CWrite\u65B9\u6CD5\u7684\u5B9E\u73B0\u4E5F\u8BC1\u5B9E\u4E86\u8FD9\u4E00\u70B9\uFF1A</p>`,2),Os=n("p",null,[n("code",null,"read")],-1),Ws={href:"https://github.com/golang/go/blob/master/src/internal/poll/fd_unix.go#L143",target:"_blank",rel:"noopener noreferrer"},Fs=s("go/fd_unix.go at master \xB7 golang/go (github.com)"),As=p(`<div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>
<span class="token comment">// Read implements io.Reader.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>fd <span class="token operator">*</span>FD<span class="token punctuation">)</span> <span class="token function">Read</span><span class="token punctuation">(</span>p <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> fd<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> fd<span class="token punctuation">.</span><span class="token function">readUnlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
		<span class="token comment">// If the caller wanted a zero byte read, return immediately</span>
		<span class="token comment">// without trying (but after acquiring the readLock).</span>
		<span class="token comment">// Otherwise syscall.Read returns 0, nil which looks like</span>
		<span class="token comment">// io.EOF.</span>
		<span class="token comment">// TODO(bradfitz): make it wait for readability? (Issue 15735)</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> fd<span class="token punctuation">.</span>pd<span class="token punctuation">.</span><span class="token function">prepareRead</span><span class="token punctuation">(</span>fd<span class="token punctuation">.</span>isFile<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> fd<span class="token punctuation">.</span>IsStream <span class="token operator">&amp;&amp;</span> <span class="token function">len</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">&gt;</span> maxRW <span class="token punctuation">{</span>
		p <span class="token operator">=</span> p<span class="token punctuation">[</span><span class="token punctuation">:</span>maxRW<span class="token punctuation">]</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> <span class="token punctuation">{</span>
		n<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">ignoringEINTRIO</span><span class="token punctuation">(</span>syscall<span class="token punctuation">.</span>Read<span class="token punctuation">,</span> fd<span class="token punctuation">.</span>Sysfd<span class="token punctuation">,</span> p<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			n <span class="token operator">=</span> <span class="token number">0</span>
			<span class="token keyword">if</span> err <span class="token operator">==</span> syscall<span class="token punctuation">.</span>EAGAIN <span class="token operator">&amp;&amp;</span> fd<span class="token punctuation">.</span>pd<span class="token punctuation">.</span><span class="token function">pollable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> err <span class="token operator">=</span> fd<span class="token punctuation">.</span>pd<span class="token punctuation">.</span><span class="token function">waitRead</span><span class="token punctuation">(</span>fd<span class="token punctuation">.</span>isFile<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
					<span class="token keyword">continue</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		err <span class="token operator">=</span> fd<span class="token punctuation">.</span><span class="token function">eofError</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span> n<span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><ul><li><code>write</code></li></ul>`,2),Es={href:"https://github.com/golang/go/blob/master/src/internal/poll/fd_unix.go#L369",target:"_blank",rel:"noopener noreferrer"},Ts=s("go/fd_unix.go at master \xB7 golang/go (github.com)"),Is=p(`<div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>
<span class="token comment">// Write implements io.Writer.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>fd <span class="token operator">*</span>FD<span class="token punctuation">)</span> <span class="token function">Write</span><span class="token punctuation">(</span>p <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> fd<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> fd<span class="token punctuation">.</span><span class="token function">writeUnlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> fd<span class="token punctuation">.</span>pd<span class="token punctuation">.</span><span class="token function">prepareWrite</span><span class="token punctuation">(</span>fd<span class="token punctuation">.</span>isFile<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">var</span> nn <span class="token builtin">int</span>
	<span class="token keyword">for</span> <span class="token punctuation">{</span>
		max <span class="token operator">:=</span> <span class="token function">len</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
		<span class="token keyword">if</span> fd<span class="token punctuation">.</span>IsStream <span class="token operator">&amp;&amp;</span> max<span class="token operator">-</span>nn <span class="token operator">&gt;</span> maxRW <span class="token punctuation">{</span>
			max <span class="token operator">=</span> nn <span class="token operator">+</span> maxRW
		<span class="token punctuation">}</span>
		n<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">ignoringEINTRIO</span><span class="token punctuation">(</span>syscall<span class="token punctuation">.</span>Write<span class="token punctuation">,</span> fd<span class="token punctuation">.</span>Sysfd<span class="token punctuation">,</span> p<span class="token punctuation">[</span>nn<span class="token punctuation">:</span>max<span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> n <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
			nn <span class="token operator">+=</span> n
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> nn <span class="token operator">==</span> <span class="token function">len</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> nn<span class="token punctuation">,</span> err
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> err <span class="token operator">==</span> syscall<span class="token punctuation">.</span>EAGAIN <span class="token operator">&amp;&amp;</span> fd<span class="token punctuation">.</span>pd<span class="token punctuation">.</span><span class="token function">pollable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> err <span class="token operator">=</span> fd<span class="token punctuation">.</span>pd<span class="token punctuation">.</span><span class="token function">waitWrite</span><span class="token punctuation">(</span>fd<span class="token punctuation">.</span>isFile<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
				<span class="token keyword">continue</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> nn<span class="token punctuation">,</span> err
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> nn<span class="token punctuation">,</span> io<span class="token punctuation">.</span>ErrUnexpectedEOF
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div>`,1),Gs=p('<p>\u6BCF\u6B21<code>Write</code>\u64CD\u4F5C\u90FD\u662F\u53D7<code>lock</code>\u4FDD\u62A4\uFF0C\u76F4\u5230\u6B64\u6B21\u6570\u636E\u5168\u90E8<code>write</code>\u5B8C\u3002\u56E0\u6B64\u5728\u5E94\u7528\u5C42\u9762\uFF0C\u8981\u60F3\u4FDD\u8BC1\u591A\u4E2A<code>Goroutine</code>\u5728\u4E00\u4E2A<code>conn</code>\u4E0A<code>write</code>\u64CD\u4F5C\u7684<code>Safe</code>\uFF0C\u9700\u8981\u4E00\u6B21<code>write</code>\u5B8C\u6574\u5199\u5165\u4E00\u4E2A\u201C\u4E1A\u52A1\u5305\u201D\uFF1B\u4E00\u65E6\u5C06\u4E1A\u52A1\u5305\u7684\u5199\u5165\u62C6\u5206\u4E3A\u591A\u6B21<code>write</code>\uFF0C\u90A3\u5C31\u65E0\u6CD5\u4FDD\u8BC1\u67D0\u4E2A<code>Goroutine</code>\u7684\u67D0\u201C\u4E1A\u52A1\u5305\u201D\u6570\u636E\u5728<code>conn</code>\u53D1\u9001\u7684\u8FDE\u7EED\u6027\u3002</p><p>\u540C\u65F6\u4E5F\u53EF\u4EE5\u770B\u51FA\u5373\u4FBF\u662F<code>Read</code>\u64CD\u4F5C\uFF0C\u4E5F\u662F<code>lock</code>\u4FDD\u62A4\u7684\u3002\u591A\u4E2A<code>Goroutine</code>\u5BF9\u540C\u4E00<code>conn</code>\u7684\u5E76\u53D1\u8BFB\u4E0D\u4F1A\u51FA\u73B0\u8BFB\u51FA\u5185\u5BB9\u91CD\u53E0\u7684\u60C5\u51B5\uFF0C\u4F46\u5185\u5BB9\u65AD\u70B9\u662F\u4F9D <code>runtime</code> \u8C03\u5EA6\u6765\u968F\u673A\u786E\u5B9A\u7684\u3002\u5B58\u5728\u4E00\u4E2A\u4E1A\u52A1\u5305\u6570\u636E\uFF0C1/3\u5185\u5BB9\u88AB<code>goroutine-1</code>\u8BFB\u8D70\uFF0C\u53E6\u59162/3\u88AB\u53E6\u5916\u4E00\u4E2A<code>goroutine-2</code>\u8BFB \u8D70\u7684\u60C5\u51B5\u3002\u6BD4\u5982\u4E00\u4E2A\u5B8C\u6574\u5305\uFF1A<code>world</code>\uFF0C\u5F53goroutine\u7684<code>read slice size &lt; 5</code>\u65F6\uFF0C\u5B58\u5728\u53EF\u80FD\uFF1A\u4E00\u4E2A<code>goroutine</code>\u8BFB\u5230 \u201C<code>worl</code>\u201D,\u53E6\u5916\u4E00\u4E2A<code>goroutine</code>\u8BFB\u51FA\u201D<code>d</code>\u201D\u3002</p><h2 id="\u56DB\u3001socket\u5C5E\u6027" tabindex="-1"><a class="header-anchor" href="#\u56DB\u3001socket\u5C5E\u6027" aria-hidden="true">#</a> \u56DB\u3001Socket\u5C5E\u6027</h2><p>\u539F\u751F<code>Socket API</code>\u63D0\u4F9B\u4E86\u4E30\u5BCC\u7684<code>socket</code>\u8BBE\u7F6E\u63A5\u53E3\uFF0C\u4F46<code>Golang</code>\u6709\u81EA\u5DF1\u7684\u7F51\u7EDC\u67B6\u6784\u6A21\u578B\uFF0C<code>golang</code>\u63D0\u4F9B\u7684<code>socket options</code>\u63A5\u53E3\u4E5F\u662F\u57FA\u4E8E\u4E0A\u8FF0\u6A21\u578B\u7684\u5FC5\u8981\u7684\u5C5E\u6027\u8BBE\u7F6E\u3002\u5305\u62EC</p><ul><li>SetKeepAlive</li><li>SetKeepAlivePeriod</li><li>SetLinger</li><li>SetNoDelay \uFF08\u9ED8\u8BA4no delay\uFF09</li><li>SetWriteBuffer</li><li>SetReadBuffer</li></ul>',5),Ns=s("\u6BD4\u5982"),Ls=n("code",null,"posix \u7684socket option",-1),Bs=s(","),Ms={href:"https://github.com/golang/go/blob/master/src/net/sockopt_posix.go",target:"_blank",rel:"noopener noreferrer"},zs=s("go/sockopt_posix.go at master \xB7 golang/go (github.com)"),Vs=p('<p><img src="'+d+`" alt="image-20220421000920002"></p><p>\u4E0D\u8FC7\u4E0A\u9762\u7684Method\u662FTCPConn\u7684\uFF0C\u800C\u4E0D\u662FConn\u7684\uFF0C\u8981\u4F7F\u7528\u4E0A\u9762\u7684Method\u7684\uFF0C\u9700\u8981type assertion\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>tcpConn<span class="token punctuation">,</span> ok <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>TCPConn<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
    <span class="token comment">//error handle</span>
<span class="token punctuation">}</span>

tcpConn<span class="token punctuation">.</span><span class="token function">SetNoDelay</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u5BF9\u4E8Elistener socket, golang\u9ED8\u8BA4\u91C7\u7528\u4E86 SO_REUSEADDR\uFF0C\u8FD9\u6837\u5F53\u4F60\u91CD\u542F listener\u7A0B\u5E8F\u65F6\uFF0C\u4E0D\u4F1A\u56E0\u4E3Aaddress in use\u7684\u9519\u8BEF\u800C\u542F\u52A8\u5931\u8D25\u3002\u800C<code>listen backlog</code>\u7684\u9ED8\u8BA4\u503C\u662F\u901A\u8FC7\u83B7\u53D6\u7CFB\u7EDF\u7684\u8BBE\u7F6E\u503C\u5F97\u5230\u7684\u3002\u4E0D\u540C\u7CFB\u7EDF\u4E0D\u540C\uFF1Amac 128, linux 512\u7B49\u3002</p><p>\u6BD4\u5982linux\u7684<code>backlog</code></p><details class="custom-container details"><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// Linux stores the backlog as:</span>
<span class="token comment">//</span>
<span class="token comment">//   - uint16 in kernel version &lt; 4.1,</span>
<span class="token comment">//   - uint32 in kernel version &gt;= 4.1</span>
<span class="token comment">//</span>
<span class="token comment">// Truncate number to avoid wrapping.</span>
<span class="token comment">//</span>
<span class="token comment">// See issue 5030 and 41470.</span>
<span class="token keyword">func</span> <span class="token function">maxAckBacklog</span><span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
	major<span class="token punctuation">,</span> minor <span class="token operator">:=</span> <span class="token function">kernelVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	size <span class="token operator">:=</span> <span class="token number">16</span>
	<span class="token keyword">if</span> major <span class="token operator">&gt;</span> <span class="token number">4</span> <span class="token operator">||</span> <span class="token punctuation">(</span>major <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> minor <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		size <span class="token operator">=</span> <span class="token number">32</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">var</span> max <span class="token builtin">uint</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">&lt;&lt;</span>size <span class="token operator">-</span> <span class="token number">1</span>
	<span class="token keyword">if</span> <span class="token function">uint</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">&gt;</span> max <span class="token punctuation">{</span>
		n <span class="token operator">=</span> <span class="token function">int</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> n
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">maxListenerBacklog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
	fd<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;/proc/sys/net/core/somaxconn&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> syscall<span class="token punctuation">.</span>SOMAXCONN
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> fd<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	l<span class="token punctuation">,</span> ok <span class="token operator">:=</span> fd<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
		<span class="token keyword">return</span> syscall<span class="token punctuation">.</span>SOMAXCONN
	<span class="token punctuation">}</span>
	f <span class="token operator">:=</span> <span class="token function">getFields</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span>
	n<span class="token punctuation">,</span> <span class="token boolean">_</span><span class="token punctuation">,</span> ok <span class="token operator">:=</span> <span class="token function">dtoi</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
		<span class="token keyword">return</span> syscall<span class="token punctuation">.</span>SOMAXCONN
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> n <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">16</span><span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">maxAckBacklog</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> n
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div></details><p>\u81F3\u4E8E<code>backlog</code>\u662F\u5565\uFF0C\u53EF\u4EE5\u53C2\u8003\u8FD9\u7BC7\u6587\u7AE0\uFF0C\u641C\u7D22\u4E86\u633A\u4E45\u624D\u627E\u5230\u7684\u3002</p>`,7),Us={href:"https://blog.csdn.net/qq_31930499/article/details/103051009",target:"_blank",rel:"noopener noreferrer"},$s=s("\u4F7F\u7528Go\u548CC\u5B9E\u4F8B\u6765\u63A2\u7A76Linux TCP\u4E4Blisten backlog_Tw!light\u7684\u535A\u5BA2-CSDN\u535A\u5BA2"),js=p('<blockquote><p>\u7B80\u5355\u7406\u89E3\u4E86\u4E00\u4E0B\uFF0C\u535A\u5BA2\u4E2D\u63D0\u5230 <code>backlog</code>\u662F\u201C\u64CD\u4F5C\u7CFB\u7EDF\u5C42\u9762\u7684\u5957\u63A5\u5B57\u961F\u5217\u957F\u5EA6\u201D\uFF0C\u5E94\u8BE5\u5C31\u662F\u53EF\u4EE5\u63A5\u53D7\u7684\u6700\u5927\u8FDE\u63A5\u6570\u5427\uFF08\u4F46\u662F\u8FD8\u6CA1\u53BB\u9A8C\u8BC1\uFF09\u3002</p></blockquote><h2 id="\u4E94\u3001\u5173\u95ED\u8FDE\u63A5" tabindex="-1"><a class="header-anchor" href="#\u4E94\u3001\u5173\u95ED\u8FDE\u63A5" aria-hidden="true">#</a> \u4E94\u3001\u5173\u95ED\u8FDE\u63A5</h2><p>\u548C\u524D\u9762\u7684\u65B9\u6CD5\u76F8\u6BD4\uFF0C\u5173\u95ED\u8FDE\u63A5\u7B97\u662F\u6700\u7B80\u5355\u7684\u64CD\u4F5C\u4E86\u3002\u7531\u4E8E<code>socket</code>\u662F\u5168\u53CC\u5DE5\u7684\uFF0C<code>client</code>\u548C<code>server</code>\u7AEF\u5728\u5DF1\u65B9\u5DF2\u5173\u95ED\u7684<code>socket</code>\u548C\u5BF9\u65B9\u5173\u95ED\u7684<code>socket</code>\u4E0A\u64CD\u4F5C\u7684\u7ED3\u679C\u6709\u4E0D\u540C\u3002\u770B\u4E0B\u9762\u4F8B\u5B50\uFF1A</p>',3),Xs={class:"custom-container details"},Ks=n("div",{class:"language-go ext-go line-numbers-mode"},[n("pre",{class:"language-go"},[n("code",null,[n("span",{class:"token keyword"},"package"),s(` main

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"("),s(`
	`),n("span",{class:"token string"},'"log"'),s(`
	`),n("span",{class:"token string"},'"net"'),s(`
`),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function"},"handleConn"),n("span",{class:"token punctuation"},"("),s("c net"),n("span",{class:"token punctuation"},"."),s("Conn"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
	`),n("span",{class:"token keyword"},"defer"),s(" c"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Close"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`

	`),n("span",{class:"token comment"},"// read from the connection"),s(`
	`),n("span",{class:"token keyword"},"var"),s(" buf "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"make"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token builtin"},"byte"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},")"),s(`
	log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"start to read from conn"'),n("span",{class:"token punctuation"},")"),s(`
	n`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" c"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Read"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"conn read error:"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Printf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"read %d bytes, content is %s\\n"'),n("span",{class:"token punctuation"},","),s(" n"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token function"},"string"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},":"),s("n"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`

	n`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},"="),s(" c"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Write"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"conn write error:"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Printf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"write %d bytes, content is %s\\n"'),n("span",{class:"token punctuation"},","),s(" n"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token function"},"string"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},":"),s("n"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
	listen`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" net"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Listen"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"tcp"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'":8888"'),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
		`),n("span",{class:"token keyword"},"return"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
	log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"start to listen"'),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"{"),s(`
		con`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" listen"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Accept"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
			`),n("span",{class:"token keyword"},"return"),s(`
		`),n("span",{class:"token punctuation"},"}"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"a new connection accept"'),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token function"},"handleConn"),n("span",{class:"token punctuation"},"("),s("con"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br"),n("span",{class:"line-number"},"32"),n("br"),n("span",{class:"line-number"},"33"),n("br"),n("span",{class:"line-number"},"34"),n("br"),n("span",{class:"line-number"},"35"),n("br"),n("span",{class:"line-number"},"36"),n("br"),n("span",{class:"line-number"},"37"),n("br"),n("span",{class:"line-number"},"38"),n("br"),n("span",{class:"line-number"},"39"),n("br"),n("span",{class:"line-number"},"40"),n("br"),n("span",{class:"line-number"},"41"),n("br"),n("span",{class:"line-number"},"42"),n("br"),n("span",{class:"line-number"},"43"),n("br"),n("span",{class:"line-number"},"44"),n("br")])],-1),Ys=n("div",{class:"language-go ext-go line-numbers-mode"},[n("pre",{class:"language-go"},[n("code",null,[s(`
`),n("span",{class:"token keyword"},"package"),s(` main

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"("),s(`
	`),n("span",{class:"token string"},'"log"'),s(`
	`),n("span",{class:"token string"},'"net"'),s(`
	`),n("span",{class:"token string"},'"time"'),s(`
`),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
	log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"begin dial..."'),n("span",{class:"token punctuation"},")"),s(`
	conn`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" net"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Dial"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"tcp"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'":8888"'),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"dial error:"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"return"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
	conn`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Close"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
	log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"close ok"'),n("span",{class:"token punctuation"},")"),s(`

	`),n("span",{class:"token keyword"},"var"),s(" buf "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"make"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token builtin"},"byte"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"32"),n("span",{class:"token punctuation"},")"),s(`
	n`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" conn"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Read"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"read error:"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Printf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"read % bytes, content is %s\\n"'),n("span",{class:"token punctuation"},","),s(" n"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token function"},"string"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},":"),s("n"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`

	n`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},"="),s(" conn"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Write"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"write error:"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Printf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"write % bytes, content is %s\\n"'),n("span",{class:"token punctuation"},","),s(" n"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token function"},"string"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},":"),s("n"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`

	time`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Sleep"),n("span",{class:"token punctuation"},"("),s("time"),n("span",{class:"token punctuation"},"."),s("Second "),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"1000"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`


`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br"),n("span",{class:"line-number"},"32"),n("br"),n("span",{class:"line-number"},"33"),n("br"),n("span",{class:"line-number"},"34"),n("br"),n("span",{class:"line-number"},"35"),n("br"),n("span",{class:"line-number"},"36"),n("br"),n("span",{class:"line-number"},"37"),n("br"),n("span",{class:"line-number"},"38"),n("br")])],-1),Zs=n("p",null,"\u4E0A\u8FF0\u4F8B\u5B50\u7684\u6267\u884C\u7ED3\u679C\u5982\u4E0B\uFF1A",-1),Hs=n("div",{class:"language-go ext-go line-numbers-mode"},[n("pre",{class:"language-go"},[n("code",null,[s(`
`),n("span",{class:"token operator"},">"),s(),n("span",{class:"token keyword"},"go"),s(" run "),n("span",{class:"token punctuation"},"."),s("\\server"),n("span",{class:"token punctuation"},"."),n("span",{class:"token keyword"},"go"),s(`
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"21"),s(),n("span",{class:"token number"},"00"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"29"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"04"),s(` start to listen
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"21"),s(),n("span",{class:"token number"},"00"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"29"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"13"),s(" a "),n("span",{class:"token builtin"},"new"),s(` connection accept
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"21"),s(),n("span",{class:"token number"},"00"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"29"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"13"),s(` start to read from conn
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"21"),s(),n("span",{class:"token number"},"00"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"29"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"13"),s(" conn read "),n("span",{class:"token builtin"},"error"),n("span",{class:"token punctuation"},":"),s(` EOF
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"21"),s(),n("span",{class:"token number"},"00"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"29"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"13"),s(" write "),n("span",{class:"token number"},"10"),s(" bytes"),n("span",{class:"token punctuation"},","),s(` content is 
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"21"),s(),n("span",{class:"token number"},"00"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"29"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"37"),s(" a "),n("span",{class:"token builtin"},"new"),s(` connection accept
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"21"),s(),n("span",{class:"token number"},"00"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"29"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"37"),s(` start to read from conn
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"21"),s(),n("span",{class:"token number"},"00"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"29"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"37"),s(" conn read "),n("span",{class:"token builtin"},"error"),n("span",{class:"token punctuation"},":"),s(` EOF
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"21"),s(),n("span",{class:"token number"},"00"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"29"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"37"),s(" write "),n("span",{class:"token number"},"10"),s(" bytes"),n("span",{class:"token punctuation"},","),s(` content is 
exit status `),n("span",{class:"token number"},"0xc000013a"),s(`

`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br")])],-1),Js=n("div",{class:"language-go ext-go line-numbers-mode"},[n("pre",{class:"language-go"},[n("code",null,[n("span",{class:"token operator"},">"),s(),n("span",{class:"token keyword"},"go"),s(" run "),n("span",{class:"token punctuation"},"."),s("\\client"),n("span",{class:"token punctuation"},"."),n("span",{class:"token keyword"},"go"),s(`
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"21"),s(),n("span",{class:"token number"},"00"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"29"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"13"),s(" begin dial"),n("span",{class:"token operator"},"..."),s(`
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"21"),s(),n("span",{class:"token number"},"00"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"29"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"13"),s(),n("span",{class:"token builtin"},"close"),s(` ok
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"21"),s(),n("span",{class:"token number"},"00"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"29"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"13"),s(" read "),n("span",{class:"token builtin"},"error"),n("span",{class:"token punctuation"},":"),s(" read tcp "),n("span",{class:"token number"},"127.0"),n("span",{class:"token number"},".0"),n("span",{class:"token number"},".1"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"61459"),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),n("span",{class:"token number"},"127.0"),n("span",{class:"token number"},".0"),n("span",{class:"token number"},".1"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"8888"),n("span",{class:"token punctuation"},":"),s(` use of closed network connection
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"21"),s(),n("span",{class:"token number"},"00"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"29"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"13"),s(" write "),n("span",{class:"token builtin"},"error"),n("span",{class:"token punctuation"},":"),s(" write tcp "),n("span",{class:"token number"},"127.0"),n("span",{class:"token number"},".0"),n("span",{class:"token number"},".1"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"61459"),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),n("span",{class:"token number"},"127.0"),n("span",{class:"token number"},".0"),n("span",{class:"token number"},".1"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"8888"),n("span",{class:"token punctuation"},":"),s(` use of closed network connection
exit status `),n("span",{class:"token number"},"0xc000013a"),s(`


`),n("span",{class:"token operator"},">"),s(),n("span",{class:"token keyword"},"go"),s(" run "),n("span",{class:"token punctuation"},"."),s("\\client"),n("span",{class:"token punctuation"},"."),n("span",{class:"token keyword"},"go"),s(`
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"21"),s(),n("span",{class:"token number"},"00"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"29"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"37"),s(" begin dial"),n("span",{class:"token operator"},"..."),s(`
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"21"),s(),n("span",{class:"token number"},"00"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"29"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"37"),s(),n("span",{class:"token builtin"},"close"),s(` ok
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"21"),s(),n("span",{class:"token number"},"00"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"29"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"37"),s(" read "),n("span",{class:"token builtin"},"error"),n("span",{class:"token punctuation"},":"),s(" read tcp "),n("span",{class:"token number"},"127.0"),n("span",{class:"token number"},".0"),n("span",{class:"token number"},".1"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"61534"),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),n("span",{class:"token number"},"127.0"),n("span",{class:"token number"},".0"),n("span",{class:"token number"},".1"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"8888"),n("span",{class:"token punctuation"},":"),s(` use of closed network connection
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"21"),s(),n("span",{class:"token number"},"00"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"29"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"37"),s(" write "),n("span",{class:"token builtin"},"error"),n("span",{class:"token punctuation"},":"),s(" write tcp "),n("span",{class:"token number"},"127.0"),n("span",{class:"token number"},".0"),n("span",{class:"token number"},".1"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"61534"),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),n("span",{class:"token number"},"127.0"),n("span",{class:"token number"},".0"),n("span",{class:"token number"},".1"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"8888"),n("span",{class:"token punctuation"},":"),s(` use of closed network connection
exit status `),n("span",{class:"token number"},"0xc000013a"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br")])],-1),Qs=p("<p>\u4ECEclient1\u7684\u7ED3\u679C\u6765\u770B\uFF0C\u5728\u5DF1\u65B9\u5DF2\u7ECF\u5173\u95ED\u7684<code>socket</code>\u4E0A\u518D\u8FDB\u884C<code>read</code>\u548C<code>write</code>\u64CD\u4F5C\uFF0C\u4F1A\u5F97\u5230\u201D<code>use of closed network connection</code>\u201D error\uFF1B \u4ECE<code>server</code>\u7684\u6267\u884C\u7ED3\u679C\u6765\u770B\uFF0C\u5728\u5BF9\u65B9\u5173\u95ED\u7684<code>socket</code>\u4E0A\u6267\u884C<code>read</code>\u64CD\u4F5C\u4F1A\u5F97\u5230<code>EOF error</code>\uFF0C\u4F46<code>write</code>\u64CD\u4F5C\u4F1A\u6210\u529F\uFF0C\u56E0\u4E3A\u6570\u636E\u4F1A\u6210\u529F\u5199\u5165\u5DF1\u65B9\u7684\u5185\u6838<code>socket</code>\u7F13\u51B2\u533A\u4E2D\uFF0C\u5373\u4FBF\u6700\u7EC8\u53D1\u4E0D\u5230\u5BF9\u65B9<code>socket</code>\u7F13\u51B2\u533A\u4E86\uFF0C\u56E0\u4E3A\u5DF1\u65B9<code>socket</code>\u5E76\u672A\u5173\u95ED\u3002\u56E0\u6B64\u5F53\u53D1\u73B0\u5BF9\u65B9<code>socket</code>\u5173\u95ED\u540E\uFF0C\u5DF1\u65B9\u5E94\u8BE5\u6B63\u786E\u5408\u7406\u5904\u7406\u81EA\u5DF1\u7684<code>socket</code>\uFF0C\u518D\u7EE7\u7EED<code>write</code>\u5DF2\u7ECF\u65E0\u4EFB\u4F55\u610F\u4E49\u4E86\u3002</p><p>\u6BD4\u5982\uFF0C<code>EOF</code></p>",2),na={class:"custom-container details"},sa=n("div",{class:"language-go ext-go line-numbers-mode"},[n("pre",{class:"language-go"},[n("code",null,[n("span",{class:"token keyword"},"package"),s(` main

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"("),s(`
	`),n("span",{class:"token string"},'"errors"'),s(`
	`),n("span",{class:"token string"},'"io"'),s(`
	`),n("span",{class:"token string"},'"log"'),s(`
	`),n("span",{class:"token string"},'"net"'),s(`
`),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function"},"handleConn"),n("span",{class:"token punctuation"},"("),s("c net"),n("span",{class:"token punctuation"},"."),s("Conn"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
	`),n("span",{class:"token keyword"},"defer"),s(" c"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Close"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`

	`),n("span",{class:"token comment"},"// read from the connection"),s(`
	`),n("span",{class:"token keyword"},"var"),s(" buf "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"make"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token builtin"},"byte"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},")"),s(`
	log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"start to read from conn"'),n("span",{class:"token punctuation"},")"),s(`
	n`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" c"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Read"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
		`),n("span",{class:"token keyword"},"if"),s(" errors"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Is"),n("span",{class:"token punctuation"},"("),s("err"),n("span",{class:"token punctuation"},","),s(" io"),n("span",{class:"token punctuation"},"."),s("EOF"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
			log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"EOF occur----"'),n("span",{class:"token punctuation"},")"),s(`
			`),n("span",{class:"token keyword"},"return"),s(`
		`),n("span",{class:"token punctuation"},"}"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"conn read error:"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`

	`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Printf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"read %d bytes, content is %s\\n"'),n("span",{class:"token punctuation"},","),s(" n"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token function"},"string"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},":"),s("n"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`

	n`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},"="),s(" c"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Write"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"conn write error:"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Printf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"write %d bytes, content is %s\\n"'),n("span",{class:"token punctuation"},","),s(" n"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token function"},"string"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},":"),s("n"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
	listen`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" net"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Listen"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"tcp"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'":8888"'),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
		`),n("span",{class:"token keyword"},"return"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
	log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"start to listen"'),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"{"),s(`
		con`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" listen"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Accept"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
			`),n("span",{class:"token keyword"},"return"),s(`
		`),n("span",{class:"token punctuation"},"}"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"a new connection accept"'),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token function"},"handleConn"),n("span",{class:"token punctuation"},"("),s("con"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`


`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br"),n("span",{class:"line-number"},"32"),n("br"),n("span",{class:"line-number"},"33"),n("br"),n("span",{class:"line-number"},"34"),n("br"),n("span",{class:"line-number"},"35"),n("br"),n("span",{class:"line-number"},"36"),n("br"),n("span",{class:"line-number"},"37"),n("br"),n("span",{class:"line-number"},"38"),n("br"),n("span",{class:"line-number"},"39"),n("br"),n("span",{class:"line-number"},"40"),n("br"),n("span",{class:"line-number"},"41"),n("br"),n("span",{class:"line-number"},"42"),n("br"),n("span",{class:"line-number"},"43"),n("br"),n("span",{class:"line-number"},"44"),n("br"),n("span",{class:"line-number"},"45"),n("br"),n("span",{class:"line-number"},"46"),n("br"),n("span",{class:"line-number"},"47"),n("br"),n("span",{class:"line-number"},"48"),n("br"),n("span",{class:"line-number"},"49"),n("br"),n("span",{class:"line-number"},"50"),n("br"),n("span",{class:"line-number"},"51"),n("br"),n("span",{class:"line-number"},"52"),n("br")])],-1),aa=n("div",{class:"language-go ext-go line-numbers-mode"},[n("pre",{class:"language-go"},[n("code",null,[n("span",{class:"token keyword"},"package"),s(` main

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"("),s(`
	`),n("span",{class:"token string"},'"log"'),s(`
	`),n("span",{class:"token string"},'"net"'),s(`
	`),n("span",{class:"token string"},'"time"'),s(`
`),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
	log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"begin dial..."'),n("span",{class:"token punctuation"},")"),s(`
	conn`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" net"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Dial"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"tcp"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'":8888"'),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"dial error:"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
		`),n("span",{class:"token keyword"},"return"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`
	conn`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Close"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
	log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"close ok"'),n("span",{class:"token punctuation"},")"),s(`

	`),n("span",{class:"token keyword"},"var"),s(" buf "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"make"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token builtin"},"byte"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"32"),n("span",{class:"token punctuation"},")"),s(`
	n`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},":="),s(" conn"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Read"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"read error:"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Printf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"read % bytes, content is %s\\n"'),n("span",{class:"token punctuation"},","),s(" n"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token function"},"string"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},":"),s("n"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`

	n`),n("span",{class:"token punctuation"},","),s(" err "),n("span",{class:"token operator"},"="),s(" conn"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Write"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token keyword"},"if"),s(" err "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token boolean"},"nil"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"write error:"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
		log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Printf"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"write % bytes, content is %s\\n"'),n("span",{class:"token punctuation"},","),s(" n"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token function"},"string"),n("span",{class:"token punctuation"},"("),s("buf"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},":"),s("n"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
	`),n("span",{class:"token punctuation"},"}"),s(`

	time`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Sleep"),n("span",{class:"token punctuation"},"("),s("time"),n("span",{class:"token punctuation"},"."),s("Second "),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token number"},"1000"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br"),n("span",{class:"line-number"},"32"),n("br"),n("span",{class:"line-number"},"33"),n("br"),n("span",{class:"line-number"},"34"),n("br"),n("span",{class:"line-number"},"35"),n("br"),n("span",{class:"line-number"},"36"),n("br")])],-1),ta=n("p",null,"\u8F93\u51FA\u7ED3\u679C",-1),ea=n("div",{class:"language-go ext-go line-numbers-mode"},[n("pre",{class:"language-go"},[n("code",null,[n("span",{class:"token operator"},">"),s(),n("span",{class:"token keyword"},"go"),s(" run "),n("span",{class:"token punctuation"},"."),s("\\server"),n("span",{class:"token punctuation"},"."),n("span",{class:"token keyword"},"go"),s(`
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"21"),s(),n("span",{class:"token number"},"00"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"53"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"18"),s(` start to listen
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"21"),s(),n("span",{class:"token number"},"00"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"53"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"24"),s(" a "),n("span",{class:"token builtin"},"new"),s(` connection accept
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"21"),s(),n("span",{class:"token number"},"00"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"53"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"24"),s(` start to read from conn
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"21"),s(),n("span",{class:"token number"},"00"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"53"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"24"),s(" EOF occur"),n("span",{class:"token operator"},"--"),n("span",{class:"token operator"},"--"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br")])],-1),oa=n("div",{class:"language-go ext-go line-numbers-mode"},[n("pre",{class:"language-go"},[n("code",null,[n("span",{class:"token operator"},">"),s(),n("span",{class:"token keyword"},"go"),s(" run "),n("span",{class:"token punctuation"},"."),s("\\client"),n("span",{class:"token punctuation"},"."),n("span",{class:"token keyword"},"go"),s(`
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"21"),s(),n("span",{class:"token number"},"00"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"53"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"24"),s(" begin dial"),n("span",{class:"token operator"},"..."),s(`
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"21"),s(),n("span",{class:"token number"},"00"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"53"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"24"),s(),n("span",{class:"token builtin"},"close"),s(` ok
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"21"),s(),n("span",{class:"token number"},"00"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"53"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"24"),s(" read "),n("span",{class:"token builtin"},"error"),n("span",{class:"token punctuation"},":"),s(" read tcp "),n("span",{class:"token number"},"127.0"),n("span",{class:"token number"},".0"),n("span",{class:"token number"},".1"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"63470"),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),n("span",{class:"token number"},"127.0"),n("span",{class:"token number"},".0"),n("span",{class:"token number"},".1"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"8888"),n("span",{class:"token punctuation"},":"),s(` use of closed network connection
`),n("span",{class:"token number"},"2022"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"04"),n("span",{class:"token operator"},"/"),n("span",{class:"token number"},"21"),s(),n("span",{class:"token number"},"00"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"53"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"24"),s(" write "),n("span",{class:"token builtin"},"error"),n("span",{class:"token punctuation"},":"),s(" write tcp "),n("span",{class:"token number"},"127.0"),n("span",{class:"token number"},".0"),n("span",{class:"token number"},".1"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"63470"),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),n("span",{class:"token number"},"127.0"),n("span",{class:"token number"},".0"),n("span",{class:"token number"},".1"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"8888"),n("span",{class:"token punctuation"},":"),s(` use of closed network connection
exit status `),n("span",{class:"token number"},"0xc000013a"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br")])],-1),pa=n("p",null,[s("\u4ECE\u8F93\u51FA\u7ED3\u679C\u6765\u770B\uFF0C\u5728\u906D\u9047"),n("code",null,"EOF"),s("\u4E4B\u540E\uFF0C"),n("code",null,"server"),s("\u4E0D\u518D"),n("code",null,"write"),s("\uFF0C\u907F\u514D\u4E86"),n("code",null,"server buf"),s(" \u7684\u6D6A\u8D39\u3002")],-1),ca=n("h2",{id:"\u516D\u3001\u5C0F\u7ED3",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u516D\u3001\u5C0F\u7ED3","aria-hidden":"true"},"#"),s(" \u516D\u3001\u5C0F\u7ED3")],-1),la=n("p",null,"\u672C\u6587\u6BD4\u8F83\u57FA\u7840\uFF0C\u4F46\u5374\u5F88\u91CD\u8981\uFF0C\u6BD5\u7ADFgolang\u662F\u9762\u5411\u5927\u89C4\u6A21\u670D\u52A1\u540E\u7AEF\u7684\uFF0C\u5BF9\u901A\u4FE1\u73AF\u8282\u7684\u7EC6\u8282\u7684\u6DF1\u5165\u7406\u89E3\u4F1A\u5927\u6709\u88E8\u76CA\u3002\u53E6\u5916Go\u7684goroutine+\u963B\u585E\u901A\u4FE1\u7684\u7F51\u7EDC\u901A\u4FE1\u6A21\u578B\u964D\u4F4E\u4E86\u5F00\u53D1\u8005\u5FC3\u667A\u8D1F\u62C5\uFF0C\u7B80\u5316\u4E86\u901A\u4FE1\u7684\u590D\u6742\u6027\uFF0C\u8FD9\u70B9\u5C24\u4E3A\u91CD\u8981\u3002",-1);function ua(ra,ia){const o=u("RouterLink"),l=u("ExternalLinkIcon"),e=u("CodeGroupItem"),c=u("CodeGroup");return i(),k(b,null,[n("nav",f,[n("ul",null,[n("li",null,[a(o,{to:"#go\u8BED\u8A00tcp-socket\u7F16\u7A0B"},{default:t(()=>[h]),_:1}),n("ul",null,[n("li",null,[a(o,{to:"#\u4E00\u3001\u6A21\u578B"},{default:t(()=>[y]),_:1})]),n("li",null,[a(o,{to:"#\u4E8C\u3001tcp\u8FDE\u63A5\u7684\u5EFA\u7ACB"},{default:t(()=>[_]),_:1}),n("ul",null,[n("li",null,[a(o,{to:"#\u5BF9\u4E8E\u5BA2\u6237\u7AEF\u800C\u8A00-\u8FDE\u63A5\u7684\u5EFA\u7ACB\u4F1A\u9047\u5230\u5982\u4E0B\u51E0\u79CD\u60C5\u5F62"},{default:t(()=>[w]),_:1}),n("ul",null,[n("li",null,[a(o,{to:"#_1\u3001\u7F51\u7EDC\u4E0D\u53EF\u8FBE\u6216\u5BF9\u65B9\u670D\u52A1\u672A\u542F\u52A8"},{default:t(()=>[v]),_:1})]),n("li",null,[a(o,{to:"#_2\u3001\u5BF9\u65B9\u670D\u52A1\u7684listen-backlog\u6EE1"},{default:t(()=>[x]),_:1})]),n("li",null,[a(o,{to:"#_3\u3001\u7F51\u7EDC\u5EF6\u8FDF\u8F83\u5927-dial\u963B\u585E\u5E76\u8D85\u65F6"},{default:t(()=>[P]),_:1})])])])])]),n("li",null,[a(o,{to:"#\u4E09\u3001socket\u8BFB\u5199"},{default:t(()=>[S]),_:1}),n("ul",null,[n("li",null,[a(o,{to:"#conn-read"},{default:t(()=>[C]),_:1}),n("ul",null,[n("li",null,[a(o,{to:"#_1\u3001socket\u4E2D\u65E0\u6570\u636E"},{default:t(()=>[R]),_:1})]),n("li",null,[a(o,{to:"#_2\u3001socket\u4E2D\u6709\u90E8\u5206\u6570\u636E"},{default:t(()=>[q]),_:1})]),n("li",null,[a(o,{to:"#_3\u3001socket\u4E2D\u6709\u8DB3\u591F\u6570\u636E"},{default:t(()=>[D]),_:1})]),n("li",null,[a(o,{to:"#_4\u3001socket\u5173\u95ED"},{default:t(()=>[O]),_:1})]),n("li",null,[a(o,{to:"#_5\u3001\u8BFB\u53D6\u64CD\u4F5C\u8D85\u65F6"},{default:t(()=>[W]),_:1})])])]),n("li",null,[a(o,{to:"#conn-write"},{default:t(()=>[F]),_:1}),n("ul",null,[n("li",null,[a(o,{to:"#_1\u3001\u6210\u529F\u5199"},{default:t(()=>[A]),_:1})]),n("li",null,[a(o,{to:"#_2\u3001\u5199\u963B\u585E"},{default:t(()=>[E]),_:1})]),n("li",null,[a(o,{to:"#_3\u3001\u5199\u5165\u90E8\u5206\u6570\u636E"},{default:t(()=>[T]),_:1})]),n("li",null,[a(o,{to:"#_4\u3001\u5199\u5165\u8D85\u65F6"},{default:t(()=>[I]),_:1})])])]),n("li",null,[a(o,{to:"#goroutine-safe"},{default:t(()=>[G]),_:1})])])]),n("li",null,[a(o,{to:"#\u56DB\u3001socket\u5C5E\u6027"},{default:t(()=>[N]),_:1})]),n("li",null,[a(o,{to:"#\u4E94\u3001\u5173\u95ED\u8FDE\u63A5"},{default:t(()=>[L]),_:1})]),n("li",null,[a(o,{to:"#\u516D\u3001\u5C0F\u7ED3"},{default:t(()=>[B]),_:1})])])])])]),M,n("div",z,[V,n("p",null,[U,n("a",$,[j,a(l)]),X])]),K,n("p",null,[Y,n("a",Z,[H,a(l)]),J,n("a",Q,[nn,a(l)]),sn]),an,tn,n("p",null,[en,n("a",on,[pn,a(l)]),cn,n("a",ln,[un,a(l)]),rn,n("a",kn,[bn,a(l)]),mn,dn,gn,fn,hn]),yn,n("details",_n,[a(c,null,{default:t(()=>[a(e,{title:"server.go",active:""},{default:t(()=>[wn]),_:1}),a(e,{title:"client.go"},{default:t(()=>[vn]),_:1})]),_:1}),xn,a(c,null,{default:t(()=>[a(e,{title:"server",active:""},{default:t(()=>[Pn]),_:1}),a(e,{title:"client"},{default:t(()=>[Sn]),_:1})]),_:1}),Cn]),Rn,qn,n("details",Dn,[a(c,null,{default:t(()=>[a(e,{title:"client2.go",active:""},{default:t(()=>[On]),_:1}),a(e,{title:"server2.go"},{default:t(()=>[Wn]),_:1})]),_:1}),Fn,An,En]),Tn,n("details",In,[a(c,null,{default:t(()=>[a(e,{title:"server3.go",active:""},{default:t(()=>[Gn]),_:1}),a(e,{title:"client3.go"},{default:t(()=>[Nn]),_:1})]),_:1}),Ln]),Bn,Mn,zn,n("details",Vn,[a(c,null,{default:t(()=>[a(e,{title:"server4.go",active:""},{default:t(()=>[Un]),_:1}),a(e,{title:"client4.go"},{default:t(()=>[$n]),_:1})]),_:1}),jn,a(c,null,{default:t(()=>[a(e,{title:"server4",active:""},{default:t(()=>[Xn]),_:1}),a(e,{title:"client4"},{default:t(()=>[Kn]),_:1})]),_:1}),Yn]),Zn,n("details",Hn,[a(c,null,{default:t(()=>[a(e,{title:"server5.go",active:""},{default:t(()=>[Jn]),_:1}),a(e,{title:"client5.go"},{default:t(()=>[Qn]),_:1})]),_:1}),ns,a(c,null,{default:t(()=>[a(e,{title:"server",active:""},{default:t(()=>[ss]),_:1}),a(e,{title:"client"},{default:t(()=>[as]),_:1})]),_:1}),ts]),es,n("details",os,[a(c,null,{default:t(()=>[a(e,{title:"server6.go",active:""},{default:t(()=>[ps]),_:1}),a(e,{title:"client6.go"},{default:t(()=>[cs]),_:1})]),_:1})]),ls,n("details",us,[a(c,null,{default:t(()=>[a(e,{title:"client",active:""},{default:t(()=>[rs]),_:1}),a(e,{title:"server"},{default:t(()=>[is]),_:1})]),_:1}),ks]),bs,n("div",ms,[ds,n("p",null,[gs,n("a",fs,[hs,a(l)])])]),n("details",ys,[_s,n("p",null,[ws,n("a",vs,[xs,a(l)]),Ps]),Ss,n("ul",null,[n("li",null,[Cs,n("p",null,[n("a",Rs,[qs,a(l)])])])]),Ds,n("ul",null,[n("li",null,[Os,n("p",null,[n("a",Ws,[Fs,a(l)])])])]),As,n("p",null,[n("a",Es,[Ts,a(l)])]),Is]),Gs,n("p",null,[Ns,Ls,Bs,n("a",Ms,[zs,a(l)])]),Vs,n("p",null,[n("a",Us,[$s,a(l)])]),js,n("details",Xs,[a(c,null,{default:t(()=>[a(e,{title:"server",active:""},{default:t(()=>[Ks]),_:1}),a(e,{title:"client"},{default:t(()=>[Ys]),_:1})]),_:1}),Zs,a(c,null,{default:t(()=>[a(e,{title:"server",active:""},{default:t(()=>[Hs]),_:1}),a(e,{title:"client"},{default:t(()=>[Js]),_:1})]),_:1})]),Qs,n("details",na,[a(c,null,{default:t(()=>[a(e,{title:"server.go",active:""},{default:t(()=>[sa]),_:1}),a(e,{title:"client.go"},{default:t(()=>[aa]),_:1})]),_:1}),ta,a(c,null,{default:t(()=>[a(e,{title:"server",active:""},{default:t(()=>[ea]),_:1}),a(e,{title:"client"},{default:t(()=>[oa]),_:1})]),_:1}),pa]),ca,la],64)}var ba=r(g,[["render",ua],["__file","tcp.html.vue"]]);export{ba as default};
