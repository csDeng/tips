import{_ as o,r as p,o as l,c as r,b as s,a as e,F as c,d as n,e as t}from"./app.2a7ffa2e.js";const i={},u=n("\u5B98\u7F51 "),m={href:"https://dev.mysql.com/doc/refman/8.0/en/server-logs.html",target:"_blank",rel:"noopener noreferrer"},b=n("https://dev.mysql.com/doc/refman/8.0/en/server-logs.html"),k=n("\u4E2D\u6587\u7248 "),d={href:"https://mysql.net.cn/doc/refman/8.0/en/server-logs.html",target:"_blank",rel:"noopener noreferrer"},h=n("https://mysql.net.cn/doc/refman/8.0/en/server-logs.html"),_=s("li",null,"\u8BFB\u82F1\u6587\u7248\u8F85\u4EE5\u4E2D\u6587\u7248\uFF0C\u56E0\u4E3A\u6709\u4E9B\u4E2D\u6587\u7FFB\u8BD1\u771F\u7684\u8BA9\u4EBA\u96BE\u4EE5\u7406\u89E3\uFF5E\uFF5E",-1),g=t(`<blockquote><p>mysql \u65E0\u6CD5\u8FDC\u7A0B\u767B\u5F55\u3002 \u4FEE\u6539 <code>mysql.user</code>\u8868\u7684 <code>host</code>\u5E76\u5237\u65B0\u6743\u9650</p></blockquote><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">use</span> mysql<span class="token punctuation">;</span>
<span class="token keyword">update</span> <span class="token keyword">user</span> <span class="token keyword">set</span> host <span class="token operator">=</span> <span class="token string">&#39;%&#39;</span> <span class="token keyword">where</span> <span class="token keyword">user</span> <span class="token operator">=</span> <span class="token string">&#39;root&#39;</span> <span class="token keyword">limit</span> <span class="token number">1</span><span class="token punctuation">;</span>
FLUSH <span class="token keyword">PRIVILEGES</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>\u8BBE\u7F6E <code>mysql</code>\u65F6\u533A\uFF0C<code>set global time_zone = &#39;Asia/Shanghai&#39;;</code> \u9700\u8981\u6CE8\u610F\u7684\u662F <code>binlog</code>\u4F7F\u7528\u7684\u65F6\u533A\u662F\u670D\u52A1\u5668\u65F6\u533A\uFF0C\u670D\u52A1\u5668\u65F6\u533A\u4FEE\u6539\u65B9\u6CD5\u5982\u4E0B\uFF1A \u8BBE\u7F6Etimezone\u7684\u65F6\u533A <code>echo &quot;Asia/Shanghai&quot; &gt; /etc/timezone</code> \u8BBE\u7F6E\u65F6\u95F4 <code>rm -rf /etc/localtime</code><code>ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</code></p></blockquote>`,3),y=s("li",null,"\u53C2\u8003 \u76F8\u5173\u94FE\u63A5",-1),f={href:"https://www.cnblogs.com/hongdada/p/10983768.html",target:"_blank",rel:"noopener noreferrer"},v=n("https://www.cnblogs.com/hongdada/p/10983768.html"),T=t('<h1 id="binlog" tabindex="-1"><a class="header-anchor" href="#binlog" aria-hidden="true">#</a> binlog</h1><h2 id="\u662F\u4EC0\u4E48" tabindex="-1"><a class="header-anchor" href="#\u662F\u4EC0\u4E48" aria-hidden="true">#</a> \u662F\u4EC0\u4E48</h2><h3 id="\u7B80\u4ECB" tabindex="-1"><a class="header-anchor" href="#\u7B80\u4ECB" aria-hidden="true">#</a> \u7B80\u4ECB</h3>',3),q=n("The binary log contains \u201Cevents\u201D that describe database changes such as table creation operations or changes to table data. It also contains events for statements that potentially could have made changes (for example, a "),E={href:"https://dev.mysql.com/doc/refman/8.0/en/delete.html",target:"_blank",rel:"noopener noreferrer"},w=n("DELETE"),S=n(" which matched no rows), unless row-based logging is used. The binary log also contains information about how long each statement took that updated data. The binary log has two important purposes:"),I=n("For replication, the binary log on a replication source server provides a record of the data changes to be sent to replicas. The source sends the information contained in its binary log to its replicas, which reproduce those transactions to make the same data changes that were made on the source. See "),A={href:"https://dev.mysql.com/doc/refman/8.0/en/replication-implementation.html",target:"_blank",rel:"noopener noreferrer"},x=n("Section\xA017.2, \u201CReplication Implementation\u201D"),O=n("."),M=n("Certain data recovery operations require use of the binary log. After a backup has been restored, the events in the binary log that were recorded after the backup was made are re-executed. These events bring databases up to date from the point of the backup. See "),N={href:"https://dev.mysql.com/doc/refman/8.0/en/point-in-time-recovery.html",target:"_blank",rel:"noopener noreferrer"},L=n("Section\xA07.5, \u201CPoint-in-Time (Incremental) Recovery\u201D"),D=n("."),C=n("The binary log is not used for statements such as "),B={href:"https://dev.mysql.com/doc/refman/8.0/en/select.html",target:"_blank",rel:"noopener noreferrer"},R=n("SELECT"),F=n(" or "),P={href:"https://dev.mysql.com/doc/refman/8.0/en/show.html",target:"_blank",rel:"noopener noreferrer"},Q=n("SHOW"),G=n(" that do not modify data. To log all statements (for example, to identify a problem query), use the general query log. See "),z={href:"https://dev.mysql.com/doc/refman/8.0/en/query-log.html",target:"_blank",rel:"noopener noreferrer"},U=n("Section\xA05.4.3, \u201CThe General Query Log\u201D"),X=n("."),Y=s("p",null,"\u4E8C\u8FDB\u5236\u6587\u4EF6\uFF0C\u901A\u5E38\u7528\u4E8E\u5907\u4EFD\u4E0E\u6062\u590D\u3002",-1),W=s("blockquote",null,[s("p",null,"The binary log is resilient to unexpected halts. Only complete events or transactions are logged or read back.")],-1),H=s("h3",{id:"\u4EA7\u751F\u65B9\u5F0F",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#\u4EA7\u751F\u65B9\u5F0F","aria-hidden":"true"},"#"),n(" \u4EA7\u751F\u65B9\u5F0F")],-1),j={href:"https://dev.mysql.com/doc/refman/8.0/en/mysqld.html",target:"_blank",rel:"noopener noreferrer"},V=n("mysqld"),K=n(" appends a numeric extension to the binary log base name to generate binary log file names. The number increases each time the server creates a new log file, thus creating an ordered series of files. The server creates a new file in the series each time any of the following events occurs:"),J=s("li",null,"The server is started or restarted",-1),Z=s("li",null,"The server flushes the logs.",-1),$=n("The size of the current log file reaches "),nn={href:"https://dev.mysql.com/doc/refman/8.0/en/replication-options-binary-log.html#sysvar_max_binlog_size",target:"_blank",rel:"noopener noreferrer"},sn=n("max_binlog_size"),an=n("."),en=n("A binary log file may become larger than "),tn={href:"https://dev.mysql.com/doc/refman/8.0/en/replication-options-binary-log.html#sysvar_max_binlog_size",target:"_blank",rel:"noopener noreferrer"},on=n("max_binlog_size"),pn=n(" if you are using large transactions because a transaction is written to the file in one piece, never split between files."),ln=s("p",null,[s("code",null,"binlog"),n("\u6587\u4EF6\u751F\u6210\u7684\u65F6\u673A\uFF1A")],-1),rn=s("li",null,"\u670D\u52A1\u5668\u5DF2\u542F\u52A8\u6216\u91CD\u65B0\u542F\u52A8",-1),cn=s("li",null,"\u670D\u52A1\u5668\u5237\u65B0\u65E5\u5FD7\u3002",-1),un=n("\u5F53\u524D\u65E5\u5FD7\u6587\u4EF6\u7684\u5927\u5C0F\u8FBE\u5230 "),mn={href:"https://mysql.net.cn/doc/refman/8.0/en/replication-options-binary-log.html#sysvar_max_binlog_size",target:"_blank",rel:"noopener noreferrer"},bn=n("max_binlog_size"),kn=n(".\uFF08\u5F53\u7136\u6587\u4EF6\u4E5F\u53EF\u80FD\u6BD4\u6587\u4EF6\u9650\u5236\u5927\uFF0C\u6BD4\u5982\u8BF4\u4E00\u4E2A\u5927\u4E8B\u52A1\u7684\u6570\u636E\u63D2\u5165\uFF0C\u56E0\u4E3A\u4E8B\u52A1\u6570\u636E\u4E0D\u5141\u8BB8\u5206\u79BB\uFF09"),dn=n("To keep track of which binary log files have been used, "),hn={href:"https://dev.mysql.com/doc/refman/8.0/en/mysqld.html",target:"_blank",rel:"noopener noreferrer"},_n=n("mysqld"),gn=n(" also creates a binary log index file that contains the names of the binary log files. By default, this has the same base name as the binary log file, with the extension '.index'. You can change the name of the binary log index file with the "),yn={href:"https://dev.mysql.com/doc/refman/8.0/en/replication-options-binary-log.html#option_mysqld_log-bin-index",target:"_blank",rel:"noopener noreferrer"},fn=n("--log-bin-index[=file_name]"),vn=n(" option. You should not manually edit this file while "),Tn={href:"https://dev.mysql.com/doc/refman/8.0/en/mysqld.html",target:"_blank",rel:"noopener noreferrer"},qn=n("mysqld"),En=n(" is running; doing so would confuse "),wn={href:"https://dev.mysql.com/doc/refman/8.0/en/mysqld.html",target:"_blank",rel:"noopener noreferrer"},Sn=n("mysqld"),In=n("."),An=s("p",null,[n("\u65E5\u5FD7\u7D22\u5F15\u6587\u4EF6\uFF0C\u4E0D\u5EFA\u8BAE\u5728 "),s("code",null,"mysql"),n("\u8FD0\u884C\u65F6\u4FEE\u6539\uFF0C\u8FD9\u6837\u4F1A\u5BFC\u81F4\u5F02\u5E38\u3002")],-1),xn=n("By default, the server logs the length of the event as well as the event itself and uses this to verify that the event was written correctly. You can also cause the server to write checksums for the events by setting the "),On={href:"https://dev.mysql.com/doc/refman/8.0/en/replication-options-binary-log.html#sysvar_binlog_checksum",target:"_blank",rel:"noopener noreferrer"},Mn=n("binlog_checksum"),Nn=n(" system variable. When reading back from the binary log, the source uses the event length by default, but can be made to use checksums if available by enabling the system variable "),Ln={href:"https://dev.mysql.com/doc/refman/8.0/en/replication-options-binary-log.html#sysvar_source_verify_checksum",target:"_blank",rel:"noopener noreferrer"},Dn=n("source_verify_checksum"),Cn=n(" (from MySQL 8.0.26) or "),Bn={href:"https://dev.mysql.com/doc/refman/8.0/en/replication-options-binary-log.html#sysvar_master_verify_checksum",target:"_blank",rel:"noopener noreferrer"},Rn=n("master_verify_checksum"),Fn=n(" (before MySQL 8.0.26). The replication I/O (receiver) thread on the replica also verifies events received from the source. You can cause the replication SQL (applier) thread to use checksums if available when reading from the relay log by enabling the system variable "),Pn={href:"https://dev.mysql.com/doc/refman/8.0/en/replication-options-replica.html#sysvar_replica_sql_verify_checksum",target:"_blank",rel:"noopener noreferrer"},Qn=n("replica_sql_verify_checksum"),Gn=n(" (from MySQL 8.0.26) or "),zn={href:"https://dev.mysql.com/doc/refman/8.0/en/replication-options-replica.html#sysvar_slave_sql_verify_checksum",target:"_blank",rel:"noopener noreferrer"},Un=n("slave_sql_verify_checksum"),Xn=n(" (before MySQL 8.0.26)."),Yn=s("p",null,"\u53EF\u4EE5\u5F00\u542F\u6821\u9A8C\u548C\u6821\u9A8C\u6587\u4EF6\u5B8C\u6574\u6027\u3002",-1),Wn=n("The format of the events recorded in the binary log is dependent on the binary logging format. Three format types are supported: row-based logging, statement-based logging and mixed-base logging. The binary logging format used depends on the MySQL version. For general descriptions of the logging formats, see "),Hn={href:"https://dev.mysql.com/doc/refman/8.0/en/binary-log-formats.html",target:"_blank",rel:"noopener noreferrer"},jn=n("Section\xA05.4.4.1, \u201CBinary Logging Formats\u201D"),Vn=n(". For detailed information about the format of the binary log, see "),Kn={href:"https://dev.mysql.com/doc/internals/en/binary-log.html",target:"_blank",rel:"noopener noreferrer"},Jn=n("MySQL Internals: The Binary Log"),Zn=n("."),$n=t('<h3 id="\u6587\u4EF6\u683C\u5F0F" tabindex="-1"><a class="header-anchor" href="#\u6587\u4EF6\u683C\u5F0F" aria-hidden="true">#</a> \u6587\u4EF6\u683C\u5F0F</h3><blockquote><p>The server uses several logging formats to record information in the binary log:</p><ul><li>Replication capabilities in MySQL originally were based on propagation of SQL statements from source to replica. This is called statement-based logging. You can cause this format to be used by starting the server with <code>--binlog-format=STATEMENT</code>.</li><li>In row-based logging (the default), the source writes events to the binary log that indicate how individual table rows are affected. You can cause the server to use row-based logging by starting it with <code>--binlog-format=ROW</code>.</li><li>A third option is also available: mixed logging. With mixed logging, statement-based logging is used by default, but the logging mode switches automatically to row-based in certain cases as described below. You can cause MySQL to use mixed logging explicitly by starting mysqld with the option <code>--binlog-format=MIXED</code>.</li></ul></blockquote><p>\u6587\u4EF6\u683C\u5F0F\u4E3B\u8981\u6709\u4E09\u79CD\uFF0C\u57FA\u4E8E\u8BED\u53E5\u3001\u57FA\u4E8E\u6570\u636E\u884C\u3001\u6DF7\u5408\u6A21\u5F0F</p><ul><li><code>STATEMENT</code> \u5BFC\u81F4\u65E5\u5FD7\u8BB0\u5F55\u662F\u57FA\u4E8E\u8BED\u53E5\u7684\u3002</li><li><code>ROW</code> \u5BFC\u81F4\u65E5\u5FD7\u8BB0\u5F55\u57FA\u4E8E\u884C\u3002\u8FD9\u662F\u9ED8\u8BA4\u503C\u3002</li><li><code>MIXED</code> \u5BFC\u81F4\u65E5\u5FD7\u8BB0\u5F55\u4F7F\u7528\u6DF7\u5408\u683C\u5F0F\u3002</li></ul><blockquote><p>The logging format can also be set or limited by the storage engine being used. This helps to eliminate issues when replicating certain statements between a source and replica which are using different storage engines. With statement-based replication, there may be issues with replicating nondeterministic statements. In deciding whether or not a given statement is safe for statement-based replication, MySQL determines whether it can guarantee that the statement can be replicated using statement-based logging. If MySQL cannot make this guarantee, it marks the statement as potentially unreliable and issues the warning, Statement may not be safe to log in statement format. You can avoid these issues by using MySQL&#39;s row-based replication instead.</p></blockquote><p>\u65E5\u5FD7\u8BB0\u5F55\u683C\u5F0F\u4E5F\u53EF\u4EE5\u7531\u6B63\u5728\u4F7F\u7528\u7684\u5B58\u50A8\u5F15\u64CE\u8BBE\u7F6E\u6216\u9650\u5236\u3002\u8FD9\u6709\u52A9\u4E8E\u6D88\u9664\u5728\u4F7F\u7528\u4E0D\u540C\u5B58\u50A8\u5F15\u64CE\u7684\u6E90\u548C\u526F\u672C\u4E4B\u95F4\u590D\u5236\u67D0\u4E9B\u8BED\u53E5\u65F6\u51FA\u73B0\u7684\u95EE\u9898\u3002 \u5BF9\u4E8E\u57FA\u4E8E\u8BED\u53E5\u7684\u590D\u5236\uFF0C\u590D\u5236\u975E\u786E\u5B9A\u6027\u8BED\u53E5\u53EF\u80FD\u4F1A\u51FA\u73B0\u95EE\u9898\u3002\u5728\u51B3\u5B9A\u7ED9\u5B9A\u8BED\u53E5\u5BF9\u4E8E\u57FA\u4E8E\u8BED\u53E5\u7684\u590D\u5236\u662F\u5426\u5B89\u5168\u65F6\uFF0CMySQL \u786E\u5B9A\u5B83\u662F\u5426\u53EF\u4EE5\u4FDD\u8BC1\u53EF\u4EE5\u4F7F\u7528\u57FA\u4E8E\u8BED\u53E5\u7684\u65E5\u5FD7\u8BB0\u5F55\u6765\u590D\u5236\u8BE5\u8BED\u53E5\u3002\u5982\u679C MySQL \u4E0D\u80FD\u505A\u51FA\u8FD9\u79CD\u4FDD\u8BC1\uFF0C\u5B83\u4F1A\u5C06\u8BED\u53E5\u6807\u8BB0\u4E3A\u6F5C\u5728\u4E0D\u53EF\u9760\u5E76\u53D1\u51FA\u8B66\u544A\u3002\u60A8\u53EF\u4EE5\u6539\u7528 MySQL \u7684\u57FA\u4E8E\u884C\u7684\u590D\u5236\u6765\u907F\u514D\u8FD9\u4E9B\u95EE\u9898\u3002</p><h5 id="statement" tabindex="-1"><a class="header-anchor" href="#statement" aria-hidden="true">#</a> <code>statement</code></h5><h5 id="row" tabindex="-1"><a class="header-anchor" href="#row" aria-hidden="true">#</a> <code>row</code></h5>',8),ns=n("With the binary log format set to ROW, many changes are written to the binary log using the row-based format. Some changes, however, still use the statement-based format. Examples include all DDL (data definition language) statements such as "),ss={href:"https://dev.mysql.com/doc/refman/8.0/en/create-table.html",target:"_blank",rel:"noopener noreferrer"},as=n("CREATE TABLE"),es=n(", "),ts={href:"https://dev.mysql.com/doc/refman/8.0/en/alter-table.html",target:"_blank",rel:"noopener noreferrer"},os=n("ALTER TABLE"),ps=n(", or "),ls={href:"https://dev.mysql.com/doc/refman/8.0/en/drop-table.html",target:"_blank",rel:"noopener noreferrer"},rs=n("DROP TABLE"),cs=n(". When row-based binary logging is used, the "),is={href:"https://dev.mysql.com/doc/refman/8.0/en/replication-options-binary-log.html#sysvar_binlog_row_event_max_size",target:"_blank",rel:"noopener noreferrer"},us=n("binlog_row_event_max_size"),ms=n(" system variable and its corresponding startup option "),bs={href:"https://dev.mysql.com/doc/refman/8.0/en/replication-options-binary-log.html#option_mysqld_binlog-row-event-max-size",target:"_blank",rel:"noopener noreferrer"},ks=n("--binlog-row-event-max-size"),ds=n(" set a soft limit on the maximum size of row events. The default value is 8192 bytes, and the value can only be changed at server startup. Where possible, rows stored in the binary log are grouped into events with a size not exceeding the value of this setting. If an event cannot be split, the maximum size can be exceeded."),hs=t('<p>\u5C06\u4E8C\u8FDB\u5236\u65E5\u5FD7\u683C\u5F0F\u8BBE\u7F6E\u4E3AROW\uFF0C\u8BB8\u591A\u66F4\u6539\u5C06\u4F7F\u7528\u57FA\u4E8E\u884C\u7684\u683C\u5F0F\u5199\u5165\u4E8C\u8FDB\u5236\u65E5\u5FD7\u3002\u4F46\u662F\uFF0C\u4E00\u4E9B\u66F4\u6539\u4ECD\u7136\u4F7F\u7528\u57FA\u4E8E\u8BED\u53E5\u7684\u683C\u5F0F\u3002\u793A\u4F8B\u5305\u62EC\u6240\u6709 DDL\uFF08\u6570\u636E\u5B9A\u4E49\u8BED\u8A00\uFF09\u8BED\u53E5\uFF0C\u4F8B\u5982 <code>CREATE TABLE\u3001 ALTER TABLE\u6216 DROP TABLE</code>\u3002 \u4F7F\u7528\u57FA\u4E8E\u884C\u7684\u4E8C\u8FDB\u5236\u65E5\u5FD7\u8BB0\u5F55\u65F6\uFF0C <code>binlog_row_event_max_size </code> \u7CFB\u7EDF\u53D8\u91CF\u53CA\u5176\u76F8\u5E94\u7684\u542F\u52A8\u9009\u9879 <code>--binlog-row-event-max-size</code> \u5BF9\u884C\u4E8B\u4EF6\u7684\u6700\u5927\u5927\u5C0F\u8BBE\u7F6E\u8F6F\u9650\u5236\u3002\u9ED8\u8BA4\u503C\u4E3A <code>8192 </code> \u5B57\u8282\uFF0C\u8BE5\u503C\u53EA\u80FD\u5728\u670D\u52A1\u5668\u542F\u52A8\u65F6\u66F4\u6539\u3002\u5728\u53EF\u80FD\u7684\u60C5\u51B5\u4E0B\uFF0C\u5B58\u50A8\u5728\u4E8C\u8FDB\u5236\u65E5\u5FD7\u4E2D\u7684\u884C\u88AB\u5206\u7EC4\u4E3A\u5927\u5C0F\u4E0D\u8D85\u8FC7\u6B64\u8BBE\u7F6E\u503C\u7684\u4E8B\u4EF6\u3002\u5982\u679C\u65E0\u6CD5\u62C6\u5206\u4E8B\u4EF6\uFF0C\u5219\u53EF\u80FD\u4F1A\u8D85\u8FC7\u6700\u5927\u5927\u5C0F\u3002</p><h5 id="mixed" tabindex="-1"><a class="header-anchor" href="#mixed" aria-hidden="true">#</a> <code>mixed</code></h5><h2 id="\u600E\u4E48\u529E" tabindex="-1"><a class="header-anchor" href="#\u600E\u4E48\u529E" aria-hidden="true">#</a> \u600E\u4E48\u529E</h2>',3),_s=n("You can display the contents of binary log files with the "),gs={href:"https://dev.mysql.com/doc/refman/8.0/en/mysqlbinlog.html",target:"_blank",rel:"noopener noreferrer"},ys=n("mysqlbinlog"),fs=n(" utility. This can be useful when you want to reprocess statements in the log for a recovery operation. For example, you can update a MySQL server from the binary log as follows:"),vs=t(`<div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mysqlbinlog log_file <span class="token operator">|</span> mysql -h server_name
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div>`,1),Ts={href:"https://dev.mysql.com/doc/refman/8.0/en/mysqlbinlog.html",target:"_blank",rel:"noopener noreferrer"},qs=n("mysqlbinlog"),Es=n(" also can be used to display the contents of the relay log file on a replica, because they are written using the same format as binary log files. For more information on the "),ws={href:"https://dev.mysql.com/doc/refman/8.0/en/mysqlbinlog.html",target:"_blank",rel:"noopener noreferrer"},Ss=n("mysqlbinlog"),Is=n(" utility and how to use it, see "),As={href:"https://dev.mysql.com/doc/refman/8.0/en/mysqlbinlog.html",target:"_blank",rel:"noopener noreferrer"},xs=n("Section\xA04.6.9, \u201Cmysqlbinlog \u2014 Utility for Processing Binary Log Files\u201D"),Os=n(". For more information about the binary log and recovery operations, see "),Ms={href:"https://dev.mysql.com/doc/refman/8.0/en/point-in-time-recovery.html",target:"_blank",rel:"noopener noreferrer"},Ns=n("Section\xA07.5, \u201CPoint-in-Time (Incremental) Recovery\u201D"),Ls=n("."),Ds=s("p",null,[n("\u53EF\u4EE5\u4F7F\u7528 "),s("code",null,"mysqlbinlog"),n("\u7A0B\u5E8F\u67E5\u8BE2\u4E8C\u8FDB\u5236\u6587\u4EF6\u5185\u5BB9\u3002")],-1),Cs=n("Binary logging is done immediately after a statement or transaction completes but before any locks are released or any commit is done. This ensures that the log is logged in commit order. Within an uncommitted transaction, all updates ("),Bs={href:"https://dev.mysql.com/doc/refman/8.0/en/update.html",target:"_blank",rel:"noopener noreferrer"},Rs=n("UPDATE"),Fs=n(", "),Ps={href:"https://dev.mysql.com/doc/refman/8.0/en/delete.html",target:"_blank",rel:"noopener noreferrer"},Qs=n("DELETE"),Gs=n(", or "),zs={href:"https://dev.mysql.com/doc/refman/8.0/en/insert.html",target:"_blank",rel:"noopener noreferrer"},Us=n("INSERT"),Xs=n(") that change transactional tables such as InnoDB tables are cached until a "),Ys={href:"https://dev.mysql.com/doc/refman/8.0/en/commit.html",target:"_blank",rel:"noopener noreferrer"},Ws=n("COMMIT"),Hs=n(" statement is received by the server. At that point, "),js={href:"https://dev.mysql.com/doc/refman/8.0/en/mysqld.html",target:"_blank",rel:"noopener noreferrer"},Vs=n("mysqld"),Ks=n(" writes the entire transaction to the binary log before the COMMIT is executed. Modifications to nontransactional tables cannot be rolled back. If a transaction that is rolled back includes modifications to nontransactional tables, the entire transaction is logged with a "),Js={href:"https://dev.mysql.com/doc/refman/8.0/en/commit.html",target:"_blank",rel:"noopener noreferrer"},Zs=n("ROLLBACK"),$s=n(" statement at the end to ensure that the modifications to those tables are replicated."),na=n("\u4E8C\u8FDB\u5236\u65E5\u5FD7\u8BB0\u5F55\u5728\u8BED\u53E5\u6216\u4E8B\u52A1\u5B8C\u6210\u540E\u4F46\u5728\u91CA\u653E\u4EFB\u4F55\u9501\u6216\u5B8C\u6210\u4EFB\u4F55\u63D0\u4EA4\u4E4B\u524D\u7ACB\u5373\u5B8C\u6210\u3002\u8FD9\u786E\u4FDD\u65E5\u5FD7\u4EE5\u63D0\u4EA4\u987A\u5E8F\u8BB0\u5F55\u3002 \u5BF9\u975E\u4E8B\u52A1\u6027\u8868\u7684\u66F4\u65B0\u5728\u6267\u884C\u540E\u7ACB\u5373\u5B58\u50A8\u5728\u4E8C\u8FDB\u5236\u65E5\u5FD7\u4E2D\u3002 \u5728\u672A\u63D0\u4EA4\u7684\u4E8B\u52A1\u4E2D\uFF0C\u6240\u6709\u66F4\u6539\u4E8B\u52A1\u8868\uFF08\u4F8B\u5982\u8868\uFF09\u7684 \u66F4\u65B0\uFF08"),sa={href:"https://mysql.net.cn/doc/refman/8.0/en/update.html",target:"_blank",rel:"noopener noreferrer"},aa=n("UPDATE"),ea=n("\u3001 "),ta={href:"https://mysql.net.cn/doc/refman/8.0/en/delete.html",target:"_blank",rel:"noopener noreferrer"},oa=n("DELETE"),pa=n("\u6216 \uFF09\u90FD\u4F1A\u88AB\u7F13\u5B58\uFF0C\u76F4\u5230 \u670D\u52A1\u5668\u6536\u5230\u4E00\u6761\u8BED\u53E5\u3002\u6B64\u65F6\uFF0C"),la={href:"https://mysql.net.cn/doc/refman/8.0/en/mysqld.html",target:"_blank",rel:"noopener noreferrer"},ra=n("mysqld"),ca=n("\u5728\u6267\u884C\u4E4B\u524D\u5C06\u6574\u4E2A\u4E8B\u52A1\u5199\u5165\u4E8C\u8FDB\u5236\u65E5\u5FD7 \u3002 "),ia={href:"https://mysql.net.cn/doc/refman/8.0/en/insert.html",target:"_blank",rel:"noopener noreferrer"},ua=n("INSERT"),ma=n("InnoDB"),ba={href:"https://mysql.net.cn/doc/refman/8.0/en/commit.html",target:"_blank",rel:"noopener noreferrer"},ka=n("COMMIT"),da={href:"https://mysql.net.cn/doc/refman/8.0/en/commit.html",target:"_blank",rel:"noopener noreferrer"},ha=n("COMMIT"),_a=n(" \u4E0D\u80FD\u56DE\u6EDA\u5BF9\u975E\u4E8B\u52A1\u6027\u8868\u7684\u4FEE\u6539\u3002\u5982\u679C\u56DE\u6EDA\u7684\u4E8B\u52A1\u5305\u62EC\u5BF9\u975E\u4E8B\u52A1\u8868\u7684\u4FEE\u6539\uFF0C\u5219\u6574\u4E2A\u4E8B\u52A1\u4F1A "),ga={href:"https://mysql.net.cn/doc/refman/8.0/en/commit.html",target:"_blank",rel:"noopener noreferrer"},ya=n("ROLLBACK"),fa=n(" \u5728\u672B\u5C3E\u8BB0\u5F55\u4E00\u6761\u8BED\u53E5\uFF0C\u4EE5\u786E\u4FDD\u590D\u5236\u5BF9\u8FD9\u4E9B\u8868\u7684\u4FEE\u6539\u3002"),va=t(`<blockquote><p>When a thread that handles the transaction starts, it allocates a buffer of binlog_cache_size to buffer statements. If a statement is bigger than this, the thread opens a temporary file to store the transaction. The temporary file is deleted when the thread ends. From MySQL 8.0.17, if binary log encryption is active on the server, the temporary file is encrypted.</p></blockquote><p>\u5904\u7406 <code>sql</code>\u8BED\u53E5\u65F6\uFF0C\u8BED\u53E5\u4F1A\u88AB\u653E\u5230\u4E00\u4E2A \u7F13\u51B2\u533A\uFF0C\u5982\u679C\u8BED\u53E5\u5927\u5C0F\u5927\u4E8E <code>binlog_cache_size</code>\u65F6\uFF0C\u8BED\u53E5\u4F1A\u88AB\u5B58\u50A8\u5230\u4E00\u4E2A\u4E34\u65F6\u6587\u4EF6\uFF0C\u5904\u7406\u5B8C\u4E4B\u540E\uFF0C\u4E34\u65F6\u6587\u4EF6\u88AB\u5220\u9664\u3002</p><h3 id="\u5F00\u542F-binlog" tabindex="-1"><a class="header-anchor" href="#\u5F00\u542F-binlog" aria-hidden="true">#</a> \u5F00\u542F <code>binlog</code></h3><ul><li>\u67E5\u770B <code>binlog</code>\u5F00\u542F\u72B6\u6001\u3002<code>log_bin</code>\u4E3A <code>off</code>\u8BF4\u660E\u5904\u4E8E\u5173\u95ED\u72B6\u6001\u3002</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> show variables like <span class="token string">&#39;log%&#39;</span><span class="token punctuation">;</span>
+----------------------------------------+--------+
<span class="token operator">|</span> Variable_name                          <span class="token operator">|</span> Value  <span class="token operator">|</span>
+----------------------------------------+--------+
<span class="token operator">|</span> log_bin                                <span class="token operator">|</span> OFF    <span class="token operator">|</span>
<span class="token operator">|</span> log_bin_basename                       <span class="token operator">|</span>        <span class="token operator">|</span>
<span class="token operator">|</span> log_bin_index                          <span class="token operator">|</span>        <span class="token operator">|</span>
<span class="token operator">|</span> log_bin_trust_function_creators        <span class="token operator">|</span> OFF    <span class="token operator">|</span>
<span class="token operator">|</span> log_bin_use_v1_row_events              <span class="token operator">|</span> OFF    <span class="token operator">|</span>
<span class="token operator">|</span> log_builtin_as_identified_by_password  <span class="token operator">|</span> OFF    <span class="token operator">|</span>
<span class="token operator">|</span> log_error                              <span class="token operator">|</span> stderr <span class="token operator">|</span>
<span class="token operator">|</span> log_error_verbosity                    <span class="token operator">|</span> <span class="token number">3</span>      <span class="token operator">|</span>
<span class="token operator">|</span> log_output                             <span class="token operator">|</span> FILE   <span class="token operator">|</span>
<span class="token operator">|</span> log_queries_not_using_indexes          <span class="token operator">|</span> OFF    <span class="token operator">|</span>
<span class="token operator">|</span> log_slave_updates                      <span class="token operator">|</span> OFF    <span class="token operator">|</span>
<span class="token operator">|</span> log_slow_admin_statements              <span class="token operator">|</span> OFF    <span class="token operator">|</span>
<span class="token operator">|</span> log_slow_slave_statements              <span class="token operator">|</span> OFF    <span class="token operator">|</span>
<span class="token operator">|</span> log_statements_unsafe_for_binlog       <span class="token operator">|</span> ON     <span class="token operator">|</span>
<span class="token operator">|</span> log_syslog                             <span class="token operator">|</span> OFF    <span class="token operator">|</span>
<span class="token operator">|</span> log_syslog_facility                    <span class="token operator">|</span> daemon <span class="token operator">|</span>
<span class="token operator">|</span> log_syslog_include_pid                 <span class="token operator">|</span> ON     <span class="token operator">|</span>
<span class="token operator">|</span> log_syslog_tag                         <span class="token operator">|</span>        <span class="token operator">|</span>
<span class="token operator">|</span> log_throttle_queries_not_using_indexes <span class="token operator">|</span> <span class="token number">0</span>      <span class="token operator">|</span>
<span class="token operator">|</span> log_timestamps                         <span class="token operator">|</span> UTC    <span class="token operator">|</span>
<span class="token operator">|</span> log_warnings                           <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span>
+----------------------------------------+--------+
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><ul><li>\u5F00\u542F <code>binog</code></li></ul><p>\u4FEE\u6539mysql\u7684my.cnf\u914D\u7F6E\u6587\u4EF6\uFF0C \u4E00\u822C\u9ED8\u8BA4\u662F\u5728/etc/my.cnf\u8DEF\u5F84\u4E0B\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">server_id</span><span class="token operator">=</span><span class="token number">1</span>
log_bin <span class="token operator">=</span> mysql-bin
binlog_format <span class="token operator">=</span> ROW
expire_logs_days <span class="token operator">=</span> <span class="token number">30</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>\u518D\u6B21\u67E5\u770B <code>mysql</code> <code>log</code> \u72B6\u6001\u3002\u5982\u4E0B\uFF0C\u8BF4\u660E <code>binlog</code>\u5DF2\u5F00\u542F\uFF0C\u4E14\u5B58\u50A8\u4F4D\u7F6E\u662F <code>/var/lib/mysql/</code></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> show variables like <span class="token string">&#39;log%&#39;</span><span class="token punctuation">;</span>
+----------------------------------------+--------------------------------+
<span class="token operator">|</span> Variable_name                          <span class="token operator">|</span> Value                          <span class="token operator">|</span>
+----------------------------------------+--------------------------------+
<span class="token operator">|</span> log_bin                                <span class="token operator">|</span> ON                             <span class="token operator">|</span>
<span class="token operator">|</span> log_bin_basename                       <span class="token operator">|</span> /var/lib/mysql/mysql-bin       <span class="token operator">|</span>
<span class="token operator">|</span> log_bin_index                          <span class="token operator">|</span> /var/lib/mysql/mysql-bin.index <span class="token operator">|</span>
<span class="token operator">|</span> log_bin_trust_function_creators        <span class="token operator">|</span> OFF                            <span class="token operator">|</span>
<span class="token operator">|</span> log_bin_use_v1_row_events              <span class="token operator">|</span> OFF                            <span class="token operator">|</span>
<span class="token operator">|</span> log_builtin_as_identified_by_password  <span class="token operator">|</span> OFF                            <span class="token operator">|</span>
<span class="token operator">|</span> log_error                              <span class="token operator">|</span> stderr                         <span class="token operator">|</span>
<span class="token operator">|</span> log_error_verbosity                    <span class="token operator">|</span> <span class="token number">3</span>                              <span class="token operator">|</span>
<span class="token operator">|</span> log_output                             <span class="token operator">|</span> FILE                           <span class="token operator">|</span>
<span class="token operator">|</span> log_queries_not_using_indexes          <span class="token operator">|</span> OFF                            <span class="token operator">|</span>
<span class="token operator">|</span> log_slave_updates                      <span class="token operator">|</span> OFF                            <span class="token operator">|</span>
<span class="token operator">|</span> log_slow_admin_statements              <span class="token operator">|</span> OFF                            <span class="token operator">|</span>
<span class="token operator">|</span> log_slow_slave_statements              <span class="token operator">|</span> OFF                            <span class="token operator">|</span>
<span class="token operator">|</span> log_statements_unsafe_for_binlog       <span class="token operator">|</span> ON                             <span class="token operator">|</span>
<span class="token operator">|</span> log_syslog                             <span class="token operator">|</span> OFF                            <span class="token operator">|</span>
<span class="token operator">|</span> log_syslog_facility                    <span class="token operator">|</span> daemon                         <span class="token operator">|</span>
<span class="token operator">|</span> log_syslog_include_pid                 <span class="token operator">|</span> ON                             <span class="token operator">|</span>
<span class="token operator">|</span> log_syslog_tag                         <span class="token operator">|</span>                                <span class="token operator">|</span>
<span class="token operator">|</span> log_throttle_queries_not_using_indexes <span class="token operator">|</span> <span class="token number">0</span>                              <span class="token operator">|</span>
<span class="token operator">|</span> log_timestamps                         <span class="token operator">|</span> UTC                            <span class="token operator">|</span>
<span class="token operator">|</span> log_warnings                           <span class="token operator">|</span> <span class="token number">2</span>                              <span class="token operator">|</span>
+----------------------------------------+--------------------------------+
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p><img src="https://cdn.nlark.com/yuque/0/2023/png/21883277/1703394795140-bf1a4869-f988-4232-8581-71e16e27df99.png#averageHue=%23090909&amp;clientId=ucac032cc-6391-4&amp;from=paste&amp;height=153&amp;id=u8f56ad22&amp;originHeight=306&amp;originWidth=1554&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=89879&amp;status=done&amp;style=none&amp;taskId=u8358951f-ed00-42d5-bebf-8712f821865&amp;title=&amp;width=777" alt="image.png"></p><h3 id="\u67E5\u770B-binlog" tabindex="-1"><a class="header-anchor" href="#\u67E5\u770B-binlog" aria-hidden="true">#</a> \u67E5\u770B <code>binlog</code></h3><blockquote><p>binlog \u76F4\u63A5\u67E5\u8BE2\u4F1A\u4E71\u7801\uFF0C\u56E0\u4E3A\u5B58\u50A8\u7684\u662F\u4E8C\u8FDB\u5236\u6587\u4EF6\u3002\u9700\u8981\u4F7F\u7528\u5DE5\u5177\u67E5\u770B\uFF0C\u6BD4\u5982 <code>mysqlbinlog</code></p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>root@4f5d2fa3a08e:/var/lib/mysql<span class="token comment"># mysqlbinlog mysql-bin.000001</span>
/*<span class="token operator">!</span><span class="token number">50530</span> SET @@<span class="token environment constant">SESSION</span>.PSEUDO_SLAVE_MODE<span class="token operator">=</span><span class="token number">1</span>*/<span class="token punctuation">;</span>
/*<span class="token operator">!</span><span class="token number">50003</span> SET @OLD_COMPLETION_TYPE<span class="token operator">=</span>@@COMPLETION_TYPE,COMPLETION_TYPE<span class="token operator">=</span><span class="token number">0</span>*/<span class="token punctuation">;</span>
DELIMITER /*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
<span class="token comment"># at 4</span>
<span class="token comment">#231224  5:02:10 server id 1  end_log_pos 123 CRC32 0x9d466f78 	Start: binlog v 4, server v 5.7.26-1-log created 231224  5:02:10 at startup</span>
ROLLBACK/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
BINLOG <span class="token string">&#39;
UruHZQ8BAAAAdwAAAHsAAAAAAAQANS43LjI2LTEtbG9nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAABSu4dlEzgNAAgAEgAEBAQEEgAAXwAEGggAAAAICAgCAAAACgoKKioAEjQA
AXhvRp0=
&#39;</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
<span class="token comment"># at 123</span>
<span class="token comment">#231224  5:02:10 server id 1  end_log_pos 154 CRC32 0xd2dd1c56 	Previous-GTIDs</span>
<span class="token comment"># [empty]</span>
<span class="token comment"># at 154</span>
<span class="token comment">#231224  5:03:16 server id 1  end_log_pos 177 CRC32 0xdbfa606c 	Stop</span>
SET @@<span class="token environment constant">SESSION</span>.GTID_NEXT<span class="token operator">=</span> <span class="token string">&#39;AUTOMATIC&#39;</span> /* added by mysqlbinlog */ /*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
DELIMITER <span class="token punctuation">;</span>
<span class="token comment"># End of log file</span>
/*<span class="token operator">!</span><span class="token number">50003</span> SET <span class="token assign-left variable">COMPLETION_TYPE</span><span class="token operator">=</span>@OLD_COMPLETION_TYPE*/<span class="token punctuation">;</span>
/*<span class="token operator">!</span><span class="token number">50530</span> SET @@<span class="token environment constant">SESSION</span>.PSEUDO_SLAVE_MODE<span class="token operator">=</span><span class="token number">0</span>*/<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><blockquote><p>row \u6A21\u5F0F\u4E0B\u9762\u7684 binlog</p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2023/png/21883277/1703399706759-ae211a65-0b5f-40e4-8e71-0f7e7b776867.png#averageHue=%235d5d5d&amp;clientId=ucac032cc-6391-4&amp;from=paste&amp;height=451&amp;id=u6f3fcb6e&amp;originHeight=902&amp;originWidth=2482&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=325332&amp;status=done&amp;style=none&amp;taskId=ue866d89a-2b0e-4154-be1d-bb903db82d6&amp;title=&amp;width=1241" alt="image.png"></p><h3 id="\u5176\u4ED6\u67E5\u770B\u76F8\u5173\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#\u5176\u4ED6\u67E5\u770B\u76F8\u5173\u547D\u4EE4" aria-hidden="true">#</a> \u5176\u4ED6\u67E5\u770B\u76F8\u5173\u547D\u4EE4</h3><ul><li><code>show binary logs;</code>\u67E5\u770B binlog \u6587\u4EF6\u5217\u8868</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> show binary logs<span class="token punctuation">;</span>
+------------------+-----------+
<span class="token operator">|</span> Log_name         <span class="token operator">|</span> File_size <span class="token operator">|</span>
+------------------+-----------+
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span>      <span class="token number">1421</span> <span class="token operator">|</span>
+------------------+-----------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><code>show master status;</code>\u67E5\u770B\u65E5\u5FD7\u72B6\u6001</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> show master status<span class="token punctuation">;</span>
+------------------+----------+--------------+------------------+-------------------+
<span class="token operator">|</span> File             <span class="token operator">|</span> Position <span class="token operator">|</span> Binlog_Do_DB <span class="token operator">|</span> Binlog_Ignore_DB <span class="token operator">|</span> Executed_Gtid_Set <span class="token operator">|</span>
+------------------+----------+--------------+------------------+-------------------+
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span>     <span class="token number">1421</span> <span class="token operator">|</span>              <span class="token operator">|</span>                  <span class="token operator">|</span>                   <span class="token operator">|</span>
+------------------+----------+--------------+------------------+-------------------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><code>flush logs;</code> \u5237\u65B0\u65E5\u5FD7</li></ul><p>\u81EA\u6B64\u523B\u5F00\u59CB\u4EA7\u751F\u4E00\u4E2A\u65B0\u7F16\u53F7\u7684binlog\u65E5\u5FD7\u6587\u4EF6 \u6BCF\u5F53mysqld\u670D\u52A1\u91CD\u542F\u65F6\uFF0C\u4F1A\u81EA\u52A8\u6267\u884C\u6B64\u547D\u4EE4\uFF0C\u5237\u65B0binlog\u65E5\u5FD7\uFF1B\u5728mysqldump\u5907\u4EFD\u6570\u636E\u65F6\u52A0 -F \u9009\u9879\u4E5F\u4F1A\u5237\u65B0binlog\u65E5\u5FD7\uFF1B</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> show master status<span class="token punctuation">;</span>
+------------------+----------+--------------+------------------+-------------------+
<span class="token operator">|</span> File             <span class="token operator">|</span> Position <span class="token operator">|</span> Binlog_Do_DB <span class="token operator">|</span> Binlog_Ignore_DB <span class="token operator">|</span> Executed_Gtid_Set <span class="token operator">|</span>
+------------------+----------+--------------+------------------+-------------------+
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span>     <span class="token number">1421</span> <span class="token operator">|</span>              <span class="token operator">|</span>                  <span class="token operator">|</span>                   <span class="token operator">|</span>
+------------------+----------+--------------+------------------+-------------------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> flush logs<span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.02</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> show binary logs<span class="token punctuation">;</span>
+------------------+-----------+
<span class="token operator">|</span> Log_name         <span class="token operator">|</span> File_size <span class="token operator">|</span>
+------------------+-----------+
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span>      <span class="token number">1468</span> <span class="token operator">|</span>
<span class="token operator">|</span> mysql-bin.000002 <span class="token operator">|</span>       <span class="token number">154</span> <span class="token operator">|</span>
+------------------+-----------+
<span class="token number">2</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> show master status<span class="token punctuation">;</span>
+------------------+----------+--------------+------------------+-------------------+
<span class="token operator">|</span> File             <span class="token operator">|</span> Position <span class="token operator">|</span> Binlog_Do_DB <span class="token operator">|</span> Binlog_Ignore_DB <span class="token operator">|</span> Executed_Gtid_Set <span class="token operator">|</span>
+------------------+----------+--------------+------------------+-------------------+
<span class="token operator">|</span> mysql-bin.000002 <span class="token operator">|</span>      <span class="token number">154</span> <span class="token operator">|</span>              <span class="token operator">|</span>                  <span class="token operator">|</span>                   <span class="token operator">|</span>
+------------------+----------+--------------+------------------+-------------------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><ul><li><p><code>reset master;</code>\u91CD\u7F6E\u6240\u6709 <code>binlog</code></p></li><li><p><code>show binlog events;</code>\u67E5\u770B binlog \u4E8B\u4EF6</p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>A.\u67E5\u8BE2\u7B2C\u4E00\u4E2A<span class="token punctuation">(</span>\u6700\u65E9<span class="token punctuation">)</span>\u7684binlog\u65E5\u5FD7\uFF1A
  mysql<span class="token operator">&gt;</span> show binlog events<span class="token punctuation">;</span> 

B.\u6307\u5B9A\u67E5\u8BE2 mysql-bin.000021 \u8FD9\u4E2A\u6587\u4EF6\uFF1A
  mysql<span class="token operator">&gt;</span> show binlog events <span class="token keyword">in</span> <span class="token string">&#39;mysql-bin.000021&#39;</span><span class="token punctuation">;</span>

C.\u6307\u5B9A\u67E5\u8BE2 mysql-bin.000021 \u8FD9\u4E2A\u6587\u4EF6\uFF0C\u4ECEpos\u70B9:8224\u5F00\u59CB\u67E5\u8D77\uFF1A
  mysql<span class="token operator">&gt;</span> show binlog events <span class="token keyword">in</span> <span class="token string">&#39;mysql-bin.000021&#39;</span> from <span class="token number">8224</span><span class="token punctuation">;</span>

D.\u6307\u5B9A\u67E5\u8BE2 mysql-bin.000021 \u8FD9\u4E2A\u6587\u4EF6\uFF0C\u4ECEpos\u70B9:8224\u5F00\u59CB\u67E5\u8D77\uFF0C\u67E5\u8BE210\u6761
  mysql<span class="token operator">&gt;</span> show binlog events <span class="token keyword">in</span> <span class="token string">&#39;mysql-bin.000021&#39;</span> from <span class="token number">8224</span> limit <span class="token number">10</span><span class="token punctuation">;</span>

E.\u6307\u5B9A\u67E5\u8BE2 mysql-bin.000021 \u8FD9\u4E2A\u6587\u4EF6\uFF0C\u4ECEpos\u70B9:8224\u5F00\u59CB\u67E5\u8D77\uFF0C\u504F\u79FB2\u884C\uFF0C\u67E5\u8BE210\u6761
  mysql<span class="token operator">&gt;</span> show binlog events <span class="token keyword">in</span> <span class="token string">&#39;mysql-bin.000021&#39;</span> from <span class="token number">8224</span> limit <span class="token number">2,10</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>\u6587\u4EF6\u5185\u5BB9\u793A\u{1F350}</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> show binlog events <span class="token keyword">in</span> <span class="token string">&#39;mysql-bin.000001&#39;</span><span class="token punctuation">;</span>
+------------------+------+----------------+-----------+-------------+----------------------------------------------------------------------------------------------+
<span class="token operator">|</span> Log_name         <span class="token operator">|</span> Pos  <span class="token operator">|</span> Event_type     <span class="token operator">|</span> Server_id <span class="token operator">|</span> End_log_pos <span class="token operator">|</span> Info                                                                                         <span class="token operator">|</span>
+------------------+------+----------------+-----------+-------------+----------------------------------------------------------------------------------------------+
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span> Format_desc    <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">123</span> <span class="token operator">|</span> Server ver: <span class="token number">5.7</span>.26-1-log, Binlog ver: <span class="token number">4</span>                                                      <span class="token operator">|</span>
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span>  <span class="token number">123</span> <span class="token operator">|</span> Previous_gtids <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">154</span> <span class="token operator">|</span>                                                                                              <span class="token operator">|</span>
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span>  <span class="token number">154</span> <span class="token operator">|</span> Anonymous_Gtid <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">219</span> <span class="token operator">|</span> SET @@<span class="token environment constant">SESSION</span>.GTID_NEXT<span class="token operator">=</span> <span class="token string">&#39;ANONYMOUS&#39;</span>                                                         <span class="token operator">|</span>
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span>  <span class="token number">219</span> <span class="token operator">|</span> Query          <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">291</span> <span class="token operator">|</span> BEGIN                                                                                        <span class="token operator">|</span>
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span>  <span class="token number">291</span> <span class="token operator">|</span> Table_map      <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">344</span> <span class="token operator">|</span> table_id: <span class="token number">118</span> <span class="token punctuation">(</span>test.user<span class="token punctuation">)</span>                                                                    <span class="token operator">|</span>
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span>  <span class="token number">344</span> <span class="token operator">|</span> Write_rows     <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">409</span> <span class="token operator">|</span> table_id: <span class="token number">118</span> flags: STMT_END_F                                                              <span class="token operator">|</span>
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span>  <span class="token number">409</span> <span class="token operator">|</span> Xid            <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">440</span> <span class="token operator">|</span> COMMIT /* <span class="token assign-left variable">xid</span><span class="token operator">=</span><span class="token number">1316</span> */                                                                        <span class="token operator">|</span>
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span>  <span class="token number">440</span> <span class="token operator">|</span> Anonymous_Gtid <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">505</span> <span class="token operator">|</span> SET @@<span class="token environment constant">SESSION</span>.GTID_NEXT<span class="token operator">=</span> <span class="token string">&#39;ANONYMOUS&#39;</span>                                                         <span class="token operator">|</span>
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span>  <span class="token number">505</span> <span class="token operator">|</span> Query          <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">577</span> <span class="token operator">|</span> BEGIN                                                                                        <span class="token operator">|</span>
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span>  <span class="token number">577</span> <span class="token operator">|</span> Table_map      <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">630</span> <span class="token operator">|</span> table_id: <span class="token number">118</span> <span class="token punctuation">(</span>test.user<span class="token punctuation">)</span>                                                                    <span class="token operator">|</span>
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span>  <span class="token number">630</span> <span class="token operator">|</span> Delete_rows    <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">680</span> <span class="token operator">|</span> table_id: <span class="token number">118</span> flags: STMT_END_F                                                              <span class="token operator">|</span>
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span>  <span class="token number">680</span> <span class="token operator">|</span> Xid            <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">711</span> <span class="token operator">|</span> COMMIT /* <span class="token assign-left variable">xid</span><span class="token operator">=</span><span class="token number">1674</span> */                                                                        <span class="token operator">|</span>
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span>  <span class="token number">711</span> <span class="token operator">|</span> Anonymous_Gtid <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">776</span> <span class="token operator">|</span> SET @@<span class="token environment constant">SESSION</span>.GTID_NEXT<span class="token operator">=</span> <span class="token string">&#39;ANONYMOUS&#39;</span>                                                         <span class="token operator">|</span>
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span>  <span class="token number">776</span> <span class="token operator">|</span> Query          <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">848</span> <span class="token operator">|</span> BEGIN                                                                                        <span class="token operator">|</span>
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span>  <span class="token number">848</span> <span class="token operator">|</span> Table_map      <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">901</span> <span class="token operator">|</span> table_id: <span class="token number">118</span> <span class="token punctuation">(</span>test.user<span class="token punctuation">)</span>                                                                    <span class="token operator">|</span>
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span>  <span class="token number">901</span> <span class="token operator">|</span> Write_rows     <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">955</span> <span class="token operator">|</span> table_id: <span class="token number">118</span> flags: STMT_END_F                                                              <span class="token operator">|</span>
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span>  <span class="token number">955</span> <span class="token operator">|</span> Xid            <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">986</span> <span class="token operator">|</span> COMMIT /* <span class="token assign-left variable">xid</span><span class="token operator">=</span><span class="token number">1804</span> */                                                                        <span class="token operator">|</span>
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span>  <span class="token number">986</span> <span class="token operator">|</span> Anonymous_Gtid <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>        <span class="token number">1051</span> <span class="token operator">|</span> SET @@<span class="token environment constant">SESSION</span>.GTID_NEXT<span class="token operator">=</span> <span class="token string">&#39;ANONYMOUS&#39;</span>                                                         <span class="token operator">|</span>
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span> <span class="token number">1051</span> <span class="token operator">|</span> Query          <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>        <span class="token number">1202</span> <span class="token operator">|</span> use <span class="token variable"><span class="token variable">\`</span><span class="token builtin class-name">test</span><span class="token variable">\`</span></span><span class="token punctuation">;</span> create table a <span class="token punctuation">(</span>
<span class="token function">id</span> int unsigned primary key auto_increment,
    num int
<span class="token punctuation">)</span>    <span class="token operator">|</span>
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span> <span class="token number">1202</span> <span class="token operator">|</span> Anonymous_Gtid <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>        <span class="token number">1267</span> <span class="token operator">|</span> SET @@<span class="token environment constant">SESSION</span>.GTID_NEXT<span class="token operator">=</span> <span class="token string">&#39;ANONYMOUS&#39;</span>                                                         <span class="token operator">|</span>
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span> <span class="token number">1267</span> <span class="token operator">|</span> Query          <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>        <span class="token number">1421</span> <span class="token operator">|</span> use <span class="token variable"><span class="token variable">\`</span><span class="token builtin class-name">test</span><span class="token variable">\`</span></span><span class="token punctuation">;</span> CREATE TABLE b<span class="token punctuation">(</span>
    <span class="token function">id</span> INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    num INT
<span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span> <span class="token number">1421</span> <span class="token operator">|</span> Rotate         <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>        <span class="token number">1468</span> <span class="token operator">|</span> mysql-bin.000002<span class="token punctuation">;</span><span class="token assign-left variable">pos</span><span class="token operator">=</span><span class="token number">4</span>                                                                       <span class="token operator">|</span>
+------------------+------+----------------+-----------+-------------+----------------------------------------------------------------------------------------------+
<span class="token number">22</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="\u8FD0\u7EF4\u67E5\u770B-binlog" tabindex="-1"><a class="header-anchor" href="#\u8FD0\u7EF4\u67E5\u770B-binlog" aria-hidden="true">#</a> \u8FD0\u7EF4\u67E5\u770B <code>binlog</code></h3><p>\u5728\u4F7F\u7528mysqlbinlog\u67E5\u770B\u6DF7\u5408\u6A21\u5F0F\u7684\u4E8C\u8FDB\u5236\u6587\u4EF6\u65F6\uFF0C\u57FA\u4E8E\u884C\u7684\u90E8\u5206\u9ED8\u8BA4\u662F\u4EE5base64\u7F16\u7801\u663E\u793A \u5C06\u5176\u4E2D\u7684base64\u8F6C\u6362\u6210sql:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code> mysqlbinlog --base64-output<span class="token operator">=</span>decode-rows -v mysql-bin.000001 <span class="token operator">&gt;</span> res.txt
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>res.txt \u7684\u5185\u5BB9</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>/*<span class="token operator">!</span><span class="token number">50530</span> SET @@<span class="token environment constant">SESSION</span>.PSEUDO_SLAVE_MODE<span class="token operator">=</span><span class="token number">1</span>*/<span class="token punctuation">;</span>
/*<span class="token operator">!</span><span class="token number">50003</span> SET @OLD_COMPLETION_TYPE<span class="token operator">=</span>@@COMPLETION_TYPE,COMPLETION_TYPE<span class="token operator">=</span><span class="token number">0</span>*/<span class="token punctuation">;</span>
DELIMITER /*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
<span class="token comment"># at 4</span>
<span class="token comment">#231224 13:28:30 server id 1  end_log_pos 123 CRC32 0xc0f50f24 	Start: binlog v 4, server v 5.7.26-1-log created 231224 13:28:30 at startup</span>
ROLLBACK/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
<span class="token comment"># at 123</span>
<span class="token comment">#231224 13:28:30 server id 1  end_log_pos 154 CRC32 0x6cc91d0a 	Previous-GTIDs</span>
<span class="token comment"># [empty]</span>
<span class="token comment"># at 154</span>
<span class="token comment">#231224 13:29:42 server id 1  end_log_pos 219 CRC32 0xf5bcc26f 	Anonymous_GTID	last_committed=0	sequence_number=1	rbr_only=yes</span>
/*<span class="token operator">!</span><span class="token number">50718</span> SET TRANSACTION ISOLATION LEVEL READ COMMITTED*//*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
SET @@<span class="token environment constant">SESSION</span>.GTID_NEXT<span class="token operator">=</span> <span class="token string">&#39;ANONYMOUS&#39;</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
<span class="token comment"># at 219</span>
<span class="token comment">#231224 13:29:42 server id 1  end_log_pos 291 CRC32 0xc68a921b 	Query	thread_id=267	exec_time=0	error_code=0</span>
SET <span class="token assign-left variable">TIMESTAMP</span><span class="token operator">=</span><span class="token number">1703395782</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
SET @@session.pseudo_thread_id<span class="token operator">=</span><span class="token number">267</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
SET @@session.foreign_key_checks<span class="token operator">=</span><span class="token number">1</span>, @@session.sql_auto_is_null<span class="token operator">=</span><span class="token number">0</span>, @@session.unique_checks<span class="token operator">=</span><span class="token number">1</span>, @@session.autocommit<span class="token operator">=</span><span class="token number">1</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
SET @@session.sql_mode<span class="token operator">=</span><span class="token number">1436549152</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
SET @@session.auto_increment_increment<span class="token operator">=</span><span class="token number">1</span>, @@session.auto_increment_offset<span class="token operator">=</span><span class="token number">1</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
/*<span class="token operator">!</span><span class="token punctuation">\\</span>C utf8mb4 *//*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
SET @@session.character_set_client<span class="token operator">=</span><span class="token number">45</span>,@@session.collation_connection<span class="token operator">=</span><span class="token number">224</span>,@@session.collation_server<span class="token operator">=</span><span class="token number">8</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
SET @@session.lc_time_names<span class="token operator">=</span><span class="token number">0</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
SET @@session.collation_database<span class="token operator">=</span>DEFAULT/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
BEGIN
/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
<span class="token comment"># at 291</span>
<span class="token comment">#231224 13:29:42 server id 1  end_log_pos 344 CRC32 0xcff0cc72 	Table_map: \`test\`.\`user\` mapped to number 118</span>
<span class="token comment"># at 344</span>
<span class="token comment">#231224 13:29:42 server id 1  end_log_pos 409 CRC32 0x075bb3b6 	Write_rows: table id 118 flags: STMT_END_F</span>
<span class="token comment">### INSERT INTO \`test\`.\`user\`</span>
<span class="token comment">### SET</span>
<span class="token comment">###   @1=1</span>
<span class="token comment">###   @2=&#39;a&#39;</span>
<span class="token comment">###   @3=&#39;p1&#39;</span>
<span class="token comment">### INSERT INTO \`test\`.\`user\`</span>
<span class="token comment">### SET</span>
<span class="token comment">###   @1=2</span>
<span class="token comment">###   @2=&#39;b&#39;</span>
<span class="token comment">###   @3=&#39;p2&#39;</span>
<span class="token comment"># at 409</span>
<span class="token comment">#231224 13:29:42 server id 1  end_log_pos 440 CRC32 0x9f0ffa07 	Xid = 1316</span>
COMMIT/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
<span class="token comment"># at 440</span>
<span class="token comment">#231224 14:30:23 server id 1  end_log_pos 505 CRC32 0x02ee3380 	Anonymous_GTID	last_committed=1	sequence_number=2	rbr_only=yes</span>
/*<span class="token operator">!</span><span class="token number">50718</span> SET TRANSACTION ISOLATION LEVEL READ COMMITTED*//*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
SET @@<span class="token environment constant">SESSION</span>.GTID_NEXT<span class="token operator">=</span> <span class="token string">&#39;ANONYMOUS&#39;</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
<span class="token comment"># at 505</span>
<span class="token comment">#231224 14:30:23 server id 1  end_log_pos 577 CRC32 0x982238b6 	Query	thread_id=350	exec_time=0	error_code=0</span>
SET <span class="token assign-left variable">TIMESTAMP</span><span class="token operator">=</span><span class="token number">1703399423</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
BEGIN
/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
<span class="token comment"># at 577</span>
<span class="token comment">#231224 14:30:23 server id 1  end_log_pos 630 CRC32 0x03e45ce2 	Table_map: \`test\`.\`user\` mapped to number 118</span>
<span class="token comment"># at 630</span>
<span class="token comment">#231224 14:30:23 server id 1  end_log_pos 680 CRC32 0xa2c1421a 	Delete_rows: table id 118 flags: STMT_END_F</span>
<span class="token comment">### DELETE FROM \`test\`.\`user\`</span>
<span class="token comment">### WHERE</span>
<span class="token comment">###   @1=2</span>
<span class="token comment">###   @2=&#39;b&#39;</span>
<span class="token comment">###   @3=&#39;p2&#39;</span>
<span class="token comment"># at 680</span>
<span class="token comment">#231224 14:30:23 server id 1  end_log_pos 711 CRC32 0x3475be60 	Xid = 1674</span>
COMMIT/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
<span class="token comment"># at 711</span>
<span class="token comment">#231224 14:31:57 server id 1  end_log_pos 776 CRC32 0x23f46e3f 	Anonymous_GTID	last_committed=2	sequence_number=3	rbr_only=yes</span>
/*<span class="token operator">!</span><span class="token number">50718</span> SET TRANSACTION ISOLATION LEVEL READ COMMITTED*//*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
SET @@<span class="token environment constant">SESSION</span>.GTID_NEXT<span class="token operator">=</span> <span class="token string">&#39;ANONYMOUS&#39;</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
<span class="token comment"># at 776</span>
<span class="token comment">#231224 14:31:57 server id 1  end_log_pos 848 CRC32 0x26f11bef 	Query	thread_id=369	exec_time=0	error_code=0</span>
SET <span class="token assign-left variable">TIMESTAMP</span><span class="token operator">=</span><span class="token number">1703399517</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
BEGIN
/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
<span class="token comment"># at 848</span>
<span class="token comment">#231224 14:31:57 server id 1  end_log_pos 901 CRC32 0xde002922 	Table_map: \`test\`.\`user\` mapped to number 118</span>
<span class="token comment"># at 901</span>
<span class="token comment">#231224 14:31:57 server id 1  end_log_pos 955 CRC32 0x26595cf5 	Write_rows: table id 118 flags: STMT_END_F</span>
<span class="token comment">### INSERT INTO \`test\`.\`user\`</span>
<span class="token comment">### SET</span>
<span class="token comment">###   @1=3</span>
<span class="token comment">###   @2=&#39;222&#39;</span>
<span class="token comment">###   @3=&#39;3333&#39;</span>
<span class="token comment"># at 955</span>
<span class="token comment">#231224 14:31:57 server id 1  end_log_pos 986 CRC32 0xd3f7919a 	Xid = 1804</span>
COMMIT/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
<span class="token comment"># at 986</span>
<span class="token comment">#231224 14:33:42 server id 1  end_log_pos 1051 CRC32 0x2f4e8cad 	Anonymous_GTID	last_committed=3	sequence_number=4	rbr_only=no</span>
SET @@<span class="token environment constant">SESSION</span>.GTID_NEXT<span class="token operator">=</span> <span class="token string">&#39;ANONYMOUS&#39;</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
<span class="token comment"># at 1051</span>
<span class="token comment">#231224 14:33:42 server id 1  end_log_pos 1202 CRC32 0xb0d39243 	Query	thread_id=452	exec_time=0	error_code=0</span>
use <span class="token variable"><span class="token variable">\`</span><span class="token builtin class-name">test</span><span class="token variable">\`</span></span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
SET <span class="token assign-left variable">TIMESTAMP</span><span class="token operator">=</span><span class="token number">1703399622</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
create table a <span class="token punctuation">(</span>
<span class="token function">id</span> int unsigned primary key auto_increment,
    num int
<span class="token punctuation">)</span>
/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
<span class="token comment"># at 1202</span>
<span class="token comment">#231224 14:34:10 server id 1  end_log_pos 1267 CRC32 0xd38832ac 	Anonymous_GTID	last_committed=4	sequence_number=5	rbr_only=no</span>
SET @@<span class="token environment constant">SESSION</span>.GTID_NEXT<span class="token operator">=</span> <span class="token string">&#39;ANONYMOUS&#39;</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
<span class="token comment"># at 1267</span>
<span class="token comment">#231224 14:34:10 server id 1  end_log_pos 1421 CRC32 0x00f1f075 	Query	thread_id=466	exec_time=0	error_code=0</span>
SET <span class="token assign-left variable">TIMESTAMP</span><span class="token operator">=</span><span class="token number">1703399650</span>/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
CREATE TABLE b<span class="token punctuation">(</span>
    <span class="token function">id</span> INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    num INT
<span class="token punctuation">)</span>
/*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
<span class="token comment"># at 1421</span>
<span class="token comment">#231224 14:40:48 server id 1  end_log_pos 1468 CRC32 0xfb426c97 	Rotate to mysql-bin.000002  pos: 4</span>
SET @@<span class="token environment constant">SESSION</span>.GTID_NEXT<span class="token operator">=</span> <span class="token string">&#39;AUTOMATIC&#39;</span> /* added by mysqlbinlog */ /*<span class="token operator">!</span>*/<span class="token punctuation">;</span>
DELIMITER <span class="token punctuation">;</span>
<span class="token comment"># End of log file</span>
/*<span class="token operator">!</span><span class="token number">50003</span> SET <span class="token assign-left variable">COMPLETION_TYPE</span><span class="token operator">=</span>@OLD_COMPLETION_TYPE*/<span class="token punctuation">;</span>
/*<span class="token operator">!</span><span class="token number">50530</span> SET @@<span class="token environment constant">SESSION</span>.PSEUDO_SLAVE_MODE<span class="token operator">=</span><span class="token number">0</span>*/<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br></div></div><h3 id="\u8BBE\u7F6E\u6587\u4EF6\u5B58\u50A8\u683C\u5F0F" tabindex="-1"><a class="header-anchor" href="#\u8BBE\u7F6E\u6587\u4EF6\u5B58\u50A8\u683C\u5F0F" aria-hidden="true">#</a> \u8BBE\u7F6E\u6587\u4EF6\u5B58\u50A8\u683C\u5F0F</h3><ul><li>\u5168\u5C40</li></ul><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> binlog_format <span class="token operator">=</span> <span class="token string">&#39;STATEMENT&#39;</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> binlog_format <span class="token operator">=</span> <span class="token string">&#39;ROW&#39;</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> binlog_format <span class="token operator">=</span> <span class="token string">&#39;MIXED&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>\u4F1A\u8BDD</li></ul><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">SET</span> <span class="token keyword">SESSION</span> binlog_format <span class="token operator">=</span> <span class="token string">&#39;STATEMENT&#39;</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">SET</span> <span class="token keyword">SESSION</span> binlog_format <span class="token operator">=</span> <span class="token string">&#39;ROW&#39;</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">SET</span> <span class="token keyword">SESSION</span> binlog_format <span class="token operator">=</span> <span class="token string">&#39;MIXED&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>\u4E3A\u4EC0\u4E48\u4F1A\u9700\u8981\u4F1A\u8BDD\u8BBE\u7F6E</li></ul><p>\u5BA2\u6237\u7AEF\u53EF\u80FD\u5E0C\u671B\u5728\u6BCF\u4E2A\u4F1A\u8BDD\u7684\u57FA\u7840\u4E0A\u8BBE\u7F6E\u4E8C\u8FDB\u5236\u65E5\u5FD7\u8BB0\u5F55\u7684\u539F\u56E0\u6709\u591A\u79CD\uFF1A</p><ul><li>\u5BF9\u6570\u636E\u5E93\u8FDB\u884C\u8BB8\u591A\u5C0F\u66F4\u6539\u7684\u4F1A\u8BDD\u53EF\u80FD\u9700\u8981\u4F7F\u7528\u57FA\u4E8E\u884C\u7684\u65E5\u5FD7\u8BB0\u5F55\u3002</li><li>\u6267\u884C\u4E0E\u5B50\u53E5\u4E2D\u7684\u8BB8\u591A\u884C\u5339\u914D\u7684\u66F4\u65B0\u7684\u4F1A\u8BDD <code>WHERE</code> \u53EF\u80FD\u5E0C\u671B\u4F7F\u7528\u57FA\u4E8E\u8BED\u53E5\u7684\u65E5\u5FD7\u8BB0\u5F55\uFF0C\u56E0\u4E3A\u8BB0\u5F55\u5C11\u91CF\u8BED\u53E5\u6BD4\u8BB0\u5F55\u8BB8\u591A\u884C\u66F4\u6709\u6548\u3002</li><li>\u6709\u4E9B\u8BED\u53E5\u5728\u6E90\u4E0A\u9700\u8981\u5927\u91CF\u6267\u884C\u65F6\u95F4\uFF0C\u4F46\u53EA\u4F1A\u4FEE\u6539\u51E0\u884C\u3002\u56E0\u6B64\uFF0C\u4F7F\u7528\u57FA\u4E8E\u884C\u7684\u65E5\u5FD7\u8BB0\u5F55\u6765\u590D\u5236\u5B83\u4EEC\u53EF\u80FD\u662F\u6709\u76CA\u7684\u3002</li></ul>`,41),Ta=n("If you are using "),qa={href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-storage-engine.html",target:"_blank",rel:"noopener noreferrer"},Ea=n("InnoDB"),wa=n(" tables and the transaction isolation level is "),Sa={href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-transaction-isolation-levels.html#isolevel_read-committed",target:"_blank",rel:"noopener noreferrer"},Ia=n("READ COMMITTED"),Aa=n(" or "),xa={href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-transaction-isolation-levels.html#isolevel_read-uncommitted",target:"_blank",rel:"noopener noreferrer"},Oa=n("READ UNCOMMITTED"),Ma=n(", only row-based logging can be used. It is possible to change the logging format to STATEMENT, but doing so at runtime leads very rapidly to errors because InnoDB can no longer perform inserts."),Na=s("p",null,[n("\u5982\u679C\u60A8\u6B63\u5728\u4F7F\u7528 "),s("code",null,"InnoDB"),n(" \u8868\u5E76\u4E14\u4E8B\u52A1\u9694\u79BB\u7EA7\u522B\u4E3A "),s("code",null,"READ COMMITTED"),n(" \u6216 "),s("code",null,"READ UNCOMMITTED"),n("\uFF0C\u5219\u53EA\u80FD\u4F7F\u7528\u57FA\u4E8E\u884C\u7684\u65E5\u5FD7\u8BB0\u5F55\u3002")],-1),La=s("h3",{id:"\u7F13\u51B2\u533A\u5927\u5C0F\u7684\u8C03\u6574\u65B9\u5F0F",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#\u7F13\u51B2\u533A\u5927\u5C0F\u7684\u8C03\u6574\u65B9\u5F0F","aria-hidden":"true"},"#"),n(" \u7F13\u51B2\u533A\u5927\u5C0F\u7684\u8C03\u6574\u65B9\u5F0F")],-1),Da=n("The "),Ca={href:"https://dev.mysql.com/doc/refman/8.0/en/server-status-variables.html#statvar_Binlog_cache_use",target:"_blank",rel:"noopener noreferrer"},Ba=n("Binlog_cache_use"),Ra=n(" status variable shows the number of transactions that used this buffer (and possibly a temporary file) for storing statements. The "),Fa={href:"https://dev.mysql.com/doc/refman/8.0/en/server-status-variables.html#statvar_Binlog_cache_disk_use",target:"_blank",rel:"noopener noreferrer"},Pa=n("Binlog_cache_disk_use"),Qa=n(" status variable shows how many of those transactions actually had to use a temporary file. These two variables can be used for tuning "),Ga={href:"https://dev.mysql.com/doc/refman/8.0/en/replication-options-binary-log.html#sysvar_binlog_cache_size",target:"_blank",rel:"noopener noreferrer"},za=n("binlog_cache_size"),Ua=n(" to a large enough value that avoids the use of temporary files. The "),Xa={href:"https://dev.mysql.com/doc/refman/8.0/en/replication-options-binary-log.html#sysvar_max_binlog_cache_size",target:"_blank",rel:"noopener noreferrer"},Ya=n("max_binlog_cache_size"),Wa=n(" system variable (default 4GB, which is also the maximum) can be used to restrict the total size used to cache a multiple-statement transaction. If a transaction is larger than this many bytes, it fails and rolls back. The minimum value is 4096."),Ha=s("p",null,"\u9ED8\u8BA4 4GB",-1),ja=n("If you are using the binary log and row based logging, concurrent inserts are converted to normal inserts for CREATE ... SELECT or "),Va={href:"https://dev.mysql.com/doc/refman/8.0/en/insert-select.html",target:"_blank",rel:"noopener noreferrer"},Ka=n("INSERT ... SELECT"),Ja=n(" statements. This is done to ensure that you can re-create an exact copy of your tables by applying the log during a backup operation. If you are using statement-based logging, the original statement is written to the log."),Za=s("p",null,[n("\u5982\u679C\u60A8\u4F7F\u7528\u4E8C\u8FDB\u5236\u65E5\u5FD7\u548C\u57FA\u4E8E\u884C\u7684\u65E5\u5FD7\u8BB0\u5F55\uFF0C\u5E76\u53D1\u63D2\u5165\u5C06\u8F6C\u6362\u4E3A\u666E\u901A\u63D2\u5165 "),s("code",null,"CREATE ... SELECT"),n(" \u6216 "),s("code",null,"INSERT ... SELECT"),n(" \u8BED\u53E5\u3002\u8FD9\u6837\u505A\u662F\u4E3A\u4E86\u786E\u4FDD\u60A8\u53EF\u4EE5\u901A\u8FC7\u5728\u5907\u4EFD\u64CD\u4F5C\u671F\u95F4\u5E94\u7528\u65E5\u5FD7\u6765\u91CD\u65B0\u521B\u5EFA\u8868\u7684\u7CBE\u786E\u526F\u672C\u3002\u5982\u679C\u60A8\u4F7F\u7528\u7684\u662F\u57FA\u4E8E\u8BED\u53E5\u7684\u65E5\u5FD7\u8BB0\u5F55\uFF0C\u5219\u539F\u59CB\u8BED\u53E5\u5C06\u5199\u5165\u65E5\u5FD7\u3002")],-1),$a=s("h3",{id:"\u7F13\u51B2\u533A\u5199\u5165\u6587\u4EF6\u7684\u65F6\u673A-sync-binlog",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#\u7F13\u51B2\u533A\u5199\u5165\u6587\u4EF6\u7684\u65F6\u673A-sync-binlog","aria-hidden":"true"},"#"),n(" \u7F13\u51B2\u533A\u5199\u5165\u6587\u4EF6\u7684\u65F6\u673A "),s("code",null,"sync_binlog")],-1),ne=n("By default, the binary log is synchronized to disk at each write (sync_binlog=1). If sync_binlog was not enabled, and the operating system or machine (not only the MySQL server) crashed, there is a chance that the last statements of the binary log could be lost. To prevent this, enable the "),se={href:"https://dev.mysql.com/doc/refman/8.0/en/replication-options-binary-log.html#sysvar_sync_binlog",target:"_blank",rel:"noopener noreferrer"},ae=n("sync_binlog"),ee=n(" system variable to synchronize the binary log to disk after every N commit groups. See "),te={href:"https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html",target:"_blank",rel:"noopener noreferrer"},oe=n("Section\xA05.1.8, \u201CServer System Variables\u201D"),pe=n(". The safest value for "),le={href:"https://dev.mysql.com/doc/refman/8.0/en/replication-options-binary-log.html#sysvar_sync_binlog",target:"_blank",rel:"noopener noreferrer"},re=n("sync_binlog"),ce=n(" is 1 (the default), but this is also the slowest."),ie=s("p",null,[s("code",null,"sync_binlog"),n("\u9ED8\u8BA4\u662F 1\uFF0C\u5373\u6BCF\u4E2A\u63D0\u4EA4\u90FD\u5199\u5165\u6587\u4EF6\uFF0C\u53EF\u4EE5\u8BBE\u7F6E\u4E3A "),s("code",null,"N"),n("\u8868\u793A "),s("code",null,"N"),n("\u4E2A "),s("code",null,"commit"),n("\u518D\u5199\u5165\u5230\u6587\u4EF6\u3002")],-1),ue=n("In earlier MySQL releases, there was a chance of inconsistency between the table content and binary log content if a crash occurred, even with "),me={href:"https://dev.mysql.com/doc/refman/8.0/en/replication-options-binary-log.html#sysvar_sync_binlog",target:"_blank",rel:"noopener noreferrer"},be=n("sync_binlog"),ke=n(" set to 1. For example, if you are using InnoDB tables and the MySQL server processes a "),de={href:"https://dev.mysql.com/doc/refman/8.0/en/commit.html",target:"_blank",rel:"noopener noreferrer"},he=n("COMMIT"),_e=n(" statement, it writes many prepared transactions to the binary log in sequence, synchronizes the binary log, and then commits the transaction into InnoDB. If the server unexpectedly exited between those two operations, the transaction would be rolled back by InnoDB at restart but still exist in the binary log. Such an issue was resolved in previous releases by enabling InnoDB support for two-phase commit in XA transactions. In MySQL 8.0, InnoDB support for two-phase commit in XA transactions is always enabled."),ge=t(`<p>\u5728\u65E9\u671F\u7684 MySQL \u7248\u672C\u4E2D\uFF0C\u5982\u679C\u53D1\u751F\u5D29\u6E83\uFF0C\u8868\u5185\u5BB9\u548C\u4E8C\u8FDB\u5236\u65E5\u5FD7\u5185\u5BB9\u4E4B\u95F4\u6709\u53EF\u80FD\u4E0D\u4E00\u81F4\uFF0C\u5373\u4F7F <code>sync_binlog</code> \u8BBE\u7F6E\u4E3A 1\u3002\u4F8B\u5982\uFF0C\u5982\u679C\u60A8\u6B63\u5728\u4F7F\u7528InnoDB \u8868\u5E76\u4E14 MySQL \u670D\u52A1\u5668\u5904\u7406\u4E00\u6761 <code> COMMIT</code> \u8BED\u53E5\uFF0C\u5B83\u4F1A\u5199\u5165\u8BB8\u591A\u51C6\u5907\u597D\u7684\u4E8B\u52A1\u987A\u5E8F\u5199\u5165\u4E8C\u8FDB\u5236\u65E5\u5FD7\uFF0C\u540C\u6B65\u4E8C\u8FDB\u5236\u65E5\u5FD7\uFF0C\u7136\u540E\u5C06\u4E8B\u52A1\u63D0\u4EA4\u5230 InnoDB. \u5982\u679C\u670D\u52A1\u5668\u5728\u8FD9\u4E24\u4E2A\u64CD\u4F5C\u4E4B\u95F4\u610F\u5916\u9000\u51FA\uFF0C\u4E8B\u52A1\u5C06\u5728\u91CD\u542F\u65F6\u56DE\u6EDAInnoDB\uFF0C\u4F46\u4ECD\u7136\u5B58\u5728\u4E8E\u4E8C\u8FDB\u5236\u65E5\u5FD7\u4E2D\u3002InnoDB\u901A\u8FC7\u5728 XA \u4E8B\u52A1\u4E2D\u542F\u7528\u5BF9\u4E24\u9636\u6BB5\u63D0\u4EA4\u7684\u652F\u6301\uFF0C\u5728\u4EE5\u524D\u7684\u7248\u672C\u4E2D\u89E3\u51B3\u4E86\u8FD9\u6837\u7684\u95EE\u9898\u3002\u5728 MySQL 8.0 \u4E2D\uFF0C InnoDB\u59CB\u7EC8\u542F\u7528 XA \u4E8B\u52A1\u4E2D\u5BF9\u4E24\u9636\u6BB5\u63D0\u4EA4\u7684\u652F\u6301\u3002</p><blockquote><p>InnoDB support for two-phase commit in XA transactions ensures that the binary log and InnoDB data files are synchronized. However, the MySQL server should also be configured to synchronize the binary log and the InnoDB logs to disk before committing the transaction. The InnoDB logs are synchronized by default, and sync_binlog=1 ensures the binary log is synchronized. The effect of implicit InnoDB support for two-phase commit in XA transactions and sync_binlog=1 is that at restart after a crash, after doing a rollback of transactions, the MySQL server scans the latest binary log file to collect transaction xid values and calculate the last valid position in the binary log file. The MySQL server then tells InnoDB to complete any prepared transactions that were successfully written to the to the binary log, and truncates the binary log to the last valid position. This ensures that the binary log reflects the exact data of InnoDB tables, and therefore the replica remains in synchrony with the source because it does not receive a statement which has been rolled back.</p></blockquote><p>InnoDB\u652F\u6301 XA \u4E8B\u52A1\u4E2D\u7684\u4E24\u9636\u6BB5\u63D0\u4EA4\u786E\u4FDD\u4E8C\u8FDB\u5236\u65E5\u5FD7\u548C InnoDB\u6570\u636E\u6587\u4EF6\u540C\u6B65\u3002\u4F46\u662F\uFF0CMySQL\u670D\u52A1\u5668\u8FD8\u5E94\u8BE5\u914D\u7F6E\u4E3AInnoDB\u5728\u63D0\u4EA4\u4E8B\u52A1\u4E4B\u524D\u5C06\u4E8C\u8FDB\u5236\u65E5\u5FD7\u548C\u65E5\u5FD7\u540C\u6B65\u5230\u78C1\u76D8\u3002InnoDB\u9ED8\u8BA4\u540C\u6B65\u65E5\u5FD7\uFF0C\u4FDD\u8BC1 <code>sync_binlog=1</code> \u4E8C\u8FDB\u5236\u65E5\u5FD7\u540C\u6B65\u3002<code>XA </code> \u4E8B\u52A1\u4E2D\u9690\u5F0F InnoDB\u652F\u6301\u4E24\u9636\u6BB5\u63D0\u4EA4\u7684\u6548\u679C <code>sync_binlog=1</code> \u662F\uFF0C\u5728\u5D29\u6E83\u540E\u91CD\u65B0\u542F\u52A8\u65F6\uFF0C\u5728\u4E8B\u52A1\u56DE\u6EDA\u540E\uFF0CMySQL \u670D\u52A1\u5668\u626B\u63CF\u6700\u65B0\u7684\u4E8C\u8FDB\u5236\u65E5\u5FD7\u6587\u4EF6\u4EE5\u6536\u96C6\u4E8B\u52A1 <code>xid</code> \u503C\u5E76\u8BA1\u7B97\u6700\u540E\u4E00\u4E2A\u6709\u6548\u4F4D\u7F6E\u5728\u4E8C\u8FDB\u5236\u65E5\u5FD7\u6587\u4EF6\u3002MySQL \u670D\u52A1\u5668\u7136\u540E\u544A\u8BC9InnoDB\u5B8C\u6210\u4EFB\u4F55\u5DF2\u6210\u529F\u5199\u5165\u4E8C\u8FDB\u5236\u65E5\u5FD7\u7684\u51C6\u5907\u4E8B\u52A1\uFF0C\u5E76\u5C06\u4E8C\u8FDB\u5236\u65E5\u5FD7\u622A\u65AD\u5230\u6700\u540E\u4E00\u4E2A\u6709\u6548\u4F4D\u7F6E\u3002\u8FD9\u786E\u4FDD\u4E8C\u8FDB\u5236\u65E5\u5FD7\u53CD\u6620 InnoDB\u8868\u7684\u51C6\u786E\u6570\u636E\uFF0C\u56E0\u6B64\u526F\u672C\u4E0E\u6E90\u4FDD\u6301\u540C\u6B65\uFF0C\u56E0\u4E3A\u5B83\u6CA1\u6709\u6536\u5230\u5DF2\u56DE\u6EDA\u7684\u8BED\u53E5\u3002</p><blockquote><p>If the MySQL server discovers at crash recovery that the binary log is shorter than it should have been, it lacks at least one successfully committed InnoDB transaction. This should not happen if sync_binlog=1 and the disk/file system do an actual sync when they are requested to (some do not), so the server prints an error message The binary log file_name is shorter than its expected size. In this case, this binary log is not correct and replication should be restarted from a fresh snapshot of the source&#39;s data.</p></blockquote><p>\u5982\u679C <code>MySQL</code> \u670D\u52A1\u5668\u5728\u5D29\u6E83\u6062\u590D\u65F6\u53D1\u73B0\u4E8C\u8FDB\u5236\u65E5\u5FD7\u6BD4\u5B83\u5E94\u8BE5\u7684\u77ED\uFF0C\u5B83\u81F3\u5C11\u7F3A\u5C11\u4E00\u4E2A\u6210\u529F\u63D0\u4EA4\u7684InnoDB\u4E8B\u52A1\u3002<code>sync_binlog=1</code> \u5982\u679C\u78C1\u76D8/\u6587\u4EF6\u7CFB\u7EDF\u5728\u8BF7\u6C42\u65F6\u8FDB\u884C\u4E86\u5B9E\u9645\u540C\u6B65\uFF08\u6709\u4E9B\u5219\u6CA1\u6709\uFF09\uFF0C\u5219\u4E0D\u5E94\u53D1\u751F\u8FD9\u79CD\u60C5\u51B5\uFF0C\u56E0\u6B64\u670D\u52A1\u5668\u4F1A\u6253\u5370\u4E00\u6761\u9519\u8BEF\u6D88\u606F\u3002\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B\uFF0C\u6B64\u4E8C\u8FDB\u5236\u65E5\u5FD7\u4E0D\u6B63\u786E\uFF0C\u5E94\u4ECE\u6E90\u6570\u636E\u7684\u65B0\u5FEB\u7167\u91CD\u65B0\u542F\u52A8\u590D\u5236\u3002</p><h2 id="\u4F1A\u600E\u6837" tabindex="-1"><a class="header-anchor" href="#\u4F1A\u600E\u6837" aria-hidden="true">#</a> \u4F1A\u600E\u6837</h2><blockquote><p><code>binlog</code> \u6587\u4EF6\u7684\u4F7F\u7528\u573A\u666F</p></blockquote><h3 id="\u6570\u636E\u589E\u91CF\u540C\u6B65\u5168\u6587\u641C\u7D22" tabindex="-1"><a class="header-anchor" href="#\u6570\u636E\u589E\u91CF\u540C\u6B65\u5168\u6587\u641C\u7D22" aria-hidden="true">#</a> \u6570\u636E\u589E\u91CF\u540C\u6B65\u5168\u6587\u641C\u7D22</h3><blockquote><p>\u5B8C\u6574\u9879\u76EE\u5730\u5740\uFF1Ahttps://github.com/csDeng/easy_binlog</p></blockquote><ul><li>\u6280\u672F\u6808 <ul><li>JDK17</li><li>redis</li><li>redis-search</li><li>mysql</li><li>docker-compose</li><li>binlog4j</li></ul></li></ul><h4 id="\u73AF\u5883\u51C6\u5907" tabindex="-1"><a class="header-anchor" href="#\u73AF\u5883\u51C6\u5907" aria-hidden="true">#</a> \u73AF\u5883\u51C6\u5907</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> ./docker
<span class="token function">docker-compose</span> up --build
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>\u6CE8\u610F\uFF0C\u5982\u679C\u767B\u5F55mysql\u65F6\uFF0C\u63D0\u793A\u65E0\u6CD5\u8FDC\u7A0B\u767B\u5F55\uFF0C\u9700\u8981\u8C37\u6B4C\u89E3\u51B3\u4E00\u4E0B\uFF0C\u628A<code>host</code>\u5207\u6362\u6210<code>%</code>, \u7136\u540E\u5237\u65B0\u4E00\u4E0B\u6743\u9650</p></blockquote><p>\u5EFA\u7ACB<code>mysql</code> \u8868</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">database</span> test<span class="token punctuation">;</span>
<span class="token keyword">use</span> test<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token identifier"><span class="token punctuation">\`</span>user<span class="token punctuation">\`</span></span><span class="token punctuation">(</span>
  id <span class="token keyword">bigint</span> <span class="token keyword">unsigned</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>
  name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  pwd <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u521B\u5EFA<code>redis search</code>\u7D22\u5F15</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>FT.CREATE user PREFIX <span class="token number">1</span> user: <span class="token environment constant">LANGUAGE</span> chinese LANGUAGE_FIELD chinese SCHEMA name TEXT <span class="token builtin class-name">pwd</span> TEXT
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u542F\u52A8\u9879\u76EE <img src="https://cdn.nlark.com/yuque/0/2023/png/21883277/1703417403313-0c723d19-fc5b-4c74-9715-b6bb3a2845eb.png#averageHue=%2324282b&amp;clientId=ucac032cc-6391-4&amp;from=paste&amp;height=293&amp;id=u6fabfc42&amp;originHeight=586&amp;originWidth=1596&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=460064&amp;status=done&amp;style=none&amp;taskId=ud05b03bb-8941-4e22-8aa1-0597cf71420&amp;title=&amp;width=798" alt="image.png"></p><ul><li>\u5728<code>mysql</code> \u4E2D\u63D2\u5165\u6570\u636E</li></ul><p>\u6570\u636E\u6210\u529F\u540C\u6B65<code>redis</code><img src="https://cdn.nlark.com/yuque/0/2023/png/21883277/1703417418437-c49b42e9-5969-4050-9432-c544addc1d2e.png#averageHue=%232b353d&amp;clientId=ucac032cc-6391-4&amp;from=paste&amp;height=328&amp;id=u8c244787&amp;originHeight=656&amp;originWidth=1598&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=315072&amp;status=done&amp;style=none&amp;taskId=u8c6aa9d8-1ddd-4d5c-9f98-b760713d295&amp;title=&amp;width=799" alt="image.png"></p><p>\u6570\u636E\u641C\u7D22\u6210\u529F <img src="https://cdn.nlark.com/yuque/0/2023/png/21883277/1703417432548-950136a3-f3e7-4554-9df8-4ee50b448e1f.png#averageHue=%23292c30&amp;clientId=ucac032cc-6391-4&amp;from=paste&amp;height=450&amp;id=u5c33718b&amp;originHeight=900&amp;originWidth=1596&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=733167&amp;status=done&amp;style=none&amp;taskId=u270a4180-918a-49e0-9127-6ee72fce136&amp;title=&amp;width=798" alt="image.png"></p><ul><li>\u6570\u636E\u5B95\u673A\u540E\u589E\u91CF\u540C\u6B65</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2023/png/21883277/1703417448526-69cf7a87-0bb1-412c-8cd2-4f11de9d0f7a.png#averageHue=%2333383d&amp;clientId=ucac032cc-6391-4&amp;from=paste&amp;height=332&amp;id=u1bd9b50f&amp;originHeight=664&amp;originWidth=1588&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=581808&amp;status=done&amp;style=none&amp;taskId=ub92c2bc2-2491-4e6b-a800-41bfc3727f9&amp;title=&amp;width=794" alt="image.png"></p><h4 id="\u9879\u76EE\u4EE3\u7801\u6838\u5FC3\u4EE3\u7801" tabindex="-1"><a class="header-anchor" href="#\u9879\u76EE\u4EE3\u7801\u6838\u5FC3\u4EE3\u7801" aria-hidden="true">#</a> \u9879\u76EE\u4EE3\u7801\u6838\u5FC3\u4EE3\u7801</h4><h5 id="\u4F9D\u8D56\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u4F9D\u8D56\u6587\u4EF6" aria-hidden="true">#</a> \u4F9D\u8D56\u6587\u4EF6</h5><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- https://mvnrepository.com/artifact/com.gitee.Jmysy/binlog4j-spring-boot-starter --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.gitee.Jmysy<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>binlog4j-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.26<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- https://mvnrepository.com/artifact/com.redislabs/jredisearch --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.redislabs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jredisearch<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h5 id="\u914D\u7F6E\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a> \u914D\u7F6E\u6587\u4EF6</h5><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">binlog4j</span><span class="token punctuation">:</span>
    <span class="token key atrule">redis-config</span><span class="token punctuation">:</span>
      <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
    <span class="token key atrule">client-configs</span><span class="token punctuation">:</span>
      <span class="token key atrule">master</span><span class="token punctuation">:</span>
        <span class="token key atrule">persistence</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># \u5F00\u542F\u5B95\u673A\u7EED\u8BFB</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">password</span><span class="token punctuation">:</span> root
        <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3306</span>
        <span class="token key atrule">serverId</span><span class="token punctuation">:</span> <span class="token number">1</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h5 id="\u6570\u636E\u57DF" tabindex="-1"><a class="header-anchor" href="#\u6570\u636E\u57DF" aria-hidden="true">#</a> \u6570\u636E\u57DF</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> pwd<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="\u9879\u76EE\u4EE3\u7801" tabindex="-1"><a class="header-anchor" href="#\u9879\u76EE\u4EE3\u7801" aria-hidden="true">#</a> \u9879\u76EE\u4EE3\u7801</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EasyBinlogApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">JedisPool</span>  jedisPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JedisPool</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/search&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">Client</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Client</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Query</span> q <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token comment">// \u8BBE\u7F6E\u67E5\u8BE2\u6761\u4EF6</span>
            <span class="token punctuation">.</span><span class="token function">setLanguage</span><span class="token punctuation">(</span><span class="token string">&quot;chinese&quot;</span><span class="token punctuation">)</span> <span class="token comment">// \u8BBE\u7F6E\u4E3A\u4E2D\u6587\u7F16\u7801</span>
            <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8FD4\u56DE\u67E5\u8BE2\u7ED3\u679C</span>
        <span class="token class-name">SearchResult</span> res <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8F93\u51FA\u67E5\u8BE2\u7ED3\u679C</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>docs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span>docs<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ConfigurableApplicationContext</span> context <span class="token operator">=</span> <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">EasyBinlogApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@BinlogSubscriber</span><span class="token punctuation">(</span>clientName <span class="token operator">=</span> <span class="token string">&quot;master&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">UserEventHandler</span> <span class="token keyword">implements</span> <span class="token class-name">IBinlogEventHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onInsert</span><span class="token punctuation">(</span><span class="token class-name">BinlogEvent</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> binlogEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;\u63D2\u5165\u6570\u636E:{}&quot;</span><span class="token punctuation">,</span> binlogEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">User</span> data <span class="token operator">=</span> binlogEvent<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;data={}&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> jedisPool<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;pwd&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span><span class="token function">getPwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Long</span> l <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token string">&quot;user:&quot;</span> <span class="token operator">+</span> data<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;\u540C\u6B65\u4E86{}\u4E2A\u8BB0\u5F55&quot;</span><span class="token punctuation">,</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onUpdate</span><span class="token punctuation">(</span><span class="token class-name">BinlogEvent</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> binlogEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onDelete</span><span class="token punctuation">(</span><span class="token class-name">BinlogEvent</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> binlogEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div>`,32);function ye(fe,ve){const a=p("ExternalLinkIcon");return l(),r(c,null,[s("blockquote",null,[s("blockquote",null,[s("ul",null,[s("li",null,[u,s("a",m,[b,e(a)])])])]),s("ul",null,[s("li",null,[k,s("a",d,[h,e(a)])]),_])]),g,s("ul",null,[y,s("li",null,[s("a",f,[v,e(a)])])]),T,s("blockquote",null,[s("p",null,[q,s("a",E,[w,e(a)]),S]),s("ul",null,[s("li",null,[I,s("a",A,[x,e(a)]),O]),s("li",null,[M,s("a",N,[L,e(a)]),D])])]),s("p",null,[C,s("a",B,[R,e(a)]),F,s("a",P,[Q,e(a)]),G,s("a",z,[U,e(a)]),X]),Y,W,H,s("blockquote",null,[s("p",null,[s("a",j,[V,e(a)]),K]),s("ul",null,[J,Z,s("li",null,[$,s("a",nn,[sn,e(a)]),an])])]),s("p",null,[en,s("a",tn,[on,e(a)]),pn]),ln,s("ul",null,[rn,cn,s("li",null,[un,s("a",mn,[bn,e(a)]),kn])]),s("blockquote",null,[s("p",null,[dn,s("a",hn,[_n,e(a)]),gn,s("a",yn,[fn,e(a)]),vn,s("a",Tn,[qn,e(a)]),En,s("a",wn,[Sn,e(a)]),In])]),An,s("blockquote",null,[s("p",null,[xn,s("a",On,[Mn,e(a)]),Nn,s("a",Ln,[Dn,e(a)]),Cn,s("a",Bn,[Rn,e(a)]),Fn,s("a",Pn,[Qn,e(a)]),Gn,s("a",zn,[Un,e(a)]),Xn])]),Yn,s("blockquote",null,[s("p",null,[Wn,s("a",Hn,[jn,e(a)]),Vn,s("a",Kn,[Jn,e(a)]),Zn])]),$n,s("blockquote",null,[s("p",null,[ns,s("a",ss,[as,e(a)]),es,s("a",ts,[os,e(a)]),ps,s("a",ls,[rs,e(a)]),cs,s("a",is,[us,e(a)]),ms,s("a",bs,[ks,e(a)]),ds])]),hs,s("blockquote",null,[s("p",null,[_s,s("a",gs,[ys,e(a)]),fs])]),vs,s("blockquote",null,[s("p",null,[s("a",Ts,[qs,e(a)]),Es,s("a",ws,[Ss,e(a)]),Is,s("a",As,[xs,e(a)]),Os,s("a",Ms,[Ns,e(a)]),Ls])]),Ds,s("blockquote",null,[s("p",null,[Cs,s("a",Bs,[Rs,e(a)]),Fs,s("a",Ps,[Qs,e(a)]),Gs,s("a",zs,[Us,e(a)]),Xs,s("a",Ys,[Ws,e(a)]),Hs,s("a",js,[Vs,e(a)]),Ks,s("a",Js,[Zs,e(a)]),$s])]),s("p",null,[na,s("a",sa,[aa,e(a)]),ea,s("a",ta,[oa,e(a)]),pa,s("a",la,[ra,e(a)]),ca,s("a",ia,[ua,e(a)]),ma,s("a",ba,[ka,e(a)]),s("a",da,[ha,e(a)]),_a,s("a",ga,[ya,e(a)]),fa]),va,s("blockquote",null,[s("p",null,[Ta,s("a",qa,[Ea,e(a)]),wa,s("a",Sa,[Ia,e(a)]),Aa,s("a",xa,[Oa,e(a)]),Ma])]),Na,La,s("blockquote",null,[s("p",null,[Da,s("a",Ca,[Ba,e(a)]),Ra,s("a",Fa,[Pa,e(a)]),Qa,s("a",Ga,[za,e(a)]),Ua,s("a",Xa,[Ya,e(a)]),Wa])]),Ha,s("blockquote",null,[s("p",null,[ja,s("a",Va,[Ka,e(a)]),Ja])]),Za,$a,s("blockquote",null,[s("p",null,[ne,s("a",se,[ae,e(a)]),ee,s("a",te,[oe,e(a)]),pe,s("a",le,[re,e(a)]),ce])]),ie,s("blockquote",null,[s("p",null,[ue,s("a",me,[be,e(a)]),ke,s("a",de,[he,e(a)]),_e])]),ge],64)}var qe=o(i,[["render",ye],["__file","MySQL\u65E5\u5FD7\u6587\u4EF6.html.vue"]]);export{qe as default};
